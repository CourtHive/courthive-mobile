"use strict";function e(){return"2.0.0-beta.6"}Object.defineProperty(exports,"__esModule",{value:!0});var t=function(){return t=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function r(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(r[n[i]]=e[n[i]])}return r}function n(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{s(n.next(e))}catch(e){a(e)}}function u(e){try{s(n.throw(e))}catch(e){a(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))}function i(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(s){return function(u){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(o=0)),o;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,n=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==u[0]&&2!==u[0])){o=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){o.label=u[1];break}if(6===u[0]&&o.label<i[1]){o.label=i[1],i=u;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(u);break}i[2]&&o.ops.pop(),o.trys.pop();continue}u=t.call(e,o)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,s])}}}function a(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function o(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,a=r.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)o.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(i)throw i.error}}return o}function u(e,t,r){if(r||2===arguments.length)for(var n,i=0,a=t.length;i<a;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function s(e,t){return(null!=e?e:0)-(null!=t?t:0)}function l(e){return"number"==typeof e?parseInt(e.toString()):parseInt(e)}function c(e){return!isNaN(e)&&(e&&0==(e&e-1))}function d(e){if(e.length){var t=u([],o(e),!1).sort(s),r=Math.floor(t.length/2);return t.length%2?t[r]:(t[r-1]+t[r])/2}}function p(e){return isNaN(e)?0:e%2&&e+1||e}function v(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function f(e){return!isNaN(parseFloat(e))}function m(e){var t=l(e);if(!isNaN(t))return 0!==t&&1==(t&-t)}function h(e){if(isNaN(e))return!1;for(;!c(e);)e++;return e}function g(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e+1))+e}function I(e){return Number.isSafeInteger("string"==typeof e?+e:e)}function y(e,t,r,n,i){void 0===i&&(i=2);var a=1-Math.random(),o=1-Math.random(),u=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return(u=u/10+.5)>1||u<0?u=y(e,t,r):(u=Math.pow(u,r),u*=t-e,u+=e),n&&(u=function(e,t){t||(t=1);var r=1/t;return Math.round(e*r)/r}(u,n)),parseFloat(u.toFixed(i))}function U(e){return null==e?void 0:e.filter((function(e,t,r){return r.lastIndexOf(e)===t}))}function S(e){return e.map((function(e){return[Math.random(),e]})).sort((function(e,t){return e[0]-t[0]})).map((function(e){return e[1]}))}function w(e){return I(e)?e:1/0}function T(e){return e.reduce((function(e,t){return e[t]||(e[t]=0),e[t]++,e}),{})}function P(e){return Object.keys(e).reduce((function(t,r){var n=e[r];return t[n]?t[n].push(r):t[n]=[r],t}),{})}function D(e,t,r){return r.indexOf(e)===t}function b(e){return e.filter(D)}function N(e){return Array.isArray(e)&&e.length?e.splice(Math.floor(Math.random()*e.length),1)[0]:void 0}function M(e){return e[Math.floor(Math.random()*e.length)]}function R(e,t){return Array.from({length:t-e},(function(t,r){return r+e}))}function A(e,t){return t.reduce((function(t,r,n){return r===e&&t.push(n),t}),[])}function E(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((function(e){return-1!==t.indexOf(e)})).filter((function(e,t,r){return r.indexOf(e)===t})):[]}function C(e,t){return Array.isArray(e)&&Array.isArray(t)?e.filter((function(e){return!t.includes(e)})):[]}function x(e,t){return!(!Array.isArray(e)||!Array.isArray(t))&&e.some((function(e){return t.includes(e)}))}function O(e,t){return e.reduce((function(e,r,n){var i=Math.floor(n/t);return e[i]=[].concat(e[i]||[],r),e}),[])}function F(e){return e.reduce((function(e,t){return!isNaN(parseInt(t))&&e}),!0)}function k(e){return e.reduce((function(e,t){return isNaN(parseInt(t))&&e}),!0)}function _(e,t,r){return e.reduce((function(e,n,i){var a=!!r&&!!(Math.floor(i/t)%2),o=i%t,u=a?t-1-o:o;return e[u]||(e[u]=[]),e[u].push(n),e}),[])}"function"==typeof SuppressedError&&SuppressedError;var L={success:!0},j={SUCCESS:L,ERROR:"error"},B={message:"Chronological error; time violation.",code:"ANACHRONISM"},V={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},G={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},q={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},W={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},H={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},z={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Y={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},K={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},J={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Z={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},X={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Q={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},$={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},ee={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},te={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},re={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},ne={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},ie={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},ae={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},oe={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},ue={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},se={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},le={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},ce={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},de={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},pe={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},ve={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},fe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},me={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},he={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},ge={message:"Invalid action",code:"ERR_INVALID_ACTION"},Ie={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},ye={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Ue={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},Se={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},we={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},Te={message:"Existing round",code:"ERR_EXISTING_ROUND"},Pe={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},De={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},be={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Ne={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Me={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Re={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Ae={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Ee={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},Ce={message:"Event exists",code:"ERR_EXISTING_EVENT"},xe={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Oe={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Fe={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},ke={message:"Missing stage",code:"ERR_MISSING_STAGE"},_e={message:"Invalid stage",code:"ERR_INVALID_STAGE"},Le={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},je={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Be={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Ve={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Ge={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qe={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},We={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},He={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},ze={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Ye={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},Ke={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Je={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Ze={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Xe={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Qe={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},$e={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},et={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},tt={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},rt={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},nt={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},it={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},at={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},ot={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},ut={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},st={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},lt={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},ct={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},dt={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},pt={message:"Missing value",code:"ERR_MISSING_VALUE"},vt={message:"Missing date",code:"ERR_MISSING_DATE"},ft={message:"No valid dates",code:"ERR_NO_VALID_DATES"},mt={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},ht={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},gt={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},It={message:"Invalid Date",code:"ERR_INVALID_DATE"},yt={message:"Invalid time",code:"ERR_INVALID_TIME"},Ut={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},St={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},wt={message:"Invalid score",code:"ERR_INVALID_SCORE"},Tt={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Pt={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},Dt={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},bt={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Nt={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},Mt={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Rt={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},At={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Et={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Ct={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},xt={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Ot={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Ft={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},kt={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},_t={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Lt={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},jt={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Bt={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Vt={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},Gt={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},qt={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},Wt={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Ht={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},zt={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},Yt={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},Kt={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},Jt={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Zt={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Xt={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},Qt={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},$t={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},er={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},tr={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},rr={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},nr={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},ir={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},ar={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},or={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},ur={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},sr={message:"Court exists",code:"ERR_EXISTING_COURT"},lr={message:"Venue exists",code:"ERR_EXISTING_VENUE"},cr={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},dr={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},pr={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},vr={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},fr={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},mr={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},hr={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},gr={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},Ir={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},yr={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},Ur={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Sr={message:"Missing context",code:"ERR_MISSING_CONTEXT"},wr={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},Tr={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},Pr={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Dr={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},br={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Nr={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Mr={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},Rr={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Ar={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Er={message:"Invalid gender",code:"ERR_INVALID_GENDER"},Cr={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},xr={message:"Invalid values",code:"ERR_INVALID_VALUES"},Or={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},Fr={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},kr={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},_r={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},Lr={message:"Value unchanged",code:"ABORT_UNCHANGED"},jr={message:"Not found",code:"ERR_NOT_FOUND"},Br={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Vr={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},Gr={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},qr={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Wr={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},Hr={message:"Existing stage",code:"ERR_EXISTING_STAGE"},zr={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Yr={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Kr={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Jr={message:"Scores present",code:"ERR_SCORES_PRESENT"},Zr={ANACHRONISM:B,CANNOT_CHANGE_WINNING_SIDE:Mt,CANNOT_MODIFY_TIEFORMAT:Dt,CANNOT_MODIFY_PARTICIPANT_TYPE:bt,CANNOT_REMOVE_MAIN_STRUCTURE:V,CANNOT_REMOVE_PARTICIPANTS:Nt,COURT_EXISTS:sr,COURT_NOT_FOUND:ur,DRAW_DEFINITION_NOT_FOUND:Z,DRAW_ID_EXISTS:ve,DRAW_POSITION_ACTIVE:ae,DRAW_POSITION_ASSIGNED:ee,DRAW_POSITION_NOT_CLEARED:re,DRAW_POSITION_NOT_FOUND:{message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},DRAW_SIZE_MISMATCH:ce,DUPLICATE_VALUE:Or,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:$t,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:Qt,EVENT_EXISTS:Ce,EVENT_NOT_FOUND:Ee,EXISTING_DRAW_DEFINITIONS:J,EXISTING_END_TIME:vr,EXISTING_FLIGHT:Vr,EXISTING_MATCHUP_ID:Wr,EXISTING_OUTCOME:qr,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Ht,EXISTING_PARTICIPANT:zt,EXISTING_POLICY_TYPE:ut,EXISTING_PROFILE:Gr,EXISTING_ROUND:Te,EXISTING_STAGE:Hr,EXISTING_STRUCTURE:zr,INCOMPATIBLE_MATCHUP_STATUS:qe,INCOMPLETE_SOURCE_STRUCTURE:Q,INSUFFICIENT_DRAW_POSITIONS:rr,INVALID_ACTION:ge,INVALID_ASSIGNMENT:Ie,INVALID_BOOKINGS:mt,INVALID_CATEGORY:Cr,INVALID_COLLECTION_DEFINITION:Rr,INVALID_CONFIGURATION:Mr,INVALID_DATE_AVAILABILITY:ht,INVALID_DATE:It,INVALID_DRAW_DEFINITION:Y,INVALID_DRAW_POSITION_FOR_SEEDING:$,INVALID_DRAW_POSITION:oe,INVALID_DRAW_SIZE:le,INVALID_END_TIME:pr,INVALID_ENTRIES:Oe,INVALID_EVENT_TYPE:Re,INVALID_GAME_SCORES:St,INVALID_GENDER:Er,INVALID_MATCHUP_FORMAT:ze,INVALID_MATCHUP_STATUS:We,INVALID_MATCHUP_STATUS_BYE:Be,INVALID_MATCHUP:tt,INVALID_OBJECT:Ar,INVALID_PARTICIPANT_ID:At,INVALID_PARTICIPANT_IDS:Et,INVALID_PARTICIPANT_ROLE:Ct,INVALID_PARTICIPANT_SEEDING:fe,INVALID_PARTICIPANT_TYPE:xt,INVALID_PARTICIPANT:Rt,INVALID_POLICY_DEFINITION:ot,INVALID_RECORDS:G,INVALID_SCALE_ITEM:Tr,INVALID_SEED_NUMBER:Ue,INVALID_SEED_POSITION:Se,INVALID_SET_NUMBER:{message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},INVALID_SIDE_NUMBER:lt,INVALID_SCORE:wt,INVALID_STAGE:_e,INVALID_START_TIME:mr,INVALID_STRUCTURE:X,INVALID_STOP_TIME:fr,INVALID_TIE_FORMAT:He,INVALID_TIME:yt,INVALID_TIME_ITEM:gr,INVALID_TOURNAMENT_DATES:Ut,INVALID_TOURNAMENT_RECORD:H,INVALID_VALUES:xr,INVALID_WINNING_SIDE:Tt,MATCHUP_NOT_FOUND:Qe,METHOD_NOT_FOUND:Yr,MISSING_ASSIGNMENTS:Fe,MISSING_ASYNC_STATE_PROVIDER:Ir,MISSING_AVOIDANCE_POLICY:it,MISSING_COLLECTION_DEFINITION:Ke,MISSING_COURT_ID:dt,MISSING_COURTS_INFO:or,MISSING_DATE_AVAILABILITY:gt,MISSING_DATE:vt,MISSING_DRAW_DEFINITION:K,MISSING_DRAW_ID:pe,MISSING_DRAW_POSITION:ue,MISSING_DRAW_POSITIONS:ie,MISSING_DRAW_SIZE:de,MISSING_ENTRIES:xe,MISSING_EVENT:Ae,MISSING_MATCHUP_FORMAT:Ye,MISSING_MATCHUP_ID:Ze,MISSING_MATCHUP_IDS:Xe,MISSING_MATCHUP:et,MISSING_MATCHUPS:$e,MISSING_PARTICIPANT_COUNT:Gt,MISSING_PARTICIPANT_ID:_t,MISSING_PARTICIPANT_IDS:Vt,MISSING_PARTICIPANT_ROLE:Ot,MISSING_PARTICIPANT:Ft,MISSING_PARTICIPANTS:kt,MISSING_PENALTY_ID:ir,MISSING_PENALTY_TYPE:nr,MISSING_PERSON_DETAILS:Wt,MISSING_POLICY_ATTRIBUTES:at,MISSING_POLICY_DEFINITION:nt,MISSING_POLICY_TYPE:rt,MISSING_POSITION_ASSIGNMENTS:je,MISSING_ROUND_NUMBER:{message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},MISSING_SCHEDULE:wr,MISSING_SCORING_POLICY:{message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},MISSING_SEED_ASSIGNMENTS:ye,MISSING_SEEDCOUNT_THRESHOLDS:he,MISSING_SEEDING_POLICY:{message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},MISSING_SET_NUMBER:{message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},MISSING_SET_OBJECT:ct,MISSING_SIDE_NUMBER:{message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},MISSING_STAGE:ke,MISSING_STRUCTURE_ID:Pe,MISSING_STRUCTURE:Ne,MISSING_STRUCTURES:be,MISSING_TARGET_LINK:we,MISSING_TIE_FORMAT:Je,MISSING_TIME_ITEM:yr,MISSING_TIME_ITEMS:Ur,MISSING_TOURNAMENT_ID:z,MISSING_TOURNAMENT_RECORD:W,MISSING_TOURNAMENT_RECORDS:q,MISSING_VALUE:pt,MISSING_VENUE_ID:dr,MODIFICATIONS_FAILED:Pr,NO_CANDIDATES:Nr,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:tr,NO_MODIFICATIONS_APPLIED:Dr,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:er,NO_PARTICIPANT_REMOVED:Bt,NO_VALID_ACTIONS:kr,NO_VALID_ATTRIBUTES:_r,NO_VALID_DATES:ft,NOT_FOUND:jr,NOT_IMPLEMENTED:Br,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:Yt,PARTICIPANT_ID_EXISTS:jt,PARTICIPANT_NOT_CHECKED_IN:qt,PARTICIPANT_NOT_FOUND:Lt,PARTICIPANT_PAIR_EXISTS:{message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PENALTY_NOT_FOUND:ar,POLICY_NOT_ATTACHED:{message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},POLICY_NOT_FOUND:st,SCHEDULE_NOT_CLEARED:te,SCHEDULED_MATCHUPS:Kr,SCORES_PRESENT:Jr,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:me,STAGE_SEQUENCE_LIMIT:Le,STRUCTURE_NOT_FOUND:De,TEAM_NOT_FOUND:Fr,UNABLE_TO_ASSIGN_COURT:br,UNLINKED_STRUCTURES:Me,UNRECOGNIZED_DRAW_TYPE:ne,UNRECOGNIZED_MATCHUP_FORMAT:Ge,UNRECOGNIZED_MATCHUP_STATUS:Ve,VALUE_UNCHANGED:Lr,VENUE_EXISTS:lr},Xr={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Qr={addNotice:function(e){var r=e.topic,n=e.payload,i=e.key;if("string"!=typeof r||"object"!=typeof n)return;Xr.disableNotifications||(Xr.modified=!0);if(Xr.disableNotifications||!Xr.subscriptions[r])return;i&&(Xr.notices=Xr.notices.filter((function(e){return!(e.topic===r&&e.key===i)})));return Xr.notices.push({topic:r,payload:n,key:i}),t({},L)},callListener:function(e){var t=e.topic,r=e.notices,n=Xr.subscriptions[t];n&&"function"==typeof n&&n(r)},cycleMutationStatus:function(){var e=Xr.modified;return Xr.modified=!1,e},deleteNotice:function(e){var t=e.topic,r=e.key;Xr.notices=Xr.notices.filter((function(e){return(!t||e.topic===t)&&e.key!==r}))},deleteNotices:function(){Xr.notices=[]},disableNotifications:function(){Xr.disableNotifications=!0},enableNotifications:function(){Xr.disableNotifications=!1},getMethods:en,getNotices:function(e){var t=e.topic,r=Xr.notices.filter((function(e){return e.topic===t})).map((function(e){return e.payload}));return r.length&&r},getTopics:function(){return{topics:Object.keys(Xr.subscriptions)}},getTournamentId:$r,getTournamentRecord:function(e){return Xr.tournamentRecords[e]},getTournamentRecords:function(){return Xr.tournamentRecords},removeTournamentRecord:function(e){if("string"!=typeof e)return{error:xr};if(!Xr.tournamentRecords[e])return{error:jr};delete Xr.tournamentRecords[e];var t=Object.keys(Xr.tournamentRecords);1===t.length?Xr.tournamentId=t[0]:t.length||(Xr.tournamentId=void 0);return{success:!0}},setMethods:function(e){return Object.keys(e).forEach((function(t){"function"==typeof e[t]&&(Xr.methods[t]=e[t])})),t({},L)},setSubscriptions:function(e){return"object"!=typeof e.subscriptions?{error:xr}:(Object.keys(e.subscriptions).forEach((function(t){Xr.subscriptions[t]=e.subscriptions[t]})),t({},L))},setTournamentId:function(e){if(!e)return Xr.tournamentId=void 0,{success:!0};return Xr.tournamentRecords[e]?(Xr.tournamentId=e,{success:!0}):{error:W}},setTournamentRecord:function(e){var t=null==e?void 0:e.tournamentId;return t?(Xr.tournamentRecords[t]=e,{success:!0}):{error:H}},setTournamentRecords:function(e){Xr.tournamentRecords=e;var t=Object.keys(e);1===t.length?Xr.tournamentId=t[0]:t.length||(Xr.tournamentId=void 0)},handleCaughtError:function(e){var t,r=e.engineName,n=e.methodName,i=e.params,a=e.err;"string"==typeof a?t=a.toUpperCase():a instanceof Error&&(t=a.message);return console.log("ERROR",{tournamentId:$r(),params:JSON.stringify(i),engine:r,methodName:n,error:t}),{error:t}}};function $r(){return Xr.tournamentId}function en(){var e;return null!==(e=Xr.methods)&&void 0!==e?e:{}}var tn={tournamentFactoryVersion:"0.0.0",timers:{default:{elapsedTime:0}},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},deepCopy:!0},rn=Qr,nn=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function an(){if(rn.createInstanceState){try{rn.createInstanceState()}catch(e){return{error:e}}return{success:!0}}return{error:Ir}}function on(e){var t;return e&&"object"==typeof e?"object"==typeof tn.devContext&&(Object.keys(e).every((function(t){var r;return(null===(r=tn.devContext)||void 0===r?void 0:r[t])===e[t]}))&&tn.devContext):null!==(t=tn.devContext)&&void 0!==t&&t}function un(e){"function"==typeof e?tn.globalLog=e:delete tn.globalLog}function sn(e){tn.devContext=e}function ln(){rn.disableNotifications()}function cn(){rn.enableNotifications()}function dn(e,t){"boolean"==typeof e&&(tn.deepCopy=e),"object"==typeof t&&(Array.isArray(t.ignore)&&(tn.deepCopyAttributes.ignore=t.ignore),Array.isArray(t.toJSON)&&(tn.deepCopyAttributes.toJSON=t.toJSON),Array.isArray(t.stringify)&&(tn.deepCopyAttributes.stringify=t.stringify),t.threshold&&(tn.deepCopyAttributes.threshold=t.threshold))}function pn(){return t({enabled:tn.deepCopy},tn.deepCopyAttributes)}function vn(e){return e?"object"!=typeof e?{error:xr}:rn.setMethods(e):{error:pt,info:"missing method declarations"}}function fn(){return rn.cycleMutationStatus()}function mn(e){return rn.addNotice(e)}function hn(){return rn.getMethods()}function gn(e){return rn.getNotices(e)}function In(e){var t=e.key,r=e.topic;return rn.deleteNotice({key:t,topic:r})}function yn(){return rn.deleteNotices()}function Un(){return rn.getTopics()}function Sn(e){return n(this,void 0,void 0,(function(){return i(this,(function(t){return[2,rn.callListener(e)]}))}))}function wn(){return rn.getTournamentId()}function Tn(e){return rn.getTournamentRecord(e)}function Pn(){return rn.getTournamentRecords()}function Dn(e){return rn.setTournamentRecord(e)}function bn(e){return rn.setTournamentRecords(e)}function Nn(e){return rn.setTournamentId(e)}function Mn(e){return rn.removeTournamentRecord(e)}function Rn(){return rn}function An(e){var t=e.engineName,r=e.methodName,n=e.params,i=e.err;return("function"==typeof rn.handleCaughtError&&rn.handleCaughtError||Qr.handleCaughtError)({engineName:t,methodName:r,params:n,err:i})}function En(e,t){if(tn.globalLog)try{tn.globalLog({engine:e,log:t})}catch(r){console.log("globalLog error",r),console.log(e,t),un()}else console.log(e,t)}var Cn={__proto__:null,addNotice:mn,callListener:Sn,createInstanceState:an,cycleMutationStatus:fn,deepCopyEnabled:pn,deleteNotice:In,deleteNotices:yn,disableNotifications:ln,enableNotifications:cn,getDevContext:on,getMethods:hn,getNotices:gn,getProvider:Rn,getTopics:Un,getTournamentId:wn,getTournamentRecord:Tn,getTournamentRecords:Pn,globalLog:En,handleCaughtError:An,removeTournamentRecord:Mn,setDeepCopy:dn,setDevContext:sn,setGlobalLog:un,setMethods:vn,setStateProvider:function(e){if("object"!=typeof e)throw new Error("Global state provider can not be undefined or null");if(E(Object.keys(e),nn).length!==nn.length)throw new Error("Global state provider is missing required methods");return rn=e,{success:!0}},setSubscriptions:function(e){return(null==e?void 0:e.subscriptions)?rn.setSubscriptions({subscriptions:e.subscriptions}):{error:pt,info:"missing subscriptions"}},setTournamentId:Nn,setTournamentRecord:Dn,setTournamentRecords:bn,timeKeeper:function(e,t){var r,n,i,a;void 0===e&&(e="reset"),void 0===t&&(t="default");var o=Date.now();if("report"===e){if("allTimers"===t)return Object.keys(tn.timers).filter((function(e){return"default"!==e||tn.timers[e].startTime})).map((function(e){var t,r=tn.timers[e],n="stopped"===r.state?0:(o-(null!==(t=null==r?void 0:r.startTime)&&void 0!==t?t:0))/1e3,i=r.elapsedTime+n;return{state:tn.timers[e].state,elapsedTime:i.toFixed(2),timer:e}}));var u="stopped"===tn.timers[t].state?0:(o-(null!==(n=null===(r=tn.timers[t])||void 0===r?void 0:r.startTime)&&void 0!==n?n:0))/1e3,s=tn.timers[t].elapsedTime+u;return{state:tn.timers[t].state,elapsedTime:s.toFixed(2),timer:t}}if(!tn.timers[t]||"reset"===e){if("allTimers"===t)return tn.timers={default:{elapsedTime:0}},!0;tn.timers[t]={startTime:o,state:"active",elapsedTime:0}}return tn.timers[t].elapsedTime||(tn.timers[t].elapsedTime=0),"stop"===e&&"stopped"!==tn.timers[t].state&&(tn.timers[t].state="stopped")&&(tn.timers[t].elapsedTime+=(o-(null!==(a=null===(i=tn.timers[t])||void 0===i?void 0:i.startTime)&&void 0!==a?a:0))/1e3),"start"===e&&(tn.timers[t].startTime=o)&&(tn.timers[t].state="active"),tn.timers[t]}};function xn(e,t,r,n){if("object"!=typeof e||null===e)return e;var i=pn();(null==i?void 0:i.enabled)||(n=!0);var a=["",void 0,null];t&&a.push(!1);var s=function(e,t,r){return Object.keys(e).filter((function(n){return!t.includes(e[n])&&(!r||!Array.isArray(e[n])||e[n].length)}))}(e,a,r);return Object.assign.apply(Object,u([{}],o(s.map((function(t){var r,i;return Array.isArray(e[t])?((r={})[t]=n?e[t]:e[t].map((function(e){return xn(e)})),r):((i={})[t]=n?e[t]:xn(e[t]),i)}))),!1))}function On(e){var r=e.context,n=e.result,i=e.stack,a=e.info;return n&&!Array.isArray(null==n?void 0:n.stack)&&(n.stack=[]),n&&Array.isArray(null==n?void 0:n.stack)&&"string"==typeof i&&n.stack.push(i),n&&a&&(n.info=a),n&&"object"==typeof r&&Object.keys(r).length&&Object.assign(n,xn(r)),!n||(null==n?void 0:n.error)||(null==n?void 0:n.success)||Object.assign(n,t({},L)),null!=n?n:{success:!0}}var Fn="element required",kn="missing name";function _n(e){var r,n;if(!e||"object"!=typeof e)return{error:pt};if(e.element&&"object"!=typeof(null==e?void 0:e.element))return{error:xr};if(!(null==e?void 0:e.name))return{error:pt,info:kn};if(!(null==e?void 0:e.element)){if(e.discover&&e.tournamentRecords){try{for(var i=a(Object.keys(e.tournamentRecords)),o=i.next();!o.done;o=i.next()){var u=o.value,s=_n({element:e.tournamentRecords[u],name:e.name});if(s.error)return On({result:s,stack:"removeExtension"})}}catch(e){r={error:e}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return t({},L)}return{error:pt,info:Fn}}return(null==e?void 0:e.element.extensions)?(e.element.extensions=e.element.extensions.filter((function(t){return(null==t?void 0:t.name)!==e.name})),t({},L)):t(t({},L),{info:jr})}function Ln(e){var t=e.requiredAttributes,r=void 0===t?["name","value"]:t,n=e.extension;if(!n||"object"!=typeof n)return!1;if("string"!=typeof n.name)return!1;var i=Object.keys(n);return r.filter((function(e){return i.includes(e)})).length===r.length}function jn(e){var r,n,i;if("object"!=typeof e)return{error:pt};var o="addExtension";if((null==e?void 0:e.element)&&"object"!=typeof e.element)return On({result:{error:xr},stack:o});if(!Ln({extension:e.extension}))return On({result:{error:xr,info:"invalid extension"},stack:o});if(!e.element){if(e.discover&&!e.tournamentId&&e.tournamentRecords){try{for(var u=a(Object.values(e.tournamentRecords)),s=u.next();!s.done;s=u.next()){var l=s.value,c=jn({extension:e.extension,element:l});if(c.error)return On({result:c,stack:o})}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return t({},L)}return On({result:{error:pt},stack:o})}if(e.element.extensions||(e.element.extensions=[]),null===(i=null==e?void 0:e.creationTime)||void 0===i||i){var d=(new Date).toISOString();Object.assign(e.extension,{createdAt:d})}var p=e.element.extensions.find((function(t){return t.name===e.extension.name}));return p?p.value=e.extension.value:e.extension.value&&e.element.extensions.push(e.extension),t({},L)}var Bn="extensionQueries";function Vn(e){var t,n=e.discover,i=e.element,a=e.name,o=r(e,["discover","element","name"]);if(!i||!a){if(n&&o){var u=Object.keys(o).filter((function(e){return"boolean"==typeof n||Array.isArray(n)&&n.includes(e)})).find((function(e){var t;return!!Array.isArray(null===(t=o[e])||void 0===t?void 0:t.extensions)&&o[e].extensions.find((function(e){return(null==e?void 0:e.name)===a}))})),s=u&&o[u];!s&&o.tournamentRecords&&(s=Object.values(o.tournamentRecords).find((function(e){var t;return null===(t=e.extensions)||void 0===t?void 0:t.length})));var l=null===(t=null==s?void 0:s.extensions)||void 0===t?void 0:t.find((function(e){return(null==e?void 0:e.name)===a}));return{extension:l,info:l?void 0:jr}}return On({result:{error:pt},stack:Bn})}if(!Array.isArray(i.extensions))return{info:"no extensions"};var c=i.extensions.find((function(e){return(null==e?void 0:e.name)===a}));return{extension:c,info:c?void 0:jr}}var Gn=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,qn=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Wn=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Hn=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function zn(e){var t=e.scheduledDate;if(!t&&e.scheduledTime&&(t=ui(e.scheduledTime)),t){var r=oi(e.scheduledTime),n=ui(t);return n&&r&&(n+="T".concat(r)),n}}function Yn(e){return"object"==typeof e&&!Array.isArray(e)&&"[object Date]"===Object.prototype.toString.call(e)}function Kn(e){var t="string"==typeof e?null==e?void 0:e.split(" "):[];return!(e&&(null==t?void 0:t.length)>1&&!["AM","PM"].includes(t[1].toUpperCase()))&&!(e&&!Hn.test(ci(e,!0,!0)))}function Jn(e){return ri(e)||Gn.test(e)}var Zn=function(e){var t=$n(e)||ri(e)?new Date(e):new Date,r=t.getUTCMonth()+1,n=r<10?"0".concat(r):"".concat(r);return"".concat(t.getUTCFullYear(),"-").concat(gi(n),"-").concat(gi(t.getUTCDate()))};function Xn(e,t,r){if(void 0===t&&(t="-"),void 0===r&&(r="YMD"),!e)return"";"string"==typeof e&&e.indexOf("T")<0&&(e+="T00:00");var n=new Date(e),i=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),"DMY"===r?[a,i,o].join(t):"MDY"===r?[i,a,o].join(t):"YDM"===r?[o,a,i].join(t):"DYM"===r?[a,o,i].join(t):"MYD"===r?[i,o,a].join(t):[o,i,a].join(t)}function Qn(e){var t=e?new Date(e):new Date,r=t.getTimezoneOffset();return new Date(t.getTime()-60*r*1e3)}function $n(e){if("boolean"==typeof e)return!1;var t=e instanceof Date&&e||!isNaN(e)&&new Date(e)||!1;return t&&!isNaN(t.valueOf())}function ei(e,t){if(!Jn(e)||!Jn(t))return[];var r=ui(e)+"T00:00",n=ui(t)+"T00:00",i=new Date(r),a=new Date(n),o=[],u=0;if($n(a)&&$n(i)&&i<=a)for(var s=i,l=s.getTime();l<=a.getTime()&&u<300;)u+=1,o.push(new Date(s)),l=s.setDate(s.getDate()+1);return o.map((function(e){return Xn(e)}))}var ti=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function ri(e){return"string"==typeof e&&ti.test(e)}function ni(e){if("string"!=typeof e)return!1;var t=e.split("Z")[0].split(":"),r=t.every((function(e){return!isNaN(parseInt(e))}));return!(t.length<2||!r||parseInt(t[0])>23||parseInt(t[1])>60)}function ii(e){var t=oi(e);if(!t)return 0;var r=o(t.split(":").map((function(e){return parseInt(e)})),2);return 60*r[0]+r[1]}function ai(e){return ni(e)?e.split(":").slice(0,2).map(gi).join(":"):void 0}function oi(e){return ri(e)&&e.indexOf("T")>0?ai(e.split("T").reverse()[0]):ai(e)}function ui(e){return ri(e)||Wn.test(e)?e.split("T")[0]:void 0}function si(e,t){var r=new Date(e);return r.setDate(r.getDate()+t),ui(r.toISOString())}function li(e){var t,r,n={},i={};return t=(e="string"!=typeof e?"00:00":e).split(" ")||[],n.time=t[0],n.ampm=t[1],r=n.time.split(":")||[],i.hours=r[0],i.minutes=r[1],i.ampm=n.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function ci(e,t,r){var n=ui(e),i=oi(e),a=n?i:e;return e?t&&(n&&r&&e||function(e){var t=li(e);return t.ampm&&t.hours&&("pm"===t.ampm.toLowerCase()&&parseInt(t.hours)<12&&(t.hours=(t.hours&&parseInt(t.hours)||0)+12),"am"===t.ampm.toLowerCase()&&"12"===t.hours&&(t.hours="00")),"".concat(t.hours||"12",":").concat(t.minutes||"00").split(":").map(gi).join(":")}(a))||function(e){var t,r=li(e);if("object"!=typeof r||Object.keys(r).length)return r.ampm?e:(r.hours>12?(r.hours-=12,r.ampm="PM"):"12"===r.hours?r.ampm="PM":"00"===r.hours?(r.hours="12",r.ampm="AM"):r.ampm="AM","0"===(null===(t=r.hours)||void 0===t?void 0:t[0])&&(r.hours=r.hours.slice(1)),"".concat(r.hours||"12",":").concat(r.minutes||"00"," ").concat(r.ampm))}(a):void 0}function di(e,t){var r=li(e),n=li(t);if(parseInt(r.hours)<parseInt(n.hours))return-1;if(parseInt(r.hours)>parseInt(n.hours))return 1;if(r.hours===n.hours){if(parseInt(r.minutes)<parseInt(n.minutes))return-1;if(parseInt(r.minutes)>parseInt(n.minutes))return 1}return 0}function pi(e,t){void 0===t&&(t=7);var r=ui(e)+"T00:00",n=new Date(r);return Xn(new Date(n.setDate(n.getDate()+t)))}function vi(e,t){void 0===t&&(t=void 0);var r=o((e||"00:00").split(":").map(gi),2),n=r[0],i=r[1],a=Qn(t).setHours(n,i,0,0);return Qn(a)}function fi(e,t,r){void 0===r&&(r=!0);var n=new Date(e),i=(new Date(t).getTime()-n.getTime())/1e3/60;return r?Math.abs(Math.round(i)):Math.round(i)}function mi(e,t){var r=oi(e);if(!r)return"00:00";var n=isNaN(t)?0:t;return oi(hi(vi(r),n).toISOString())}function hi(e,t){var r=new Date(e);return new Date(r.getTime()+6e4*t)}function gi(e){return e.toString()[1]?e:"0"+e}function Ii(e,t){var r=new Date(e),n=new Date(t);return r.getFullYear()===n.getFullYear()&&r.getMonth()===n.getMonth()&&r.getDate()===n.getDate()}var yi={addDays:pi,addWeek:function(e){return pi(e)},addMinutesToTimeString:mi,convertTime:ci,getIsoDateString:zn,getUTCdateString:Zn,DateHHMM:function(e){var t,r,n,i,a,o=new Date(e),u=o.getSeconds()+60*o.getMinutes()+3600*o.getHours();return t={displaySeconds:!1},r=parseInt(u,10),n=Math.floor(r/3600),i=Math.floor((r-3600*n)/60),a=r-3600*n-60*i,(!t||(null==t?void 0:t.displaySeconds)?n+":"+i+":"+a:n+":"+i).split(":").map(gi).join(":")},extractDate:ui,extractTime:oi,formatDate:Xn,getDateByWeek:function(e,t,r,n){void 0===n&&(n=!1);var i=new Date(t,0,1+7*(e-1)),a=n?0:1;return i.setDate(i.getDate()+(a-i.getDay())),Xn(i,r)},isISODateString:ri,isDate:$n,isTimeString:ni,offsetDate:Qn,offsetTime:function(e){return Qn(e).getTime()},sameDay:Ii,timeStringMinutes:ii,timeToDate:vi,timeUTC:function(e){var t=$n(e)||ri(e)?new Date(e):new Date;return Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())},validTimeValue:Kn,validDateString:Gn,timeValidation:Hn,dateValidation:Wn};function Ui(e,t,r,n,i){var s,l;if(void 0===i&&(i=0),Rn().makeDeepCopy)return Rn().makeDeepCopy(e,t,r,n);var c=pn(),d=c||{},p=d.stringify,v=d.toJSON,f=d.ignore,m=d.modulate;if(!(null==c?void 0:c.enabled)&&!r||"object"!=typeof e||"function"==typeof e||null===e||"number"==typeof(null==c?void 0:c.threshold)&&i>=c.threshold)return e;var h=Array.isArray(e)?[]:{},g=Object.keys(e).filter((function(e){return!r||!f||Array.isArray(f)&&!f.includes(e)||"function"==typeof f&&!f(e)})),I=function(e,t){h[e]="function"==typeof(null==t?void 0:t.toString)?t.toString():JSON.stringify(t)};try{for(var y=a(g),U=y.next();!U.done;U=y.next()){var S=U.value,w=e[S],T="function"==typeof m?m(w):void 0;if(void 0!==T)h[S]=T;else if(t&&"extensions"===S&&Array.isArray(w)){var P=Si(w);Object.assign.apply(Object,u([h],o(P),!1))}else n&&"extensions"===S?h[S]=[]:Array.isArray(p)&&p.includes(S)?I(S,w):Array.isArray(v)&&v.includes(S)&&"function"==typeof(null==w?void 0:w.toJSON)?h[S]=w.toJSON():null===w?h[S]=void 0:Yn(w)?h[S]=new Date(w).toISOString():h[S]=Ui(w,t,r,n,i+1)}}catch(e){s={error:e}}finally{try{U&&!U.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}return h}function Si(e){return null==e?void 0:e.map((function(e){var t,r=e.name,n=e.value;return r&&n&&((t={})["_".concat(r)]=n,t)})).filter(Boolean)}function wi(e){var t=e.element,r=e.accessor;if("string"!=typeof r)return{values:[]};var n,i=Ui(t),u=r.split("."),s=[];!function e(t){var r,i,u=t.targetElement,l=t.attributes,c=void 0===l?[]:l,d=t.significantCharacters,p=function(t,r){if(null==u?void 0:u[r]){var i=c.slice(t+1);if(i.length)if(Array.isArray(u[r])){u[r].forEach((function(t){return e({targetElement:t,attributes:i})}))}else!function(e){var t=e.targetElement,r=e.index;if(t&&r===c.length-1&&["string","number"].includes(typeof t)){var i=d?t.slice(0,d):t;n?s.includes(i)||s.push(i):(n=i,s.push(i))}}({targetElement:u=u[r],index:t});else n||(n=u[r]),s.includes(u[r])||s.push(u[r])}};try{for(var v=a(c.entries()),f=v.next();!f.done;f=v.next()){var m=o(f.value,2);p(m[0],m[1])}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(r)throw r.error}}}({targetElement:i,attributes:u});var l={value:n};return s.length&&(l.values=s),l}function Ti(e){return"function"==typeof e}function Pi(e){return"string"==typeof e}function Di(e){return null!==e&&"object"==typeof e&&!Array.isArray(e)}function bi(e,t){var r,n;if(!Di(e)||!Di(t))return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;try{for(var u=a(i),s=u.next();!s.done;s=u.next()){var l=s.value;if(e[l]!==t[l])return!1}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return!0}function Ni(e,t){return Array.isArray(e)?Object.assign.apply(Object,u([{}],o((null!=e?e:[]).filter(Di).map((function(e){var r;return e[t]&&((r={})[e[t]]=e,r)})).filter(Boolean)),!1)):{}}var Mi=function(e){return function(t){var r;return e&&"object"==typeof t?Array.isArray(e)&&e.map((function(e){var r,n;return(r={})[e]=null===(n=wi({element:t,accessor:e}))||void 0===n?void 0:n.value,r}))||"object"==typeof e&&Object.keys(e).map((function(e){var r,n;return(r={})[e]=null===(n=wi({element:t,accessor:e}))||void 0===n?void 0:n.value,r}))||(null===(r="string"==typeof e&&wi({element:t,accessor:e}))||void 0===r?void 0:r.value):void 0}},Ri=Mi;function Ai(e){return Array.isArray(e)?e.length+e.map(Ai).reduce((function(e,t){return e+t}),0):"object"==typeof e&&null!==e?Object.keys(e).length+Object.keys(e).map((function(t){return Ai(e[t])})).reduce((function(e,t){return e+t}),0):0}var Ei,Ci,xi="tournamentRecords",Oi="policyDefinitions",Fi="tournamentRecord",ki="drawDefinition",_i="matchUpFormat",Li="participantId",ji="scheduleDates",Bi="structureId",Vi="participant",Gi="matchUpIds",qi="structures",Wi="matchUpId",Hi="inContext",zi="structure",Yi="courtIds",Ki="venueIds",Ji="matchUps",Zi="courtId",Xi="eventId",Qi="matchUp",$i="drawId",ea="error",ta="event",ra="param",na="object",ia="array",aa="validate",oa="invalid",ua="_ofType",sa="_oneOf",la=((Ei={})[xi]=q,Ei[Fi]=W,Ei[Oi]=nt,Ei[ki]=K,Ei[Li]=_t,Ei.tournamentId=z,Ei[Bi]=Pe,Ei[Gi]=Xe,Ei[Vi]=Ft,Ei[qi]=be,Ei[Wi]=Ze,Ei[zi]=Ne,Ei[Zi]=dt,Ei[Ji]=$e,Ei[Qi]=et,Ei[Yi]=pt,Ei[Ki]=pt,Ei[$i]=pe,Ei[Xi]=Ae,Ei[ta]=Ee,Ei),ca=((Ci={})[xi]=na,Ci[Oi]=na,Ci[Fi]=na,Ci[ki]=na,Ci[ji]=ia,Ci[Vi]=na,Ci[Gi]=ia,Ci[qi]=ia,Ci[zi]=na,Ci[Yi]=ia,Ci[Ki]=ia,Ci[Ji]=ia,Ci[Qi]=na,Ci[ta]=na,Ci.uuids=ia,Ci);function da(e,n,i){if(!e&&!Di(e))return{error:xr};if(!(null==n?void 0:n.length)||(null==e?void 0:e._bypassParamCheck))return{valid:!0};if(!Array.isArray(n))return{error:xr};var a=function(e,n){var i,a=n.find((function(n){var a=n._ofType,o=n._oneOf,u=n._anyOf,s=n.validate,l=r(n,["_ofType","_oneOf","_anyOf","validate"]),c=o&&function(e,r){if(!r)return;var n=pa(e,r);return 1!==n.length?{error:xr}:n.reduce((function(e,r){var n;return t(t({},e),((n={})[r]=!0,n))}),{})}(e,o);if(null==c?void 0:c.error)return c.error;c&&Object.assign(l,c);var d=u&&function(e,r){if(!r)return;var n=pa(e,r).filter((function(t){return e[t]}));return n.length<1?{error:xr}:n.reduce((function(e,r){var n;return t(t({},e),((n={})[r]=!0,n))}),{})}(e,u);if(null==d?void 0:d.error)return d.error;d&&Object.assign(l,d);var p=Object.keys(l).filter((function(e){return"boolean"==typeof l[e]})),v=p.find((function(t){var r=s&&!Ti(s),n=e[t]&&!s&&function(e,t,r){if(r=r||ca[t]||"string","array"===r)return!Array.isArray(e[t]);return typeof e[t]!==r}(e,t,a),o=l[t]&&!e[t],u=r||n||o||s&&e[t]&&!function(e,t){return!Ti(t)||t(e)}(e[t],s);return u&&(i=t),u}));return!p.length||v}));return{paramError:a,errorParam:i}}(e,n),o=a.paramError,u=a.errorParam;return o?On({info:{param:u},result:{error:void 0===e[u]?la[u]||xr:o.validate&&o.invalid||xr},stack:i}):{valid:!0}}function pa(e,t){return E(Object.keys(e),Object.keys(t))}var va="SINGLES",fa="SINGLES",ma="DOUBLES",ha="DOUBLES",ga="TEAM",Ia="TEAM",ya={AGE:"AGE",BOTH:"BOTH",DOUBLES:ma,DOUBLES_EVENT:ha,RATING:"RATING",SINGLES:va,SINGLES_EVENT:fa,TEAM_EVENT:Ia,TEAM:ga},Ua="DYNAMIC",Sa="RANKING",wa="RATING",Ta="SCALE",Pa="SEEDING",Da={RANKING:Sa,RATING:wa,SCALE:Ta,SEEDING:Pa};function ba(e){var r,n,i,u,s=da(e,[(r={},r[Vi]=!0,r)]);if(s.error)return s;var l=null===(u=e.participant.timeItems)||void 0===u?void 0:u.filter((function(e){var t=e.itemType;return(null==t?void 0:t.startsWith(Ta))&&[Sa,wa,Pa].includes(t.split(".")[1])})),c={ratings:{},rankings:{},seedings:{}};if(null==l?void 0:l.length){var d=function(e){return l.filter((function(t){return(null==t?void 0:t.itemType)===e})).sort((function(e,t){return new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime()})).pop()},p=U(l.map((function(e){return e.itemType})));try{for(var v=a(p),f=v.next();!f.done;f=v.next()){var m=d(f.value);if(m){var h=o(m.itemType.split("."),5),g=h[1],I=h[2],y=h[3],S=h[4],w=S?"".concat(y,".").concat(S):y,T=(g===Pa?"seedings":g===Sa&&"rankings")||"ratings";c[T][I]||(c[T][I]=[]),c[T][I].push({scaleValue:m.itemValue,scaleDate:m.itemDate,scaleName:w})}}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}return t(t({},L),c)}function Na(e){if(null===e)return{};var t=e||{},r=t.source,n=t.template;if(!n)return r;var i={};return function e(t,r,n){var i,s;if(!t||!r)return;var l=Object.keys(t),c=Object.keys(r),d=Object.assign.apply(Object,u([{}],o(c.filter((function(e){return e.indexOf("||")})).map((function(e){return e.split("||").map((function(t){var r;return(r={})[t]=e,r}))})).flat()),!1)),p=c.concat.apply(c,u([],o(Object.keys(d)),!1)),v=p.includes("*"),f=function(i){if(p.indexOf(i)>=0||v){var a=d[i]||i,o=r[a]||v,u=t[i];if("object"!=typeof o||"function"==typeof u||Array.isArray(o)){var s=t[i];if(Array.isArray(o)&&!o.includes(s))return{value:!1};(r[i]||v&&!1!==r[i])&&(n[i]=s)}else if(Array.isArray(u)){var l=u.map((function(t){var r={};return!1!==e(t,o,r)?r:void 0})).filter(Boolean);n[i]=l}else u&&(n[i]={},e(u,o,n[i]))}};try{for(var m=a(l),h=m.next();!h.done;h=m.next()){var g=f(h.value);if("object"==typeof g)return g.value}}catch(e){i={error:e}}finally{try{h&&!h.done&&(s=m.return)&&s.call(m)}finally{if(i)throw i.error}}return}(r,n,i),i}var Ma="voluntaryConsolation",Ra="competitiveBands",Aa="roundRobinTally",Ea="positionActions",Ca="matchUpActions",xa="rankingPoints",Oa="roundNaming",Fa="participant",ka="progression",_a="scheduling",La="avoidance",ja="scoring",Ba="seeding",Va="feedIn",Ga="draws",qa={POLICY_TYPE_VOLUNTARY_CONSOLATION:Ma,POLICY_TYPE_COMPETITIVE_BANDS:Ra,POLICY_TYPE_ROUND_ROBIN_TALLY:Aa,POLICY_TYPE_POSITION_ACTIONS:Ea,POLICY_TYPE_MATCHUP_ACTIONS:Ca,POLICY_TYPE_RANKING_POINTS:xa,POLICY_TYPE_ROUND_NAMING:Oa,POLICY_TYPE_PARTICIPANT:Fa,POLICY_TYPE_PROGRESSION:ka,POLICY_TYPE_SCHEDULING:_a,POLICY_TYPE_AVOIDANCE:La,POLICY_TYPE_DISPLAY:"display",POLICY_TYPE_FEED_IN:Va,POLICY_TYPE_SCORING:ja,POLICY_TYPE_SEEDING:Ba,POLICY_TYPE_AUDIT:"audit",POLICY_TYPE_DRAWS:Ga};function Wa(e){var t=e.tournamentParticipants,r=void 0===t?[]:t,n=e.policyDefinitions,i=void 0===n?{}:n,a=e.contextProfile,o=e.participantId,u=e.internalUse,s=e.personId,l=Ui(r.find((function(e){return o&&e.participantId===o||s&&e.person&&e.person.personId===s})),!1,u);if(l){var c=null==i?void 0:i[Fa];if(null==a?void 0:a.withScaleValues){var d=ba({participant:l}),p=d.ratings,v=d.rankings;l.rankings=v,l.ratings=p}if(null==c?void 0:c.participant)return Na({template:c.participant,source:l})}return l}function Ha(e){return e&&"object"==typeof e?e.tournamentRecord?jn({creationTime:e.creationTime,element:e.tournamentRecord,extension:e.extension}):{error:W}:{error:pt}}function za(e){return e&&"object"==typeof e?e.drawDefinition?jn({creationTime:e.creationTime,element:e.drawDefinition,extension:e.extension}):{error:Z}:{error:pt}}function Ya(e){return e&&"object"==typeof e?e.event?jn({creationTime:e.creationTime,extension:e.extension,element:e.event}):{error:Ee}:{error:pt}}function Ka(e){return e&&"object"==typeof e?e.tournamentRecord?_n({element:e.tournamentRecord,name:e.name}):{error:W}:{error:pt}}function Ja(e){return e&&"object"==typeof e?(null==e?void 0:e.event)?_n({element:e.event,name:e.name}):{error:Ee}:{error:pt}}var Za="appliedPolicies",Xa="positionActions",Qa="context",$a="delegatedOutcome",eo="disabled",to="disableLinks",ro="disableAutoCalc",no="drawDeletions",io="entryProfile",ao="flightProfile",oo="groupingAttribute",uo="lineUps",so="linkedTournamentsIds",lo="matchUpHistory",co="participantRepresentatives",po="personRequests",vo="rankingPoints",fo="roundTarget",mo="scheduleLimits",ho="scheduleTiming",go="schedulingProfile",Io="subOrder",yo="tally",Uo="tieFormatModification",So={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:Za,AUDIT_POSITION_ACTIONS:Xa,CONTEXT:Qa,DELEGATED_OUTCOME:$a,DISABLED:eo,DISABLE_LINKS:to,DISABLE_AUTO_CALC:ro,DRAW_DELETIONS:no,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:io,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:ao,GROUPING_ATTRIBUTE:oo,LINEUPS:uo,LINKED_TOURNAMENTS:so,MATCHUP_HISTORY:lo,PARTICIPANT_REPRESENTATIVES:co,PERSON_REQUESTS:po,RANKING_POINTS:vo,ROUND_TARGET:fo,SCHEDULE_LIMITS:mo,SCHEDULE_TIMING:ho,SCHEDULING_PROFILE:go,STATUS_DETAIL:"statusDetail",SUB_ORDER:Io,TALLY:yo,TIE_FORMAT_MODIFICATIONS:Uo,FACTORY:"factory"},wo=[$a,eo,to,ao,uo,lo,co,po,fo,mo,ho,go,Io,yo];function To(e){var r=e.tournamentRecords,n=Di(r)?Object.keys(r):[];return t({tournamentIds:n},L)}var Po={linkTournaments:function(e){var r=e.tournamentRecords;if("object"!=typeof r||!Object.keys(r).length)return{error:q};var n=To({tournamentRecords:r}).tournamentIds;return(null==n?void 0:n.length)>1?jn({tournamentRecords:r,discover:!0,extension:{name:so,value:{tournamentIds:n}}}):t({},L)},unlinkTournament:function(e){var r=e.tournamentRecords,n=e.tournamentId;if("object"!=typeof r)return{error:xr};if(!n)return{error:z};var i,a=To({tournamentRecords:r}).tournamentIds;return a.includes(n)?(a.every((function(e){var t,a=r[e],o=Vn({element:a,name:so}).extension;if(!o)return!0;var u=(null===(t=null==o?void 0:o.value)||void 0===t?void 0:t.tournamentIds)||[];if(!(null==u?void 0:u.length)||1===u.length&&u.includes(n)||e===n){var s=Ka({name:so,tournamentRecord:a});return s.error&&(i=s.error),s.success}var l=u.filter((function(e){return e!==n}));o.value={tournamentIds:l};var c=Ha({tournamentRecord:a,extension:o});return c.error&&(i=c.error),c.success})),i?{error:i}:t({},L)):{error:z}},unlinkTournaments:function(e){var t=e.tournamentRecords;return"object"==typeof t&&Object.keys(t).length?On({result:_n({name:so,tournamentRecords:t,discover:!0}),stack:"unlinkTournaments"}):{error:q}}},Do=function(e){return function(t){return e[t]}},bo=function(e){return void 0===e&&(e=[]),e.map(Ro).filter(Boolean)},No=function(e){return void 0===e&&(e=[]),e.map(Mo).filter(Boolean)},Mo=function(e){return void 0===e&&(e={}),Do(e)("participantId")},Ro=function(e){return void 0===e&&(e={}),Do(e)("matchUpId")};var Ao,Eo,Co,xo="ABANDONED",Oo="AWAITING_RESULT",Fo="BYE",ko="CANCELLED",_o="COMPLETED",Lo="DEAD_RUBBER",jo="DEFAULTED",Bo="DOUBLE_DEFAULT",Vo="DOUBLE_WALKOVER",Go="IN_PROGRESS",qo="INCOMPLETE",Wo="NOT_PLAYED",Ho="RETIRED",zo="SUSPENDED",Yo="TO_BE_PLAYED",Ko="WALKOVER",Jo=[Oo,_o,jo,Go,qo,Ho,zo],Zo=[Oo,_o,jo,Vo,Bo,Go,qo,Ho,zo,Ko],Xo=[xo,Oo,Fo,ko,_o,Lo,jo,Vo,Bo,Go,qo,Wo,Ho,zo,Yo,Ko],Qo=[Fo,Vo,Bo,_o,jo,Ho,Ko],$o=[xo,Oo,ko,Lo,Go,qo,Wo,zo,Yo,void 0],eu=[ko,xo,_o,Lo,jo,Vo,Bo,Ho,Ko],tu=[xo,_o,jo,Vo,Bo,Go,Ho,Ko],ru=[Go,qo,zo,Yo],nu={ABANDONED:xo,AWAITING_RESULT:Oo,BYE:Fo,CANCELLED:ko,COMPLETED:_o,DEAD_RUBBER:Lo,DEFAULTED:jo,DOUBLE_WALKOVER:Vo,DOUBLE_DEFAULT:Bo,IN_PROGRESS:Go,INCOMPLETE:qo,NOT_PLAYED:Wo,RETIRED:Ho,SUSPENDED:zo,TO_BE_PLAYED:Yo,WALKOVER:Ko},iu="MAIN",au="QUALIFYING",ou="CONSOLATION",uu="VOLUNTARY_CONSOLATION",su="PLAY_OFF",lu=[iu,au,ou,su,uu],cu=((Ao={})[au]=1,Ao[iu]=2,Ao[su]=3,Ao[ou]=3,Ao[uu]=4,Ao),du="finishingPositions",pu="aggregateEventStructures",vu=((Eo={})[iu]=1,Eo[su]=2,Eo[ou]=3,Eo[au]=4,Eo[uu]=5,Eo),fu=((Co={})[su]=1,Co[iu]=2,Co[ou]=3,Co[au]=4,Co[uu]=5,Co),mu="CLUSTER",hu="WATERFALL",gu="ITEM",Iu="CONTAINER",yu="DRAW",Uu="RANDOM",Su="TOP_DOWN",wu="BOTTOM_UP",Tu="POSITION",Pu="WINNER",Du="LOSER",bu="FIRST_MATCHUP",Nu="AD_HOC",Mu="FEED_IN",Ru="COMPASS",Au="OLYMPIC",Eu="SINGLE_ELIMINATION",Cu="DOUBLE_ELIMINATION",xu="FIRST_MATCH_LOSER_CONSOLATION",Ou="FIRST_ROUND_LOSER_CONSOLATION",Fu="LUCKY_DRAW",ku="CURTIS_CONSOLATION",_u="CURTIS_CONSOLATION",Lu="FEED_IN_CHAMPIONSHIP_TO_SF",ju="FEED_IN_CHAMPIONSHIP_TO_SF",Bu="FEED_IN_CHAMPIONSHIP_TO_QF",Vu="FEED_IN_CHAMPIONSHIP_TO_QF",Gu="FEED_IN_CHAMPIONSHIP_TO_R16",qu="FEED_IN_CHAMPIONSHIP_TO_R16",Wu="MODIFIED_FEED_IN_CHAMPIONSHIP",Hu="MODIFIED_FEED_IN_CHAMPIONSHIP",zu="FEED_IN_CHAMPIONSHIP",Yu="ROUND_ROBIN",Ku="ROUND_ROBIN_WITH_PLAYOFF",Ju="DECIDER",Zu="BACKDRAW",Xu={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Qu={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},$u="WIN_RATIO",es="ROUND_OUTCOME",ts=[Ru,ku,Vu,qu,ju,zu,Bu,Gu,Lu,xu,Ou,Fu,Hu,Au,su,Ku],rs={MAIN:iu,QUALIFYING:au,CONSOLATION:ou,ITEM:gu,CONTAINER:Iu,FIRST_MATCHUP:bu,WINNER:Pu,LOSER:Du,AD_HOC:Nu,FEED_IN:Mu,FLEX_ROUNDS:"AD_HOC",COMPASS:Ru,PLAY_OFF:su,OLYMPIC:Au,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:Eu,DOUBLE_ELIMINATION:Cu,CURTIS:ku,FICSF:Lu,FICQF:Bu,FICR16:Gu,MFIC:Wu,VOLUNTARY_CONSOLATION:uu,FIRST_MATCH_LOSER_CONSOLATION:xu,FIRST_ROUND_LOSER_CONSOLATION:Ou,MODIFIED_FEED_IN_CHAMPIONSHIP:Hu,FEED_IN_CHAMPIONSHIP_TO_R16:qu,FEED_IN_CHAMPIONSHIP_TO_QF:Vu,FEED_IN_CHAMPIONSHIP_TO_SF:ju,FEED_IN_CHAMPIONSHIP:zu,LUCKY_DRAW:Fu,ROUND_ROBIN_WITH_PLAYOFF:Ku,ROUND_ROBIN:Yu,DECIDER:Ju,BACKDRAW:Zu,COMPASS_ATTRIBUTES:Xu,OLYMPIC_ATTRIBUTES:Qu,DRAW:yu,RANDOM:Uu,TOP_DOWN:Su,BOTTOM_UP:wu,WATERFALL:hu,WIN_RATIO:$u,ROUND_OUTCOME:es,MULTI_STRUCTURE_DRAWS:ts,generatedDrawTypes:[Nu,Ru,ku,Cu,Vu,qu,ju,zu,Mu,xu,Ou,Fu,Hu,Au,su,Yu,Ku,Eu],stageOrder:cu,finishOrder:vu,AGGREGATE_EVENT_STRUCTURES:pu,FINISHING_POSITIONS:du};function ns(e,t,r){var n,i,a,o,u,s,l=function(e){var t,r;return null===(r=null===(t=Vn({element:e,name:fo}))||void 0===t?void 0:t.extension)||void 0===r?void 0:r.value},c=null==r?void 0:r.deprioritizeCompleted,d=(null==r?void 0:r.mode)===pu&&fu,p=(null==r?void 0:r.mode)===du&&vu,v=p||d||cu,f=function(e){return function(e){return(null==e?void 0:e.stage)===iu&&1===(null==e?void 0:e.stageSequence)}(e)?-1:v[null==e?void 0:e.stage]},m=function(e){return null==e?void 0:e.matchUps.every((function(e){var t=e.matchUpStatus;return eu.includes(t)?1:-1}))};return c&&m(e)-m(t)||d&&f(e)-f(t)||((null==e?void 0:e.stage)&&v[e.stage]||0)-((null==t?void 0:t.stage)&&v[t.stage]||0)||(l(e)||0)-(l(t)||0)||!p&&!d&&(null!==(i=null===(n=null==t?void 0:t.positionAssignments)||void 0===n?void 0:n.length)&&void 0!==i?i:1/0)-(null!==(o=null===(a=null==e?void 0:e.positionAssignments)||void 0===a?void 0:a.length)&&void 0!==o?o:1/0)||(null!==(u=null==e?void 0:e.stageSequence)&&void 0!==u?u:0)-(null!==(s=null==t?void 0:t.stageSequence)&&void 0!==s?s:0)||(is(e)||0)-(is(t)||0)}function is(e){return((null==e?void 0:e.matchUps)||[]).reduce((function(e,t){var r,n=((null===(r=t.finishingPositionRange)||void 0===r?void 0:r.winner)||[]).reduce((function(e,t){return e+t}),0);return!e||n<e?n:e}),void 0)}function as(e){var t=e.drawDefinition,r=e.structureId;if(!t)return{error:K};if(!r)return{error:Pe};var n=os({drawDefinition:t}).structures,i=null==n?void 0:n.map((function(e){return e.structures?u([],o(e.structures),!1).concat(e):e})).flat(),a=null==i?void 0:i.find((function(e){return e.structureId===r}));if(!a)return{error:De};var s=a.structureType===gu?null==i?void 0:i.find((function(e){var t;return null===(t=e.structures)||void 0===t?void 0:t.some((function(e){return e.structureId===r}))})):void 0;return{structure:a,containingStructure:s}}function os(e){var t,r,n=e.withStageGrouping,i=e.drawDefinition,a=e.stageSequences,s=e.stageSequence,l=e.roundTarget,c=e.sortConfig,d=e.stages,p=e.stage,v=!i&&K||!(null==i?void 0:i.structures)&&be||void 0;if(v)return{error:v,structures:[],stageStructures:{}};var f=null!==(r=null===(t=null==i?void 0:i.structures)||void 0===t?void 0:t.filter((function(e){return!p&&!Array.isArray(d)||p&&e.stage===p||Array.isArray(d)&&d.includes(e.stage)})).filter((function(e){return!s&&!Array.isArray(a)||s&&e.stageSequence===s||Array.isArray(a)&&a.includes(e.stageSequence)})).filter((function(e){var t,r,n=null===(r=null===(t=Vn({element:e,name:fo}))||void 0===t?void 0:t.extension)||void 0===r?void 0:r.value;return!l||l===n})).sort((function(e,t){return ns(e,t,c)})))&&void 0!==r?r:[],m=n?Object.assign.apply(Object,u([{}],o(lu.map((function(e){var t,r=null==f?void 0:f.filter((function(t){return t.stage===e}));return(null==r?void 0:r.length)&&((t={})[e]=r,t)})).filter(Boolean)),!1)):{};return{structures:f,stageStructures:m}}function us(e){var t=e.drawDefinition;if(!t)return{error:K};var r={},n=(t.structures||[]).map((function(e){var t,n,i=e.stage;r[i]||(r[i]=[]);var a=ss({structure:e}).positionAssignments,s=null!==(n=null==a?void 0:a.map(Ri("participantId")).filter(Boolean))&&void 0!==n?n:[];return(t=r[i]).push.apply(t,u([],o(s),!1)),s})).flat();return{allPositionedParticipantIds:n,stagePositionedParticipantIds:r}}function ss(e){var t,r,n=e.drawDefinition,i=e.structureId,a=e.structure,s=[];if(!a){if(!n)return{positionAssignments:s,error:K};if(a=(t=as({drawDefinition:n,structureId:i})).structure,r=t.error)return{positionAssignments:s,error:r}}return a.structures?s=[].concat.apply([],u([],o(a.structures.map((function(e){return ss({structure:e}).positionAssignments}))),!1)):a.positionAssignments?s=a.positionAssignments:r=je,{positionAssignments:s,error:r}}function ls(e){var t,r=(null===(t=ss({drawDefinition:e.drawDefinition,structureId:e.structureId,structure:e.structure}))||void 0===t?void 0:t.positionAssignments)||[],n=null==r?void 0:r.filter((function(e){var t,r;return null!==(r=null!==(t=e.participantId)&&void 0!==t?t:e.bye)&&void 0!==r?r:e.qualifier})),i=r&&(null==r?void 0:r.length)===(null==n?void 0:n.length),a=null==r?void 0:r.filter((function(e){return!e.participantId&&!e.bye&&!e.qualifier})),o=null==r?void 0:r.filter((function(e){return!e.participantId&&e.bye})),u=null==r?void 0:r.filter((function(e){return!e.participantId&&e.qualifier}));return{allPositionsAssigned:i,positionAssignments:r,unassignedPositions:a,assignedPositions:n,qualifierPositions:u,byePositions:o}}var cs="SIGN_IN_STATUS",ds="SIGNED_OUT",ps="SIGNED_IN",vs="TEAM",fs="INDIVIDUAL",ms="GROUP",hs="PAIR",gs="TEAM",Is={TEAM_PARTICIPANT:vs,INDIVIDUAL:fs,GROUP:ms,TEAM:gs,PAIR:hs},ys={INDIVIDUAL:fs,GROUP:ms,PAIR:hs,TEAM:gs,SIGN_IN_STATUS:cs,SIGNED_OUT:ds,SIGNED_IN:ps};function Us(e){var t=e.participantsProfile,r=e.participants,n=void 0===r?[]:r,i=e.deepCopy,a=new Map,o=!1!==i?Ui(n,null==t?void 0:t.convertExtensions,!0):n,u=o.filter((function(e){return e.participantType===gs})),s=o.filter((function(e){return e.participantType===ms})),l=o.filter((function(e){return e.participantType===hs}));return o.forEach((function(e){if(e.participantType===fs){var t=e.participantId;e.groupParticipantIds=[],e.teamParticipantIds=[],e.pairParticipantIds=[],e.groups=[],e.teams=[],u.forEach((function(r){((null==r?void 0:r.individualParticipantIds)||[]).forEach((function(n){var i;n!==t||(null===(i=e.teamParticipantIds)||void 0===i?void 0:i.includes(r.participantId))||(e.teamParticipantIds.push(r.participantId),a.get(r.participantId)||a.set(r.participantId,{participantName:r.participantName,participantId:r.participantId}),e.teams.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId,teamId:r.teamId}))}))})),l.forEach((function(r){((null==r?void 0:r.individualParticipantIds)||[]).forEach((function(n){n!==t||e.pairParticipantIds.includes(r.participantId)||e.pairParticipantIds.push(r.participantId)}))})),s.forEach((function(r){((null==r?void 0:r.individualParticipantIds)||[]).forEach((function(n){n!==t||e.groupParticipantIds.includes(r.participantId)||(e.groupParticipantIds.push(r.participantId),e.groups.push({participantRoleResponsibilities:r.participantRoleResponsibilities,participantOtherName:r.participantOtherName,participantName:r.participantName,participantId:r.participantId}))}))}))}})),{participantsWithGroupings:o,groupInfo:Object.fromEntries(a)}}function Ss(e){return e&&void 0!==String.fromCodePoint?e.toUpperCase().replace(/./g,(function(e){return String.fromCodePoint(e.charCodeAt(0)+127397)})):e}var ws=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Ts(e){var t=e.participant,r=e.withISO2,n=e.withIOC,i=t.person,a=t.individualParticipants,o=[i,null==a?void 0:a.map((function(e){return e.person}))].flat().filter(Boolean);o.forEach((function(e){var t=(e||{}).nationalityCode;if(t){var i=ws.find((function(e){return e.iso===t}));n&&(null==i?void 0:i.ioc)&&!e.iocNationalityCode&&(e.iocNationalityCode=i.ioc),r&&(null==i?void 0:i.iso2)&&!e.iso2NationalityCode&&(e.iso2NationalityCode=i.iso2),(null==i?void 0:i.label)&&!e.countryName&&(e.countryName=i.label)}}))}function Ps(e){var t,r,n,i,o=e.tournamentRecord,u=e.participantId,s=e.tournamentRecords||o&&((t={})[o.tournamentId]=o,t)||{};try{for(var l=a(Object.values(s)),c=l.next();!c.done;c=l.next()){var d=c.value,p=null===(i=d.participants)||void 0===i?void 0:i.find((function(e){return e.participantId===u}));if(p)return{participant:p,tournamentId:d.tournamentId}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return{error:Lt}}function Ds(e){var r=e.returnPreviousValues,n=e.itemSubTypes,i=e.itemType,a=e.element;if(!a)return{error:pt,info:Fn};if(n&&!Array.isArray(n))return{error:xr,context:{itemSubTypes:n}};if(!Array.isArray(a.timeItems))return{error:Ur};var o=a.timeItems.filter((function(e){return(null==e?void 0:e.itemType)===i})).filter((function(e){return!(null==n?void 0:n.length)||n.some((function(t){var r;return null===(r=null==e?void 0:e.itemSubTypes)||void 0===r?void 0:r.includes(t)}))})).sort((function(e,t){return new Date(e.createdAt||void 0).getTime()-new Date(t.createdAt||void 0).getTime()})),u=o.pop();if(u){var s=t({timeItem:u},L);return r&&Object.assign(s,{previousItems:o}),s}return{info:jr}}function bs(e){var t=e.returnPreviousValues,r=e.itemSubTypes,n=e.itemType,i=e.event;if(!i)return{error:Ae};if(!i.timeItems)return{info:jr};var a=Ds({returnPreviousValues:t,element:i,itemSubTypes:r,itemType:n}),o=a.timeItem,u=a.previousItems,s=a.info;return o&&{timeItem:o,previousItems:u}||{info:s}}function Ns(e){var t=e.returnPreviousValues,r=e.tournamentRecord,n=e.itemSubTypes,i=e.itemType;if(!r)return{error:W};if(!r.timeItems)return{info:jr};var a=Ds({element:r,returnPreviousValues:t,itemSubTypes:n,itemType:i}),o=a.timeItem,u=a.previousItems,s=a.info;return o&&{timeItem:o,previousItems:u}||{info:s}}var Ms,Rs,As="SINGLES",Es="SINGLES",Cs="DOUBLES",xs="DOUBLES",Os="TEAM",Fs="TEAM",ks={SINGLES_MATCHUP:As,SINGLES:Es,DOUBLES_MATCHUP:Cs,DOUBLES:xs,TEAM_MATCHUP:Os,TEAM:Fs},_s=((Ms={})[ms]="groupParticipantIds",Ms[hs]="pairParticipantIds",Ms[gs]="teamParticipantIds",Ms),Ls=((Rs={})[ms]="groups",Rs[gs]="teams",Rs);function js(e){var t,r,n,i,o,u,s=e.withIndividualParticipants,l=e.convertExtensions,c=e.tournamentRecord,d=e.withSignInStatus,p=e.withScaleValues,v=e.internalUse,f=e.withISO2,m=e.withIOC,h={};try{for(var g=a(null!==(o=c.participants)&&void 0!==o?o:[]),I=g.next();!I.done;I=g.next()){(T=null==(S=I.value)?void 0:S.participantId)&&Gs({participantMap:h,participantId:T})}}catch(e){t={error:e}}finally{try{I&&!I.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}try{for(var y=a(null!==(u=c.participants)&&void 0!==u?u:[]),U=y.next();!U.done;U=y.next()){var S,w=Ui(S=U.value,l,v),T=w.participantId,P=w.individualParticipantIds,D=w.participantType;if(Object.assign(h[T].participant,w),P&&Vs({individualParticipantIds:P,participantCopy:w,participantMap:h,participantType:D,participantId:T}),d&&(h[T].participant.signedIn=Bs(w)),p){var b=ba({participant:w}),N=b.ratings,M=b.rankings,R=b.seedings;h[T].participant.seedings=R,h[T].participant.rankings=M,h[T].participant.ratings=N}(m||f)&&Ts({participant:h[T].participant,withISO2:f,withIOC:m})}}catch(e){n={error:e}}finally{try{U&&!U.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}s&&function(e){var t,r,n,i,o,u=e.participantMap,s=e.template,l=Object.values(u);try{for(var c=a(l),d=c.next();!d.done;d=c.next()){var p=d.value.participant;if(null===(o=p.individualParticipantIds)||void 0===o?void 0:o.length){p.individualParticipants=[];try{for(var v=(n=void 0,a(p.individualParticipantIds)),f=v.next();!f.done;f=v.next()){var m=u[f.value].participant;p.individualParticipants.push(s?Na({template:s,source:m}):m)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}({participantMap:h,template:Di(s)?s:void 0});return{participantMap:h}}function Bs(e){var t=Ds({itemType:cs,element:e}).timeItem;return(null==t?void 0:t.itemValue)===ps}function Vs(e){var t,r,n=e.individualParticipantIds,i=e.participantCopy,o=e.participantMap,u=e.participantType,s=e.participantId,l=function(e){var t=o[e].participant;if(t[_s[u]].push(s),[gs,ms].includes(u)){var r=i.participantRoleResponsibilities,a=i.participantOtherName,l=i.participantName,c=i.participantId,d=i.teamId;t[Ls[u]].push({participantRoleResponsibilities:r,participantOtherName:a,participantName:l,participantId:c,teamId:d})}if(u===hs){var p=n.find((function(t){return t!==e}));o[e].pairIdMap[s]=p,o[e].pairIdMap[p]=s}};try{for(var c=a(n),d=c.next();!d.done;d=c.next()){l(d.value)}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}function Gs(e){var r,n=e.participantMap,i=e.participantId;if(!n[i]){var a={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};n[i]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:t((r={},r[Es]=t({},a),r[xs]=t({},a),r[gs]=t({},a),r),a)}}}function qs(e){var r,n,i,o,u=e.participantsProfile,s=e.useParticipantMap,l=e.tournamentRecord,c=e.contextProfile,d=e.inContext;if(s)return{participantMap:null===(o=js(t(t(t({},u),c),{tournamentRecord:l})))||void 0===o?void 0:o.participantMap};var p,v=Ui(l.participants,!1,!0)||[];if(((null==u?void 0:u.withIOC)||(null==u?void 0:u.withISO2))&&v.forEach((function(e){return Ts(t({participant:e},u))})),(d||(null==u?void 0:u.withGroupings))&&(null==v?void 0:v.length)&&(v=(r=Us({participantsProfile:u,deepCopy:!1,participants:v})).participantsWithGroupings,p=r.groupInfo),(null==u?void 0:u.withScaleValues)&&(null==v?void 0:v.length))try{for(var f=a(v),m=f.next();!m.done;m=f.next()){var h=m.value,g=ba({participant:h}),I=g.ratings,y=g.rankings;h.rankings=y,h.ratings=I}}catch(e){n={error:e}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}return{participants:v,groupInfo:p}}function Ws(e){var t=e.groupedOrder,r=e.roundPositionsCount;if(!t||(null==t?void 0:t.length)<=r)return t;var n=O(t,t.length/r).map((function(e){return e.reduce((function(e,t){return e+t}))})),i=n.slice().sort(s);return n.map((function(e){return i.indexOf(e)+1}))}function Hs(e){var t,r=e.sourceRoundMatchUpCount,n=e.inContextDrawMatchUps,i=e.sourceRoundPosition,a=e.drawDefinition,s=e.targetLink;if(!s)return{error:we};var l=s.target,c=l.structureId,d=l.feedProfile,p=l.groupedOrder,v=l.roundNumber,f=l.positionInterleave,m=as({drawDefinition:a,structureId:c}).structure,h=ss({structure:m}).positionAssignments,g=null==n?void 0:n.filter((function(e){return e.structureId===(null==m?void 0:m.structureId)})),I=g.filter((function(e){return e.roundNumber===v&&!e.matchUpTieId})),y=I.length,U=R(1,y+1),S=y/r,w=Math.ceil(S*i),T=1-i%2;if((null==f?void 0:f.interleave)&&.5!==S){var P=i+(f.offset+(i-1)*f.interleave);w=Math.ceil(P/2),T=1-P%2}var D=U,b=U[w-1],N=Ws({groupedOrder:p,roundPositionsCount:U.length}),M=(null==N?void 0:N.length)||1;if(M<=U.length){var A=O(U,y/M);d===wu&&A.forEach((function(e){return e.reverse()})),D=(null==N?void 0:N.length)&&(null==N?void 0:N.map((function(e){return A[e-1]})).flat())||D}d===Su?b=D[w-1]:d===wu?((!(null==N?void 0:N.length)||M>U.length)&&(w=I.length+1-w),b=D[w-1]):d===Uu&&on()&&console.log(Br,{feedProfile:d});var E,C=b&&I.reduce((function(e,t){return t.roundPosition===b?t:e}),void 0);(null==C?void 0:C.feedRound)?(T=0,E=Math.min.apply(Math,u([],o((C.drawPositions||[]).filter(Boolean)),!1))):E=2===(null===(t=null==C?void 0:C.drawPositions)||void 0===t?void 0:t.length)&&(null==C?void 0:C.drawPositions[T]);var x=null==h?void 0:h.find((function(e){return e.drawPosition===E}));if(x){var F=Vn({element:x,name:to}).extension;if(null==F?void 0:F.value)return{disabledDrawPosition:E}}return{matchUp:C,targetDrawPosition:E,matchUpDrawPositionIndex:T}}function zs(e){var t,r=e.finishingPositions,n=e.linkCondition,i=e.linkType,a=e.source.find((function(e){var t,a,o=!(null===(t=e.source)||void 0===t?void 0:t.finishingPositions)||!r||x(r,null===(a=e.source)||void 0===a?void 0:a.finishingPositions);return n===e.linkCondition&&o&&e.linkType===i}));return[Pu,Du].includes(null==a?void 0:a.linkType)&&!(null===(t=null==a?void 0:a.source)||void 0===t?void 0:t.roundNumber)?On({result:{error:xr},stack:"getTargetLink",context:a}):a}function Ys(e){var t=e.drawDefinition,r=e.structureId,n=e.roundNumber;if(!t)return{error:K};if(!r)return{error:Pe};var i=(t.links||[]).filter(Boolean).reduce((function(e,t){var i,a;return(null===(i=t.source)||void 0===i?void 0:i.structureId)!==r||n&&t.source.roundNumber!==n||(e.source=e.source.concat(t)),(null===(a=t.target)||void 0===a?void 0:a.structureId)!==r||n&&t.target.roundNumber!==n||(e.target=e.target.concat(t)),e}),{source:[],target:[]});return{links:i}}function Ks(e){var t=e.inContextDrawMatchUps,r=void 0===t?[]:t,n=e.useTargetMatchUpIds,i=e.inContextMatchUp,a=e.drawDefinition,o=e.matchUpId,u=i;r.length&&!u&&(u=r.find((function(e){return e.matchUpId===o})));var s=as({structureId:null==u?void 0:u.structureId,drawDefinition:a}).structure;return(null==s?void 0:s.finishingPosition)===es?function(e){var t,r,n,i,a,o,u=e.inContextDrawMatchUps,s=e.useTargetMatchUpIds,l=e.drawDefinition,c=e.structure,d=e.matchUp,p=d.winnerMatchUpId,v=d.loserMatchUpId,f=function(e){var t=e.drawDefinition,r=e.roundNumber,n=e.structureId;if(!t)return{error:K};if(!n)return{error:Pe};var i=Ys({drawDefinition:t,structureId:n}).links;return{links:{source:i.source.reduce((function(e,t){return t.source.roundNumber&&t.source.roundNumber!==r?e:e.concat(t)}),[]),target:i.target.reduce((function(e,t){return t.target.roundNumber&&t.target.roundNumber!==r?e:e.concat(t)}),[])}}}({roundNumber:d.roundNumber,structureId:c.structureId,drawDefinition:l}).links,m=null==f?void 0:f.source,h=zs({source:m,linkType:Pu}),g=zs({linkCondition:bu,linkType:Du,source:m}),I=zs({source:m,linkType:Du}),y=g&&I;I||(I=g);var U,S,w,T,P,D,b,N,M,R,A=null===(i=null==h?void 0:h.target)||void 0===i?void 0:i.feedProfile,E=null===(a=null==I?void 0:I.target)||void 0===a?void 0:a.feedProfile,C=null===(o=null==g?void 0:g.target)||void 0===o?void 0:o.feedProfile;if(s&&(p||v)&&(b=p&&A!==yu&&u.find((function(e){return e.matchUpId===p})),T=v&&E!==yu&&u.find((function(e){return e.matchUpId===v})),b||T))return{matchUp:d,targetLinks:{loserTargetLink:I,winnerTargetLink:h},targetMatchUps:{loserMatchUp:T,winnerMatchUp:b}};var x=d.roundPosition;R=R||u.filter((function(e){return e.structureId===c.structureId}));var O=R.reduce((function(e,t){return t.roundNumber!==d.roundNumber||t.matchUpTieId?e:e+1}),0);I&&!T&&E!==yu&&(D=(t=Hs({targetLink:I,sourceRoundMatchUpCount:O,inContextDrawMatchUps:u,sourceRoundPosition:x,drawDefinition:l})).matchUpDrawPositionIndex,P=t.targetDrawPosition,T=t.matchUp);y&&C!==yu&&(w=(r=Hs({targetLink:g,sourceRoundMatchUpCount:O,inContextDrawMatchUps:u,sourceRoundPosition:x,drawDefinition:l})).matchUpDrawPositionIndex,S=r.targetDrawPosition,U=r.matchUp);h&&!b&&A!==yu&&(M=(n=Hs({targetLink:h,sourceRoundMatchUpCount:O,inContextDrawMatchUps:u,sourceRoundPosition:x,drawDefinition:l})).matchUpDrawPositionIndex,N=n.targetDrawPosition,b=n.matchUp);b||(R=R||u.filter((function(e){return e.structureId===c.structureId})),b=function(e){var t=e.structureMatchUps,r=e.matchUp,n=r.roundNumber,i=r.roundPosition,a=t.filter((function(e){return e.roundNumber===n&&!e.matchUpTieId})),o=t.filter((function(e){return e.roundNumber===n+1&&!e.matchUpTieId}));if(o.length){var u=void 0;return o.length===a.length?u=o.find((function(e){return e.roundPosition===i})):o.length===a.length/2&&(u=o.find((function(e){return e.roundPosition===Math.ceil(i/2)}))),{matchUp:u}}return{message:"no progression found"}}({structureMatchUps:R,matchUp:d}).matchUp);return xn({matchUp:d,targetLinks:{loserTargetLink:I,winnerTargetLink:h,byeTargetLink:g},targetMatchUps:{winnerMatchUpDrawPositionIndex:M,loserMatchUpDrawPositionIndex:D,byeMatchUpDrawPositionIndex:w,winnerTargetDrawPosition:N,loserTargetDrawPosition:P,byeTargetDrawPosition:S,winnerMatchUp:b,loserMatchUp:T,byeMatchUp:U},targetMatchUpIds:!(!p&&!v)})}({inContextDrawMatchUps:r,useTargetMatchUpIds:n,drawDefinition:a,structure:s,matchUp:u}):function(e){var t=e.matchUp;return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}({matchUp:u})}function Js(e){if(!Di(e))return!1;var t=e.matchUpId,r=e.drawPositions,n="string"==typeof t,i=!r||Array.isArray(r)&&r.length<=2&&r.every((function(e){return I(e)||null==e}));return n&&i}function Zs(e){return!!Array.isArray(e)&&e.every(Js)}function Xs(e){var r,n=e.matchUps,i=void 0===n?[]:n,a=e.interpolate;if(!Zs(i))return{roundMatchUps:[],error:xr};var d=i.reduce((function(e,t){var r="string"==typeof t.roundNumber?l(t.roundNumber):t.roundNumber;return!t.roundNumber||e.includes(r)?e:e.concat(r)}),[]).sort(s).map((function(e){var t,r=i.filter((function(t){return t.roundNumber===e})),n=r.find((function(e){return e.matchUpType===Fs})),a=n?r.filter((function(e){return e.matchUpType===Fs})):r;return(t={})[e]=a.sort((function(e,t){return s(e.roundPosition,t.roundPosition)})),t})),p=i.reduce((function(e,t){var r="string"==typeof t.roundNumber?l(t.roundNumber):t.roundNumber;return e[r]||(e[r]=xn({abbreviatedRoundName:t.abbreviatedRoundName,finishingRound:t.finishingRound,roundName:t.roundName})),e}),{}),v=Object.assign.apply(Object,u([{}],o(d),!1));if(a){var f=Math.max.apply(Math,u([],o(Object.keys(v).map((function(e){return l(e)})).filter((function(e){return!isNaN(e)}))),!1)),m=null===(r=v[f])||void 0===r?void 0:r.length;if(m>1&&c(m)){var h=f+1;R(h,h+m/2).forEach((function(e,t){v[e]=R(0,m/(2+2*t)).map((function(){return{}}))}))}}var g=0,I=Object.assign.apply(Object,u([{}],o(Object.keys(v).map((function(e){var t,r,n,i,a=null===(r=v[e])||void 0===r?void 0:r.length,o=null===(i=null===(n=v[e])||void 0===n?void 0:n.filter((function(e){var t;return!eu.includes(e.matchUpStatus)&&!(null===(t=e.score)||void 0===t?void 0:t.scoreStringSide1)})))||void 0===i?void 0:i.length,u=a&&a===o;return g=Math.max(g,a),(t={})[e]={matchUpsCount:a,inactiveCount:o,inactiveRound:u},t}))),!1)),y=0,U=0,S=Object.keys(v).map((function(e){return l(e)})).filter((function(e){return!isNaN(e)}));S.forEach((function(e){var t,r,n,i,a,l=v[e].sort((function(e,t){return e.roundPosition-t.roundPosition})),c=l.map((function(e){return(null==e?void 0:e.drawPositions)||[]})).flat();if(I[e].roundNumber=e,I[e].roundFactor=I[e].matchUpsCount?g/I[e].matchUpsCount:1,I[e].finishingRound=null===(t=p[e])||void 0===t?void 0:t.finishingRound,I[e].roundName=null===(r=p[e])||void 0===r?void 0:r.roundName,I[e].abbreviatedRoundName=null===(n=p[e])||void 0===n?void 0:n.abbreviatedRoundName,I[e].finishingPositionRange=null===(a=null===(i=v[e])||void 0===i?void 0:i[0])||void 0===a?void 0:a.finishingPositionRange,1!==e&&I[e-1]){var d=I[e-1],f=d.drawPositions,m=d.matchUpsCount/I[e].matchUpsCount,h=O(f,m),S=l.map((function(t){var r=t.roundPosition,n=u(u([],o(t.drawPositions||[]),!1),[void 0,void 0],!1).slice(0,2);if(!r)return n;var i=(null==n?void 0:n.filter(Boolean))||[];if(!(null==i?void 0:i.length))return[void 0,void 0];if(e<3&&2===(null==i?void 0:i.length))return null==n?void 0:n.slice().sort(s);var a=E(f,i).length!==(null==i?void 0:i.length);if((null==i?void 0:i.length)&&a)return 1===(null==i?void 0:i.length)?[i[0],void 0]:null==n?void 0:n.slice().sort(s);var l=2*(r-1);return h.slice(l,l+2).map((function(e){return null==i?void 0:i.find((function(t){return e.includes(t)}))}))}));I[e].drawPositions=null==S?void 0:S.flat(),I[e].pairedDrawPositions=S}else{var w=c.sort(s),T=O(w,2);I[e].drawPositions=w,I[e].pairedDrawPositions=T}I[e+1]&&I[e+1].matchUpsCount===I[e].matchUpsCount&&(I[e+1].feedRound=!0,I[e+1].feedRoundIndex=U,I[e].preFeedRound=!0,U+=1),I[e]&&!I[e].feedRound&&(I[e].roundIndex=y,y+=1)}));var w=!!Object.values(I).find((function(e){return!c(e.matchUpsCount)})),T=i.some((function(e){return!e.roundPosition}));return t({hasNoRoundPositions:T,roundsNotPowerOf2:w,maxMatchUpsCount:g,roundMatchUps:v,roundNumbers:S,roundProfile:I},L)}function Qs(e){var t=e.drawDefinition,r=e.inContextDrawMatchUps,n={};return r.forEach((function(e){var i,a,c,d,p,v,f=e.matchUpId,m=e.structureId,h=e.drawPositions,g=void 0===h?[]:h,I=as({drawDefinition:t,structureId:m}).structure;if((null==I?void 0:I.finishingPosition)===$u){var y=e.roundNumber,U=y&&l(y)+1,S=Xs({matchUps:null!==(i=I.matchUps)&&void 0!==i?i:[]}).roundMatchUps;if(U&&(null==S?void 0:S[U])){var w=u([],o(g),!1).sort(s).map((function(e,t){var r=S[U].find((function(t){var r;return null===(r=t.drawPositions)||void 0===r?void 0:r.includes(e)}));return{matchUpId:null==r?void 0:r.matchUpId,roundNumber:U,schedule:null==r?void 0:r.schedule,sideNumber:t+1,structureName:I.structureName}}));Object.assign(e,{sidesTo:w})}}else{var T=Ks({useTargetMatchUpIds:!0,inContextDrawMatchUps:r,inContextMatchUp:e,drawDefinition:t,matchUpId:f}),P=T.targetMatchUps.winnerMatchUp,D=T.targetMatchUps.loserMatchUp;!e.winnerMatchUpId&&P&&(e.winnerMatchUpId=P.matchUpId),!e.loserMatchUpId&&D&&(e.loserMatchUpId=D.matchUpId);var b=el({upcomingMatchUp:P}),N=el({upcomingMatchUp:D});if(e.matchUpStatus!==Fo&&(null==D?void 0:D.matchUpStatus)===Fo){var M=($s({matchUp:D,drawDefinition:t,inContextDrawMatchUps:r})||{}).matchUp;N=M&&el({upcomingMatchUp:M})||N}var R=null===(a=e.schedule)||void 0===a?void 0:a.timeAfterRecovery;if(R){if(null===(c=null==b?void 0:b.schedule)||void 0===c?void 0:c.scheduledTime)ii(b.schedule.scheduledTime)<ii(R)&&(n[b.matchUpId]=e.matchUpId,b.schedule.scheduleConflict=e.matchUpId);if(null===(d=null==N?void 0:N.schedule)||void 0===d?void 0:d.scheduledTime)ii(N.schedule.scheduledTime)<ii(R)&&(n[N.matchUpId]=e.matchUpId,N.schedule.scheduleConflict=e.matchUpId)}if(Object.assign(e,{winnerTo:b,loserTo:N}),null===(p=e.drawPositions)||void 0===p?void 0:p.filter(Boolean).length){var A=null===(v=T.targetLinks)||void 0===v?void 0:v.loserTargetLink,E=(null==A?void 0:A.linkCondition)===bu,C=function(e){var t;return(null===(t=null==e?void 0:e.sides)||void 0===t?void 0:t.map((function(e){var t=e.participant,r=e.participantId,n=e.qualifier;return t||r&&{participantId:r}||n&&{qualifier:n}})).filter(Boolean))||[]}(e);if(C.length){var x=No(null==P?void 0:P.sides),O=No(null==D?void 0:D.sides),F=C.find((function(e){var t=e.participantId;return x.includes(t)})),k=F?[]:C,_=C.find((function(e){var t=e.participantId;return O.includes(t)})),L=_?[]:C;D&&E&&L.length<2&&L.push({bye:!0,tbd:!0}),(null==k?void 0:k.length)&&P&&(!T.targetMatchUpIds&&P&&(P=r.find((function(e){return e.matchUpId===P.matchUpId}))),P.potentialParticipants||(P.potentialParticipants=[]),P.potentialParticipants.push(k)),(null==L?void 0:L.length)&&D&&(T.targetMatchUpIds||(P=r.find((function(e){return e.matchUpId===D.matchUpId}))),D.potentialParticipants||(D.potentialParticipants=[]),D.potentialParticipants.push(L))}}}})),Object.keys(n).length&&r.forEach((function(e){Object.keys(n).includes(e.matchUpId)&&(e.schedule.scheduleConflict=n[e.matchUpId])})),{scheduleConflictMatchUpIds:n}}function $s(e){var t=e.matchUp,r=e.drawDefinition,n=e.inContextDrawMatchUps,i=t||{},a=i.matchUpId,o=i.matchUpStatus,u=i.structureId;if(!t||!u||(null==t?void 0:t.matchUpStatus)===Yo)return{matchUp:t};if(o===Fo){var s=void 0;if(t.winnerMatchUpId)s=n.find((function(e){return e.matchUpId===t.winnerMatchUpId}));else{var l=Ks({inContextDrawMatchUps:n,drawDefinition:r,matchUpId:a});s=((null==l?void 0:l.targetMatchUps)||{}).winnerMatchUp}return $s({matchUp:s,drawDefinition:r,inContextDrawMatchUps:n})}return{matchUp:void 0}}function el(e){if(null==e?void 0:e.upcomingMatchUp)return function(e){return{matchUpId:e.matchUpId,structureId:e.structureId,schedule:e.schedule,roundNumber:e.roundNumber,roundPosition:e.roundPosition,structureName:e.structureName}}(e.upcomingMatchUp)}function tl(e){var r=e.onlySpecifiedPolicyTypes,n=void 0!==r&&r,i=e.policyTypes,o=void 0===i?[]:i,u=e.tournamentRecord,s=e.drawDefinition,l=e.structure,c=e.event;if(!Array.isArray(o))return{error:rt};var d={};return u&&p(u),c&&p(c),s&&p(s),l&&p(l),t({appliedPolicies:d},L);function p(e){var t,r,i,u=null==e?void 0:e.extensions,s=null===(i=null==u?void 0:u.find((function(e){return e.name===Za})))||void 0===i?void 0:i.value;if(s)try{for(var l=a(Object.keys(s)),c=l.next();!c.done;c=l.next()){var p=c.value;(n?o.includes(p):!o.length||o.includes(p))&&(d[p]=Ui(s[p],!1,!0))}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}}}function rl(e){var t,r,n=e.policyTypes,i=void 0===n?[]:n,o=e.tournamentRecord,u=e.drawDefinition,s=e.structure,l=e.event;if(!Array.isArray(i))return{error:rt};var c=tl({tournamentRecord:o,drawDefinition:u,structure:s,event:l}).appliedPolicies,d={};try{for(var p=a(i),v=p.next();!v.done;v=p.next()){var f=v.value,m=null==c?void 0:c[f];m&&(d[f]=m)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}return Object.keys(d).length?{policyDefinitions:d}:{info:st.message}}var nl,il,al="WALKOVER",ol="RETIRED",ul="COMPETITIVE",sl="ROUTINE",ll="DECISIVE",cl="winRatio",dl=((nl={})[Ra]={policyName:"Competitive Bands Default",profileBands:(il={},il[ll]=20,il[sl]=50,il)},nl);function pl(e){var t,r,n=e.policyDefinitions,i=e.tournamentRecord,a=e.contextProfile,o=e.drawDefinition,u=e.event,s={policies:{}};if(!a)return s;var l=rl({tournamentRecord:i,drawDefinition:o,event:u}).policyDefinitions;if(a.withCompetitiveness){var c=null!==(r=null!==(t=null==n?void 0:n[Ra])&&void 0!==t?t:null==l?void 0:l[Ra])&&void 0!==r?r:dl[Ra];s.policies[Ra]=c}return s}function vl(e){var t,r,n=e.drawDefinition;if("object"!=typeof n)return{error:Y};var i={},o=n||{},u=o.structures,s=void 0===u?[]:u,l=o.links,c=void 0===l?[]:l,d=s.reduce((function(e,t){var r=t.stage;return e[r]?e[r].push(t):e[r]=[t],e}),{});try{for(var p=a(Object.keys(d)),v=p.next();!v.done;v=p.next()){var f=v.value,m=d[f].find((function(e){return 1===e.stageSequence}));if(m){var h=m.structureId;g({aggregator:{},targetRound:0,exitProfiles:i,exitProfile:"0",structureId:h,stage:f})}}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}return{exitProfiles:i};function g(e){var t,r,n=e.exitProfiles,i=e.exitProfile,o=e.structureId,u=e.targetRound,l=e.aggregator,d=e.stage;n[o]||(n[o]=[]),"0"===i&&[ou,su].includes(d)||n[o].push(i);var p=c.filter((function(e){return e.source.structureId===o&&e.source.roundNumber>=u})),v=function(e){var t=e.source.roundNumber,r=e.target.roundNumber,a=e.target.structureId,o=s.find((function(e){return e.structureId===a})).stage,u=[o,a,r,t].join("|");if(l[u])return{value:void 0};l[u]=!0,g({exitProfile:"".concat(i,"-").concat(t),structureId:a,exitProfiles:n,targetRound:r,aggregator:l,stage:o})};try{for(var f=a(p),m=f.next();!m.done;m=f.next()){var h=v(m.value);if("object"==typeof h)return h.value}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}}}function fl(e){var t,r=e.drawDefinition,n=e.structure,i={},a=[];return(null!==(t=null==r?void 0:r.structures)&&void 0!==t?t:[n]).filter((function(e){return e&&"object"==typeof e})).forEach((function(e){if(e){var t=e.structureId,r=e.matchUps,n=e.structures,s=Array.isArray(n);if(s)s&&n.forEach((function(e){var r=e.structureName,n=e.matchUps;i[e.structureId]={matchUps:n,itemStructureIds:[],structureName:r},n&&(a.push.apply(a,u([],o(n),!1)),n.forEach((function(e){e.tieMatchUps&&a.push.apply(a,u([],o(e.tieMatchUps),!1))}))),i[t]||(i[t]={itemStructureIds:[],matchUps:[]}),i[t].itemStructureIds||(i[t].itemStructureIds=[]),i[t].itemStructureIds.push(e.structureId)}));else{var l=r;i[t]={matchUps:l,itemStructureIds:[]},null==l||l.forEach((function(e){a.push(e),e.tieMatchUps&&a.push.apply(a,u([],o(e.tieMatchUps),!1))}))}}})),{mappedMatchUps:i,drawMatchUps:a}}function ml(e){var t,r,n=e.mappedMatchUps,i=e.matchUpsMap,a=e.structureId,s=e.inContext,l=(n=null!==(r=null==i?void 0:i.mappedMatchUps)&&void 0!==r?r:n)[a],c=((null==l?void 0:l.itemStructureIds)||[]).map((function(e){var t=n[e],r=t.matchUps,i=t.structureName;return s?r.map((function(t){return Object.assign(Ui(t,!0,!0),{containerStructureId:a,structureId:e,structureName:i})})):r})).flat();return(t=(null==l?void 0:l.matchUps)||[]).concat.apply(t,u([],o(c),!1))}function hl(e){var r,n,i=e.collectionPosition,o=e.collectionId,u=e.lineUp,s=[],l=[];if(u){var c=function(e){return void 0===e?-1:e},d=u.map((function(e){var r=e.collectionAssignments,n=e.participantId,a=null==r?void 0:r.find((function(e){return e.collectionPosition===i&&e.collectionId===o}));return a&&t({participantId:n},a)})).filter(Boolean).sort((function(e,t){return c(e.substitutionOrder)-c(t.substitutionOrder)})),p=function(e){var t=e.participantId,r=e.previousParticipantId,n=e.substitutionOrder;if(s.includes(t))return"continue";r&&l.push({previousParticipantId:r,substitutionOrder:n,participantId:t}),(s=s.filter((function(e){return e!==r}))).push(t)};try{for(var v=a(d),f=v.next();!f.done;f=v.next()){p(f.value)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}}return{assignedParticipantIds:s,substitutions:l}}function gl(e){var r,n=e.tournamentParticipants,i=e.tournamentRecord,a=e.participantIds,o="getPairedParticipant";if(!n&&!i)return{error:W};if(!Array.isArray(a)||a.length>2)return{error:Et};if(!a.length)return On({result:{error:Vt},stack:o});var u=(n=null!==(r=null!=n?n:null==i?void 0:i.participants)&&void 0!==r?r:[]).filter((function(e){return e.participantType===hs&&E(a,e.individualParticipantIds).length===a.length&&e.individualParticipantIds.length===a.length})),s=u[0];if(!s)return On({result:{error:Lt},stack:o});var l=Ui(u.slice(1),!1,!0);return t({participant:Ui(s),duplicatedPairParticipants:l},L)}function Il(e){var t=e.drawDefinition,r=e.participantId;if("object"!=typeof t)return{error:K};if("string"!=typeof r)return{error:_t};var n=Vn({element:t,name:uo}).extension;return{lineUp:((null==n?void 0:n.value)||{})[r]}}function yl(e){var t=e.drawDefinition,r=e.attributes,n=Vn({element:t,name:io}).extension,i=(null==n?void 0:n.value)||{};return r.forEach((function(e){Object.keys(e).forEach((function(t){i[t]?Object.assign(i[t],e[t]):i[t]=e[t]}))})),za({drawDefinition:t,extension:n={name:io,value:i}}),{entryProfile:i}}function Ul(e){var t=Vn({element:e.drawDefinition,name:io}).extension;return{entryProfile:(null==t?void 0:t.value)||{}}}var Sl="ALTERNATE",wl="CONFIRMED",Tl="DIRECT_ACCEPTANCE",Pl="FEED_IN",Dl="JUNIOR_EXEMPT",bl="LUCKY_LOSER",Nl="ORGANISER_ACCEPTANCE",Ml="QUALIFIER",Rl="SPECIAL_EXEMPT",Al="UNGROUPED",El="UNPAIRED",Cl="WILDCARD",xl="WITHDRAWN",Ol=[wl,Tl,Dl,Nl,Rl],Fl=[Pl,bl,Ml],kl=[wl,Tl,Pl,Dl,Nl,Rl,Cl],_l=[wl,Tl,Dl,bl,Ml,Nl,Rl,Cl],Ll=[Sl,wl,Tl,Pl,Dl,bl,Nl,Ml,"REGISTERED",Rl,Al,El,Cl,xl],jl={ALTERNATE:Sl,CONFIRMED:wl,DIRECT_ACCEPTANCE:Tl,DIRECT_ENTRY_STATUSES:kl,DRAW_SPECIFIC_STATUSES:Fl,EQUIVALENT_ACCEPTANCE_STATUSES:Ol,FEED_IN:Pl,JUNIOR_EXEMPT:Dl,LUCKY_LOSER:bl,ORGANISER_ACCEPTANCE:Nl,QUALIFIER:Ml,SPECIAL_EXEMPT:Rl,STRUCTURE_SELECTED_STATUSES:_l,UNGROUPED:Al,UNPAIRED:El,VALID_ENTRY_STATUSES:Ll,WILDCARD:Cl,WITHDRAWN:xl};function Bl(e){var t,r=e.stage,n=e.drawDefinition,i=Ul({drawDefinition:n}).entryProfile,a=Object.keys(i).includes(r);return!a&&lu.includes(r)?(yl({drawDefinition:n,attributes:[(t={},t[r]={drawSize:void 0,alternates:!0},t)]}),!0):a}function Vl(e){var t=e.stage,r=e.drawDefinition,n=e.entryStatus;return r.entries.reduce((function(e,r){return r.entryStage===t&&r.entryStatus===n?e+1:e}),0)}function Gl(e){var t,r,n=e.provisionalPositioning,i=e.placementGroup,a=e.drawDefinition,l=e.stageSequence,c=e.entryStatuses,d=e.structureId,p=e.roundTarget,v=e.stages,f=e.stage,m=null!==(r=null===(t=a.entries)||void 0===t?void 0:t.reduce((function(e,t){var r,n,i,a=null===(n=null===(r=Vn({name:fo,element:t}))||void 0===r?void 0:r.extension)||void 0===n?void 0:n.value,o=f&&t.entryStage===f||(null==v?void 0:v.length)&&t.entryStage&&v.includes(t.entryStage),u=!c||t.entryStatus&&c.includes(t.entryStatus),s=null!==(i=t.entryStageSequence)&&void 0!==i?i:1;return o&&(!l||s===l)&&u&&(!p||!a||p===a)?e.concat(t):e}),[]))&&void 0!==r?r:[];if(d&&f===su){var h=function(e){var t,r,n=e.provisionalPositioning,i=e.drawDefinition,a=e.structureId,l=[],c=(null!==(t=i.links)&&void 0!==t?t:[]).find((function(e){return e.linkType===Tu&&e.target.structureId===a}));if(c){var d=c.source,p=d.finishingPositions,v=as({drawDefinition:i,structureId:d.structureId}).structure;if((null==v?void 0:v.structureType)===Iu)(null!==(r=v.structures)&&void 0!==r?r:[]).forEach((function(e){var t,r=null!==(t=e.positionAssignments)&&void 0!==t?t:[],i=e.structureId,a=Object.assign.apply(Object,u([{}],o(r.map((function(e){var t,r,n=e.participantId,i=null===(r=Vn({element:e,name:yo}).extension)||void 0===r?void 0:r.value;return i&&n?((t={})[n]=i,t):void 0})).filter(Boolean)),!1)),c=Object.keys(a).reduce((function(e,t){var r=a[t],i=r.groupOrder||n&&r.provisionalOrder;return e.includes(i)||e.push(i),e}),[]),d=c.length===Object.keys(a).length,v=Object.keys(a).filter((function(e){var t=a[e],r=t.groupOrder||n&&t.provisionalOrder;return null==p?void 0:p.includes(r)}));n&&!d||v.forEach((function(e){var t=a[e],r=t.groupOrder,c=t.provisionalOrder,d=t.GEMscore,v=r||n&&c,f=u([],o(null!=p?p:[]),!1).sort(s).indexOf(v)+1;l.push({entryStage:su,entryStatus:Pl,placementGroup:f,groupingValue:i,participantId:e,GEMscore:d})}))}))}return{playoffEntries:l}}({provisionalPositioning:n,drawDefinition:a,structureId:d}),g=h.playoffEntries;return h.error&&console.log("playoff entries error"),((null==g?void 0:g.length)?g:m).filter((function(e){return!i||e.placementGroup===i}))}return m}function ql(e){var t,r,n,i,a=e.provisionalPositioning,o=e.returnAllProxies,u=e.drawDefinition,s=e.structureId,l=e.structure,c=[];l||(l=(t=as({drawDefinition:u,structureId:s})).structure,i=t.error);var d=ss({structure:l}).positionAssignments;if(i||!l)return{seedAssignments:[],error:De};s||(s=l.structureId);var p=l.stage,v=l.stageSequence,f=p===su&&u&&Gl({provisionalPositioning:a,drawDefinition:u,stageSequence:v,structureId:s,stage:p}),m=f?f.filter((function(e){return 1===e.placementGroup})).sort((function(e,t){return(e.GEMscore<t.GEMscore?1:e.GEMscore>t.GEMscore&&-1)||0})).map((function(e,t){var r=t+1;return{participantId:e.participantId,seedValue:r,seedProxy:!0,seedNumber:r}})):[],h=null==m?void 0:m.slice(0,o?m.length:d.length/2);return h.length?c=h:l.seedAssignments?c=l.seedAssignments:i=ye,{seedAssignments:c,stageSequence:v,seedLimit:null!==(r=l.seedLimit)&&void 0!==r?r:null===(n=null==l?void 0:l.positionAssignments)||void 0===n?void 0:n.length,stage:p,error:i}}var Wl=function(e,t){return(e||0)+(t||0)};function Hl(e,t){var r=Array.isArray(e)?e[0]:e;return isNaN(r)&&al||r<=t[ll]&&ll||r<=t[sl]&&sl||ul}function zl(e){var t=e.score,r=(null==t?void 0:t.sets)||[],n=r.reduce((function(e,t){return e[0]+=t.side1Score||0,e[1]+=t.side2Score||0,e}),[0,0]),i=r.reduce((function(e,t){return e[0]+=t.side1TiebreakScore||0,e[1]+=t.side2TiebreakScore||0,e}),[0,0]);return i.reduce(Wl)&&(n[i[0]>i[1]?0:1]+=1),{sets:r,games:n,score:t}}function Yl(e){var t=Math.min.apply(Math,u([],o(e.games),!1)),r=Math.max.apply(Math,u([],o(e.games),!1));return Math.round(t/r*100)}function Kl(e){return e.map(Yl).sort().map((function(e){return parseFloat(e.toFixed(2))}))}function Jl(e){var t=e.tournamentRecord,r=e.drawDefinition,n=e.policyType,i=e.structure,a=e.event;if(!t)return{error:W};var o=tl({tournamentRecord:t,drawDefinition:r,structure:i,event:a}).appliedPolicies;return(null==o?void 0:o[n])?{policy:o[n]}:{info:null==st?void 0:st.message}}function Zl(e){var r=e.tournamentRecord,n=e.profileBands,i=e.matchUp;if(!i)return{error:et};var a=i.score;if(!i.winningSide)return{error:xr};var o=!n&&r&&Jl({policyType:Ra,tournamentRecord:r}).policy,u=n||(null==o?void 0:o.profileBands)||dl[Ra].profileBands,s=Kl([zl({score:a})]),l=Hl(s,u),c=Array.isArray(s)?s[0]:s;return t(t({},L),{competitiveness:l,pctSpread:c})}function Xl(e){var r,n,i,a,s,l,c,d,p,v=e.matchUp;if(!v)return{error:et};if(v&&!v.sides)return{error:tt};if(v&&!v.hasContext)return{error:Sr};var f=null===(n=null!==(r=v.sides)&&void 0!==r?r:[])||void 0===n?void 0:n.map((function(e){return null==e?void 0:e.participantId})).filter(Boolean),m=null!==(a=null===(i=v.sides)||void 0===i?void 0:i.filter((function(e){var t;return(null===(t=e.participant)||void 0===t?void 0:t.participantType)===fs})).map((function(e){return e.participantId})).filter(Boolean))&&void 0!==a?a:[],h=null!==(c=null===(l=null!==(s=v.sides)&&void 0!==s?s:[])||void 0===l?void 0:l.map((function(e){var t;return null===(t=e.participant)||void 0===t?void 0:t.individualParticipants})).filter(Boolean))&&void 0!==c?c:[],g=h.map((function(e){return(null!=e?e:[]).map((function(e){return null==e?void 0:e.participantId})).filter(Boolean)})),I=null!==(d=u(u([],o(m),!1),o(g.flat()),!1).filter(Boolean))&&void 0!==d?d:[],y=null!==(p=U(I.concat(f)).filter(Boolean))&&void 0!==p?p:[];return t({nestedIndividualParticipantIds:g,allRelevantParticipantIds:y,individualParticipantIds:I,sideParticipantIds:f},L)}var Ql="CHECK_IN",$l="CHECK_OUT",ec="SCHEDULE.ASSIGNMENT.VENUE",tc="SCHEDULE.ALLOCATION.COURTS",rc="SCHEDULE.ASSIGNMENT.COURT",nc="SCHEDULE.COURT.ORDER",ic="SCHEDULE.DATE",ac="SCHEDULE.ASSIGN.OFFICIAL",oc="SCHEDULE.TIME.SCHEDULED",uc="SCHEDULE.TIME.START",sc="SCHEDULE.TIME.STOP",lc="SCHEDULE.TIME.RESUME",cc="SCHEDULE.TIME.END",dc="SCHEDULE.TIME.MODIFIERS",pc="TO_BE_ANNOUNCED",vc="NEXT_AVAILABLE",fc="FOLLOWED_BY",mc="AFTER_REST",hc="RAIN_DELAY",gc=[pc,vc,fc,mc,hc],Ic="SCALE",yc="RATING",Uc="RANKING",Sc="SEEDING",wc="PUBLISH",Tc="PUBLIC",Pc="STATUS",Dc={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:gc,AFTER_REST:mc,ALLOCATE_COURTS:tc,ASSIGN_COURT:rc,ASSIGN_OFFICIAL:ac,ASSIGN_VENUE:ec,CHECK_IN:Ql,CHECK_OUT:$l,COMPLETED_DATE:"COMPLETED.DATE",COURT_ORDER:nc,ELIGIBILITY:"ELIGIBILITY",END_TIME:cc,FOLLOWED_BY:fc,MEDICAL:"MEDICAL",MODIFICATION:"MODIFICATION",NEXT_AVAILABLE:vc,NOT_BEFORE:"NOT_BEFORE",OTHER:"other",PENALTY:"PENALTY",PUBLIC:Tc,PUBLISH:wc,RANKING:Uc,RATING:yc,RAIN_DELAY:hc,REGISTRATION:"REGISTRATION",RESUME_TIME:lc,RETRIEVAL:"RETRIEVAL",SCALE:Ic,SCHEDULE:"SCHEDULE",SCHEDULED_DATE:ic,SCHEDULED_TIME:oc,SEEDING:Sc,START_TIME:uc,STATUS:Pc,STOP_TIME:sc,SUSPENSION:"SUSPENSION",TIME_MODIFIERS:dc,TO_BE_ANNOUNCED:pc};function bc(e){var r,n=e.matchUp;if(!n)return{error:et};if(!n.hasContext)return{error:Sr};if(!n.sides||2!==n.sides.filter(Boolean).length)return{error:tt};var i=Xl({matchUp:n}),a=i.nestedIndividualParticipantIds,o=i.allRelevantParticipantIds,u=i.sideParticipantIds,s=(null!==(r=n.timeItems)&&void 0!==r?r:[]).filter((function(e){return(null==e?void 0:e.itemType)&&[Ql,$l].includes(e.itemType)})).sort((function(e,t){return(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0)})),l=s.map((function(e){return e.itemValue})).filter((function(e){return s.filter((function(t){return(null==t?void 0:t.itemValue)===e})).reverse()[0].itemType===Ql}));null==a||a.forEach((function(e,t){var r=null==u?void 0:u[t],n=(null==e?void 0:e.length)&&e.every((function(e){return l.includes(e)}));r&&n&&!l.includes(r)&&l.push(r)})),null==u||u.forEach((function(e,t){var r;l.includes(e)&&(null!==(r=null==a?void 0:a[t])&&void 0!==r?r:[]).forEach((function(e){e&&!l.includes(e)&&l.push(e)}))}));var c=null==u?void 0:u.reduce((function(e,t){return l.includes(t)&&e}),!0);return t({allRelevantParticipantIds:o,allParticipantsCheckedIn:c,checkedInParticipantIds:l},L)}function Nc(e){var t=e||{},r=t.matchUpAverageTimes,n=t.matchUpFormat,i=(null==r?void 0:r.map((function(e){var t=e.matchUpFormatCodes;return null==t?void 0:t.filter((function(e){return e===n}))})).flat().filter(Boolean).sort((function(e,t){return((null==e?void 0:e.length)||0)-((null==t?void 0:t.length)||0)})))||[],a=i.includes(n)?n:i[0],o=null==r?void 0:r.find((function(e){var t=e.matchUpFormatCodes,r=e.averageTimes;return(null==t?void 0:t.find((function(e){return a===e})))&&r}));return null==o?void 0:o.averageTimes}function Mc(e){var t,r=e||{},n=r.matchUpRecoveryTimes,i=r.averageMinutes,a=r.matchUpFormat;return null===(t=null==n?void 0:n.find((function(e){var t=e.matchUpFormatCodes,r=e.averageTimes,n=e.recoveryTimes;if(r&&i){var o=r.greaterThan,u=void 0===o?0:o,s=r.lessThan;if(i>u&&i<(void 0===s?360:s))return!0}return(null==t?void 0:t.find((function(e){return e===a})))&&n})))||void 0===t?void 0:t.recoveryTimes}function Rc(e){var t=e.timesBlockArray,r=e.categoryName,n=e.categoryType;return t.filter((function(e){return Array.isArray(e)})).map((function(e){return e.sort((function(e,t){var r,n;return((null===(r=t.categoryNames)||void 0===r?void 0:r.length)||0)-((null===(n=e.categoryNames)||void 0===n?void 0:n.length)||0)})).find((function(e){var t=e.categoryTypes,i=e.categoryNames;return!(null==i?void 0:i.length)&&!(null==t?void 0:t.length)||(null==i?void 0:i.includes(r))||(null==t?void 0:t.includes(n))}))})).find(Boolean)}function Ac(e){var t,r,n,i,a,o,u=e.tournamentRecord,s=e.categoryName,l=e.categoryType,c=e.event;s=null!==(r=null!=s?s:null===(t=null==c?void 0:c.category)||void 0===t?void 0:t.categoryName)&&void 0!==r?r:null===(n=null==c?void 0:c.category)||void 0===n?void 0:n.ageCategoryCode,l=null!==(a=null!=l?l:null===(i=null==c?void 0:c.category)||void 0===i?void 0:i.categoryType)&&void 0!==a?a:null===(o=null==c?void 0:c.category)||void 0===o?void 0:o.subType;var d=Jl({policyType:_a,tournamentRecord:u,event:c}).policy,p=u?Vn({element:u,name:ho}).extension:void 0,v=null==p?void 0:p.value,f=c&&Vn({name:ho,element:c}).extension;return{scheduleTiming:{tournamentScheduling:v,eventScheduling:null==f?void 0:f.value,categoryName:s,categoryType:l,policy:d}}}var Ec="DOUBLES_SINGLES",Cc="SINGLES_DOUBLES",xc="total",Oc="participantConflict",Fc="matchUpConflict",kc="ISSUE_IDS",_c="CONFLICT",Lc="WARNING",jc="ERROR",Bc="ISSUE",Vc="STATE",Gc={SINGLES_DOUBLES:Cc,DOUBLES_SINGLES:Ec,TOTAL:xc,CONFLICT_MATCHUP_ORDER:Fc,CONFLICT_PARTICIPANTS:Oc,SCHEDULE_ISSUE_IDS:kc,SCHEDULE_CONFLICT:_c,SCHEDULE_WARNING:Lc,SCHEDULE_ERROR:jc,SCHEDULE_ISSUE:Bc,SCHEDULE_STATE:Vc};function qc(e){var r,n=e.defaultAverageMinutes,i=void 0===n?90:n,a=e.defaultRecoveryMinutes,o=void 0===a?0:a,u=e.tournamentRecord,s=e.matchUpFormat,l=e.categoryName,c=e.categoryType,d=e.eventType,p=e.event;if(!u)return{error:W};d=null!==(r=null!=d?d:null==p?void 0:p.eventType)&&void 0!==r?r:fa;var v={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:o}}]},f=Ac({tournamentRecord:u,categoryName:l,categoryType:c,event:p}).scheduleTiming;return Wc({eventType:d,timingDetails:t(t({},f),{matchUpFormat:s,categoryType:c,defaultTiming:v})})}function Wc(e){var r=e.timingDetails,n=e.eventType,i=function(e){var r,n=e.matchUpFormat,i=e.categoryName,a=e.categoryType,o=e.defaultTiming,u=e.tournamentScheduling,s=e.eventScheduling,l=e.policy;return Rc({categoryName:i,categoryType:a,timesBlockArray:[(null==s?void 0:s.matchUpAverageTimes)&&Nc(t(t({},s),{matchUpFormat:n})),(null==u?void 0:u.matchUpAverageTimes)&&Nc(t(t({},u),{matchUpFormat:n})),(null==l?void 0:l.matchUpAverageTimes)&&Nc(t(t({},l),{matchUpFormat:n})),null===(r=null==l?void 0:l.defaultTimes)||void 0===r?void 0:r.averageTimes,null==o?void 0:o.averageTimes]})}(r),a=Object.keys((null==i?void 0:i.minutes)||{}),o=(null==i?void 0:i.minutes)&&((null==a?void 0:a.includes(n))&&i.minutes[n]||i.minutes.default),u=function(e){var r,n=e.tournamentScheduling,i=e.eventScheduling,a=e.averageMinutes,o=e.defaultTiming,u=e.matchUpFormat,s=e.categoryName,l=e.categoryType,c=e.policy;return Rc({categoryName:s,categoryType:l,timesBlockArray:[(null==i?void 0:i.matchUpRecoveryTimes)&&Mc(t(t({},i),{averageMinutes:a,matchUpFormat:u})),(null==n?void 0:n.matchUpRecoveryTimes)&&Mc(t(t({},n),{averageMinutes:a,matchUpFormat:u})),(null==c?void 0:c.matchUpRecoveryTimes)&&Mc(t(t({},c),{averageMinutes:a,matchUpFormat:u})),null===(r=null==c?void 0:c.defaultTimes)||void 0===r?void 0:r.recoveryTimes,null==o?void 0:o.recoveryTimes]})}(t(t({},r),{averageMinutes:o})),s=Object.keys((null==u?void 0:u.minutes)||{}),l=(null==u?void 0:u.minutes)&&((null==s?void 0:s.includes(n))&&u.minutes[n]||u.minutes.default),c=n===fa?Cc:Ec;return{averageMinutes:o,recoveryMinutes:l,typeChangeRecoveryMinutes:(null==u?void 0:u.minutes)&&((null==s?void 0:s.includes(c))&&u.minutes[c]||l)}}function Hc(e){return e.createdAt?new Date(e.createdAt).getTime():0}function zc(e){var t=e.visibilityThreshold,r=e.timeItems,n=e.itemType,i=r.filter((function(e){return e&&e.itemType===n&&(!t||Hc(e)<new Date(t).getTime())})).sort((function(e,t){return Hc(e)-Hc(t)})).pop(),a=i&&Hc(i);return{itemValue:null==i?void 0:i.itemValue,timeStamp:a}}function Yc(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:oc,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{scheduledTime:o}:n}function Kc(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:ic,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{scheduledDate:o}:n}function Jc(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:tc,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{allocatedCourts:Ui(o,!1,!0)}:n}function Zc(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:rc,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{courtId:o}:n}function Xc(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:ec,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{venueId:o}:n}function Qc(e){var t=e.tournamentRecords;if("object"!=typeof t||!Object.keys(t).length)return{error:q};var r=Object.assign.apply(Object,u([{}],o(Object.keys(t).map((function(e){var r,n,i=t[e],a=null==i?void 0:i.tournamentId,o=Vn({element:i,name:so}).extension,u=((null===(n=null==o?void 0:o.value)||void 0===n?void 0:n.tournamentIds)||[]).filter((function(e){return e!==a}));return(r={})[e]=u,r}))),!1));return{linkedTournamentIds:r}}function $c(e){var t,r,n;return null!==(n=null!==(r=null==e?void 0:e.tournamentRecords)&&void 0!==r?r:(null==e?void 0:e.tournamentRecord)&&((t={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,t))&&void 0!==n?n:{}}function ed(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);var r=4294967295*Math.random()|0,n=4294967295*Math.random()|0,i=4294967295*Math.random()|0,a=4294967295*Math.random()|0;return e[255&r]+e[r>>8&255]+e[r>>16&255]+e[r>>24&255]+"-"+e[255&n]+e[n>>8&255]+"-"+e[n>>16&15|64]+e[n>>24&255]+"-"+e[63&i|128]+e[i>>8&255]+"-"+e[i>>16&255]+e[i>>24&255]+e[255&a]+e[a>>8&255]+e[a>>16&255]+e[a>>24&255]}var td="addDrawDefinition",rd="addMatchUps",nd="addParticipants",id="addScaleItems",ad="addVenue",od="audit",ud="deleteParticipants",sd="deleteVenue",ld="deletedDrawIds",cd="deletedMatchUpIds",dd="modifyDrawDefinition",pd="modifyDrawEntries",vd="modifyEventEntries",fd="modifyMatchUp",md="modifyParticipants",hd="modifyPositionAssignments",gd="modifySeedAssignments",Id="modifyTournamentDetail",yd="modifyVenue",Ud="mutations",Sd="publishEvent",wd="publishEventSeeding",Td="publishOrderOfPlay",Pd="unPublishEvent",Dd="unPublishEventSeeding",bd="unPublishOrderOfPlay",Nd="updateInContextMatchUp",Md={ADD_DRAW_DEFINITION:td,ADD_MATCHUPS:rd,ADD_PARTICIPANTS:nd,ADD_SCALE_ITEMS:id,ADD_VENUE:ad,AUDIT:od,DELETE_PARTICIPANTS:ud,DELETE_VENUE:sd,DELETED_DRAW_IDS:ld,DELETED_MATCHUP_IDS:cd,MODIFY_DRAW_DEFINITION:dd,MODIFY_DRAW_ENTRIES:pd,MODIFY_EVENT_ENTRIES:vd,MODIFY_MATCHUP:fd,MODIFY_PARTICIPANTS:md,MODIFY_POSITION_ASSIGNMENTS:hd,MODIFY_SEED_ASSIGNMENTS:gd,MODIFY_TOURNAMENT_DETAIL:Id,MODIFY_VENUE:yd,MUTATIONS:Ud,PUBLISH_EVENT_SEEDING:wd,PUBLISH_EVENT:Sd,PUBLISH_ORDER_OF_PLAY:Td,UNPUBLISH_EVENT_SEEDING:Dd,UNPUBLISH_EVENT:Pd,UNPUBLISH_ORDER_OF_PLAY:bd,UPDATE_INCONTEXT_MATCHUP:Nd};function Rd(e){var r,n,i=e.disableNotice,o=e.venue,u=e.context;if("object"!=typeof o)return{error:xr};var s,l=$c(e);o.venueId||(o.venueId=ed());try{for(var c=a(Object.values(l)),d=c.next();!d.done;d=c.next()){var p=Ad({disableNotice:!0,tournamentRecord:d.value,context:u,venue:o});if(null==p?void 0:p.error)return p;s=p.venue}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return i||mn({topic:ad,payload:{venue:o}}),xn(t(t({},L),{venue:s}))}function Ad(e){var r=e.tournamentRecord,n=e.disableNotice,i=e.context,a=e.venue;return r?a?(r.venues||(r.venues=[]),a.venueId||(a.venueId=ed()),r.venues.reduce((function(e,t){return e||t.venueId===a.venueId}),void 0)?{error:lr}:(i&&jn({element:a,extension:{value:i,name:Qa}}),r.venues.push(a),n||mn({payload:{venue:a,tournamentId:r.tournamentId},topic:ad}),t(t({},L),{venue:Ui(a)}))):{error:pt,info:"missing venue"}:{error:W}}function Ed(e){var r,n,i,o,u=e.tournamentRecords,s=e.tournamentRecord,l=e.venueId;if(!s)return{error:W};if(!l)return{error:dr};var c=(null!==(i=s.venues)&&void 0!==i?i:[]).reduce((function(e,t){return t.venueId===l?t:e}),void 0);if(!c&&u){var d=(null!==(o=Qc({tournamentRecords:u}).linkedTournamentIds)&&void 0!==o?o:[])[s.tournamentId];try{for(var p=a(d),v=p.next();!v.done;v=p.next()){var f=Ed({tournamentRecord:u[v.value],venueId:l});if(f.success&&f.venue)return Rd({tournamentRecord:s,venue:f.venue}),t(t({},L),{venue:c})}}catch(e){r={error:e}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}}return c?t(t({},L),{venue:c}):{error:cr}}function Cd(e){var r,n,i,o,u=e.tournamentRecords,s=e.tournamentRecord,l=e.courtId;if(!s)return{error:W};if(!l)return{error:dt};var c,d;if((null!==(i=s.venues)&&void 0!==i?i:[]).forEach((function(e){var t;(null!==(t=e.courts)&&void 0!==t?t:[]).forEach((function(t){t.courtId===l&&(c=t,d=e)}))})),c)return t(t({},L),{court:c,venue:d});if(u){var p=(null!==(o=Qc({tournamentRecords:u}).linkedTournamentIds)&&void 0!==o?o:[])[s.tournamentId];try{for(var v=a(p),f=v.next();!f.done;f=v.next()){var m=Cd({tournamentRecord:u[f.value],courtId:l});if(m.success)return m.venue&&Rd({tournamentRecord:s,venue:m.venue}),t(t({},L),{court:c,venue:d})}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}}return On({result:{error:ur},stack:"findCourt"})}function xd(e){var r=e.tournamentRecord,n=e.internalUse,i=e.courtId;if(!r)return{error:W};if(!i)return{error:dt};var a=Cd({tournamentRecord:r,courtId:i});if(a.error)return a;var o=a.court&&function(e){return{altitude:e.altitude,courtId:e.courtId,courtName:e.courtName,courtDimensions:e.courtDimensions,latitude:e.latitude,longitude:e.longitude,surfaceCategory:e.surfaceCategory,surfaceType:e.surfaceType,surfacedDate:e.surfacedDate,pace:e.pace,notes:e.notes}}(a.court);return t(t({},L),{courtInfo:Ui(o,!1,n)})}function Od(e){var r,n,i=e.tournamentRecord,a=e.venueId;if(!i)return{error:W};if(!a)return{error:dr};var o=Ed({tournamentRecord:i,venueId:a});if(o.error)return o;var u=(null!==(n=null===(r=o.venue)||void 0===r?void 0:r.courts)&&void 0!==n?n:[]).map((function(e){return function(e){var r=e.courtInfo;return t({},r)}(xd({courtId:e.courtId,internalUse:!0,tournamentRecord:i}))})),s=o.venue&&function(e){var t=e.venueId,r=e.venueName;return{venueAbbreviation:e.venueAbbreviation,venueName:r,venueId:t}}(o.venue),l=s&&t(t({},s),{courtsInfo:u});return t(t({},L),{venueData:Ui(l,!1,!0)})}function Fd(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:dc,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{timeModifiers:o}:n}function kd(e){if(qn.test(e)){var t=Zn();return new Date("".concat(t,"T").concat(e))}return new Date(e)}function _d(e){var t,r=e.event,n=e.eventId;if(!r)return{error:Ae};var i=Vn({name:ao,element:r}),a=null==i?void 0:i.extension,o=n?Ui(null==a?void 0:a.value,!1,!0):null==a?void 0:a.value;return n&&(null===(t=r.drawDefinitions)||void 0===t||t.forEach((function(e){var t;null===(t=null==o?void 0:o.flights)||void 0===t||t.forEach((function(t){t.drawId===e.drawId&&Object.assign(t,{drawDefinition:e})}))}))),{flightProfile:o}}function Ld(e){var r,n,i,a,o=e.tournamentRecord,u=e.eventId,s=e.drawId,l="findEvent",c={},d=null!==(i=null!==(n=e.tournamentRecords)&&void 0!==n?n:o&&((r={})[o.tournamentId]=o,r))&&void 0!==i?i:{},p=Object.values(d).map((function(e){var t=e.events,r=e.tournamentId;return t&&t.forEach((function(e){c[e.eventId]={tournamentId:r}})),null!=t?t:[]})).flat();if(s){var v,f=p.find((function(e){var t,r,n,i=(null!==(t=null==e?void 0:e.drawDefinitions)&&void 0!==t?t:[]).find((function(e){return e.drawId===s}));if(i)v=i,a=c[e.eventId].tournamentId;else{var o=e&&(null===(r=_d({event:e}))||void 0===r?void 0:r.flightProfile),u=null===(n=null==o?void 0:o.flights)||void 0===n?void 0:n.find((function(e){return e.drawId===s}));if(u)return a=c[e.eventId].tournamentId,{entries:u.drawEntries,drawName:u.drawName,tournamentId:a,drawId:s}}return i}));if(f)return{event:f,drawDefinition:v,tournamentId:a}}if(u){var m=p.find((function(e){return(null==e?void 0:e.eventId)===u}));return m?{event:m,drawDefinition:void 0,tournamentId:a=c[m.eventId].tournamentId}:t({event:void 0,drawDefinition:void 0},On({result:{error:Ee},stack:l}))}return t({event:void 0,drawDefinition:void 0},On({result:{error:Z},context:{drawId:s,eventId:u},stack:l}))}function jd(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P=e.event,D=e.matchUpType,b=e.scheduleVisibilityFilters,N=e.afterRecoveryTimes,M=e.tournamentRecord,R=e.usePublishState,A=e.scheduleTiming,E=e.matchUpFormat,C=e.publishStatus,x=e.matchUp;if(!x)return{error:et};if(N&&!x.matchUpType&&!e.matchUpType&&(P||M)&&x.drawId){var O=null===(p=null==P?void 0:P.drawDefinitions)||void 0===p?void 0:p.find((function(e){return e.drawId===x.drawId}));!O&&M&&(O=(r=Ld({tournamentRecord:M,drawId:x.drawId})).drawDefinition,P=r.event);var F=x.structureId&&(null===(v=null==O?void 0:O.structures)||void 0===v?void 0:v.find((function(e){return e.structureId===x.structureId})));D=e.matchUpType||(null==F?void 0:F.matchUpType)||(null==O?void 0:O.matchUpType)||(null==P?void 0:P.eventType)!==ga&&(null==P?void 0:P.eventType)}var k,_=function(e){var t=e.matchUp;if(!t)return{error:et};if(!t.timeItems)return{error:Ur};var r,n,i=t.timeItems.filter((function(e){return[uc,sc,lc,cc].includes(null==e?void 0:e.itemType)})).sort((function(e,t){return kd(e.itemValue).getTime()-kd(t.itemValue).getTime()})),a=i.reduce((function(e,t){var r,n,i,a=null===(r=null==t?void 0:t.itemType)||void 0===r?void 0:r.split("."),o=(null===(n=null==t?void 0:t.itemType)||void 0===n?void 0:n.startsWith("SCHEDULE.TIME"))&&a[2],u="SCHEDULE.TIME.".concat(o);switch(u){case uc:i=0;break;case cc:if(e.lastValue&&[uc,lc].includes(e.lastType)){var s=kd(t.itemValue).getTime()-kd(e.lastValue).getTime();i=e.milliseconds+s}else i=e.milliseconds;break;case sc:[uc,"SCHECULE.TIME.RESUME"].includes(e.lastType)?(s=kd(t.itemValue).getTime()-kd(e.lastValue).getTime(),i=e.milliseconds+s):i=e.milliseconds;break;default:i=e.milliseconds}return{milliseconds:i,lastType:u,lastValue:t.itemValue}}),{milliseconds:0,lastType:void 0,lastValue:void 0});if([uc,lc].includes(a.lastType)){var o=(new Date).getTime()-kd(a.lastValue).getTime();a.milliseconds+=o}return{milliseconds:a.milliseconds,time:(r=a.milliseconds,n=function(e,t){return void 0===t&&(t=2),("00"+e).slice(-t)},n(r/36e5|0)+":"+n(r%36e5/6e4|0)+":"+n(r%6e4/1e3|0)),relevantTimeItems:i}}({matchUp:x}),L=_.milliseconds,j=_.time,B=function(e){var t=e.matchUp,r=(null==t?void 0:t.timeItems)||[],n=function(e){return e.createdAt?new Date(e.createdAt).getTime():0},i=r.reduce((function(e,t){var r=t.itemType===uc&&t;return r&&(!e||n(r)<n(e))?r:e}),void 0);return{startTime:null==i?void 0:i.itemValue}}({matchUp:x}).startTime,V=function(e){var t=e.matchUp,r=(null==t?void 0:t.timeItems)||[],n=function(e){return e.createdAt?new Date(e.createdAt).getTime():0},i=r.reduce((function(e,t){var r=t.itemType===cc&&t;return r&&(!e||n(r)>n(e))?r:e}),void 0);return{endTime:null==i?void 0:i.itemValue}}({matchUp:x}).endTime,G=null!=b?b:{},q=G.visibilityThreshold,W=G.eventIds,H=G.drawIds;if(W&&!W.includes(x.eventId)||H&&!H.includes(x.drawId))k=xn({milliseconds:L,startTime:B,endTime:V,time:j});else{var z={matchUp:x,visibilityThreshold:q},Y=Jc(z).allocatedCourts,K=Yc(z).scheduledTime,J=Kc(z).scheduledDate,Z=Xc(z).venueId,X=Zc(z).courtId,Q=function(e){var t=e.visibilityThreshold,r=e.timeStamp,n=e.schedule,i=e.matchUp,a=zc({timeItems:(null==i?void 0:i.timeItems)||[],itemType:nc,visibilityThreshold:t}),o=a.itemValue,u=a.timeStamp;return!n||u&&r&&new Date(u).getTime()>new Date(r).getTime()?{courtOrder:o}:n}(z).courtOrder,$=Fd(z).timeModifiers,ee=void 0,te=void 0,re=void 0,ne=void 0,ie=void 0,ae=null!==(f=x.matchUpType)&&void 0!==f?f:D;if(A&&K&&N&&ae)te=void 0===(i=(n=Wc({timingDetails:t({matchUpFormat:null!==(m=x.matchUpFormat)&&void 0!==m?m:E},A),eventType:ae})).averageMinutes)?0:i,re=void 0===(s=n.recoveryMinutes)?0:s,ne=void 0===(l=n.typeChangeRecoveryMinutes)?0:l,(te||re)&&(ee=V?mi(oi(V),re):mi(K,te+re)),ne&&(ie=V?mi(oi(V),ne):mi(K,te+ne));!J&&K&&(J=ui(K));var oe=zn({scheduledDate:J,scheduledTime:K}),ue={},se=(null===(h=M&&Z&&Od({tournamentRecord:M,venueId:Z}))||void 0===h?void 0:h.venueData)||{};Z&&(ue[Z]=se);var le=se.venueName,ce=se.venueAbbreviation,de=se.courtsInfo,pe=X&&(null==de?void 0:de.find((function(e){return e.courtId===X}))),ve=null==pe?void 0:pe.courtName,fe=function(e){if(!M)return"break";e.venueId&&!ue[e.venueid]&&(ue[e.venueId]=null===(g=Od({venueId:e.venueId,tournamentRecord:M}))||void 0===g?void 0:g.venueData);var t=ue[e.venueId];e.venueName=null==t?void 0:t.venueName;var r=null===(I=null==t?void 0:t.courtsInfo)||void 0===I?void 0:I.find((function(t){return t.courtId===e.courtId}));e.courtName=null==r?void 0:r.courtName};try{for(var me=a(Y||[]),he=me.next();!he.done;he=me.next()){if("break"===fe(he.value))break}}catch(e){c={error:e}}finally{try{he&&!he.done&&(d=me.return)&&d.call(me)}finally{if(c)throw c.error}}k=xn({typeChangeTimeAfterRecovery:ie,timeAfterRecovery:ee,scheduledDate:J,scheduledTime:K,isoDateString:oe,allocatedCourts:Y,timeModifiers:$,venueAbbreviation:ce,venueName:le,venueId:Z,courtOrder:Q,courtName:ve,courtId:X,typeChangeRecoveryMinutes:ne,recoveryMinutes:re,averageMinutes:te,milliseconds:L,startTime:B,endTime:V,time:j})}var ge=Kc({matchUp:x}).scheduledDate,Ie=Yc({matchUp:x}).scheduledTime;if(R&&(null===(y=null==C?void 0:C.displaySettings)||void 0===y?void 0:y.draws)){var ye=C.displaySettings.draws,Ue=null===(S=null!==(U=null==ye?void 0:ye[x.drawId])&&void 0!==U?U:null==ye?void 0:ye.default)||void 0===S?void 0:S.scheduleDetails;if(Ue){var Se=null===(T=null!==(w=Ue.find((function(e){var t;return ge&&(null===(t=e.dates)||void 0===t?void 0:t.includes(ge))})))&&void 0!==w?w:Ue.find((function(e){var t;return!(null===(t=e.dates)||void 0===t?void 0:t.length)})))||void 0===T?void 0:T.attributes;if(Se){var we=Object.assign.apply(Object,u(u([{}],o(Object.keys(k).map((function(e){var t;return(t={})[e]=!0,t}))),!1),[Se],!1));k=Na({source:k,template:we})}}}return{schedule:k,endDate:x.matchUpStatus&&eu.includes(x.matchUpStatus)&&(ui(V)||ui(ge)||ui(Ie))||void 0}}function Bd(e){if(e){var t=e.tieFormatId,r=e.tieFormats;return e.tieFormat?e.tieFormat:t&&Array.isArray(r)?r.find((function(e){return e.tieFormatId===t})):void 0}}function Vd(e){var t,r,n,i=e.item,a=e.drawDefinition,o=e.structure,u=e.event;if(i){if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){if(a.tieFormat)return a.tieFormat;var s=null===(t=a.tieFormats)||void 0===t?void 0:t.find((function(e){return i.tieFormatId===e.tieFormatId}));return s||(u.tieFormat?u.tieFormat:null===(r=u.tieFormats)||void 0===r?void 0:r.find((function(e){return i.tieFormatId===e.tieFormatId})))}if(o.tieFormat)return o.tieFormat;if(o.tieFormatId){var l=null===(n=a.tieFormats)||void 0===n?void 0:n.find((function(e){return o.tieFormatId===e.tieFormatId}));if(l)return l}}}function Gd(e){var t=e.drawDefinition,r=e.structure,n=e.matchUp,i=e.event;return{tieFormat:Vd({item:n,drawDefinition:t,structure:r,event:i})||Vd({item:r,drawDefinition:t,structure:r,event:i})||Bd(t)||Bd(i)}}function qd(e){if(!Array.isArray(e))return"";var t=e.filter(f);return t.length?U([Math.min.apply(Math,u([],o(t),!1)),Math.max.apply(Math,u([],o(t),!1))]).join("-"):""}var Wd,Hd,zd="timed",Yd="NOAD",Kd="SET",Jd={S:"normal",F:"final"};function Zd(e){if("string"==typeof e){var t=e.startsWith("T")&&zd||e.startsWith(Kd)&&Kd||"";if(t===zd){var r=ep(e);if(r)return{simplified:!0,setFormat:r,bestOf:1}}if(t===Kd)return function(e){var t=e.split("-"),r=rp(t[0].slice(3)),n=1===r||r%2!=0?r:void 0,i=1!==r&&r%2==0?r:void 0,a=t&&Xd(t[1]),o=t&&Xd(t[2]),u=a&&a.timed||o&&o.timed,s=n&&n<6||u&&i,l=!t[2]||o,c=a,d=xn({setFormat:a,exactly:i,bestOf:n});o&&(d.finalSetFormat=o);if(s&&c&&l)return d}(e)}}function Xd(e){if(":"===(null==e?void 0:e[1])){var t=e.split(":"),r=Jd[t[0]],n=t[1];if(r&&n){if(n.startsWith("TB")){var i=$d(n);return!1!==i&&("object"==typeof i?{tiebreakSet:i}:void 0)}if(n.startsWith("T"))return ep(n);var a=e.match(/^[FS]:(\d+)([A-Za-z]*)/),o=a&&tp(a[2])||!1,u=!(null==a?void 0:a[2])||o,s=a?rp(a[1]):void 0,l=Qd(n),c=!1!==l,d=c&&l||s,p=$d(n.split("/")[1]),v=!1!==p,f={setTo:s};return o&&(f.NoAD=!0),p?(f.tiebreakFormat=p,f.tiebreakAt=d):f.noTiebreak=!0,s&&u&&v&&c&&f||!1}}}function Qd(e,t){void 0===t&&(t=!0);var r=(null==e?void 0:e.indexOf("@"))>0&&e.split("@");if(r)return(t?rp(r[1]):r[1])||!1}function $d(e){if(e){if(e.startsWith("TB")){var t=Qd(e,!1),r=e.match(/^TB(\d+)([A-Za-z]*)/),n=null==r?void 0:r[1],i=r&&tp(r[2]),a=!(null==r?void 0:r[2])||i,o=rp(n);if(o&&a){var u={tiebreakTo:o};return t&&"string"==typeof t&&!I(t)&&(u.modifier=t),i&&(u.NoAD=!0),u}return!1}return!1}}function ep(e){var t,r=e.slice(1),n=r.match(/^(\d+)(@?[A-Za-z]*)/),i=rp(null==n?void 0:n[1]);if(i){var a={timed:!0,minutes:i},o=null==n?void 0:n[2],u=[void 0,"P","G"].includes(o);if(o&&!u){var s=null===(t=r.match(/^(\d+)(@)([A-Za-z]+)$/))||void 0===t?void 0:t[3];return s?(a.modifier=s,a):void 0}return o&&(a.based=n[2]),a}}function tp(e){return e&&e.indexOf(Yd)>=0}function rp(e){return isNaN(Number(e))?0:Number(e)}function np(e){var t,r,n=e.roundsNotPowerOf2,i=e.drawDefinition,a=e.structure,o=e.matchUps;if(!a)return!1;o=null!==(t=null!=o?o:a.matchUps)&&void 0!==t?t:[],n=null!=n?n:Xs({matchUps:o}).roundsNotPowerOf2;var u=!!(null===(r=a.positionAssignments)||void 0===r?void 0:r.find((function(e){return e.drawPosition})))||!!(null==o?void 0:o.find((function(e){var t=e.drawPositions;return null==t?void 0:t.length})));return(!(null==i?void 0:i.drawType)||i.drawType!==Fu)&&!(null==a?void 0:a.structures)&&n&&u}function ip(e){var t=e.drawDefinition,r=e.structure;if(!r)return!1;var n=r.matchUps||r.roundMatchUps&&Object.values(r.roundMatchUps).flat(),i=null==n?void 0:n.find((function(e){return null==e?void 0:e.roundPosition})),a=null==n?void 0:n.find((function(e){var t;return null===(t=null==e?void 0:e.drawPositions)||void 0===t?void 0:t.length}));return!((null==r?void 0:r.structures)||(null==r?void 0:r.stage)===uu||(null==t?void 0:t.drawType)&&t.drawType!==Nu||i||a)}var ap=((Wd={})[Oa]={policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:(Hd={},Hd[iu]="",Hd[su]="P",Hd[au]="Q",Hd[ou]="C",Hd)},Wd);function op(e){var t,r,n=da(e,[(t={},t[Qi]=!0,t)]);if(n.error)return n;var i=null==e?void 0:e.matchUp,a=null==i?void 0:i.matchUpType;if(!a&&(null===(r=null==i?void 0:i.sides)||void 0===r?void 0:r.length)){var o=i.sides.find((function(e){return e.participant})),u=null==o?void 0:o.participant,s=null==u?void 0:u.participantType;a=s===fs&&Es||s===hs&&xs||s===gs&&gs||void 0}return{matchUpType:a}}function up(e){var t=e.matchUps,r=e.isCollectionMatchUp,n=e.excludeMatchUpStatuses,i=e.matchUpStatuses,a=e.hasWinningSide,o=e.matchUpFormats,u=e.roundPositions,s=e.matchUpFormat,l=e.collectionIds,c=e.isMatchUpTie,d=e.roundNumbers,p=e.matchUpIds,v=e.roundNames,f=e.stageSequences,m=e.scheduledDates,h=e.scheduledDate,g=e.participantIds,I=e.processContext,y=e.tournamentIds,U=e.matchUpTypes,S=e.structureIds,w=e.readyToScore,T=e.courtIds,P=e.eventIds,D=e.venueIds,b=e.drawIds,N=e.stages,M=e.filterMatchUpIds,R=void 0===M||M,A=e.filterMatchUpTypes,E=void 0===A||A,C=Array.isArray(g)?g.filter(Boolean):[],x=Array.isArray(i)?i.filter(Boolean):[],O=Array.isArray(n)?n.filter(Boolean):[],F=Array.isArray(N)?N.filter(Boolean):[],k=Array.isArray(f)?f.filter(Boolean):[],_=Array.isArray(l)?l.filter(Boolean):[],L=Array.isArray(v)?v.filter(Boolean):[],j=Array.isArray(d)?d.filter(Boolean):[],B=Array.isArray(u)?u.filter(Boolean):[],V=Array.isArray(p)&&R?p.filter(Boolean):[],G=Array.isArray(U)&&E?U.filter(Boolean):[],q=Array.isArray(T)?T.filter(Boolean):[],W=Array.isArray(D)?D.filter(Boolean):[],H=Array.isArray(o)&&o.filter(Boolean)||"string"==typeof s&&[s]||[],z=Array.isArray(m)&&m.filter(Boolean)||"string"==typeof h&&h.length&&[h]||[],Y=Array.isArray(y)?y.filter(Boolean):[],K=Array.isArray(P)?P.filter(Boolean):[],J=Array.isArray(b)?b.filter(Boolean):[],Z=Array.isArray(S)?S.filter(Boolean):[];return t.filter((function(e){var t,n;if(w&&e.matchUpType!==Os&&!e.readyToScore)return!1;if(e.winningSide&&a&&![1,2].includes(e.winningSide))return!1;if(void 0!==c){if(c&&!e.tieMatchUps)return!1;if(!c&&e.tieMatchUps)return!1}if(void 0!==r){if(r&&!e.collectionId)return!1;if(!r&&e.collectionId)return!1}if(F.length&&!F.includes(e.stage))return!1;if(k.length&&!k.includes(e.stageSequence))return!1;if(_.length&&(!e.collectionId||!_.includes(e.collectionId)))return!1;if(L.length&&(!e.roundName||!L.includes(e.roundName)))return!1;if(j.length&&(!e.roundNumber||!j.includes(e.roundNumber)))return!1;if(B.length&&(!e.roundPosition||!B.includes(e.roundPosition)))return!1;if(x.length&&(!e.matchUpStatus||!x.includes(e.matchUpStatus)))return!1;if(O.length&&e.matchUpStatus&&O.includes(e.matchUpStatus))return!1;if(V.length&&!V.includes(e.matchUpId))return!1;if(G.length&&(!e.matchUpType||!G.includes(e.matchUpType)))return!1;if(H.length&&(!e.matchUpFormat||!H.includes(e.matchUpFormat)))return!1;if(null==z?void 0:z.length){var i=Yc({matchUp:e}).scheduledTime,o=Kc({matchUp:e}).scheduledDate,u=ui(i)||o;if(!z.find((function(e){return Ii(e,u)})))return!1}if(q.length){var s=Zc({matchUp:e}).courtId,l=Jc({matchUp:e}).allocatedCourts,d=null==l?void 0:l.map((function(e){return e.courtId}));if(!q.filter(Boolean).includes(s)||(null==d?void 0:d.includes(s)))return!1}if(W.length){var p=Xc({matchUp:e}).venueId;if(!W.filter(Boolean).includes(p))return!1}if(I){if(Y.length&&!Y.includes(e.tournamentId))return!1;if(K.length&&!K.includes(e.eventId))return!1;if(J.length&&!J.includes(e.drawId))return!1;if(Z.length&&!Z.includes(e.structureId))return!1;if(C.length){var v=null!==(n=null===(t=e.sides)||void 0===t?void 0:t.map((function(e){return e.participantId})).filter(Boolean))&&void 0!==n?n:[];if(!C.some((function(e){return v.includes(e)})))return!1}}return!0}))}function sp(e){var r,n,i,a,o=e.drawPositionCollectionAssignment,u=e.sideNumberCollectionAssignment,s=e.positionAssignments,l=e.displaySideNumber,c=e.seedAssignments,d=e.drawPosition,p=e.isFeedRound,v=e.sideNumber,f=s.find((function(e){return e.drawPosition&&e.drawPosition===d})),m=d&&o,h=v&&u,g=m?null===(r=m[d])||void 0===r?void 0:r.participantId:null==f?void 0:f.participantId,I=f?function(e){var t=e.displaySideNumber,r=e.seedAssignments,n=e.participantId,i=e.assignment,a=e.sideNumber,o={drawPosition:i.drawPosition,displaySideNumber:t,sideNumber:a};if(n){var u=function(e){var t=e.seedAssignments,r=e.participantId;return null==t?void 0:t.find((function(e){return!e.seedProxy&&e.participantId===r}))}({seedAssignments:r,participantId:n});Object.assign(o,u,{participantId:n})}else i.bye&&Object.assign(o,{bye:!0});i.qualifier&&Object.assign(o,{qualifier:!0});return o}({displaySideNumber:l,seedAssignments:c,participantId:g,assignment:f,sideNumber:v}):t({},null==h?void 0:h[v]);if(p&&(1===v?Object.assign(I,{participantFed:!0}):Object.assign(I,{participantAdvanced:!0})),d&&m){var y=null===(n=m[d])||void 0===n?void 0:n.teamParticipant,U=null===(i=m[d])||void 0===i?void 0:i.participant,S=null===(a=m[d])||void 0===a?void 0:a.substitutions;U&&(I.participant=U),S&&(I.substitutions=S),y&&(I.teamParticipant=y)}return I}var lp="ANY",cp="MALE",dp="MIXED",pp="OTHER",vp="FEMALE",fp={ANY:lp,MALE:cp,FEMALE:vp,MIXED:dp,OTHER:pp};function mp(e){var r,n,i,a,c,d,p,v=e.scheduleVisibilityFilters,f=e.tournamentAppliedPolicies,m=e.provisionalPositioning,h=e.tournamentParticipants,g=e.afterRecoveryTimes,y=e.policyDefinitions,S=e.tournamentRecord,w=e.seedAssignments,T=e.usePublishState,P=e.contextFilters,D=e.contextContent,b=e.matchUpFilters,N=e.participantMap,M=e.scheduleTiming,A=e.contextProfile,E=e.drawDefinition,C=e.publishStatus,_=e.context,L=void 0===_?{}:_,j=e.exitProfiles,B=e.matchUpsMap,V=e.structure,G=e.inContext,q=e.event,W={},H={};if(h=null!=h?h:null==S?void 0:S.participants,!V)return{collectionPositionMatchUps:W,error:Ne,roundMatchUps:H,matchUps:[]};var z=Array.isArray(null==b?void 0:b.eventIds)?null==b?void 0:b.eventIds.filter(Boolean):[],Y=Array.isArray(null==b?void 0:b.structureIds)?null==b?void 0:b.structureIds.filter(Boolean):[],J=Array.isArray(null==b?void 0:b.drawIds)?null==b?void 0:b.drawIds.filter(Boolean):[],Z=!(null==L?void 0:L.eventId)||!(null==z?void 0:z.length)&&!(null===(r=null==P?void 0:P.eventIds)||void 0===r?void 0:r.filter(Boolean).length)||(null==z?void 0:z.includes(L.eventId))||(null===(n=null==P?void 0:P.eventIds)||void 0===n?void 0:n.includes(L.eventId)),X=!(null==Y?void 0:Y.length)||Y.includes(V.structureId),Q=!E||!(null==J?void 0:J.length)||J.includes(E.drawId);if(!Z||!X||!Q)return{collectionPositionMatchUps:W,roundMatchUps:H,matchUps:[]};A&&!D&&(D=pl({tournamentRecord:S,contextProfile:A,drawDefinition:E}));var $=tl({drawDefinition:E}).appliedPolicies,ee=t(t(t({},f),$),y),te=null===(i=null==ee?void 0:ee.scoring)||void 0===i?void 0:i.structures,re=V.stage&&(null==te?void 0:te.stage)&&(null==te?void 0:te.stage[V.stage]),ne=V.stageSequence&&(null==re?void 0:re.stageSequence)&&re.stageSequence[V.stageSequence],ie=(null===(a=null==ee?void 0:ee.scoring)||void 0===a?void 0:a.requireAllPositionsAssigned)||(null==re?void 0:re.requireAllPositionsAssigned)||(null==ne?void 0:ne.requireAllPositionsAssigned);B||(B=fl({drawDefinition:E,structure:V}));var ae=ls({structure:V}),oe=ae.positionAssignments,ue=ae.allPositionsAssigned,se=!ie||ue,le=ql({provisionalPositioning:m,drawDefinition:E,structure:V}).seedAssignments;w=null!=w?w:le;var ce=V.roundOffset,de=V.structureId,pe=V.structureName,ve=V.stage,fe=V.stageSequence,me=null!=E?E:{},he=me.drawId,ge=me.drawName,Ie=me.drawType,ye=null==(j=j||E&&vl({drawDefinition:E}).exitProfiles)?void 0:j[de],Ue=(null==ye?void 0:ye.length)&&(ye[0].split("-").map((function(e){return parseInt(e)})).reduce((function(e,t){return e+t}))||0),Se=!!V.structures,we=ml({matchUpsMap:B,structureId:de,inContext:G}),Te=function(e){var t,r,n,i,a,s,l=e.roundNamingPolicy,c=e.drawDefinition,d=e.structure,p=Xs({matchUps:e.matchUps}),v=p.roundProfile,f=p.roundMatchUps,m=d.structureAbbreviation,h=d.stage,g=ip({structure:d}),I=np({structure:d}),y=d.structures,U={},S=ap[Oa],w=d.stage===au,T=w?Math.max.apply(Math,u(u([],o((null!==(t=null==c?void 0:c.structures)&&void 0!==t?t:[]).filter((function(e){return e.stage===au})).map((function(e){var t=e.stageSequence;return null!=t?t:1}))),!1),[0],!1)):0,P=(null!==(r=d.stageSequence)&&void 0!==r?r:1)<T?null!==(n=d.stageSequence)&&void 0!==n?n:1:"",D=P&&((null===(i=null==l?void 0:l.affixes)||void 0===i?void 0:i.preQualifying)||S.affixes.preQualifying)||"",b=(null==l?void 0:l.roundNamingMap)||S.roundNamingMap||{},N=(null==l?void 0:l.abbreviatedRoundNamingMap)||S.abbreviatedRoundNamingMap||{},M=(null===(a=null==l?void 0:l.affixes)||void 0===a?void 0:a.preFeedRound)||S.affixes.preFeedRound,R=(null===(s=null==l?void 0:l.affixes)||void 0===s?void 0:s.roundNumber)||S.affixes.roundNumber,A=((null==l?void 0:l.namingConventions)||S.namingConventions).round,E=h&&h!==iu?h[0]:"",C=(null==l?void 0:l.stageConstants)||S.stageConstants,x=h&&(null==C?void 0:C[h])||E,O="".concat(D).concat(x).concat(P),F=v?Object.keys(v):[],k=w&&(null==C?void 0:C[au])?"".concat(null==C?void 0:C[au],"-"):"";if(y||g||I)Object.assign.apply(Object,u([U],o(F.map((function(e){var t,r="".concat(k).concat(A," ").concat(e),n="".concat(R).concat(e);return(t={})[e]={roundName:r,abbreviatedRoundName:n},t}))),!1));else{var _=w&&((null==l?void 0:l.qualifyingFinishMap)||(null==S?void 0:S.qualifyingFinishMap)||{});Object.assign.apply(Object,u([U],o(F.map((function(e){var t;if(null==v?void 0:v[e]){var r=v[e],n=r.matchUpsCount,i=r.preFeedRound,a=2*n,o=(null==_?void 0:_[null==v?void 0:v[e].finishingRound])||_&&"".concat(R).concat(a)||b[n]||"".concat(R).concat(a),u=i?"-".concat(M):"",s="".concat(o).concat(u),l=[O,m,s].filter(Boolean).join("-"),c=N[n]||"".concat(R).concat(a),d="".concat(c).concat(u),p=[O,m,d].filter(Boolean).join("-");return(t={})[e]={abbreviatedRoundName:p,roundName:l},t}}))),!1))}return{roundNamingProfile:U,roundProfile:v,roundMatchUps:f}}({roundNamingPolicy:null==ee?void 0:ee[Oa],drawDefinition:E,structure:V,matchUps:we}),De=Te.roundNamingProfile,be=Te.roundProfile;if(H=null!==(c=null==Te?void 0:Te.roundMatchUps)&&void 0!==c?c:[],b&&(we=up(t(t({matchUps:we},b),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),G){var Me=function(e){var t=e.drawDefinition,r=e.structureId,n=e.matchUpsMap;if(!t)return{error:K};if(!r)return{error:Pe};var i=as({drawDefinition:t,structureId:r}).structure;if((null==i?void 0:i.stage)!==ou)return{error:_e,info:"Structure is not CONSOLATION stage"};var a=t.links,s=(null==a?void 0:a.filter((function(e){return e.target.structureId===r})))||[],l=(null==s?void 0:s.reduce((function(e,t){var r=t.source.structureId;return e.includes(r)?e:e.concat(r)}),[]))||[],c=Object.assign.apply(Object,u([{}],o(l.map((function(e){var t,r=Xs({matchUps:ml({structureId:e,matchUpsMap:n})}).roundProfile;return(t={})[e]=r,t}))),!1)),d=Xs({matchUps:ml({matchUpsMap:n,structureId:r})}).roundProfile,p={};return null==s||s.forEach((function(e){var t,r=e.source,n=r.structureId,i=r.roundNumber,a=e.target,s=a.feedProfile,l=a.groupedOrder,v=a.positionInterleave,f=a.roundNumber,m=c[n],h=null===(t=m[1])||void 0===t?void 0:t.drawPositions,g=m[i],I=null==g?void 0:g.matchUpsCount;if(I){var y=I?h.length/I:0,U=h.length/y,S=h.slice(),w=Ws({roundPositionsCount:S.length,groupedOrder:l}),T=(null==w?void 0:w.length)||1;if(T<=U){var P=O(S,h.length/T);s===wu&&P.forEach((function(e){return e.reverse()})),S=(null==w?void 0:w.length)&&(null==w?void 0:w.map((function(e){return P[e-1]})).flat())||S}var D=O(S,y);if((null==w?void 0:w.length)||s!==wu||D.reverse(),v){var b=R(0,v.interleave).map((function(){})),N=R(0,v.offset).map((function(){}));(D=D.map((function(e){return u([e],o(b),!1)}))).unshift(N);var M=(D=D.flat(1)).length-v.offset;D=D.slice(0,M)}p[f]||(p[f]={});var A=null==d?void 0:d[f],E=(null==A?void 0:A.feedRound)?2:1;D.forEach((function(e,t){var r=1+t*E;p[f][r]||(p[f][r]=qd(e))}))}})),{sourceDrawPositionRanges:p}}({drawDefinition:E,matchUpsMap:B,structureId:de}).sourceDrawPositionRanges,Re=E?function(e){var t,r,n=e.drawDefinition,i=e.roundProfile,a=e.structureId,l=e.matchUpsMap;if(!n)return{error:K};if(!a)return{error:Pe};if(!i){var c=ml({matchUpsMap:l,structureId:a});if(!(i=Xs({matchUps:c}).roundProfile))return{error:pt}}var d=(Math.min.apply(Math,u([],o(null!==(r=null===(t=null==i?void 0:i[1])||void 0===t?void 0:t.drawPositions)&&void 0!==r?r:[]),!1))||1)-1,p=Object.keys(i),v=Object.assign.apply(Object,u([{}],o((p||[]).map((function(e){var t,r,n,a,l=null===(r=null==i?void 0:i[e])||void 0===r?void 0:r.matchUpsCount,c=null!==(a=null===(n=null==i?void 0:i[1])||void 0===n?void 0:n.drawPositions)&&void 0!==a?a:[],v=O(c,c.length/l),f=v.map(qd),m=v.map((function(e){return e.map((function(e){return e-d}))})).map(qd),h=p.map((function(t){var r,n;if(!(t>e)){var a=null!==(n=null===(r=null==i?void 0:i[t])||void 0===r?void 0:r.drawPositions)&&void 0!==n?n:[];return O(a,a.length/l)}})).filter(Boolean),g=R(0,l).map((function(e){return h.map((function(t){return t[e]})).flat().filter(Boolean).sort(s)})).map((function(e){return U(e)})),I=g.map((function(e){return(t=e,t.reduce((function(e,t){var r=e[e.length-1];return r&&r[r.length-1]===t-1||e.push([]),e[e.length-1].push(t),e}),[])).map(qd).join(", ");var t})),y=Object.assign.apply(Object,u([{}],o(R(0,l).map((function(e){var t;return(t={})[e+1]={firstRoundDrawPositionsRange:f[e],firstRoundOffsetDrawPositionsRange:m[e],possibleDrawPositions:g[e],drawPositionsRange:I[e]},t}))),!1));return(t={})[e]=y,t}))),!1));return{drawPositionsRanges:v}}({drawDefinition:E,roundProfile:be,matchUpsMap:B,structureId:de}).drawPositionsRanges:void 0;(null==(we=we.map((function(e){return Ae({scheduleVisibilityFilters:v,sourceDrawPositionRanges:Me,drawPositionsRanges:Re,roundNamingProfile:De,initialRoundOfPlay:Ue,appliedPolicies:ee,usePublishState:T,publishStatus:C,isRoundRobin:Se,roundProfile:be,matchUp:e,event:q})})))?void 0:we.filter((function(e){return Array.isArray(e.tieMatchUps)}))).forEach((function(e){var t=e.tieMatchUps;we=we.concat.apply(we,u([],o(t),!1))})),P&&(we=up(t(t({processContext:!0},P),{matchUps:we})))}else{(null==we?void 0:we.filter((function(e){return Array.isArray(e.tieMatchUps)}))).forEach((function(e){var t=e.tieMatchUps;we=we.concat.apply(we,u([],o(t),!1))}))}return b&&(we=up(t(t({matchUps:we},b),{filterMatchUpTypes:!1,filterMatchUpIds:!1}))),((null==b?void 0:b.matchUpTypes)||(null==b?void 0:b.matchUpIds))&&(we=up({matchUpTypes:b.matchUpTypes,matchUpIds:b.matchUpIds,matchUps:we})),((null==b?void 0:b.matchUpTypes)||(null==b?void 0:b.matchUpIds)||G)&&(H=null!==(d=Xs({matchUps:we}).roundMatchUps)&&void 0!==d?d:[]),(null===(p=Gd({drawDefinition:E,structure:V,event:q}))||void 0===p?void 0:p.tieFormat)&&(W=function(e){var t=e.matchUps,r=t.reduce((function(e,t){return!t.collectionPosition||e.includes(t.collectionPosition)?e:e.concat(t.collectionPosition)}),[]).map((function(e){var r;return(r={})[e]=t.filter((function(t){return t.collectionPosition===e})),r}));return{collectionPositionMatchUps:Object.assign.apply(Object,u([{}],o(r),!1))}}({matchUps:we}).collectionPositionMatchUps),{collectionPositionMatchUps:W,roundMatchUps:H,roundProfile:be,matchUpsMap:B,matchUps:we};function Ae(e){var r,n,i,a,c,d,p,v,f,m,y,T,P,b,R,C,O,_,j,B,G,q,W,H,z=e.scheduleVisibilityFilters,Y=e.sourceDrawPositionRanges,K=e.drawPositionsRanges,J=e.initialRoundOfPlay,Z=e.additionalContext,X=e.roundNamingProfile,Q=e.tieDrawPositions,$=e.appliedPolicies,ee=e.isCollectionBye,te=e.usePublishState,re=e.publishStatus,ne=e.matchUpTieId,ie=e.isRoundRobin,ae=e.roundProfile,ue=e.sideLineUps,le=e.matchUp,me=e.event;Z=null!=Z?Z:{};var ye=null===(r=Gd({drawDefinition:E,structure:V,matchUp:le,event:me}))||void 0===r?void 0:r.tieFormat,Ue=null==ye?void 0:ye.collectionDefinitions,Se=le.collectionId&&(null==Ue?void 0:Ue.find((function(e){return e.collectionId===le.collectionId}))),we=le.collectionId?null==Se?void 0:Se.matchUpFormat:null!==(a=null!==(i=null!==(n=le.matchUpFormat)&&void 0!==n?n:null==V?void 0:V.matchUpFormat)&&void 0!==i?i:null==E?void 0:E.matchUpFormat)&&void 0!==a?a:null==me?void 0:me.matchUpFormat,Te=le.matchUpType||(null==Se?void 0:Se.matchUpType)||(null==V?void 0:V.matchUpType)||(null==E?void 0:E.matchUpType)||(null==me?void 0:me.eventType)!==ga&&(null==me?void 0:me.eventType),Pe=ee?Fo:le.matchUpStatus,De=jd({scheduleVisibilityFilters:z,afterRecoveryTimes:g,tournamentRecord:S,usePublishState:te,scheduleTiming:M,matchUpFormat:we,publishStatus:re,matchUpType:Te,matchUp:le,event:me}),be=De.schedule,Ne=De.endDate,Me=null!==(c=null!=Q?Q:le.drawPositions)&&void 0!==c?c:[],Re=le.collectionPosition,Ee=le.collectionId,Ce=le.roundPosition,xe=null!==(d=le.roundNumber)&&void 0!==d?d:Z.roundNumber,Oe=Ee?function(e){var t=e.tournamentParticipants,r=e.positionAssignments,n=e.collectionPosition,i=e.drawPositions,a=void 0===i?[]:i,s=e.participantMap,l=e.drawDefinition,c=e.collectionId,d=e.sideLineUps,p=e.matchUpType;if(!c||!n)return{};var v=function(e){var r,i,a,o,u,l,d=e.attribute,v=e.lineUp,f=e.teamParticipant,m=hl({collectionPosition:n,collectionId:c,lineUp:v}),h=m.assignedParticipantIds,g=m.substitutions;if(p!==xs)return(U=null==h?void 0:h[0])&&((a={})[d]={participantId:U,teamParticipant:f,substitutions:g},a);if((null==h?void 0:h.length)<=2){var I=null===(u=null===(o=null==s?void 0:s[h[0]])||void 0===o?void 0:o.pairIdMap)||void 0===u?void 0:u[h[1]],y=I&&(null===(l=s[I])||void 0===l?void 0:l.participant)||gl({participantIds:h,tournamentParticipants:t}).participant,U=null==y?void 0:y.participantId;return(r={})[d]={participantId:U,teamParticipant:f,substitutions:g},r}return(null==h?void 0:h.length)>2?((i={})[d]={teamParticipant:f,substitutions:g},i):void 0};if(!(null==a?void 0:a.length)){var f=(null==d?void 0:d.map((function(e){var t,r=e.teamParticipant,n=e.sideNumber,i=e.lineUp||(null===(t=Il({participantId:r.teamParticipantId,drawDefinition:l}))||void 0===t?void 0:t.lineUp);return v({attribute:n,lineUp:i,teamParticipant:r})})).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign.apply(Object,u([{}],o(f),!1))}}var m=(null==a?void 0:a.map((function(e){var n,i,a,o=null===(n=r.find((function(t){return t.drawPosition===e})))||void 0===n?void 0:n.participantId,u=null==d?void 0:d.find((function(t){return(null==t?void 0:t.drawPosition)===e})),c=(null==u?void 0:u.teamParticipant)||o&&(null===(i=null==s?void 0:s[o])||void 0===i?void 0:i.participant)||(null==t?void 0:t.find((function(e){return e.participantId===o}))),p=(null==u?void 0:u.lineUp)||(null===(a=Il({participantId:o,drawDefinition:l}))||void 0===a?void 0:a.lineUp);return v({attribute:e,lineUp:p,teamParticipant:c})})).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign.apply(Object,u([{}],o(m),!1))}}({tournamentParticipants:h,positionAssignments:oe,collectionPosition:Re,drawDefinition:E,participantMap:N,drawPositions:Me,collectionId:Ee,sideLineUps:ue,matchUpType:Te}):void 0,Fe=(null===(p=null==X?void 0:X[xe])||void 0===p?void 0:p.roundName)||Z.roundName,ke=(null===(v=null==X?void 0:X[xe])||void 0===v?void 0:v.abbreviatedRoundName)||Z.abbreviatedRoundName,_e=null===(f=null==ae?void 0:ae[xe])||void 0===f?void 0:f.feedRound,Le=null===(m=null==ae?void 0:ae[xe])||void 0===m?void 0:m.preFeedRound,je=null===(y=null==ae?void 0:ae[xe])||void 0===y?void 0:y.roundFactor,Be=null==K?void 0:K[xe],Ve=Ce?null==Be?void 0:Be[Ce]:void 0,Ge=null==Y?void 0:Y[xe],qe=(null==Se?void 0:Se.category)?t(t({},(null==L?void 0:L.category)||{}),Se.category):null!==(T=null==L?void 0:L.category)&&void 0!==T?T:null==me?void 0:me.category,We=(null===(P=le.processCodes)||void 0===P?void 0:P.length)&&le.processCodes||(null===(b=null==Se?void 0:Se.processCodes)||void 0===b?void 0:b.length)&&(null==Se?void 0:Se.processCodes)||(null===(R=null==V?void 0:V.processCodes)||void 0===R?void 0:R.length)&&(null==V?void 0:V.processCodes)||(null===(C=null==E?void 0:E.processCodes)||void 0===C?void 0:C.length)&&(null==E?void 0:E.processCodes)||(null===(O=null==me?void 0:me.processCodes)||void 0===O?void 0:O.length)&&(null==me?void 0:me.processCodes)||(null==S?void 0:S.processCodes),He=(null==A?void 0:A.withCompetitiveness)&&Zl(t(t({},D),{matchUp:le})),ze=null!==(_=le.finishingPositionRange)&&void 0!==_?_:Z.finishingPositionRange,Ye=function(e){return xn(e,void 0,!0)},Ke=t(t(t({},Ye(L)),Ye({matchUpFormat:le.matchUpType===ga?void 0:we,tieFormat:le.matchUpType!==ga?void 0:ye,gender:null!==(j=null==Se?void 0:Se.gender)&&void 0!==j?j:null==me?void 0:me.gender,roundOfPlay:ve!==au&&I(J)&&J+(xe||0),endDate:null!==(B=le.endDate)&&void 0!==B?B:Ne,discipline:null==me?void 0:me.discipline,category:qe,finishingPositionRange:ze,abbreviatedRoundName:ke,drawPositionsRange:Ve,competitiveProfile:He,structureName:pe,stageSequence:fe,drawPositions:Me,matchUpStatus:Pe,processCodes:We,isRoundRobin:ie,matchUpTieId:ne,preFeedRound:Le,matchUpType:Te,roundFactor:je,roundOffset:ce,structureId:de,roundNumber:xe,feedRound:_e,roundName:Fe,drawName:ge,drawType:Ie,schedule:be,drawId:he,stage:ve})),Ui(Ye(le),!0,!0));if(we&&(null===(G=le.score)||void 0===G?void 0:G.scoreStringSide1)){var Je=Zd(we),Ze=null!=Je?Je:{},Xe=Ze.bestOf,Qe=Ze.finalSetFormat,$e=Ze.setFormat;((null==Qe?void 0:Qe.tiebreakSet)||(null==$e?void 0:$e.tiebreakSet)||(null==$e?void 0:$e.timed))&&(Ke.score.sets=Ke.score.sets.sort((function(e,t){return e.setNumber-t.setNumber})).map((function(e,t){return t+1===Xe?((null==Qe?void 0:Qe.tiebreakSet)||(null==Qe?void 0:Qe.timed))&&(e.tiebreakSet=!0):((null==$e?void 0:$e.tiebreakSet)||(null==$e?void 0:$e.timed))&&(e.tiebreakSet=!0),e})))}if(Array.isArray(Me)){var et=function(e){var t,r=e.drawPositions,n=e.roundProfile,i=e.roundNumber,a=[void 0,void 0];if(k(r))return{orderedDrawPositions:a,displayOrder:a};var c,d=null==n?void 0:n[i],p=null==d?void 0:d.pairedDrawPositions,v=null!==(t=null==p?void 0:p.find((function(e){return x(e||[],r.filter(Boolean))})))&&void 0!==t?t:a,f=null==d?void 0:d.feedRound;return F(r)?{orderedDrawPositions:2===(c=u([],o(r),!1).sort(s)).length?c:v,displayOrder:f?c:v}:f?{orderedDrawPositions:c=[r.find((function(e){return!isNaN(l(e))})),void 0],displayOrder:c}:{orderedDrawPositions:v,displayOrder:v}}({drawPositions:Me,roundProfile:ae,roundNumber:xe}),tt=et.orderedDrawPositions,rt=et.displayOrder,nt=null===(q=null==ae?void 0:ae[xe])||void 0===q?void 0:q.feedRound,it=rt[0]!==tt[0],at=tt.concat(void 0,void 0).slice(0,2).map((function(e,r){var n,i=r+1,a=it?3-i:i,o=sp(t(t({},Oe),{positionAssignments:oe,displaySideNumber:a,seedAssignments:w,drawPosition:e,isFeedRound:nt,sideNumber:i})),u=null===(n=le.sides)||void 0===n?void 0:n.find((function(e){return e.sideNumber===i})),s=Ce?2*(Ce-1)+r+1:void 0,l=s?null==Ge?void 0:Ge[s]:void 0;return Ye(t(t({sourceDrawPositionRange:l},u),o))}));Object.assign(Ke,Ui({sides:at},!0,!0))}if(h&&Ke.sides){var ot=null==$?void 0:$[Fa],ut=function(e){var t,r=null===(t=null==N?void 0:N[e])||void 0===t?void 0:t.participant;return r&&Na({template:null==ot?void 0:ot.participant,source:r})};if(Ke.sides.filter(Boolean).forEach((function(e){var t,r,n;if(e.participantId){var i=Ui(ut(e.participantId)||h&&Wa({policyDefinitions:$,participantId:e.participantId,tournamentParticipants:h,internalUse:!0,contextProfile:A}),void 0,!0);if(i){if(null==E?void 0:E.entries){var a=E.entries.find((function(t){return t.participantId===e.participantId}));(null==a?void 0:a.entryStatus)&&(i.entryStatus=a.entryStatus),(null==a?void 0:a.entryStage)&&(i.entryStage=a.entryStage)}Object.assign(e,{participant:i})}}if((null===(r=null===(t=null==e?void 0:e.participant)||void 0===t?void 0:t.individualParticipantIds)||void 0===r?void 0:r.length)&&!(null===(n=e.participant.individualParticipants)||void 0===n?void 0:n.length)){var o=e.participant.individualParticipantIds.map((function(e){return ut(e)||h&&Wa({policyDefinitions:$,tournamentParticipants:h,internalUse:!0,contextProfile:A,participantId:e})}));Object.assign(e.participant,{individualParticipants:o})}})),!Ke.matchUpType){var st=op({matchUp:Ke}).matchUpType;st&&Object.assign(Ke,{matchUpType:st})}if((null==A?void 0:A.inferGender)&&(!Ke.gender||Ke.gender===dp)&&2===(null===(W=Ke.sides)||void 0===W?void 0:W.length)&&Ke.matchUpType!==ga){var lt=Ke.sides.map((function(e){var t,r,n,i;if(Ke.matchUpType===Es)return null===(r=null===(t=e.participant)||void 0===t?void 0:t.person)||void 0===r?void 0:r.sex;if(2===(null===(i=null===(n=e.participant)||void 0===n?void 0:n.individualParticipants)||void 0===i?void 0:i.length)){var a=U(e.participant.individualParticipants.map((function(e){var t;return null===(t=e.person)||void 0===t?void 0:t.sex}))).filter(Boolean);if(1===a.length)return a[0]}}));if(2===lt.filter(Boolean).length&&1===U(lt).length){var ct=lt[0];Ke.inferredGender=ct}}}if(Ke.tieMatchUps){var dt=Ke.matchUpStatus===Fo,pt=null===(H=Ke.sides)||void 0===H?void 0:H.map((function(e){var t=e.participant,r=e.drawPosition,n=e.sideNumber,i=e.lineUp,a=(null==t?void 0:t.participantType)===ga&&t;return{teamParticipant:a&&xn({participantRoleResponsibilities:a.participantRoleResponsibilities,participantOtherName:a.participanOthertName,participantName:a.participantName,participantId:a.participantId,teamId:a.teamId}),drawPosition:r,sideNumber:n,lineUp:i}}));Ke.tieMatchUps=Ke.tieMatchUps.map((function(e){var t=Ke.matchUpId,r=Ke.finishingPositionRange;return Ae({tieDrawPositions:Me,scheduleVisibilityFilters:z,sourceDrawPositionRanges:Y,sideLineUps:pt,drawPositionsRanges:K,initialRoundOfPlay:J,roundNamingProfile:X,additionalContext:{finishingPositionRange:r,abbreviatedRoundName:ke,roundNumber:xe,roundName:Fe},appliedPolicies:$,isCollectionBye:dt,usePublishState:te,publishStatus:re,matchUpTieId:t,isRoundRobin:ie,roundProfile:ae,matchUp:e,event:me})}))}var vt=Ke.sides&&2===Ke.sides.filter((function(e){return null==e?void 0:e.participantId})).length,ft=!Ke.winningSide,mt=se&&vt&&ft;if(Object.assign(Ke,{readyToScore:mt,hasContext:!0}),vt){var ht=bc({matchUp:Ke}),gt=ht.allParticipantsCheckedIn,It=ht.checkedInParticipantIds;Object.assign(Ke,{allParticipantsCheckedIn:gt,checkedInParticipantIds:It})}return Array.isArray(null==A?void 0:A.exclude)&&(null==A||A.exclude.forEach((function(e){return delete Ke[e]}))),Ke}}function hp(e){var t=e.matchUp;return!!t&&(eu.includes(null==t?void 0:t.matchUpStatus)||(null==t?void 0:t.winningSide))}function gp(e){var t=e.requireParticipants,r=void 0===t||t,n=e.scheduleVisibilityFilters,i=e.tournamentAppliedPolicies,a=e.tournamentParticipants,o=e.afterRecoveryTimes,u=e.policyDefinitions,s=e.tournamentRecord,l=e.usePublishState,c=e.matchUpFilters,d=e.contextFilters,p=e.contextContent,v=e.participantMap,f=e.scheduleTiming,m=e.publishStatus,h=e.contextProfile,g=e.drawDefinition,I=e.exitProfiles,y=e.matchUpsMap,U=e.structureId,S=e.inContext,w=e.structure,T=e.context,P=e.event;!w&&U&&(w=as({drawDefinition:g,structureId:U}).structure);var D=mp({tournamentAppliedPolicies:i,scheduleVisibilityFilters:n,tournamentParticipants:a,afterRecoveryTimes:o,policyDefinitions:u,tournamentRecord:s,usePublishState:l,matchUpFilters:c,contextFilters:d,contextContent:p,participantMap:v,scheduleTiming:f,publishStatus:m,contextProfile:h,drawDefinition:g,exitProfiles:I,matchUpsMap:y,structure:w,inContext:S,context:T,event:P}),b=[],N=[],M=[],R=[],A=[];if(D.error)return D;var E,C=D.matchUps,x=ls({structure:w}).assignedPositions,O=null==x?void 0:x.filter((function(e){return e.participantId})).map((function(e){return e.drawPosition}));return C.filter((function(e){var t,r=1===(null===(t=null==c?void 0:c.matchUpTypes)||void 0===t?void 0:t.length)&&c.matchUpTypes[0]===Fs;return!(e.matchUpType!==Fs&&r)})).forEach((function(e){var t,n,i,a;if(e.matchUpStatus!==xo){e.matchUpType===Fs&&(E=!0);var o=e.collectionId,u=o&&(null===(t=e.sides)||void 0===t?void 0:t.every((function(e){return e.participantId}))),s=!o&&2===(null===(n=e.drawPositions)||void 0===n?void 0:n.filter(Boolean).length),l=!o&&(null===(i=e.drawPositions)||void 0===i?void 0:i.every((function(e){return null==O?void 0:O.includes(e)}))),c=null==x?void 0:x.filter((function(e){return e.bye})).map((function(e){return e.drawPosition})),d=!o&&(null===(a=e.drawPositions)||void 0===a?void 0:a.find((function(e){return null==c?void 0:c.includes(e)}))),p=ru.includes(e.matchUpStatus)&&(u||s&&(!r||l));return d?A.push(e):hp({matchUp:e})?N.push(e):p?M.push(e):R.push(e)}b.push(e)})),{includesTeamMatchUps:E,abandonedMatchUps:b,completedMatchUps:N,upcomingMatchUps:M,pendingMatchUps:R,byeMatchUps:A,structure:w}}function Ip(e){var t;Object.assign(e,{requireParticipants:!1});var r=yp(e);if(r.error)return On({result:r,stack:"getAllDrawMatchUps"});var n=r.abandonedMatchUps,i=r.completedMatchUps,a=r.upcomingMatchUps,s=r.pendingMatchUps,l=r.byeMatchUps,c=r.matchUpsMap;return{matchUps:(t=null!=n?n:[]).concat.apply(t,u(u(u(u([],o(null!=i?i:[]),!1),o(null!=a?a:[]),!1),o(null!=s?s:[]),!1),o(null!=l?l:[]),!1)),matchUpsMap:c}}function yp(e){var r;if(!(null==e?void 0:e.drawDefinition))return{error:K};var n,i=e.tournamentParticipants,a=e.contextContent,s=e.matchUpsMap,l=e.scheduleVisibilityFilters,c=e.tournamentAppliedPolicies,d=e.requireParticipants,p=e.participantsProfile,v=e.afterRecoveryTimes,f=e.policyDefinitions,m=e.tournamentRecord,h=e.usePublishState,g=e.contextFilters,I=e.matchUpFilters,y=e.scheduleTiming,U=e.participantMap,S=e.publishStatus,w=e.contextProfile,T=e.drawDefinition,P=e.nextMatchUps,D=e.inContext,b=e.context,N=e.event,M=[],R=[],A=[],E=[],C=[];w&&!a&&(a=pl({policyDefinitions:f,tournamentRecord:m,contextProfile:w,event:N})),!(null==i?void 0:i.length)&&m&&(i=null==m?void 0:m.participants,(D||(null==p?void 0:p.withGroupings))&&(null==i?void 0:i.length)&&(r=Us({participants:i,participantsProfile:p}),i=r.participantsWithGroupings,n=r.groupInfo));var x=os({drawDefinition:T}).structures;if(!x)return{error:De};s||(s=fl({drawDefinition:T}));var O=T&&vl({drawDefinition:T}).exitProfiles;x.forEach((function(e){var t=gp({matchUpFilters:P?void 0:I,contextFilters:P?void 0:g,inContext:D||P||g,tournamentAppliedPolicies:c,scheduleVisibilityFilters:l,tournamentParticipants:i,requireParticipants:d,afterRecoveryTimes:v,policyDefinitions:f,tournamentRecord:m,usePublishState:h,contextContent:a,participantMap:U,scheduleTiming:y,publishStatus:S,contextProfile:w,drawDefinition:T,exitProfiles:O,matchUpsMap:s,structure:e,context:b,event:N}),r=t.byeMatchUps,n=void 0===r?[]:r,p=t.pendingMatchUps,x=void 0===p?[]:p,F=t.upcomingMatchUps,k=void 0===F?[]:F,_=t.completedMatchUps,L=void 0===_?[]:_,j=t.abandonedMatchUps,B=void 0===j?[]:j;M=M.concat.apply(M,u([],o(B),!1)),R=R.concat.apply(R,u([],o(L),!1)),A=A.concat.apply(A,u([],o(k),!1)),E=E.concat.apply(E,u([],o(x),!1)),C=C.concat.apply(C,u([],o(n),!1))}));var F=function(e){return I||P||g?(I&&(e=up(t({matchUps:e},I))),g&&(e=up(t(t({matchUps:e},g),{processContext:!0}))),e):e},k=t(t({abandonedMatchUps:F(M),completedMatchUps:F(R),upcomingMatchUps:F(A),pendingMatchUps:F(E),byeMatchUps:F(C),matchUpsMap:s},L),{groupInfo:n});if(P){var _="object"==typeof P||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},j=_.abandoned,B=_.completed,V=_.upcoming,G=_.pending,q=_.bye;Qs({inContextDrawMatchUps:[].concat.apply([],u(u(u(u(u([],o(j&&M||[]),!1),o(B&&R||[]),!1),o(V&&A||[]),!1),o(G&&E||[]),!1),o(q&&C||[]),!1)),drawDefinition:T})}return k}function Up(e){var r,n,i,a,o,u=e.participants,s=e.participantMap,l=e.contextContent,c=e.scheduleVisibilityFilters,d=e.tournamentAppliedPolicies,p=e.participantsProfile,v=e.afterRecoveryTimes,f=e.policyDefinitions,m=e.useParticipantMap,h=e.tournamentRecord,g=e.contextFilters,I=e.contextProfile,y=e.drawDefinition,U=e.matchUpFilters,S=e.nextMatchUps,w=e.inContext,T=e.context,P=e.event,D=null!=P?P:{},b=D.eventId,N=D.eventName,M=D.eventType,R=D.category,A=D.gender,E=D.matchUpFormat,C=t(t({},T),{eventId:b,eventType:M,eventName:N,category:R,gender:A,matchUpFormat:E,indoorOutDoor:null!==(i=null==P?void 0:P.indoorOutdoor)&&void 0!==i?i:null==h?void 0:h.indoorOutdoor,surfaceCategory:null!==(a=null==P?void 0:P.surfaceCategory)&&void 0!==a?a:null==h?void 0:h.surfaceCategory,endDate:null==P?void 0:P.endDate});(null==u?void 0:u.length)||s||!h||(u=void 0===(n=(r=qs({participantsProfile:p,useParticipantMap:m,policyDefinitions:f,tournamentRecord:h,contextProfile:I,inContext:w})).participants)?[]:n,s=r.participantMap,o=r.groupInfo),I&&!l&&(l=pl({policyDefinitions:f,tournamentRecord:h,contextProfile:I,drawDefinition:y,event:P}));var x=Ip({context:C,tournamentAppliedPolicies:d,scheduleVisibilityFilters:c,tournamentParticipants:u,participantsProfile:p,afterRecoveryTimes:v,policyDefinitions:f,tournamentRecord:h,drawDefinition:y,contextContent:l,contextFilters:g,contextProfile:I,matchUpFilters:U,participantMap:s,nextMatchUps:S,inContext:w,event:P});return t(t({},x),{groupInfo:o})}function Sp(e){var r=e.drawDefinition,n=e.matchUpsMap,i=as({drawDefinition:r,structureId:e.structureId});if(i.error)return On({result:i});var a=mp({structure:i.structure,matchUpsMap:n}).matchUps;return t(t({},Xs({matchUps:a})),{matchUps:a,matchUpsMap:n})}function wp(e){var t=e.finishingPositions,r=Sp({drawDefinition:e.drawDefinition,structureId:e.structureId}).roundProfile,n=r&&Object.keys(r);return null==n?void 0:n.reduce((function(e,n){return Tp(null==r?void 0:r[n]).forEach((function(r){t.forEach((function(t){(function(e){var t=e.position,r=e.rangeDefinition;if(!Array.isArray(r))return!1;if(r.reduce((function(e,t){return e||isNaN(t)}),!1))return!1;var n=o(r,2),i=n[0],a=n[1];return R(i,(a||i)+1).includes(t)})({position:t,rangeDefinition:r})&&(e[t]={roundNumber:n})}))})),e}),{})}function Tp(e){var t,r;return[U((null===(t=null==e?void 0:e.finishingPositionRange)||void 0===t?void 0:t.loser)||[]),U((null===(r=null==e?void 0:e.finishingPositionRange)||void 0===r?void 0:r.winner)||[])]}function Pp(e){return Tp(e).map((function(e){return R(e[0],e[1]&&e[1]+1||e[0]+1)}))}function Dp(e){var t,r=e.drawDefinition,n=e.structureIds,i=e.matchUpsMap;if(n&&!Array.isArray(n))return{error:xr,context:{structureIds:n}};if(!r)return{error:K};n=null!=n?n:(null!==(t=r.structures)&&void 0!==t?t:[]).filter((function(e){return e.stage!==au})).map((function(e){return e.structureId}));var a=n.map((function(e){var t=Sp({drawDefinition:r,matchUpsMap:i,structureId:e}).roundProfile,n=t&&Object.values(t);return null==n?void 0:n.map(Pp).flat()})).flat(),o=a.filter((function(e){return 1===(null==e?void 0:e.length)})).sort(s).flat();return{positionsNotPlayedOff:U(a.flat()).filter((function(e){return!o.includes(e)})),positionsPlayedOff:o}}function bp(e){var t=e.excludeRoundNumbers,r=void 0===t?[]:t,n=e.playoffPositions,i=void 0===n?[]:n,a=e.drawDefinition,c=e.structureId;if(!a)return{error:K};if(!c)return{error:Pe};if(!i)return{error:pt,info:"missing playoffPositions"};var d=Dp({drawDefinition:a});if(d.error)return d;var p=d.positionsPlayedOff,v=wp({finishingPositions:i.filter((function(e){return!p.includes(e)})),drawDefinition:a,structureId:c}),f=Object.values(v).reduce((function(e,t){return e.includes(t.roundNumber)?e:e.concat(t.roundNumber)}),[]).map((function(e){return l(e)})).filter((function(e){return!r.includes(e)})),m=wp({finishingPositions:p,drawDefinition:a,structureId:c}),h=m?Object.values(m):[],g=m?h.reduce((function(e,t){return e.includes(t.roundNumber)?e:e.concat(t.roundNumber)}),[]).map((function(e){return l(e)})):[],I=f.filter((function(e){return!g.includes(e)})).sort(s),y=Sp({drawDefinition:a,structureId:c}).roundProfile,U=I.map((function(e){var t=null==y?void 0:y[e].finishingPositionRange.loser,r=o(null!=t?t:[0,0],2),n=r[0];return R(n,(r[1]||n)+1)})).flat().sort(s),S=function(e){var t=e.playoffSourceRounds,r=e.roundProfile,n=t.map((function(e){var t=r[e].finishingPositionRange.loser,n=o(t,2),i=n[0],a=R(i,(n[1]||i)+1);return{finishingPositionRange:t.join("-"),finishingPositions:a,roundNumber:e}}));return{playoffRoundsRanges:n}}({playoffSourceRounds:I,roundProfile:y}).playoffRoundsRanges,w=u(u([],o(I),!1),o(g),!1);return{playoffPositionsReturned:U,playedOffSourceRounds:g,playoffRoundsRanges:S,playoffSourceRounds:I,sourceRounds:w,roundProfile:y}}function Np(e){var n,i,o=e.drawDefinition,u=e.structureId;if(!o)return{error:K};var s=Up({inContext:!0,drawDefinition:o}),l=s.matchUps,c=Dp({drawDefinition:o,matchUpsMap:s.matchUpsMap}),d=c.positionsNotPlayedOff,p=c.positionsPlayedOff,v=os({drawDefinition:o}).structures.filter((function(e){return!u&&e.stage!==uu||e.structureId===u})),f={};try{for(var m=a(v),h=m.next();!h.done;h=m.next()){var g=h.value,I=null==g?void 0:g.structureId,y=Mp({playoffPositions:d,drawDefinition:o,structure:g,matchUps:l}),U=y.error,S=r(y,["error"]);if(U)return y;f[I]=t({structureId:I},S)}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}return u?t({positionsPlayedOff:p},f[u]):{availablePlayoffProfiles:Object.values(f),availablePlayoffRounds:Object.values(f),positionsPlayedOff:p}}function Mp(e){var t,r,n,i,l,c,d,p,v,f,m,h=e.playoffPositions,g=e.drawDefinition,I=e.structure,y=e.matchUps,U=null==I?void 0:I.structureId,S=Ys({drawDefinition:g,structureId:U}).links;if(I.structureType===Iu||I.structures){var w=null===(i=null===(n=ss({structure:I}))||void 0===n?void 0:n.positionAssignments)||void 0===i?void 0:i.length,T=I.structures.length,P=(null!=w?w:0)/T,D=(null===(l=S.source)||void 0===l?void 0:l.flatMap((function(e){var t=e.source;return(null==t?void 0:t.finishingPositions)||[]})))||[],b=R(1,P+1).filter((function(e){return!D.includes(e)})),N=(null===(d=null===(c=y.find((function(e){return e.containerStructureId===U&&e.finishingPositionRange})))||void 0===c?void 0:c.finishingPositionRange)||void 0===d?void 0:d.winner)||[0,1],M=null==S?void 0:S.source.map((function(e){return e.target.structureId})),A=Dp({structureIds:M,drawDefinition:g}),E=A.positionsPlayedOff,C=A.positionsNotPlayedOff,x=u(u([],o(null!=E?E:[]),!1),o(C),!1),F=R(N[0],N[1]+1).filter((function(e){return!x.includes(e)})),k=O(F,F.length/b.length);return{positionsNotPlayedOff:F,playoffFinishingPositionRanges:b.map((function(e,t){var r=k[t];return{finishingPosition:e,finishingPositions:r,finishingPositionRange:[Math.min.apply(Math,u([],o(r||[]),!1)),Math.max.apply(Math,u([],o(r||[]),!1))].join("-")}})),finishingPositionsAvailable:b,finishingPositionsPlayedOff:D,positionsPlayedOff:E,groupCount:T,groupSize:P}}var _=(null===(p=null==S?void 0:S.source)||void 0===p?void 0:p.filter((function(e){return e.linkCondition!==bu})).map((function(e){var t;return null===(t=e.source)||void 0===t?void 0:t.roundNumber})))||[],L=(null===(v=null==S?void 0:S.source)||void 0===v?void 0:v.filter((function(e){return e.linkCondition===bu})).map((function(e){var t;return null===(t=e.source)||void 0===t?void 0:t.roundNumber})))||[],j=bp({excludeRoundNumbers:_,playoffPositions:h,drawDefinition:g,structureId:U}),B=(null==j?void 0:j.playoffSourceRounds)?u([],o((null==j?void 0:j.playoffSourceRounds)||[]),!1):void 0,V=u([],o((null==j?void 0:j.playoffRoundsRanges)||[]),!1),G=j.roundProfile,q=j.error,W=function(e){var t=null==S?void 0:S.source.find((function(t){return t.source.roundNumber===e})),r=null==t?void 0:t.target.roundNumber,n=null==t?void 0:t.target.structureId,i=y.filter((function(e){var t=e.roundNumber;return e.structureId===n&&t===r})),a=i.filter((function(e){return e.sides.find((function(e){return e.participantFed&&!e.participantId}))})).length;if(B&&a===i.length){B.push(e);var s=null===(m=null===(f=null==G?void 0:G[e])||void 0===f?void 0:f.finishingPositionRange)||void 0===m?void 0:m.loser;if(s){var l=Math.min.apply(Math,u([],o(s),!1)),c=l+a,d=R(l,c),p={finishingPositionRange:[l,c-1].join("-"),finishingPositions:d,roundNumber:e};V.push(p)}}};try{for(var H=a(L),z=H.next();!z.done;z=H.next()){W(z.value)}}catch(e){t={error:e}}finally{try{z&&!z.done&&(r=H.return)&&r.call(H)}finally{if(t)throw t.error}}return B&&B.sort(s),V.sort((function(e,t){return e.roundNumber-t.roundNumber})),{playoffRounds:B,playoffRoundsRanges:V,error:q}}function Rp(e,r){var n;if(!e)return{error:K};var i=Date.now();e.updatedAt&&i===new Date(e.updatedAt).getTime()&&(i+=1);var a=new Date(i).toISOString(),o=null==r?void 0:r.filter(Boolean);return e.updatedAt=a,null===(n=e.structures)||void 0===n||n.filter(Boolean).forEach((function(e){(null==o?void 0:o.length)&&!(null==o?void 0:o.includes(e.structureId))||(e.updatedAt=a)})),t({},L)}function Ap(e){var r=e.drawDefinition,n=e.tournamentId,i=e.matchUps,a=e.eventId;return r&&Rp(r),mn({payload:{matchUps:i,tournamentId:n,eventId:a},topic:rd}),t({},L)}function Ep(e){var r,n,i=e.drawDefinition,o=e.tournamentId,u=e.matchUpIds,s=e.eventId,l=e.action;i&&Rp(i),mn({topic:cd,payload:{tournamentId:o,matchUpIds:u,eventId:s,action:l}});try{for(var c=a(u),d=c.next();!d.done;d=c.next()){In({key:d.value})}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return t({},L)}function Cp(e){var r=e.drawDefinition,n=e.tournamentId,i=e.structureId,a=e.context,o=e.eventId,u=e.matchUp;if(!u)return console.log(et),{error:et};r&&Op({drawDefinition:r,structureIds:i?[i]:void 0,tournamentId:n,eventId:o});return mn({topic:fd,payload:{matchUp:u,tournamentId:n,context:a},key:u.matchUpId}),t({},L)}function xp(e){var r=e.tournamentId,n=e.eventId,i=e.drawDefinition;return i?(Rp(i),mn({payload:{drawDefinition:i,tournamentId:r,eventId:n},topic:td,key:i.drawId}),t({},L)):(console.log(K),{error:K})}function Op(e){var r=e.drawDefinition,n=e.tournamentId,i=e.structureIds,a=e.eventId;return r?(Rp(r,i),mn({payload:{tournamentId:n,eventId:a,drawDefinition:r},topic:dd,key:r.drawId}),t({},L)):{error:K}}function Fp(e){var r=e.drawDefinition,n=e.tournamentId,i=e.structure,a=e.eventId;if(!r)return{error:K};if(!i)return{error:Ne};var o=i.seedAssignments,u=i.structureId;return mn({payload:{tournamentId:n,eventId:a,drawId:r.drawId,structureId:u,seedAssignments:o},topic:gd,key:r.drawId}),Op({structureIds:[u],drawDefinition:r,tournamentId:n,eventId:a}),t({},L)}function kp(e){var r=e.drawDefinition,n=e.tournamentId,i=e.structure,a=e.event;if(!r)return{error:K};if(!i)return{error:Ne};var o=ss({structure:i}),u=i.structureId,s=r.drawId,l=null==a?void 0:a.eventId;return mn({topic:hd,payload:{positionAssignments:o,tournamentId:n,structureId:u,eventId:l,drawId:s},key:u}),Op({structureIds:[u],drawDefinition:r,tournamentId:n,eventId:l}),t({},L)}function _p(e){var t=e.drawPositions,r=e.structure;if(![au,iu].includes(r.stage)||1!==r.stageSequence){var n=ss({structure:r}).positionAssignments,i=null==n?void 0:n.filter((function(e){var r=e.drawPosition;return null==t?void 0:t.includes(r)}));null==i||i.forEach((function(e){jn({element:e,extension:{name:to,value:!0}})}))}}function Lp(e){var t,r,n=e.drawDefinition,i=e.positionAction,a=Vn({name:Xa,element:n}).extension,o=Array.isArray(null==a?void 0:a.value)&&null!==(t=null==a?void 0:a.value)&&void 0!==t?t:[];if(!(null==o?void 0:o.length)){var u=n.structures.find((function(e){return e.stage===iu}));if(u){var s=null===(r=ss({structure:u}).positionAssignments)||void 0===r?void 0:r.map((function(e){var t=e.drawPosition,r=e.participantId,n=e.bye;return{drawPosition:t,participantId:r,qualifier:e.qualifier,bye:n}}));o.push({name:"initialMainAssignments",initialAssignments:s})}}jn({element:n,extension:{name:Xa,value:o.concat(i)}})}function jp(e){var t,r,n=e.tournamentRecord,i=e.drawDefinition,o=e.event,u=(null==n?void 0:n.events)||o&&[o],s=(null==u?void 0:u.map((function(e){return null==e?void 0:e.drawDefinitions})).flat().filter(Boolean))||i&&[i]||[],l={},c={},d=s.map((function(e){var t;return null===(t=null==e?void 0:e.structures)||void 0===t?void 0:t.filter((function(e){return null==e?void 0:e.structures}))})).flat().filter(Boolean),p=function(e){var t=null!=e?e:{},r=t.structures,n=t.structureId;r&&n&&(l[n]=null==r?void 0:r.map((function(e){return e.structureId})))&&r.forEach((function(t){return c[t.structureId]=null==e?void 0:e.structureId}))};try{for(var v=a(d),f=v.next();!f.done;f=v.next()){p(f.value)}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}return{containedStructures:l,containerStructures:c}}function Bp(e){var t,r,n=null==e?void 0:e.matchUp,i=(null==e?void 0:e.score)||(null==n?void 0:n.score),a=(null===(t=null==i?void 0:i.sets)||void 0===t?void 0:t[0])||{},o=a.side1Score,u=a.side2Score,s=a.side1TiebreakScore,l=a.side2TiebreakScore,c=a.side1PointScore,d=a.side2PointScore,p=o||u||s||l||c||d;return!!((null===(r=null==i?void 0:i.sets)||void 0===r?void 0:r.length)>1||p)}function Vp(e){var t=e.matchUpStatus;return Qo.includes(t)}function Gp(e){var t=e.matchUpStatus;return $o.includes(t)}function qp(e){var t,r=e.matchUpStatus,n=e.winningSide,i=e.tieMatchUps,a=e.sides,o=e.score,u=null==a?void 0:a.find((function(e){return e.participantId})),s=null===(t=null==i?void 0:i.filter(qp))||void 0===t?void 0:t.length;return Bp({score:o})||s||n&&u||r&&function(e){var t=e.matchUpStatus;return tu.includes(t)}({matchUpStatus:r})&&![jo,Ko,Go].includes(r)}function Wp(e){var t,r=e||{},n=r.sides,i=r.matchUpType,a=(null===(t=e.potentialParticipants)||void 0===t?void 0:t.length)?e.potentialParticipants.flat().map((function(e){return i===xs?(null==e?void 0:e.individualParticipantIds)||[]:e.participantId})).flat():[],o=(n||[]).map((function(e){var t;return i===xs&&((null===(t=null==e?void 0:e.participant)||void 0===t?void 0:t.individualParticipantIds)||[])||(null==e?void 0:e.participantId)&&[e.participantId]||[]})).flat();return{individualParticipantIds:o.concat(a).flat(),enteredIndividualParticipantIds:o,potentialIndividualParticipantIds:a}}function Hp(e){var t,r=e.finishingPositionOffset,n=void 0===r?0:r,i=e.finishingPositionLimit,a=e.positionsFed,s=e.roundsCount,l=e.roundLimit,c=e.matchUps,d=e.lucky,p=e.fmlc;if(!Zs(c))return[];var v=Xs({interpolate:!0,matchUps:c}),f=v.roundProfile,m=v.roundNumbers,h=void 0===m?[]:m;s=null!=s?s:Math.max.apply(Math,u(u([],o(h),!1),[0],!1));var g=l?s-l:0,I=g&&(null===(t=null==f?void 0:f[s-g])||void 0===t?void 0:t.matchUpsCount),y=f&&Object.values(f).map(Ri("matchUpsCount")),U=function(e,t){var r=Math.min.apply(Math,u([],o(e),!1));I&&t&&1===r&&(r=I);var n=Math.max.apply(Math,u([],o(e),!1));return i&&n>i&&(n=i),[r,n]},S=f&&Object.assign.apply(Object,u([{}],o(h.map((function(e){var t,r=(null!=s?s:0)+1-e-g,i=f[e].matchUpsCount,o={finishingPositionRange:{},finishingRound:r},u=null==y?void 0:y.slice(e-1).reduce((function(e,t){return e+(t||0)}),0),l=1+n+(p&&1!==e&&null!=a?a:0),c=R(l,d?l+2*i:u+l+1),v=u+1-i,m=U(c.slice(v)),h=U(c.slice(0,v),!0);return o.finishingPositionRange={loser:m,winner:h},(t={})[e]=o,t}))),!1)),w=on({finishingRound:!0});return c.filter(Boolean).forEach((function(e){var t=e.roundNumber&&S[e.roundNumber];w&&!t&&console.log({roundFinishingData:S,matchUp:e}),e.finishingRound=null==t?void 0:t.finishingRound,e.finishingPositionRange=null==t?void 0:t.finishingPositionRange})),c}function zp(e){var t,r,n,i=e.inContextDrawMatchUps,a=e.drawDefinition,s=e.matchUpsMap;if(!a)return{error:K};var l={loserMatchUpIds:{},winnerMatchUpIds:{}};(i||(t=Ip({inContext:!0,drawDefinition:a,matchUpsMap:s}),i=t.matchUps,s=t.matchUpsMap),(null==s?void 0:s.drawMatchUps.some((function(e){return e.finishingPositionRange})))||1!==(null===(r=null==a?void 0:a.structures)||void 0===r?void 0:r.length)||(null==a?void 0:a.structures[0].structures))||Hp({matchUps:null!==(n=null==s?void 0:s.drawMatchUps)&&void 0!==n?n:[]});return(null!=i?i:[]).filter((function(e){return!e.collectionId})).forEach((function(e){var t=e.matchUpId,r=e.structureId,n=Ks({inContextDrawMatchUps:i,drawDefinition:a,matchUpId:t}).targetMatchUps,c=n.winnerMatchUp,d=n.loserMatchUp,p=null==c?void 0:c.matchUpId,v=null==d?void 0:d.matchUpId,f=ml({matchUpsMap:s,structureId:r}).find((function(e){return e.matchUpId===t}));if(f&&(p&&(l.winnerMatchUpIds[f.matchUpId]=p,Object.assign(f,{winnerMatchUpId:p}),Object.assign(e,{winnerMatchUpId:p})),v&&(l.loserMatchUpIds[f.matchUpId]=v,e.loserMatchUpId=v,f.loserMatchUpId=v,e.finishingPositionRange))){var m=d.finishingPositionRange&&u(u([],o(e.finishingPositionRange.loser),!1),o(d.finishingPositionRange.loser),!1),h=m&&[Math.min.apply(Math,u([],o(m),!1)),Math.max.apply(Math,u([],o(m),!1))];e.finishingPositionRange.loser=h,f.finishingPositionRange.loser=h}})),{inContextDrawMatchUps:i,goesToMap:l}}function Yp(e){var r,n,i,a,o,u=e.participants,s=void 0===u?[]:u,l=e.contextContent,c=e.participantMap,d=e.scheduleVisibilityFilters,p=e.tournamentAppliedPolicies,v=e.participantsProfile,f=e.afterRecoveryTimes,m=e.policyDefinitions,h=e.useParticipantMap,g=e.tournamentRecord,I=e.contextFilters,y=e.contextProfile,U=e.matchUpFilters,S=e.nextMatchUps,w=e.inContext,T=e.context,P=e.event;if(!P)return{error:Ae};var D,b=P.eventId,N=P.eventName,M=P.endDate,R=P.category,A=P.gender,E=P.matchUpFormat,C=t(t({},T),xn({indoorOutDoor:null!==(r=P.indoorOutdoor)&&void 0!==r?r:null==g?void 0:g.indoorOutdoor,surfaceCategory:null!==(n=P.surfaceCategory)&&void 0!==n?n:null==g?void 0:g.surfaceCategory,endDate:null!==(i=P.endDate)&&void 0!==i?i:null==g?void 0:g.endDate,tournamentId:null==g?void 0:g.tournamentId,matchUpFormat:E,eventName:N,category:R,gender:A,eventId:b}));if(M&&(C.endDate=M),y&&!l&&(l=pl({policyDefinitions:m,tournamentRecord:g,contextProfile:y,event:P})),!(null==s?void 0:s.length)&&!c&&g){var x=qs({participantsProfile:v,useParticipantMap:h,policyDefinitions:m,tournamentRecord:g,contextProfile:y,inContext:w});c=x.participantMap,s=null!==(a=x.participants)&&void 0!==a?a:[],D=x.groupInfo}var O=null!==(o=P.drawDefinitions)&&void 0!==o?o:[],F=Ac({tournamentRecord:g,event:P}).scheduleTiming;return{matchUps:O.flatMap((function(e){var t=Ip({tournamentParticipants:s,tournamentAppliedPolicies:p,scheduleVisibilityFilters:d,context:C,participantsProfile:v,afterRecoveryTimes:f,policyDefinitions:m,tournamentRecord:g,contextFilters:I,contextProfile:y,drawDefinition:e,contextContent:l,matchUpFilters:U,participantMap:c,scheduleTiming:F,nextMatchUps:S,inContext:w,event:P}).matchUps;return null!=t?t:[]})),groupInfo:D}}function Kp(e){var r,n,i,a,s;if(!(null==e?void 0:e.tournamentRecord))return{error:W};var l=e.participantMap,c=e.participants,d=e.scheduleVisibilityFilters,p=e.participantsProfile,v=e.afterRecoveryTimes,f=e.useParticipantMap,m=e.policyDefinitions,h=e.tournamentRecord,g=e.inContext,I=void 0===g||g,y=e.contextProfile,U=e.matchUpFilters,S=e.contextFilters,w=e.nextMatchUps,T=e.context,P=null!==(i=e.tournamentId)&&void 0!==i?i:h.tournamentId,D=null!==(a=null==h?void 0:h.events)&&void 0!==a?a:[];c||(r=qs({participantsProfile:p,useParticipantMap:f,policyDefinitions:m,tournamentRecord:h,contextProfile:y,inContext:I}),c=r.participants,l=r.participantMap);var b=tl({tournamentRecord:h}).appliedPolicies,N=t(t({},T),{tournamentId:P,indoorOutDoor:h.indoorOutdoor,surfaceCategory:h.surfaceCategory,endDate:h.endDate}),M=pl({policyDefinitions:m,tournamentRecord:h,contextProfile:y}),R=(n=D.flatMap((function(e){var t,r,n;return N.eventDrawsCount=null!==(r=null===(t=e.drawDefinitions)||void 0===t?void 0:t.length)&&void 0!==r?r:0,null!==(n=Yp({context:N,scheduleVisibilityFilters:d,tournamentAppliedPolicies:b,participantsProfile:p,afterRecoveryTimes:v,policyDefinitions:m,tournamentRecord:h,contextContent:M,contextFilters:S,contextProfile:y,matchUpFilters:U,participantMap:l,nextMatchUps:w,participants:c,inContext:I,event:e}).matchUps)&&void 0!==n?n:[]}))).concat.apply(n,u([],o(null!==(s=h.matchUps)&&void 0!==s?s:[]),!1));return{matchUps:R}}function Jp(e){var t=e.scheduleVisibilityFilters,r=e.afterRecoveryTimes,n=e.participantsProfile,i=e.tournamentRecords,a=e.policyDefinitions,o=e.matchUpFilters,u=e.contextFilters,s=e.nextMatchUps,l=e.inContext;if("object"!=typeof i||!Object.keys(i).length)return{error:q};var c=Object.keys(i).map((function(e){var c,d=i[e];return null!==(c=Kp({scheduleVisibilityFilters:t,afterRecoveryTimes:r,participantsProfile:n,policyDefinitions:a,tournamentRecord:d,matchUpFilters:o,contextFilters:u,nextMatchUps:s,inContext:l}).matchUps)&&void 0!==c?c:[]})).flat();return{matchUps:c}}function Zp(e,t){var r,n;return function(e,t){return(cu[null==e?void 0:e.stage]||0)-(cu[null==t?void 0:t.stage]||0)}(e,t)||((null==e?void 0:e.stageSequence)||0)-((null==t?void 0:t.stageSequence)||0)||(null==e?void 0:e.roundNumber)&&t.roundNumber&&(null==e?void 0:e.roundNumber)-(null==t?void 0:t.roundNumber)||(null!==(r=null==e?void 0:e.roundPosition)&&void 0!==r?r:0)-(null!==(n=null==t?void 0:t.roundPosition)&&void 0!==n?n:0)}function Xp(e){var r,n,i,o,u,s,l,c,d,p,v=$c(e),f=null!==(c=e.matchUps)&&void 0!==c?c:[],m=null!==(d=e.drawIds)&&void 0!==d?d:[],h=e.includeParticipantDependencies,g=e.tournamentRecord,I=e.drawDefinition;if(!Array.isArray(f))return{error:$e};if(!Array.isArray(m))return{error:pe};var y=(null===(p=e.matchUpIds)||void 0===p?void 0:p.length)?e.matchUpIds:f.map((function(e){return e.matchUpId}));if(!Array.isArray(y))return{error:Xe};var U={},S={},w={},T={};g&&!Object.keys(v).length&&((r={})[g.tournamentId]=g,v=r);var P=Object.values(v),D=P.reduce((function(e,t){var r;return e.concat(null!==(r=t.events)&&void 0!==r?r:[]).map((function(e){return(e.drawDefinitions||[]).map((function(e){return e.links||[]}))})).flat(1/0)}),[]),b=D.filter((function(e){return e.linkType===Tu})),N=f;if(b.length){N=Jp({nextMatchUps:!0,tournamentRecords:v}).matchUps;var M=b.reduce((function(e,t){var r,n,i=null===(r=t.source)||void 0===r?void 0:r.structureId,a=null===(n=t.target)||void 0===n?void 0:n.structureId;return i&&a&&(w[a]=i),i&&!e.includes(i)&&e.push(i),e}),[]);try{for(var R=a(M),A=R.next();!A.done;A=R.next()){var E=A.value;U[E]=[]}}catch(e){n={error:e}}finally{try{A&&!A.done&&(i=R.return)&&i.call(R)}finally{if(n)throw n.error}}try{for(var C=a(null!=N?N:[]),x=C.next();!x.done;x=C.next()){var O=x.value;E=O.containerStructureId||O.structureId;M.includes(E)&&U[E].push(O.matchUpId)}}catch(e){o={error:e}}finally{try{x&&!x.done&&(u=C.return)&&u.call(C)}finally{if(o)throw o.error}}}var F=function(e){S[e]||(S[e]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},T[e]=[])},k=function(e,t){S[e].matchUpIds.forEach((function(e){S[t].matchUpIds.push(e)})),S[t].matchUpIds.push(e),S[e].dependentMatchUpIds.push(t),h&&S[e].participantIds.forEach((function(e){return S[t].participantIds.push(e)}))},_=function(e){var t,r,n,i,o,u=Object.keys(U).length;try{for(var s=a(e||[]),l=s.next();!l.done;l=s.next()){var c=l.value,d=c.matchUpId,p=c.winnerMatchUpId,v=c.loserMatchUpId;if(!y.length||y.includes(d)){if(F(d),h){var f=Wp(c).individualParticipantIds;S[d].participantIds=f}p&&(F(p),k(d,p),T[p].push(d)),v&&(F(v),k(d,v),T[v].push(d)),S[d].sources.push(T[d]);var m=T[d].map((function(e){return S[e].sources[0]})).flat(),g=T[d].map((function(e){return S[e].sources[1]})).flat();if((n=S[d].sources).push.apply(n,[m,g]),u){var I=c.containerStructureId||c.structureId,P=w[I];if(U[P])try{for(var D=(i=void 0,a(U[P])),b=D.next();!b.done;b=D.next()){var N=b.value;F(N),k(N,d),T[N].push(d)}}catch(e){i={error:e}}finally{try{b&&!b.done&&(o=D.return)&&o.call(D)}finally{if(i)throw i.error}}}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}};if(I)zp({drawDefinition:I}),(null==N?void 0:N.length)||(N=Up({drawDefinition:I}).matchUps),_(N);else{if((null==N?void 0:N.length)||(N=Jp({nextMatchUps:!0,tournamentRecords:v}).matchUps),!m.length){var j=(null==P?void 0:P.length)?P.map((function(e){var t=e.events;return(void 0===t?[]:t).map((function(e){var t=e.drawDefinitions;return(void 0===t?[]:t).map((function(e){return e.drawId}))}))})).flat(1/0):[];j&&(m=j)}var B=function(e){var t=null==N?void 0:N.filter((function(t){return t.drawId===e})).sort(Zp),r=null==t?void 0:t.find((function(e){return!e.roundPosition}));if(!r){var n=null==t?void 0:t.find((function(e){return e.tournamentId})),i=Ld({tournamentRecord:v[null==n?void 0:n.tournamentId],drawId:e}).drawDefinition;i&&zp({drawDefinition:i})}_(t)};try{for(var V=a(m),G=V.next();!G.done;G=V.next()){B(G.value)}}catch(e){s={error:e}}finally{try{G&&!G.done&&(l=V.return)&&l.call(V)}finally{if(s)throw s.error}}}return t({positionDependencies:U,matchUpDependencies:S,sourceMatchUpIds:T,matchUps:N},L)}function Qp(e){var t,r,n,i,l,c,d,p,v=e.drawDefinition,f=e.findContainer,m=e.structureId,h=e.event,g=e.structure,I=jp({drawDefinition:v}).containedStructures,y=m&&I[m]||[];if(!g){var S=as({drawDefinition:v,structureId:m});if(S.error)return S;g=f&&null!==(l=S.containingStructure)&&void 0!==l?l:S.structure}if(ip({drawDefinition:v,structure:g}))return{structure:g,isAdHoc:!0,error:oe};var w=Ip({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:v,event:h}).matchUps,T=null==w?void 0:w.filter((function(e){return e.structureId===m||y.includes(e.structureId)})),P=Xp({drawIds:[v.drawId],matchUps:w,drawDefinition:v}).matchUpDependencies,D=[],b=[],N={},M=[];try{for(var R=a(null!=w?w:[]),A=R.next();!A.done;A=R.next()){var E=A.value;if(E.structureId===m||y.includes(E.structureId)){b.push.apply(b,u([],o(null!==(c=E.drawPositions)&&void 0!==c?c:[]),!1));var C=E.roundNumber;try{for(var x=(n=void 0,a((null!==(d=E.drawPositions)&&void 0!==d?d:[]).filter(Boolean))),O=x.next();!O.done;O=x.next()){var F=O.value;(!N[F]||C&&N[F]>C)&&(N[F]=C)}}catch(e){n={error:e}}finally{try{O&&!O.done&&(i=x.return)&&i.call(x)}finally{if(n)throw n.error}}}qp(E)&&(M.push(E),D.push.apply(D,u([E.matchUpId],o((null===(p=null==P?void 0:P[null==E?void 0:E.matchUpId])||void 0===p?void 0:p.matchUpIds)||[]),!1)))}}catch(e){t={error:e}}finally{try{A&&!A.done&&(r=R.return)&&r.call(R)}finally{if(t)throw t.error}}var k=U(b.filter(Boolean)).sort(s),_=U(D),L=U(null==T?void 0:T.map((function(e){var t=e.matchUpId,r=e.drawPositions;return _.includes(t)?r:[]})).flat().filter(Boolean)).sort(s),j=ss({drawDefinition:v,structure:g}).positionAssignments,B=null==j?void 0:j.filter((function(e){return e.bye})).map((function(e){return e.drawPosition})),V=null==j?void 0:j.filter((function(e){return e.qualifier})).map((function(e){return e.drawPosition})),G=(null==k?void 0:k.filter((function(e){return!L.includes(e)})))||[];return{allDrawPositions:k,inContextStructureMatchUps:T,drawPositionInitialRounds:N,activeDependentMatchUpIds:_,qualifyingDrawPositions:V,inactiveDrawPositions:G,positionAssignments:j,activeDrawPositions:L,byeDrawPositions:B,activeMatchUps:M,structure:g}}function $p(e){var t=e.drawPosition,r=e.matchUps,n=(void 0===r?[]:r).filter((function(e){var r=e.drawPositions;return t&&(null==r?void 0:r.includes(t))})).map((function(e){return e.roundNumber})).sort(s)[0];return{initialRoundNumber:n}}var ev,tv={reset:"[0m",bright:"[1m",dim:"[2m",red:"[31m",brightred:"[91m",green:"[32m",brightgreen:"[92m",yellow:"[33m",brightyellow:"[93m",blue:"[34m",brightblue:"[94m",lightblue:"[105m",magenta:"[35m",brightmagenta:"[95m",cyan:"[36m",brightcyan:"[96m",white:"[37m",brightwhite:"[97m"},rv=[];function nv(e,t){"string"==typeof e&&(e={method:e}),(t||on())&&rv.push(e)}function iv(e){var t=function(e){var t=rv.slice();return e&&(rv.length=0),t}(e),r=t.map((function(e){var t=e.color,r=e.keyColors,n=e.method,i=e.newline,a=Object.keys(tv).includes(t)?tv[t]:tv.cyan,o=Object.keys(e).filter((function(e){return!["color","keyColors","method","newline"].includes(e)})).map((function(t){var n=r&&Object.keys(r).includes(t)&&tv[r[t]]?tv[r[t]]:tv.brightwhite;return"".concat(tv.white).concat(t,": ").concat(n).concat(e[t])})).join(", ");return[i?"\n":"",a,n,(null==n?void 0:n.length)<15?"\t\t":"\t",tv.white,o,tv.reset,"\n"].join("")}));(null==r?void 0:r.length)&&console.log.apply(console,u([],o(r),!1))}function av(e){var r,n,i=e.provisionalPositioning,a=e.isPositionAction,o=e.tournamentRecord,u=e.drawDefinition,s=e.drawPosition,l=e.matchUpsMap,c=e.structureId,d=e.structure,p=e.event;if(!u)return{error:K};if(d||(d=as({drawDefinition:u,structureId:c}).structure),!d)return{error:De};c||(c=d.structureId);var v="assignDrawPositionBye";nv({method:v,color:"cyan",drawPosition:s}),l||(l=fl({drawDefinition:u}));var f=ss({structure:d}).positionAssignments,m=Qp({drawDefinition:u,structureId:c}).activeDrawPositions,h=null==f?void 0:f.find((function(e){return e.drawPosition===s}));if(null==h?void 0:h.bye)return t({},L);if(null==m?void 0:m.includes(s))return{error:ae};var g=null==f?void 0:f.find((function(e){return e.drawPosition===s}));if(!g)return{error:oe};var I=function(e){var t=e.bye,r=e.qualifier,n=e.participantId,i=t||r||n;return{containsBye:t,containsQualifier:r,assignedParticipantId:n,filled:i}}(g),y=I.filled,U=I.containsBye,S=I.assignedParticipantId;if(U)return t({},L);if(y&&!U)return On({result:{error:ee},stack:v});var w=null!==(r=Ip({inContext:!0,drawDefinition:u,matchUpsMap:l}).matchUps)&&void 0!==r?r:[],T=mp({provisionalPositioning:i,drawDefinition:u,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:l,structure:d}).matchUps;if(null==f||f.forEach((function(e){e.drawPosition===s&&(e.bye=!0)})),d.structureType===Iu)return function(e){var t=e.tournamentRecord,r=e.drawDefinition,n=e.drawPosition,i=e.matchUps,a=e.event;i.forEach((function(e){var i;(null===(i=e.drawPositions)||void 0===i?void 0:i.includes(n))&&uv({eventId:null==a?void 0:a.eventId,tournamentRecord:t,drawDefinition:r,matchUp:e})}))}({tournamentRecord:o,drawDefinition:u,drawPosition:s,matchUps:T}),kp({tournamentId:null==o?void 0:o.tournamentId,drawDefinition:u,structure:d,event:p}),ov({assignedParticipantId:S,isPositionAction:a,drawDefinition:u,drawPosition:s,structureId:c,stack:v});var P=Xs({matchUps:T}),D=P.roundProfile,b=P.roundMatchUps,N=D&&Object.keys(D).map((function(e){return parseInt(e)})).reverse(),M=null==N?void 0:N.find((function(e){var t;return null===(t=null==D?void 0:D[e].drawPositions)||void 0===t?void 0:t.includes(s)})),R=M?null==b?void 0:b[M].find((function(e){var t=e.drawPositions;return null==t?void 0:t.includes(s)})):void 0;R&&uv({tournamentRecord:o,drawDefinition:u,matchUp:R,event:p});var A=null===(n=null==R?void 0:R.drawPositions)||void 0===n?void 0:n.find((function(e){return e!==s}));if(R&&A){var E=sv({sourceDrawPositions:R.drawPositions,matchUpId:R.matchUpId,inContextDrawMatchUps:w,drawPositionToAdvance:A,tournamentRecord:o,drawDefinition:u,matchUpsMap:l});if(E.error)return E}return kp({tournamentId:null==o?void 0:o.tournamentId,drawDefinition:u,structure:d,event:p}),ov({assignedParticipantId:S,isPositionAction:a,drawDefinition:u,drawPosition:s,structureId:c,stack:v})}function ov(e){var r=e.assignedParticipantId,n=e.isPositionAction,i=e.drawDefinition,a=e.drawPosition,o=e.structureId,u=e.stack;n&&Lp({drawDefinition:i,positionAction:{removedParticipantId:r,drawPosition:a,structureId:o,name:u}});return On({result:t({},L),stack:u})}function uv(e){var t=e.tournamentRecord,r=e.drawDefinition,n=e.eventId,i=e.matchUp,a=e.event;Object.assign(i,{matchUpStatus:Fo,score:void 0,winningSide:void 0}),Cp({tournamentId:null==t?void 0:t.tournamentId,eventId:null!=n?n:null==a?void 0:a.eventId,context:"setMatchUpStatusBye",drawDefinition:r,matchUp:i})}function sv(e){var r,n=e.drawPositionToAdvance,i=e.inContextDrawMatchUps,a=e.sourceDrawPositions,l=e.tournamentRecord,c=e.drawDefinition,d=e.matchUpsMap,p=e.matchUpId,v=e.event;nv({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:n});var f=d.drawMatchUps.find((function(e){return e.matchUpId===p})),m=i.find((function(e){return e.matchUpId===p})),h=as({drawDefinition:c,structureId:null==m?void 0:m.structureId}).structure,g=ss({structure:h}).positionAssignments,I=null==g?void 0:g.filter((function(e){return e.bye})).map((function(e){return e.drawPosition})),y=null===(r=null==f?void 0:f.drawPositions)||void 0===r?void 0:r.find((function(e){return e!==n})),U=y&&(null==I?void 0:I.includes(y)),S=Ks({inContextDrawMatchUps:i,drawDefinition:c,matchUpId:p}),w=S.targetLinks.loserTargetLink,T=S.targetMatchUps,P=T.loserMatchUp,D=T.winnerMatchUp,b=T.loserTargetDrawPosition;if(D&&D.structureId===(null==h?void 0:h.structureId)&&function(e){var t,r,n,i=e.drawPositionToAdvance,a=e.inContextDrawMatchUps,l=e.sourceDrawPositions,c=e.tournamentRecord,d=e.drawDefinition,p=e.winnerMatchUp,v=e.matchUpsMap,f=e.event,m="advanceWinner",h=v.drawMatchUps.find((function(e){return e.matchUpId===p.matchUpId})),g=a.find((function(e){return e.matchUpId===p.matchUpId})),I=null==g?void 0:g.structureId,y=as({drawDefinition:d,structureId:I}).structure,U=ss({structure:y}).positionAssignments,S=null==U?void 0:U.find((function(e){return e.drawPosition===i})),w=null==S?void 0:S.bye,T=null===(t=h.drawPositions)||void 0===t?void 0:t.filter(Boolean),P=null==U?void 0:U.filter((function(e){return null==T?void 0:T.includes(e.drawPosition)})),D=null==U?void 0:U.find((function(e){return e.drawPosition===i})),b=null==l?void 0:l.find((function(e){return e!==i})),N=b&&(null==P?void 0:P.find((function(e){return e.drawPosition===b}))),M=null==N?void 0:N.bye,R=w&&M;R&&console.log({isByeAdvancedBye:R});if((null==T?void 0:T.length)>1&&w&&!M)return On({result:{error:ee},stack:m});var A=null==T?void 0:T.find((function(e){return e!==i})),E=R,C=u(u([],o((h.drawPositions||[]).filter(Boolean)),!1),[void 0,void 0],!1).slice(0,2),x=C.map((function(e){return!e&&!E||e===i?(E=!0,i):e})).sort(s);if(!E)return console.log("@@@@@@@",{advancingAssignmentIsBye:D,drawPositionToAdvance:i,existingAssignments:P}),On({result:{error:ee},stack:m});var O=null===(r=null==U?void 0:U.find((function(e){return e.drawPosition===A})))||void 0===r?void 0:r.bye,F=null===(n=null==U?void 0:U.find((function(e){return e.drawPosition===i})))||void 0===n?void 0:n.bye,k=F||O?Fo:Yo;Object.assign(h,{matchUpStatus:k,score:void 0,winningSide:void 0,drawPositions:x});var _=h.drawPositions.find((function(e){return!C.includes(e)}));nv({method:m,color:"brightyellow",changedDrawPosition:_,pairedDrawPositionIsBye:O,drawPositionIsBye:F}),Cp({tournamentId:null==c?void 0:c.tournamentId,matchUp:h,eventId:null==f?void 0:f.eventId,context:m,drawDefinition:d});var L=Ks({matchUpId:p.matchUpId,inContextDrawMatchUps:a,drawDefinition:d}),j=L.targetLinks.loserTargetLink,B=L.targetMatchUps,V=B.loserMatchUp,G=B.loserTargetDrawPosition;if(O||F){var q=O?i:A;if(q)sv({drawPositionToAdvance:q,matchUpId:p.matchUpId,inContextDrawMatchUps:a,tournamentRecord:c,drawDefinition:d,matchUpsMap:v});else if(F&&j&&V)if(V.feedRound)lv({loserTargetDrawPosition:G,tournamentRecord:c,loserTargetLink:j,drawDefinition:d,loserMatchUp:V,matchUpsMap:v});else{var W=1-p.roundPosition%2,H=V.drawPositions[W],z=av({structureId:j.target.structureId,drawPosition:H,tournamentRecord:c,drawDefinition:d,event:f});if(z.error);}}}({drawPositionToAdvance:n,inContextDrawMatchUps:i,sourceDrawPositions:a,tournamentRecord:l,drawDefinition:c,winnerMatchUp:D,matchUpsMap:d,event:v}),P&&U&&P.structureId!==(null==h?void 0:h.structureId))if(1===P.roundNumber){var N=av({structureId:w.target.structureId,drawPosition:b,tournamentRecord:l,drawDefinition:c,event:v});if(N.error)return N}else lv({loserTargetDrawPosition:b,tournamentRecord:l,loserTargetLink:w,drawDefinition:c,loserMatchUp:P,matchUpsMap:d,event:v});return t({},L)}function lv(e){var t=e.loserTargetDrawPosition,r=e.tournamentRecord,n=e.loserTargetLink,i=e.drawDefinition,a=e.loserMatchUp,o=e.matchUpsMap,u=e.event,s=a.roundNumber;if(nv({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t}),$p({drawPosition:t,matchUps:((null==o?void 0:o.mappedMatchUps)||{})[a.structureId].matchUps}).initialRoundNumber===s){var l=av({structureId:n.target.structureId,drawPosition:t,tournamentRecord:r,drawDefinition:i,event:u});if(l.error)return l}}function cv(e){var t=e.positionAssignments,r=e.tournamentRecord,n=e.drawDefinition,i=e.matchUpsMap,a=e.structure,o=e.event;mp({drawDefinition:n,matchUpsMap:i,structure:a,event:o}).matchUps.forEach((function(e){var i=t.filter((function(t){var r,n=t.drawPosition;return null===(r=e.drawPositions)||void 0===r?void 0:r.includes(n)})),a=i.filter((function(e){return e.bye})).length;if(!e.winningSide){var u=a?Fo:Yo;Object.assign(e,{matchUpStatus:u}),Cp({tournamentId:null==r?void 0:r.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:null==o?void 0:o.eventId,drawDefinition:n,matchUp:e})}}))}function dv(e){var r=e.inContextDrawMatchUps,n=e.participantId,i=e.drawPosition,a=e.tournamentRecord,o=e.drawDefinition,u=e.structureId,s=e.matchUpsMap,l=e.event,c=as({drawDefinition:o,structureId:u}).structure,d=(ls({drawDefinition:o,structure:c}).positionAssignments||[]).find((function(e){return n&&e.participantId===n||i&&e.drawPosition===i}));return d&&n&&!i&&(i=null==d?void 0:d.drawPosition),i?(n||(n=null==d?void 0:d.participantId),Qp({drawDefinition:o,structureId:u}).activeDrawPositions.includes(i)?{error:ae}:(r||(r=Ip({inContext:!0,drawDefinition:o,matchUpsMap:s}).matchUps),pv({inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,structureId:u,drawPosition:i,matchUpsMap:s,event:l}).drawPositionCleared?(kp({tournamentId:null==a?void 0:a.tournamentId,drawDefinition:o,structure:c,event:l}),t(t({},L),{participantId:n})):{error:re})):{error:ue}}function pv(e){var r=e.inContextDrawMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.drawPosition,s=e.matchUpsMap,c=e.structureId,d=e.event,p=as({drawDefinition:i,structureId:c}).structure;if(!p)return{error:De};var v=ls({drawDefinition:i,structure:p}).positionAssignments||[],f=v.some((function(e){if(e.drawPosition===a)return delete e.participantId,delete e.qualifier,delete e.bye,!0}));if(p.structureType===Iu)return cv({positionAssignments:v,tournamentRecord:n,drawDefinition:i,matchUpsMap:s,structure:p}),t({drawPositionCleared:f},L);var m=Xs({matchUps:mp({drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:s,structure:p,event:d}).matchUps}),h=m.roundProfile,g=m.roundMatchUps,I=h&&Object.keys(h),y=null==I?void 0:I.map((function(e){return l(e)})),U=a,S=null==y?void 0:y.map((function(e){var t,r,n,i=null==h?void 0:h[e],a=null===(t=null==i?void 0:i.pairedDrawPositions)||void 0===t?void 0:t.find((function(e){return e.includes(U)})),o=null==a?void 0:a.find((function(e){return e!==U})),u=v.find((function(e){return e.drawPosition===o})),s=null==h?void 0:h[e+1],l=null==u?void 0:u.bye,c=null===(r=null==s?void 0:s.pairedDrawPositions)||void 0===r?void 0:r.find((function(e){return e.includes(o)})),d=l&&c&&s&&(null===(n=s.drawPositions)||void 0===n?void 0:n.includes(o)),p=a&&{pairedDrawPositionByeAdvancedPair:!d&&c,pairedDrawPosition:o,targetDrawPosition:U,relevantPair:a,roundNumber:e};return d&&(U=o),p})).filter((function(e){return null==e?void 0:e.targetDrawPosition})),w=null==S?void 0:S.reduce((function(e,t){var r=t.roundNumber,n=t.relevantPair,i=t.targetDrawPosition,a=t.pairedDrawPosition,s=t.pairedDrawPositionByeAdvancedPair,l=[{roundNumber:r,targetDrawPosition:i,relevantPair:n},s&&{roundNumber:r+1,targetDrawPosition:a,relevantPair:s,subsequentRoundRemoval:!0}].filter(Boolean);return e.concat.apply(e,u([],o(l),!1))}),[]);return null==w||w.forEach((function(e){var o=e.roundNumber,u=e.targetDrawPosition,l=e.relevantPair,f=null==g?void 0:g[o].find((function(e){var t;return x(null===(t=e.drawPositions)||void 0===t?void 0:t.filter(Boolean),l.filter(Boolean))}));f&&(!function(e){var r,n=e.inContextDrawMatchUps,i=e.targetDrawPosition,a=e.tournamentRecord,o=e.drawDefinition,u=e.matchUpsMap,s=e.roundNumber,l=e.structureId,c=as({drawDefinition:o,structureId:l}).structure;if(!c)return{error:De};if(c.structureType===Iu)return;u=u||fl({drawDefinition:o});var d=(null==u?void 0:u.mappedMatchUps)||{},p=d[l].matchUps,v=$p({drawPosition:i,matchUps:p}).initialRoundNumber,f=null==p?void 0:p.filter((function(e){var t;return e.roundNumber>=s&&e.roundNumber!==v&&(null===(t=e.drawPositions)||void 0===t?void 0:t.includes(i))})),m=null!==(r=ss({drawDefinition:o,structureId:l}).positionAssignments)&&void 0!==r?r:[];null==f||f.forEach((function(e){return vv({drawPosition:i,targetMatchUp:e,inContextDrawMatchUps:n,positionAssignments:m,tournamentRecord:a,drawDefinition:o,matchUpsMap:u,structure:c})})),t({},L)}({inContextDrawMatchUps:r,targetDrawPosition:u,tournamentRecord:n,drawDefinition:i,structureId:c,roundNumber:o,matchUpsMap:s}),vv({inContextDrawMatchUps:r,positionAssignments:v,tournamentRecord:n,drawDefinition:i,targetMatchUp:f,drawPosition:a,matchUpsMap:s,structure:p,event:d}))})),{tasks:w,drawPositionCleared:f,positionAssignments:v}}function vv(e){var r,n,i,a,s,l,c,d=e.inContextDrawMatchUps,p=e.positionAssignments,v=e.tournamentRecord,f=e.drawDefinition,m=e.targetMatchUp,h=e.drawPosition,g=e.matchUpsMap,I=e.structure,y=e.event,U="removeDrawPosition",S=null===(r=m.drawPositions)||void 0===r?void 0:r.slice(),w=m.matchUpStatus,T=m.winningSide,P=(g=null!=g?g:fl({drawDefinition:f})).mappedMatchUps[I.structureId].matchUps,D=$p({drawPosition:h,matchUps:P}).initialRoundNumber;if(m.roundNumber&&D&&m.roundNumber>D){var b=(null!==(n=m.drawPositions)&&void 0!==n?n:[]).map((function(e){return e===h?void 0:e}));m.drawPositions=b}if(m.matchUpType===Fs){var N=null==d?void 0:d.find((function(e){return e.matchUpId===m.matchUpId})),M=(null!==(i=null==N?void 0:N.sides)&&void 0!==i?i:[]).reduce((function(e,t,r){return t.drawPosition===h?r:e}),void 0);void 0!==M&&(null===(s=null===(a=m.sides)||void 0===a?void 0:a[M])||void 0===s?void 0:s.lineUp)&&(null===(l=m.sides)||void 0===l||delete l[M].lineUp,Cp({tournamentId:null==v?void 0:v.tournamentId,context:"".concat(U,"-TEAM"),eventId:null==y?void 0:y.eventId,matchUp:m,drawDefinition:f}))}var R=Ks({matchUpId:m.matchUpId,inContextDrawMatchUps:d,drawDefinition:f}),A=R.targetLinks.winnerTargetLink,E=R.targetMatchUps,C=E.loserMatchUp,x=E.winnerMatchUp,O=E.loserMatchUpDrawPositionIndex,F=p.filter((function(e){var t,r=e.drawPosition;return null===(t=m.drawPositions)||void 0===t?void 0:t.includes(r)})),k=F.filter((function(e){return e.bye})).length,_=k&&Fo||m.matchUpStatus&&[jo,Ko].includes(m.matchUpStatus)&&m.matcHUpStatus||2===(null===(c=m.drawPositions)||void 0===c?void 0:c.length)&&Yo||void 0;m.matchUpStatus=_,m.matchUpStatus&&[Ko,jo].includes(m.matchUpStatus)&&(m.winningSide=void 0);var j=null==S?void 0:S.find((function(e){var t;return!(null===(t=m.drawPositions)||void 0===t?void 0:t.includes(e))}));if((null==S?void 0:S.includes(h))&&w===m.matchUpStatus&&T===m.winningSide||(j&&nv({method:U,color:"brightyellow",removedDrawPosition:j}),Cp({tournamentId:null==v?void 0:v.tournamentId,eventId:null==y?void 0:y.eventId,matchUp:m,context:"".concat(U,"-").concat(h),drawDefinition:f})),C&&C.structureId!==R.matchUp.structureId&&!k){b=C.drawPositions;if(1===C.roundNumber){var B=b[O];pv({structureId:C.structureId,drawPosition:B,inContextDrawMatchUps:d,tournamentRecord:v,drawDefinition:f,matchUpsMap:g})}else{var V=function(e){var r=e.loserMatchUpDrawPosition,n=e.inContextDrawMatchUps,i=e.tournamentRecord,a=e.drawDefinition,o=e.loserMatchUp,u=e.matchUpsMap,s=e.event,l=as({structureId:o.structureId,drawDefinition:a}).structure,c=ss({structure:l}).positionAssignments,d=null==c?void 0:c.find((function(e){return e.drawPosition===r}));if(null==d?void 0:d.bye){var p=dv({drawPosition:r,structureId:o.structureId,inContextDrawMatchUps:n,tournamentRecord:i,drawDefinition:a,matchUpsMap:u,event:s});if(p.error)return p}return t({},L)}({loserMatchUpDrawPosition:B=Math.min.apply(Math,u([],o(b.filter(Boolean)),!1)),inContextDrawMatchUps:d,tournamentRecord:v,drawDefinition:f,loserMatchUp:C,matchUpsMap:g,event:y});if(V.error)return On({result:V,stack:U});1===$p({drawPosition:B,matchUps:((null==g?void 0:g.mappedMatchUps)||{})[C.structureId].matchUps}).initialRoundNumber&&(nv({method:U,color:"brightyellow",loserMatchUpDrawPosition:B}),pv({structureId:C.structureId,drawPosition:B,inContextDrawMatchUps:d,tournamentRecord:v,drawDefinition:f,matchUpsMap:g}))}}return x&&x.structureId!==R.matchUp.structureId&&A.target.feedProfile,t({},L)}function fv(e){var r,n=e.drawDefinition,i=e.stages;if(!n)return{error:K};var a=U((null!==(r=null==n?void 0:n.structures)&&void 0!==r?r:[]).filter((function(e){return!(null==i?void 0:i.length)||e.stage&&i.includes(e.stage)})).map((function(e){var t=ss({structure:e}).positionAssignments;return t?t.map(Ri("participantId")):[]})).flat().filter(Boolean));return t(t({},L),{assignedParticipantIds:a})}function mv(e){var r,n=(null!==(r=null==e?void 0:e.entries)&&void 0!==r?r:[]).filter(Boolean).reduce((function(e,t){var r=t.entryStage,n=t.entryStatus,i="_".concat(r||iu).concat(n||"");return e[i]||(e[i]=[]),e[i].push(t),e}),{}),i=function(e){return isNaN(e)?1/0:e};return Object.keys(n).map((function(e){return n[e].sort((function(e,t){return i(e.entryPosition)-i(t.entryPosition)})).map((function(e,r){var n=r+1;return t(t({},e),{entryPosition:n})}))})).flat()}function hv(e){return[El,Al].includes(e)}function gv(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D,b=e.autoEntryPositions,N=void 0===b||b,M=e.ignoreAssignment,R=e.tournamentRecord,A=e.drawDefinition,E=e.participantIds,C=e.entryStatus,x=e.entryStage,O=e.extension,F=e.eventSync,k=e.drawId,_=e.stage,j=e.event;if(!E||!Array.isArray(E))return{error:At,method:"modifyEntriesStatus",participantIds:E};if(!A&&!j)return{error:Ae};if(C&&!Ll.includes(C))return{error:Kt};if(x&&!lu.includes(x))return{error:_e};var B="modifyEntriesStatus",V=[];if(!C&&!O)return On({result:{error:pt},info:"Missing entryStatus",stack:B});if(O&&!Ln({extension:O,requiredAttributes:["name"]}))return On({result:{error:xr},info:"Invalid extension",context:{extension:O},stack:B});var G=[];null===(l=null==j?void 0:j.drawDefinitions)||void 0===l||l.forEach((function(e){var t,r=null!==(t=fv({stages:_&&[_],drawDefinition:e}).assignedParticipantIds)&&void 0!==t?t:[];G.push.apply(G,u([],o(r),!1))}));var q=null!==(c=null==R?void 0:R.participants)&&void 0!==c?c:[],W=E.every((function(e){var t,r=null===(t=Wa({tournamentParticipants:q,participantId:e}))||void 0===t?void 0:t.participantType;return!(r&&[hs,vs].includes(r)&&hv(C)||C&&(null==j?void 0:j.eventType)&&r===fs&&[ma,Ia].includes(j.eventType)&&u([Sl],o(Ol),!1).includes(C))}));if(!W)return{error:Kt};var H=j&&_d({event:j}).flightProfile,z=null===(d=null==H?void 0:H.flights)||void 0===d?void 0:d.find((function(e){return e.drawId===k})),Y=function(e){var r=(e||[]).filter((function(e){return!_||!e.entryStage||_===e.entryStage})).filter((function(e){var t=e.participantId;return E.includes(t)}));return r.every((function(e){return!(function(e){return C&&G.includes(e.participantId)&&!(Ol.includes(e.entryStatus)&&Ol.includes(C))}(e)&&!M)&&(C&&(e.entryStatus=C,delete e.entryPosition),x&&(e.entryStage=x,delete e.entryPosition),O&&(O.value?jn({element:e,extension:O}):_n({element:e,name:O.name})),!0)}))?t({},L):{error:Ht}},K=function(e){var t,r=e.flight,n=e.drawDefinition;j&&(j.entries=mv({entries:null!==(t=j.entries)&&void 0!==t?t:[]})),r&&(r.drawEntries=mv({entries:r.drawEntries})),n&&(n.entries=mv({entries:n.entries}))},J=function(e){var r=e.flight,n=e.drawDefinition,i="updateDrawEntries";if(r&&(a=Y(r.drawEntries)).error)return On({result:a,stack:i});if(n){var a;if((a=Y(n.entries)).error)return On({result:a,stack:i});V.includes(n.drawId)||V.push(n.drawId)}return t({},L)},Z=null!==(v=null===(p=null==j?void 0:j.entries)||void 0===p?void 0:p.find((function(e){return e.entryPosition})))&&void 0!==v?v:(null===(f=null==z?void 0:z.drawEntries)||void 0===f?void 0:f.find((function(e){return e.entryPosition})))||(null===(m=null==A?void 0:A.entries)||void 0===m?void 0:m.find((function(e){return e.entryPosition})));if((N&&!Z&&K({flight:z,drawDefinition:A}),z||A)&&(ne=J({flight:z,drawDefinition:A})).error)return On({result:ne,stack:B});var X=null!==(g=null===(h=null==j?void 0:j.drawDefinitions)||void 0===h?void 0:h.map((function(e){return e.drawId})))&&void 0!==g?g:[],Q=(null===(I=null==H?void 0:H.flights)||void 0===I?void 0:I.filter((function(e){return!X.includes(e.drawId)})))||[];try{for(var $=a(Q),ee=$.next();!ee.done;ee=$.next()){var te=ee.value;if(null==(ne=te&&J({flight:te}))?void 0:ne.error)return On({result:ne,stack:B})}}catch(e){r={error:e}}finally{try{ee&&!ee.done&&(n=$.return)&&n.call($)}finally{if(r)throw r.error}}var re=1===(null===(y=null==H?void 0:H.flights)||void 0===y?void 0:y.length)&&(null!==(S=null===(U=null==j?void 0:j.drawDefinitions)||void 0===U?void 0:U.length)&&void 0!==S?S:0)<=(null===(w=null==H?void 0:H.flights)||void 0===w?void 0:w.length);if(!z&&!A&&C&&Fl.includes(C))return{error:$t};if(!z&&!A||C===xl||F&&re){var ne,ie;if(null==(ne=Y(null==j?void 0:j.entries))?void 0:ne.error)return On({result:ne,stack:B});if(C===xl&&(null===(T=null==H?void 0:H.flights)||void 0===T||T.every((function(e){var t=Y(e.drawEntries);return t.error?(ie=t.error,!1):(e.drawEntries=e.drawEntries.filter((function(e){var t=e.participantId;return!E.includes(t)})),!0)})),null===(P=null==j?void 0:j.drawDefinitions)||void 0===P||P.every((function(e){var t,r=Y(e.entries);return r.error?(ie=r.error,!1):(e.entries=null===(t=e.entries)||void 0===t?void 0:t.filter((function(e){var t=e.participantId;return!E.includes(t)})),!0)}))),ie)return On({result:{error:ie},stack:B})}N&&K({flight:z,drawDefinition:A});try{for(var ae=a(null!==(D=null==j?void 0:j.drawDefinitions)&&void 0!==D?D:[]),oe=ae.next();!oe.done;oe=ae.next()){var ue=oe.value;V.length&&!V.includes(ue.drawId)||Op({tournamentId:R.tournamentId,eventId:null==j?void 0:j.eventId,drawDefinition:ue})}}catch(e){i={error:e}}finally{try{oe&&!oe.done&&(s=ae.return)&&s.call(ae)}finally{if(i)throw i.error}}return t({},L)}function Iv(e){var r=e.participantMap,n=e.participantId,i=e.matchUpStatus,a=e.roundPosition,o=e.structureId,u=e.matchUpType,s=e.roundNumber,l=e.matchUpId,c=e.potential,d=e.schedule,p=e.drawId,v=e.score;d&&Object.keys(d).length&&(i===Fo||r[n].scheduleItems.push(t(t({},d),{scheduledDate:ui(null==d?void 0:d.scheduledDate),scheduledTime:oi(null==d?void 0:d.scheduledTime),checkScoreHasValue:Bp({score:v}),matchUpStatus:i,roundPosition:a,structureId:o,matchUpType:u,roundNumber:s,matchUpId:l,potential:c,drawId:p})))}function yv(e){var r,n,i=e.requireTimeStamp,a=e.scaleAttributes,u=e.participant;if(!u)return{error:Ft};if(!Di(a))return{error:xr};if(u.timeItems||(u.timeItems=[]),Array.isArray(u.timeItems)){var s=a.accessor,l=a.scaleType,c=a.eventType,d=a.scaleName,p=[Ta,l,c,d].join("."),v=u.timeItems.filter((function(e){return(null==e?void 0:e.itemType)===p})).filter((function(e){return!i||(null==e?void 0:e.itemDate)})).sort((function(e,t){return(e.createdAt?new Date(e.createdAt).getTime():0)-(t.createdAt?new Date(t.createdAt).getTime():0)})),f=v.pop();if(f){var m=o(null!==(n=null===(r=f.itemType)||void 0===r?void 0:r.split("."))&&void 0!==n?n:[],4),h=m[0],g=m[1],I=m[2],y=m[3];if(h!==Ta)return{error:Tr};var U=s&&wi({element:f.itemValue,accessor:s}),S=(null==U?void 0:U.value)||f.itemValue,w={eventType:I,scaleDate:f.itemDate,scaleValue:S,scaleName:y,scaleType:g};return t(t({},L),{scaleItem:w})}}return t(t({},L),{scaleItem:void 0})}function Uv(e){var t,r,n,i=e.event,a=e.status,o=void 0===a?Tc:a;return null===(n=null===(r=null===(t=bs({itemType:"".concat(wc,".").concat(Pc),event:i}))||void 0===t?void 0:t.timeItem)||void 0===r?void 0:r.itemValue)||void 0===n?void 0:n[o]}function Sv(e){var t,r=e.drawDetails,n=e.drawId,i=null===(t=null==r?void 0:r[n])||void 0===t?void 0:t.publishingDetail;return null==i?void 0:i.published}function wv(e){var r,n,i,o,u,s,l,c,d=e.tournamentRecord,p=e.eventIds,v=e.drawIds,f=e.drawId,m=e.event;if(Array.isArray(p)&&(null==p?void 0:p.length)){var h={};try{for(var g=a(p),I=g.next();!I.done;I=g.next()){var y=I.value;if(!Pi(y))return{error:xr};var U=Ld({tournamentRecord:d,eventId:y});if(!U)return{error:Ee};if((N=Tv({event:U})).error)return N;h[y]=N}}catch(e){r={error:e}}finally{try{I&&!I.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}return t(t({},L),{publishState:h})}if(!m&&(null==d?void 0:d.events)&&Array.isArray(v)&&v.length){h={};try{for(var S=a(d.events),w=S.next();!w.done;w=S.next()){if((N=Tv({event:w.value})).error)return N;try{for(var T=(u=void 0,a(v)),P=T.next();!P.done;P=T.next()){var D=P.value;if(!Pi(D))return{error:xr};var b=N.publishState.publishedDrawIds.includes(D);b&&(h[D]={published:b})}}catch(e){u={error:e}}finally{try{P&&!P.done&&(s=T.return)&&s.call(T)}finally{if(u)throw u.error}}}}catch(e){i={error:e}}finally{try{w&&!w.done&&(o=S.return)&&o.call(S)}finally{if(i)throw i.error}}return t(t({},L),{publishState:h})}if(m){var N;if((N=Tv({event:m})).error)return N;if(f)return{publishState:t({published:N.publishState.publishedDrawIds.includes(f)},L)};if(!Array.isArray(v)||!(null==v?void 0:v.length))return N;h={};try{for(var M=a(v),R=M.next();!R.done;R=M.next()){var A=R.value;return Pi(A)?(h[A]={published:N.publishState.publishedDrawIds.includes(A)},t(t({},L),{publishState:h})):{error:xr}}}catch(e){l={error:e}}finally{try{R&&!R.done&&(c=M.return)&&c.call(M)}finally{if(l)throw l.error}}}return{error:xr}}function Tv(e){var r=Uv({event:e.event});if(!r)return{error:Ee};var n={published:void 0,seedingScaleNames:[],drawIds:[]};r.seeding&&Object.assign(n,r.seeding);var i=r.drawDetails,a=i&&Object.keys(i).filter((function(e){return Sv({drawDetails:i,drawId:e})}))||r.drawIds||[];return t({publishState:{published:a.length>0,publishedDrawIds:a,publishedSeeding:n,drawDetails:i}},L)}function Pv(e,t){return(e||"").localeCompare(t||"")}function Dv(e){var r,n,i,s,l,c,d,p,v,f,m,h,g=e.withScheduleItems,I=e.scheduleAnalysis,y=e.withTeamMatchUps,U=e.participantMap,S=e.withOpponents,w=e.withMatchUps,T=e.withEvents,P=e.withDraws,D=e.finishingPositionRange,b=e.finishingRound,N=e.matchUpStatus,M=e.stageSequence,R=e.roundNumber,A=e.structureId,E=e.score,C=e.stage,x=e.withRankingProfile,O=e.tieWinningSide,F=e.roundPosition,k=e.matchUpTieId,_=e.matchUpSides,L=e.collectionId,j=e.matchUpType,B=e.winningSide,V=e.matchUpId,G=e.schedule,q=e.eventId,W=e.drawId,H=e.sides,z=S&&2===(null==H?void 0:H.length)&&Object.assign.apply(Object,u([{}],o(H.map((function(e,t){var r,n=e.sideNumber,i=H[1-t].participantId;return n&&((r={})[n]=i,r)})).filter(Boolean)),!1)),Y=function(e){var r=e.participantId,n=e.sideNumber;if(e.bye)return"continue";var o=B===n,u=function(e,t){if(w){if(U[e].matchUps[V]={participantWon:o,matchUpType:j,structureId:A,sideNumber:n,matchUpId:V,eventId:q,drawId:W,stage:C},S){var r=function(e){var t,r,n,i,o=null===(n=U[e])||void 0===n?void 0:n.participant,u=null==o?void 0:o.participantType,s=[{participantId:e,participantType:u}];if(u!==vs)try{for(var l=(t=void 0,a((null==o?void 0:o.individualParticipantIds)||[])),c=l.next();!c.done;c=l.next()){var d=c.value,p=null===(i=U[d])||void 0===i?void 0:i.participant;s.push({participantType:null==p?void 0:p.participantType,participantId:d})}}catch(e){t={error:e}}finally{try{c&&!c.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return s}(t);U[e].matchUps[V].opponentParticipantInfo=r}L&&(U[e].matchUps[V].collectionId=L)}S&&t&&(U[e].opponents[t]={participantId:t,matchUpId:V,eventId:q,drawId:W}),x&&function(e){var t=e.finishingPositionRange,r=void 0===t?{}:t,n=e.participantMap,i=e.finishingRound,a=e.participantWon,o=e.matchUpStatus,u=e.participantId,s=e.stageSequence,l=e.roundNumber,c=e.structureId,d=e.matchUpId,p=e.drawId,v=e.stage,f=n[u],m=function(e){return Math.abs(e[0]-e[1])};f.structureParticipation[c]||(f.structureParticipation[c]={rankingStage:v,walkoverWinCount:0,defaultWinCount:0,stageSequence:s,winCount:0,structureId:c,drawId:p});var h=f.structureParticipation[c],g=r,I=g.winner,y=g.loser,U=a?I:y;a&&(h.winCount+=1,o===Ko&&(h.walkoverWinCount+=1),o===jo&&(h.defaultWinCount+=1)),U&&(!h.finishingPositionRange||m(U)<m(h.finishingPositionRange))&&(h.finishingPositionRange=U),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=d,h.finishingRound=i,h.roundNumber=l),1===i&&(h.participantWon=a))}({finishingPositionRange:D,participantMap:U,participantWon:o,finishingRound:b,matchUpStatus:N,participantId:e,stageSequence:M,roundNumber:R,structureId:A,matchUpId:V,drawId:W,stage:C}),(I||g)&&Iv({participantMap:U,participantId:e,matchUpStatus:N,roundPosition:F,matchUpType:j,roundNumber:R,structureId:A,matchUpId:V,schedule:G,drawId:W,score:E})};if(r&&U[r]){var H=null==z?void 0:z[n];u(r,H);var Y=(null===(i=U[r])||void 0===i?void 0:i.participant.participantType)===hs,K=(null===(s=U[r])||void 0===s?void 0:s.participant.individualParticipantIds)||[];if(k){if(y){var J=function(e){return U[e].matchUps[k]={participantWon:O===n,matchUpId:k,matchUpType:Fs,sideNumber:n}};J(r),K.forEach(J)}if(P&&!U[r].draws[W]){var Z=null===(c=null===(l=_.find((function(e){return e.sideNumber===n})))||void 0===l?void 0:l.participant)||void 0===c?void 0:c.participantId,X=null===(v=null===(p=null===(d=U[Z])||void 0===d?void 0:d.draws)||void 0===p?void 0:p[W])||void 0===v?void 0:v.entryStatus,Q=function(e){return U[e].draws[W]={entryStatus:X,eventId:q,drawId:W}};Q(r),K.forEach(Q)}}if(Y)if(K.forEach((function(e){return U[e]&&u(e,H)})),K.forEach((function(e,t){var r=K[1-t],n=U[e];n&&function(e){var t,r,n,i=e.participant,a=e.partnerParticipantId,o=function(e,t){e&&(e.partnerParticipantIds||(e.partnerParticipantIds=[]),e.partnerParticipantIds.includes(t)||e.partnerParticipantIds.push(t))};P&&o(null===(t=null==i?void 0:i.draws)||void 0===t?void 0:t[W],a),T&&o(null===(r=null==i?void 0:i.events)||void 0===r?void 0:r[q],a),w&&o(null===(n=null==i?void 0:i.matchUps)||void 0===n?void 0:n[V],a)}({participant:n,partnerParticipantId:r})})),T&&_)if(Z=null===(m=null===(f=_.find((function(e){return e.sideNumber===n})))||void 0===f?void 0:f.participant)||void 0===m?void 0:m.participantId){var $=null===(h=U[Z])||void 0===h?void 0:h.events[q];$?(U[r].events[q]=t({},$),K.forEach((function(e){return U[e].events[q]=t({},$)}))):console.log("Missing teamEntry",{eventId:q,teamParticipantId:Z})}if(B){var ee=function(e){o?(U[e].counters[j].wins+=1,U[e].counters.wins+=1,N===Ko&&(U[e].counters[j].walkoverWins+=1,U[e].counters.walkoverWins+=1),N===jo&&(U[e].counters[j].defaultWins+=1,U[e].counters.defaultWins+=1)):(U[e].counters[j].losses+=1,U[e].counters.losses+=1,N===Ko&&(U[e].counters[j].walkovers+=1,U[e].counters.walkovers+=1),N===jo&&(U[e].counters[j].defaults+=1,U[e].counters.defaults+=1))};ee(r),K.forEach(ee)}}};try{for(var K=a(H),J=K.next();!J.done;J=K.next()){Y(J.value)}}catch(e){r={error:e}}finally{try{J&&!J.done&&(n=K.return)&&n.call(K)}finally{if(r)throw r.error}}}function bv(e){var r,n,i,s,l,c,d,p,v,f,m,h,g=e.participantFilters,I=e.convertExtensions,y=e.policyDefinitions,S=e.tournamentRecord,w=e.usePublishState,T=e.contextProfile,P=e.participantMap,D=e.withPotentialMatchUps,b=e.withRankingProfile,N=e.withScheduleItems,M=e.scheduleAnalysis,R=e.withTeamMatchUps,A=e.withStatistics,C=e.withOpponents,x=e.withMatchUps,O=e.withSeeding,F=e.withEvents,k=e.withDraws,_=null==g?void 0:g.participantIds,L={withMatchUps:x||b,withEvents:F||b,withDraws:k||b,withPotentialMatchUps:D,withRankingProfile:b,withScheduleItems:N,scheduleAnalysis:M,withTeamMatchUps:R,withStatistics:A,participantMap:P,withOpponents:C,withSeeding:O},j=[],B={},V=[],G={},q={},W={},H=function(e){var t,r,n,i,a=e.eventType,o=e.scaleNames,u=e.participantId;return null===(i=null===(n=null===(r=null===(t=P[u].participant)||void 0===t?void 0:t.rankings)||void 0===r?void 0:r[a])||void 0===n?void 0:n.find((function(e){return o.includes(e.scaleName)})))||void 0===i?void 0:i.scaleValue},z=function(e){var r,n,i,s,j,z;if((null==g?void 0:g.eventIds)&&!g.eventIds.includes(e.eventId))return"continue";var Y=e.drawDefinitions,K=void 0===Y?[]:Y,J=e.extensions,Z=void 0===J?[]:J,X=e.eventType,Q=e.eventName,$=e.category,ee=e.entries,te=e.eventId,re=e.gender,ne=_d({event:e}).flightProfile,ie=null!==(l=null==ne?void 0:ne.flights)&&void 0!==l?l:[],ae=wv({event:e}).publishState;ae&&(G[te]=ae);var oe=null==ae?void 0:ae.publishedSeeding;if(F||O||b){var ue=I?Object.assign.apply(Object,u([{}],o(Si(Z)),!1)):{};q[te]=t(t({},ue),{eventName:Q,eventType:X,category:$,eventId:te,gender:re});var se=[null==$?void 0:$.categoryName,null==$?void 0:$.ageCategoryCode].filter(Boolean),le=function(t){var r,n=t.participantId;if(!n||!P[n])return"continue";var i,s,l=H({eventType:X,scaleNames:se,participantId:n});if(O){var c=P[n].participant;r=function(e){var t,r,n,i,s,l=e.publishedSeeding,c=e.usePublishState,d=e.withSeeding,p=e.participant,v=e.event,f={},m=function(e){return[Ta,Pa,v.eventType,e].join(".")},h=Object.assign.apply(Object,u([{}],o((p.timeItems||[]).filter((function(e){return e.itemType.split(".")[1]===Pa})).map((function(e){var t,r=e.itemType,n=e.itemValue;return(t={})[r]=n,t}))),!1)),g=((null==l?void 0:l.stageSeedingScaleNames)&&Object.values(null==l?void 0:l.stageSeedingScaleNames)||Array.isArray(null==l?void 0:l.seedingScaleNames)&&l.seedingScaleNames||[]).map(m),I=E(Object.keys(h),g);if(c&&(Object.keys(h).length||(null===(n=null==l?void 0:l.drawIds)||void 0===n?void 0:n.length))&&!I.length||!I.length)if(c||"object"!=typeof d){var y=v.category||{},U=y.categoryName,S=[y.ageCategoryCode,v.eventId,U].filter(Boolean),w=void 0;try{for(var T=a(S),P=T.next();!P.done;P=T.next()){var D=P.value,b=yv({scaleAttributes:{eventType:v.eventType,scaleType:Pa,scaleName:D},participant:p});if(b.scaleItem){w=b.scaleItem;break}}}catch(e){t={error:e}}finally{try{P&&!P.done&&(r=T.return)&&r.call(T)}finally{if(t)throw t.error}}if(w&&(!c||(null==l?void 0:l.published)&&!(null===(s=null===(i=null==l?void 0:l.published)||void 0===i?void 0:i.drawIds)||void 0===s?void 0:s.length))){var N=w.scaleValue;f.seedValue=N}}else M=Object.keys(d).map((function(e){var t=m(d[e]);return[e,h[t]]})).filter((function(e){return e[1]})).map((function(e){var t;return(t={})[e[0]]={seedValue:e[1]},t})),R=Object.assign.apply(Object,u([{}],o(M),!1)),f.seedAssignments=R;else if(null==l?void 0:l.stageSeedingScaleNames){var M=Object.keys(l.stageSeedingScaleNames).map((function(e){var t=m(l.stageSeedingScaleNames[e]);return[e,h[t]]})).filter((function(e){return e[1]})).map((function(e){var t;return(t={})[e[0]]={seedValue:e[1]},t})),R=Object.assign.apply(Object,u([{}],o(M),!1));f.seedAssignments=R}else if(I){var A=I.map((function(e){return h[e]}));f.seedValue=A.pop()}return f}({publishedSeeding:oe,usePublishState:w,withSeeding:O,participant:c,event:e}),i=r.seedAssignments,s=r.seedValue}var d=function(e){var r,n;if(!(null===(n=null===(r=P[e])||void 0===r?void 0:r.events)||void 0===n?void 0:n[te])){var a=P[e];!function(e){var t=e.convertExtensions,r=e.seedAssignments,n=e.participant,i=e.withSeeding,a=e.seedValue,s=e.eventId,l=e.ranking,c=e.entry,d=c.entryStatus,p=c.entryStage,v=c.entryPosition,f=c.extensions,m=(null==f?void 0:f.length)&&t?Object.assign.apply(Object,u([{}],o(Si(f)),!1)):{},h=Object.assign(m,{entryPosition:v,entryStatus:d,entryStage:p,ranking:l,eventId:s});n.events[s]=xn(h,!1,!1,!0),i&&(r&&(n.events[s].seedAssignments=r),a&&(n.events[s].seedValue=a))}({convertExtensions:I,seedAssignments:i,participant:a,withSeeding:O,seedValue:s,eventId:te,ranking:l,entry:t})}};d(n),(P[n].participant.individualParticipantIds||[]).forEach(d)};try{for(var ce=(r=void 0,a(ee)),de=ce.next();!de.done;de=ce.next()){le(de.value)}}catch(e){r={error:e}}finally{try{de&&!de.done&&(n=ce.return)&&n.call(ce)}finally{if(r)throw r.error}}}var pe=null===(c=null==G?void 0:G[te])||void 0===c?void 0:c.publishedSeeding;if(k||b||O){var ve=function(e){return e?Object.assign.apply(Object,u([{}],o(e.map((function(e){var t,r=e.participantId,n=e.seedValue,i=e.seedNumber;return(t={})[r]={seedValue:n,seedNumber:i},t}))),!1)):void 0},fe=U(u(u([],o(K.map(Ri("drawId"))),!1),o(ie.map(Ri("drawId"))),!1)),me=function(e){var r,n,i,s,l,c,m=K.find((function(t){return t.drawId===e})),h=null==ie?void 0:ie.find((function(t){return t.drawId===e})),g=(null==m?void 0:m.entries)||(null==h?void 0:h.drawEntries),I=null!=m?m:{},y=I.structures,U=void 0===y?[]:y,S=I.drawOrder,T=I.drawName,D=I.drawType,N=null==h?void 0:h.flightNumber,M=[null==$?void 0:$.categoryName,null==$?void 0:$.ageCategoryCode].filter(Boolean),R=((null==m?void 0:m.structures)||[]).sort((function(e,t){return ns(e,t)})).map((function(e){return u([e.structureId],o((e.structures||[]).map((function(e){return e.structureId}))),!1)})).flat(1/0),A=0,E=U.filter((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r||t===au})).flatMap((function(e){var t,r=e.seedAssignments,n=e.stageSequence,a=e.stage,o=ss({structure:e}).positionAssignments;return a===iu?(A=null!==(t=null==o?void 0:o.length)&&void 0!==t?t:0,l=o,c=r):1===n&&(i=o,s=r),o})).map((function(e){return e.participantId})).filter(Boolean),C=ve(c),x=ve(s),F=m?g.filter((function(e){var t=e.participantId;return E.includes(t)})):g,_=!w||(null==pe?void 0:pe.published)&&(0===(null===(d=null==pe?void 0:pe.drawIds)||void 0===d?void 0:d.length)||(null===(p=null==pe?void 0:pe.drawIds)||void 0===p?void 0:p.includes(e))),L=function(r){var n=r.entryStatus,i=r.entryStage,a=r.entryPosition,o=r.participantId,u=H({participantId:o,scaleNames:M,eventType:X}),s=function(r){var s,l,c,d,p;if(!(null===(s=P[r].draws)||void 0===s?void 0:s[e])){var v=O&&_,f=v?{}:void 0,m=v?(null===(l=null==C?void 0:C[o])||void 0===l?void 0:l.seedValue)||(null===(c=null==C?void 0:C[o])||void 0===c?void 0:c.seedNumber):void 0,h=m?null==C?void 0:C[o]:void 0,g=v?(null===(d=null==x?void 0:x[o])||void 0===d?void 0:d.seedValue)||(null===(p=null==x?void 0:x[o])||void 0===p?void 0:p.seedNumber):void 0,I=g?null==x?void 0:x[o]:void 0;f&&m&&(f[iu]=h),f&&g&&(f[au]=I);var y=m||g;y&&(P[r].participant.seedings[X]||(P[r].participant.seedings[X]=[]),h&&P[r].participant.seedings[X].push(t(t({},h),{scaleName:e})),I&&P[r].participant.seedings[X].push(t(t({},I),{scaleName:e})),f&&(P[r].events[te].seedAssignments||(P[r].events[te].seedAssignments={}),Object.keys(f).forEach((function(e){return P[r].events[te].seedAssignments[e]=f[e]})))),(k||b)&&(P[r].draws[e]=xn({seedAssignments:f,entryPosition:a,entryStatus:n,entryStage:i,seedValue:y,eventId:te,ranking:u,drawId:e},!1,!1,!0))}};if(![Al,El].includes(n)){s(o);var l=P[o].participant.individualParticipantIds||[];null==l||l.forEach(s)}};try{for(var j=(r=void 0,a(F)),B=j.next();!B.done;B=j.next()){L(B.value)}}catch(e){r={error:e}}finally{try{B&&!B.done&&(n=j.return)&&n.call(j)}finally{if(r)throw r.error}}var V=(null!==(v=null==m?void 0:m.structures)&&void 0!==v?v:[]).reduce((function(e,t){return e.includes(t.stage)||e.push(t.stage),e}),[]),G=(null!==(f=null==m?void 0:m.links)&&void 0!==f?f:[]).length;W[e]={qualifyingPositionAssignments:i,qualifyingSeedAssignments:s,mainPositionAssignments:l,qualifyingSeedingMap:x,mainSeedAssignments:c,orderedStructureIds:R,mainSeedingMap:C,flightNumber:N,linksCount:G,drawOrder:S,drawName:T,drawType:D,drawSize:A,drawId:e,stages:V}};try{for(var he=(i=void 0,a(fe)),ge=he.next();!ge.done;ge=he.next()){me(ge.value)}}catch(e){i={error:e}}finally{try{ge&&!ge.done&&(s=he.return)&&s.call(he)}finally{if(i)throw i.error}}}if(b||M||R||A||C||x||k){var Ie=!!M||D,ye=null!==(h=null===(m=Yp({afterRecoveryTimes:!!M,policyDefinitions:y,tournamentRecord:S,inContext:!0,contextProfile:T,participantMap:P,nextMatchUps:Ie,event:e}))||void 0===m?void 0:m.matchUps)&&void 0!==h?h:[],Ue=function(e){var r,n,i=e.finishingPositionRange,o=e.potentialParticipants,u=e.tieMatchUps,s=void 0===u?[]:u,l=e.sides,c=void 0===l?[]:l,d=e.winningSide,p=e.matchUpType,v=e.matchUpId,f=e.eventId,m=e.drawId,h=e.collectionId,g=e.stageSequence,I=e.finishingRound,y=e.matchUpStatus,U=e.roundPosition,w=e.roundNumber,T=e.structureId,D=e.schedule,b=e.score,R=e.stage;B[v]=e;var A={finishingPositionRange:i,finishingRound:I,stageSequence:g,roundPosition:U,collectionId:h,roundNumber:w,structureId:T,schedule:D,eventId:f,drawId:m,score:b,stage:R};Dv(t(t(t({},A),L),{matchUpStatus:y,winningSide:d,matchUpType:p,matchUpId:v,sides:c}));try{for(var E=(r=void 0,a(s)),C=E.next();!C.done;C=E.next()){var x=C.value,O=x.winningSide,F=x.sides,k=void 0===F?[]:F,j=x.matchUpId,V=x.matchUpStatus,G=x.matchUpType;Dv(t(t(t({},A),L),{winningSide:O,tieWinningSide:d,matchUpTieId:v,matchUpId:j,sides:k,matchUpSides:c,matchUpStatus:V,matchUpType:G}))}}catch(e){r={error:e}}finally{try{C&&!C.done&&(n=E.return)&&n.call(E)}finally{if(r)throw r.error}}if(Array.isArray(o)&&(Ie||M||N)){var q=o.flat().map(Ri("participantId")).filter(Boolean);null==q||q.forEach((function(e){var t=function(e){var t,r,n=[e];return null===(r=null===(t=P[e])||void 0===t?void 0:t.participant.individualParticipantIds)||void 0===r||r.forEach((function(e){return n.push(e)})),n.some((function(e){return!(null==_?void 0:_.length)||_.includes(e)}))?n:[]}(e);null==t||t.forEach((function(e){P[e]&&(P[e].potentialMatchUps[v]=xn({tournamentId:null==S?void 0:S.tournamentId,matchUpId:v,eventId:f,drawId:m}))})),(M||N)&&Iv({potential:!0,participantMap:P,participantId:e,matchUpStatus:y,roundPosition:U,structureId:T,matchUpType:p,roundNumber:w,matchUpId:v,schedule:D,drawId:m,score:b})}))}};try{for(var Se=(j=void 0,a(ye)),we=Se.next();!we.done;we=Se.next()){Ue(we.value)}}catch(e){j={error:e}}finally{try{we&&!we.done&&(z=Se.return)&&z.call(Se)}finally{if(j)throw j.error}}V.push.apply(V,u([],o(ye),!1))}};try{for(var Y=a((null==S?void 0:S.events)||[]),K=Y.next();!K.done;K=Y.next()){z(K.value)}}catch(e){r={error:e}}finally{try{K&&!K.done&&(n=Y.return)&&n.call(Y)}finally{if(r)throw r.error}}if(A||b||M){var J=Object.values(P),Z=function(e){var r,n,i,o,u,s,l=e.counters,c=l.wins,d=l.losses,p=l[Es],v=p.wins,f=p.losses,m=l[xs],h=m.wins,g=m.losses,I=function(t,r,n){var i=r+n,a=r,o=i&&a/i;e.statistics[t]={denominator:i,numerator:a,statValue:o,statCode:t}};if(A&&(I(cl,c,d),I("".concat(cl,".").concat(Es),v,f),I("".concat(cl,".").concat(xs),h,g)),b){var y=function(e){return void 0===e&&(e=[]),Math.abs(e[0]-e[1])},U=function(r){var n=W[r]||{},i=n.orderedStructureIds,a=void 0===i?[]:i,o=n.flightNumber;if(e.structureParticipation&&a.length){var u,s=0,l=a.map((function(r){var n=e.structureParticipation[r];if(n){u||(u=null==n?void 0:n.finishingPositionRange),y(u)>y(null==n?void 0:n.finishingPositionRange)&&(u=null==n?void 0:n.finishingPositionRange);var i=n.stage!==au;i&&(s+=1);var a=i?s:void 0;return xn(t(t({},n),{participationOrder:a,flightNumber:o}))}})).filter(Boolean);e.draws[r]&&(e.draws[r].finishingPositionRange=u,e.draws[r].structureParticipation=l)}};try{for(var S=(r=void 0,a(Object.keys(e.draws))),w=S.next();!w.done;w=S.next()){U(w.value)}}catch(e){r={error:e}}finally{try{w&&!w.done&&(n=S.return)&&n.call(S)}finally{if(r)throw r.error}}}if(M){var T=Di(M)?M.scheduledMinutesDifference:0,D=e.scheduleItems||[],N=e.potentialMatchUps||{},R=D.reduce((function(e,t){var r=t.scheduledDate,n=t.scheduledTime;return e[r]||(e[r]=[]),n&&e[r].push(t),e}),{});Object.values(R).forEach((function(e){return e.sort(di)}));try{for(var E=(i=void 0,a(D)),C=E.next();!C.done;C=E.next()){var x=C.value,O=x.typeChangeTimeAfterRecovery,F=x.timeAfterRecovery,k=x.scheduledDate,_=x.scheduledTime,L=R[k],B=ii(_);try{for(var V=(u=void 0,a(L)),G=V.next();!G.done;G=V.next()){var q=G.value;if(!(q.matchUpId===x.matchUpId||[Ko,jo].includes(q.matchUpStatus)&&!q.checkScoreHasValue)){var H=x.matchUpType!==q.matchUpType&&O||F,z=x.drawId===q.drawId,Y=N[x.matchUpId]&&N[q.matchUpId],K=ii(q.scheduledTime),J=Math.abs(K-B),Z=K>=B;if((T&&!isNaN(T)?J<=T:Z&&ii(q.scheduledTime)<ii(H))&&(!Y||!z)&&Z){var X=[x.matchUpId,q.matchUpId].sort(Pv).join("|");e.scheduleConflicts[X]={priorScheduledMatchUpId:x.matchUpId,matchUpIdWithConflict:q.matchUpId}}}}}catch(e){u={error:e}}finally{try{G&&!G.done&&(s=V.return)&&s.call(V)}finally{if(u)throw u.error}}}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=E.return)&&o.call(E)}finally{if(i)throw i.error}}var Q=e.participant.participantId;Object.keys(e.scheduleConflicts).length&&j.push(Q),P[Q].scheduleConflicts=e.scheduleConflicts}};try{for(var X=a(J),Q=X.next();!Q.done;Q=X.next()){Z(Q.value)}}catch(e){i={error:e}}finally{try{Q&&!Q.done&&(s=X.return)&&s.call(X)}finally{if(i)throw i.error}}}return{participantIdsWithConflicts:j,eventsPublishStatuses:G,derivedEventInfo:q,derivedDrawInfo:W,mappedMatchUps:B,participantMap:P,matchUps:V}}function Nv(e){var t,r=e.participantFilters,n=void 0===r?{}:r,i=e.tournamentRecord,a=e.participants,s=void 0===a?[]:a;if(!Object.keys(n).length)return s;var l=n.accessorValues,c=n.drawEntryStatuses,d=n.positionedParticipants,p=n.eventEntryStatuses,v=n.participantRoles,f=n.participantRoleResponsibilities,m=n.participantTypes,h=n.participantIds,g=n.signInStatus,I=n.enableOrFiltering,y=n.eventIds,S=n.genders,w=Mv(y)&&(null===(t=null==i?void 0:i.events)||void 0===t?void 0:t.filter((function(e){return null==y?void 0:y.includes(e.eventId)})))||(null==i?void 0:i.events)||[],T=c&&function(e){var t=e.drawEntryStatuses,r=e.tournamentEvents,n=function(e){var r=e.entryStatus;return!Array.isArray(t)||t.includes(r)};return U(r.reduce((function(e,t){var r,i,a=_d({event:t}).flightProfile,s=(null===(r=null==a?void 0:a.flights)||void 0===r?void 0:r.map((function(e){var t=e.drawEntries;return Array.isArray(t)?t.filter(n).map(Mo):[]})).flat())||[],l=(null===(i=t.drawDefinitions)||void 0===i?void 0:i.map((function(e){var t=e.entries;return t?t.filter(n).map(Mo):[]})))||[];return e.concat.apply(e,u(u([],o(s),!1),o(l),!1))}),[]))}({drawEntryStatuses:c,tournamentEvents:w}),P=p&&function(e){var t=e.eventEntryStatuses,r=e.tournamentEvents;return U(r.reduce((function(e,r){var n=(r.entries||[]).filter((function(e){var r=e.entryStatus;return!Array.isArray(t)||t.includes(r)})).map(Mo);return e.concat.apply(e,u([],o(n),!1))}),[]))}({eventEntryStatuses:p,tournamentEvents:w}),D=void 0!==d&&[!0,!1].includes(d)&&w.reduce((function(e,t){return e.concat.apply(e,u([],o((t.drawDefinitions||[]).map((function(e){return us({drawDefinition:e}).allPositionedParticipantIds})).filter(Boolean)),!1))}),[]),b=function(e){return null==l?void 0:l.reduce((function(t,r){var n=r.accessor,i=r.value,a=wi({element:e,accessor:n}).values;return t&&(null==a?void 0:a.includes(i))}),!0)};if(s=null==s?void 0:s.filter((function(e){var t,r,n=null===(r=null===(t=Ds({element:e,itemType:cs}))||void 0===t?void 0:t.timeItem)||void 0===r?void 0:r.itemValue,i=e.participantRoleResponsibilities,a=e.participantType,o=e.participantRole,u=e.participantId,s=e.person,c=Array.isArray(S)&&(null==S?void 0:S.length)&&(null==s?void 0:s.sex)&&S.includes(s.sex);return I?S&&c||d&&D.includes(u)||!1===d&&!D.includes(u)||(null==T?void 0:T.includes(u))||(null==P?void 0:P.includes(u))||(null==h?void 0:h.includes(u))||g&&n===g||m&&a&&Mv(m)&&m.includes(a)||v&&o&&Mv(v)&&v.includes(o)||f&&Mv(i)&&Mv(f)&&f.find((function(e){return null==i?void 0:i.includes(e)}))||(null==l?void 0:l.length)&&Mv(l)&&b(e):(!S||c)&&(void 0===d||d&&D.includes(u)||!1===d&&!D.includes(u))&&(!T||T.includes(u))&&(!P||P.includes(u))&&(!h||h.includes(u))&&(!g||n===g)&&(!m||a&&Mv(m)&&m.includes(a))&&(!v||o&&Mv(v)&&v.includes(o))&&(!f||Mv(i)&&Mv(f)&&f.find((function(e){return null==i?void 0:i.includes(e)})))&&(!(null==l?void 0:l.length)||Mv(l)&&b(e))})),w.length&&y){var N=w.filter((function(e){return y.includes(e.eventId)})).map((function(e){var t,r=(e.entries||[]).map((function(e){return e.participantId}));if(e.eventType===va)return r;var n=(null!==(t=null==i?void 0:i.participants)&&void 0!==t?t:[]).filter((function(e){return r.includes(e.participantId)})).map((function(e){return e.individualParticipantIds})).flat(1);return r.concat.apply(r,u([],o(n),!1))})).flat(1);s=null==s?void 0:s.filter((function(e){return N.includes(e.participantId)}))}return s}function Mv(e){return e&&Array.isArray(e)&&e.length}function Rv(e){var r,n,i,s,l,c,d,p=e.withIndividualParticipants,v=e.participantFilters,f=void 0===v?{}:v,m=e.withPotentialMatchUps,h=e.withRankingProfile,g=e.convertExtensions,I=e.policyDefinitions,y=e.withScheduleItems,U=e.tournamentRecord,S=e.scheduleAnalysis,w=e.withSignInStatus,T=e.withTeamMatchUps,P=e.withScaleValues,D=e.usePublishState,b=e.contextProfile,N=e.withStatistics,M=e.withOpponents,R=e.withMatchUps,A=e.internalUse,E=e.withSeeding,C=e.withEvents,x=e.withDraws,O=e.withISO2,F=e.withIOC;if(!U)return{error:W};(R||h)&&Xp({tournamentRecord:U});var k=js({convertExtensions:g,tournamentRecord:U,withSignInStatus:w,withScaleValues:P,internalUse:A,withISO2:O,withIOC:F}).participantMap,_=bv({withMatchUps:null!=R?R:h,withEvents:null!=C?C:h,withDraws:null!=x?x:h,withPotentialMatchUps:m,participantFilters:f,withRankingProfile:h,convertExtensions:g,withScheduleItems:y,policyDefinitions:I,tournamentRecord:U,scheduleAnalysis:S,withTeamMatchUps:T,usePublishState:D,withStatistics:N,participantMap:k,withOpponents:M,contextProfile:b,withSeeding:E}),j=_.participantIdsWithConflicts,B=_.eventsPublishStatuses,V=_.derivedEventInfo,G=_.derivedDrawInfo,q=_.mappedMatchUps,H=_.matchUps;k=_.participantMap;var z=null!=S?S:m,Y=function(e){var r=e.potentialMatchUps,n=e.scheduleConflicts,i=e.scheduleItems,a=e.participant,o=e.statistics,u=e.opponents,s=e.matchUps,l=e.events,c=e.draws,d=Object.values(c),p=Object.values(u);return M&&(null==d||d.forEach((function(e){e.opponents=p.filter((function(t){return t.drawId===e.drawId}))}))),xn(t(t({},a),{scheduleConflicts:S?Object.values(n):void 0,draws:x||h?d:void 0,events:C||h?Object.values(l):void 0,matchUps:R||h?Object.values(s):void 0,opponents:M?p:void 0,potentialMatchUps:z?Object.values(r):void 0,statistics:N?Object.values(o):void 0,scheduleItems:y?i:void 0}),!1,!1,!0)},K=new Map;try{for(var J=a(Object.keys(k)),Z=J.next();!Z.done;Z=J.next()){var X=Z.value;K.set(X,Y(k[X]))}}catch(e){r={error:e}}finally{try{Z&&!Z.done&&(n=J.return)&&n.call(J)}finally{if(r)throw r.error}}var Q=u([],o(K.values()),!1),$=null==I?void 0:I[Fa],ee=null==$?void 0:$.participant,te=Nv({participants:Q,participantFilters:f,tournamentRecord:U});if(p){var re=Di(p)?p:void 0;try{for(var ne=a(te),ie=ne.next();!ie.done;ie=ne.next()){var ae=ie.value;try{for(var oe=(l=void 0,a(null!==(d=ae.individualParticipantIds)&&void 0!==d?d:[])),ue=oe.next();!ue.done;ue=oe.next()){var se=ue.value;ae.individualParticipants||(ae.individualParticipants=[]);var le=K.get(se);ae.individualParticipants.push(re?Na({template:re,source:le}):le)}}catch(e){l={error:e}}finally{try{ue&&!ue.done&&(c=oe.return)&&c.call(oe)}finally{if(l)throw l.error}}}}catch(e){i={error:e}}finally{try{ie&&!ie.done&&(s=ne.return)&&s.call(ne)}finally{if(i)throw i.error}}}var ce=ee?te.map((function(e){return Na({source:e,template:ee})})):te;return t(t({participantIdsWithConflicts:j,eventsPublishStatuses:B,derivedEventInfo:V,derivedDrawInfo:G,mappedMatchUps:q,participantMap:k,participants:ce},L),{matchUps:H})}function Av(e){var t,r=e.participantId,n=e.drawDefinition,i=e.entryStatus,a=e.entryStage;if(!n)return{error:K};var o=null===(t=n.entries)||void 0===t?void 0:t.find((function(e){return!(e.participantId!==r||i&&i!==e.entryStatus||a&&a!==e.entryStage)}));return r&&o}function Ev(e){var t,r,n,i,o,u,s,l,c,d,p,v,f=e.provisionalPositioning,m=e.drawDefinition,h=e.stageSequence,g=e.structureId,I=e.stage;if(!m)return{error:K};var y=Ul({drawDefinition:m}).entryProfile,U=I&&h&&(null===(o=null===(i=null===(n=null==y?void 0:y[I])||void 0===n?void 0:n.stageSequence)||void 0===i?void 0:i[h])||void 0===o?void 0:o.qualifiersCount)||I&&(null===(u=null==y?void 0:y[I])||void 0===u?void 0:u.qualifiersCount)||0,S={};if(!g)return{qualifiersCount:U,roundQualifiersCounts:S};var w=as({drawDefinition:m,structureId:g}).structure,T=null===(s=m.links)||void 0===s?void 0:s.filter((function(e){var t;return(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.structureId)===(null==w?void 0:w.structureId)})),P=0;if(null==T?void 0:T.length)try{for(var D=a(T),b=D.next();!b.done;b=D.next()){var N=b.value,M=null===(l=as({structureId:N.source.structureId,drawDefinition:m}))||void 0===l?void 0:l.structure;if((null==M?void 0:M.stage)===au){var R=N.source.roundNumber,A=N.target.roundNumber,E=0;if(M.structureType===Iu){E=(null!==(d=null===(c=M.structures)||void 0===c?void 0:c.length)&&void 0!==d?d:0)*(null!==(v=null===(p=N.source.finishingPositions)||void 0===p?void 0:p.length)&&void 0!==v?v:0)}else{var C=mp({matchUpFilters:{roundNumbers:[R]},structure:M,afterRecoveryTimes:!1,provisionalPositioning:f,inContext:!1}).matchUps;E=(null==C?void 0:C.length)||0}S[A]||(S[A]=0),S[A]+=E,P+=E}}}catch(e){t={error:e}}finally{try{b&&!b.done&&(r=D.return)&&r.call(D)}finally{if(t)throw t.error}}var x=Object.keys(S);if(x.length<=1){var O=x[0]||1;S[O]=Math.max(S[O]||0,U)}return{qualifiersCount:P=Math.max(P,U),roundQualifiersCounts:S}}function Cv(e){var t,r=e.stage,n=Ul({drawDefinition:e.drawDefinition}).entryProfile;return(null===(t=null==n?void 0:n[r])||void 0===t?void 0:t.drawSize)||0}function xv(e){var t=e.stage,r=e.drawDefinition;return Boolean(t===uu||Bl({stage:t,drawDefinition:r})&&Cv({stage:t,drawDefinition:r}))}function Ov(e){var r=e.entryStatus,n=void 0===r?Tl:r,i=e.drawDefinition,a=e.stageSequence,o=e.stage;if(n===Sl)return function(e){var t,r=e.stage;return(null===(t=Ul({drawDefinition:e.drawDefinition}).entryProfile[r])||void 0===t?void 0:t.alternates)||0}({stage:o,drawDefinition:i})?t({positionsAvailable:1/0},L):{error:Qt};var u=function(e){var t=e.provisionalPositioning,r=e.drawDefinition,n=e.stageSequence,i=e.stage,a=Cv({stage:i,drawDefinition:r}),o=Ev({provisionalPositioning:t,drawDefinition:r,stageSequence:n,stage:i}).qualifiersCount;return a&&a-o}({drawDefinition:i,stageSequence:a,stage:o}),s=function(e){var t,r=e.stage;return(null===(t=Ul({drawDefinition:e.drawDefinition}).entryProfile[r])||void 0===t?void 0:t.wildcardsCount)||0}({drawDefinition:i,stage:o}),l=Vl({entryStatus:Cl,drawDefinition:i,stage:o}),c=l+Vl({entryStatus:Tl,drawDefinition:i,stage:o}),d=u-c;return o!==uu&&c>=u?{error:er}:n===Cl?l<s?t({},L):{error:er}:t({positionsAvailable:d},L)}function Fv(e){var r=e.entryStatus,n=void 0===r?Tl:r,i=e.entryStageSequence,a=e.entryStage,o=void 0===a?iu:a,u=e.ignoreStageSpace,s=e.drawDefinition,l=e.entryPosition,c=e.participant,d=e.roundTarget,p=e.extensions,v=e.extension,f=e.drawType,m="addDrawEntry";if(!s)return{error:K};if(!o)return{error:ke};if(f!==Nu&&!xv({stage:o,drawDefinition:s}))return On({result:{error:_e},stack:m});var h=Ov({stageSequence:i,stage:o,drawDefinition:s,entryStatus:n});if(!u&&!h.success)return{error:h.error};if(v&&!Ln({extension:v}))return On({result:{error:xr},info:"Invalid extension",context:{extension:v},stack:m});var g=e.participantId||(null==c?void 0:c.participantId);if(!g)return On({result:{error:_t},stack:m});var I=n===bl&&Av({participantId:g,drawDefinition:s,entryStatus:n}),y=o===uu&&Av({participantId:g,drawDefinition:s,entryStage:o}),U=n!==bl&&o!==uu&&Av({drawDefinition:s,participantId:g});if(U||I||y)return On({context:{invalidEntry:U,invalidLuckyLoser:I,invalidVoluntaryConsolation:y},result:{error:zt},stack:m});var S=xn({entryStageSequence:i,participantId:g,entryPosition:l,entryStatus:n,entryStage:o,extensions:p});return v&&jn({element:S,extension:v}),d&&jn({extension:{name:"roundEntry",value:d},element:S}),s.entries||(s.entries=[]),s.entries.push(S),Op({drawDefinition:s}),t({},L)}function kv(e){var r=e.autoEntryPositions,n=void 0===r||r,i=e.entryStageSequence,a=e.ignoreStageSpace,o=e.drawDefinition,u=e.participantIds,s=e.entryStatus,l=e.roundTarget,c=e.entryStage,d=e.extension,p=e.drawId,v=e.event;if(!(null==u?void 0:u.length))return{error:Vt};if(!v)return{error:Ee};if(!p)return{error:pe};var f=(v.entries||[]).map(Mo);if(u.filter((function(e){return!f.includes(e)})).length)return{error:xe};if(o){var m=function(e){var r,n=e.entryStatus,i=void 0===n?Tl:n,a=e.stage,o=void 0===a?iu:a,u=e.autoEntryPositions,s=void 0===u||u,l=e.ignoreStageSpace,c=e.drawDefinition,d=e.participantIds,p=e.stageSequence,v=e.roundTarget,f=e.extension;if(!o)return{error:ke};if(!c)return{error:K};if(!Array.isArray(d))return{error:Et};if(!xv({stage:o,drawDefinition:c}))return{error:_e};if(f&&!Ln({extension:f}))return On({result:{error:xr},info:"Invalid extension",context:{extension:f},stack:"addDrawEntries"});var m=Ov({drawDefinition:c,stageSequence:p,entryStatus:i,stage:o});if(!l&&!m.success)return{error:m.error};var h=null!==(r=m.positionsAvailable)&&void 0!==r?r:0;if(!l&&o!==uu&&h<d.length)return{error:Yt};var g=d.reduce((function(e,t){var r=i===bl&&Av({participantId:t,drawDefinition:c,entryStatus:i}),n=o===uu&&Av({entryStage:o,drawDefinition:c,participantId:t});return i!==bl&&o!==uu&&Av({drawDefinition:c,participantId:t})||r||n?e.concat(t):e}),[]);return d.filter((function(e){return e&&!g.includes(e)})).forEach((function(e){var t={entryStageSequence:p,entryStage:o,participantId:e,entryStatus:i};f&&jn({element:t,extension:f}),v&&jn({extension:{name:fo,value:v},element:t}),c.entries||(c.entries=[]),c.entries.push(t)})),s&&(c.entries=mv({entries:c.entries})),Op({drawDefinition:c}),(null==g?void 0:g.length)?t({info:"some participantIds could not be added",participantIdsNotAdded:g},L):t({},L)}({stageSequence:i,autoEntryPositions:n,stage:c,ignoreStageSpace:a,drawDefinition:o,participantIds:u,entryStatus:s,roundTarget:l,extension:d});if(m.error)return m}var h=_d({event:v}).flightProfile,g=null==h?void 0:h.flights.find((function(e){return e.drawId===p}));return(null==g?void 0:g.drawEntries)&&(u.forEach((function(e){var t=s===bl&&_v({participantId:e,entryStatus:s,flight:g}),r=c===uu&&_v({participantId:e,entryStage:c,flight:g});s!==bl&&c!==uu&&_v({flight:g,participantId:e})||t||r||g.drawEntries.push({participantId:e,entryStatus:s,entryStage:c})})),n&&(g.drawEntries=mv({entries:g.drawEntries}))),t({},L)}function _v(e){var t,r=e.participantId,n=e.entryStatus,i=e.entryStage,a=null===(t=e.flight.drawEntries)||void 0===t?void 0:t.find((function(e){return!(e.participantId!==r||n&&n!==e.entryStatus||i&&i!==e.entryStage)}));return r&&a}function Lv(e){var r,n,i,a,o,u,s=e.autoEntryPositions,l=void 0===s||s,c=e.participantIds,d=void 0===c?[]:c,p=e.entryStatuses,v=e.stage,f=e.event,m="removeEventEntries";if(!(null==f?void 0:f.eventId))return{error:Ae};if(!Array.isArray(d)||d.some((function(e){return!Pi(e)})))return On({result:{error:At},stack:m});var h=(null!==(r=f.drawDefinitions)&&void 0!==r?r:[]).flatMap((function(e){var t;return null!==(t=fv({drawDefinition:e}).assignedParticipantIds)&&void 0!==t?t:[]})),g=((null==p?void 0:p.length)&&(null===(n=f.entries)||void 0===n?void 0:n.filter((function(e){return e.entryStatus&&p.includes(e.entryStatus)})))||[]).map(Ri("participantId")).filter((function(e){return!h.includes(e)})),I=(v&&(null===(i=f.entries)||void 0===i?void 0:i.filter((function(e){return e.entryStage&&e.entryStage===v})))||[]).map(Ri("participantId")).filter((function(e){return!h.includes(e)}));if(d.length?d=d.filter((function(e){return(!(null==p?void 0:p.length)||g.includes(e))&&(!v||I.includes(e))})):g.length&&I.length?d=E(g,I):g.length?d=g:I.length&&(d=I),(null==d?void 0:d.length)&&h.some((function(e){return d.includes(e)})))return On({result:{error:Ht},stack:m});if(!(null==d?void 0:d.length))return t(t({},L),{participantIdsRemoved:[]});var y=[];f.entries=(null!==(a=f.entries)&&void 0!==a?a:[]).filter((function(e){var t=!d.includes(null==e?void 0:e.participantId);return t||y.push(e.participantId),t})),l&&(f.entries=mv({entries:f.entries}));var U=_d({event:f}).flightProfile;return null===(o=null==U?void 0:U.flights)||void 0===o||o.forEach((function(e){e.drawEntries=(e.drawEntries||[]).filter((function(e){return!d.includes(e.participantId)}))})),null===(u=f.drawDefinitions)||void 0===u||u.forEach((function(e){var t;e.entries=(null!==(t=e.entries)&&void 0!==t?t:[]).filter((function(e){return!d.includes(e.participantId)}))})),t(t({},L),{participantIdsRemoved:y})}var jv=((ev={})[Ca]={policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1},ev);function Bv(e){var r,n,i,a,s,l,c,d=e.entryStatus,p=void 0===d?Tl:d,v=e.autoEntryPositions,f=void 0===v||v,m=e.enforceGender,h=void 0===m||m,g=e.participantIds,I=void 0===g?[]:g,y=e.entryStageSequence,U=e.policyDefinitions,S=e.entryStage,w=void 0===S?iu:S,T=e.tournamentRecord,P=e.ignoreStageSpace,D=e.drawDefinition,b=e.roundTarget,N=e.extensions,M=e.extension,R=e.drawId,A=e.event,E="addEventEntries";if(!A)return{error:Ae};if(!(null==I?void 0:I.length))return On({result:{error:Vt},stack:E});if(!(null==A?void 0:A.eventId))return{error:Ee};var C=null!==(r=tl({tournamentRecord:T,event:A}).appliedPolicies)&&void 0!==r?r:{},x=null!==(i=null!==(n=null==U?void 0:U[Ca])&&void 0!==n?n:null==C?void 0:C[Ca])&&void 0!==i?i:jv[Ca],O=!1!==(null!=h?h:null===(a=null==x?void 0:x.participants)||void 0===a?void 0:a.enforceGender),F=[],k=[];if(N&&(!Array.isArray(N)||!N.every((function(e){return Ln({extension:e})})))||M&&!Ln({extension:M}))return On({context:xn({extension:M,extensions:N}),result:{error:xr},info:"Invalid extension(s)",stack:E});var _,j=!!T,B=[],V=null!==(l=null===(s=null==T?void 0:T.participants)||void 0===s?void 0:s.filter((function(e){var t,r,n;if(!I.includes(e.participantId))return!1;var i=A.eventType===Es&&e.participantType===fs&&!hv(p),a=A.eventType===xs&&e.participantType===hs;return!(!i||A.gender&&O&&![dp,lp].includes(A.gender)&&A.gender!==(null===(t=e.person)||void 0===t?void 0:t.sex))||(!(!a||hv(p))||(!(A.eventType!==xs||e.participantType!==fs||!hv(p))||(i&&A.gender&&O&&![dp,lp].includes(A.gender)&&A.gender!==(null===(r=e.person)||void 0===r?void 0:r.sex)?(B.push({participantId:e.participantId,sex:null===(n=e.person)||void 0===n?void 0:n.sex}),!1):A.eventType===gs&&(e.participantType===gs||hv(p)&&e.participantType===fs))))})).map((function(e){return e.participantId})))&&void 0!==l?l:[],G=I.filter((function(e){return!j||V.includes(e)}));A.entries||(A.entries=[]);var q=A.entries.map((function(e){var t;return e.participantId||(null===(t=e.participant)||void 0===t?void 0:t.participantId)}));if(G.forEach((function(e){var t;if(!q.includes(e)){var r=xn({participantId:e,entryStatus:p,entryStage:w,extensions:N});M&&jn({element:r,extension:M}),b&&jn({extension:{name:fo,value:b},element:r}),y&&(r.entryStageSequence=y),F.push(r.participantId),null===(t=A.entries)||void 0===t||t.push(r)}})),R&&!hv(w)){var W=kv({participantIds:G,autoEntryPositions:f,entryStageSequence:y,ignoreStageSpace:P,drawDefinition:D,entryStatus:p,roundTarget:b,entryStage:w,extension:M,drawId:R,event:A});W.error&&(_=W.error)}if(A.eventType&&[ha,Ia].includes(A.eventType)){var H=(A.entries||[]).map((function(e){return e.participantId})),z=(A.entries||[]).filter((function(e){return hv(e.entryStatus)})).map((function(e){return e.participantId})),Y=(null!==(c=null==T?void 0:T.participants)&&void 0!==c?c:[]).filter((function(e){return H.includes(e.participantId)&&e.participantType&&[hs,gs].includes(e.participantType)})).map((function(e){return e.individualParticipantIds})).flat(1/0),K=z.filter((function(e){return Y.includes(e)}));K.length&&(k.push.apply(k,u([],o(K),!1)),Lv({participantIds:K,autoEntryPositions:!1,event:A}))}if(G.length!==I.length)return On({context:{mismatchedGender:B,gender:A.gender},result:{error:Et},stack:E});f&&(A.entries=mv({entries:A.entries||[]}));var J=F.length-k.length;return On({result:t(t({},L),{addedEntriesCount:J}),stack:E,info:_})}var Vv="COMPETITOR",Gv="OFFICIAL",qv="OTHER",Wv={ADMINISTRATION:"ADMINISTRATION",CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:Vv,MEDIA:"MEDIA",MEDICAL:"MEDICAL",OFFICIAL:Gv,OTHER:qv,SECURITY:"SECURITY"};function Hv(e){var r,n,i,o,u,s=e.addIndividualParticipantsToEvents,l=e.individualParticipantIds,c=e.groupingParticipantId,d=e.tournamentRecord,p=e.suppressErrors,v="removeIndividualParticipantIds";if(!d)return On({result:{error:W},stack:v});if(!c||!l)return On({result:{error:pt},stack:v});var f=(null!==(i=d.participants)&&void 0!==i?i:[]).find((function(e){return e.participantId===c}));if(!f)return On({result:{error:Lt},stack:v});if(![gs,ms].includes(f.participantType))return On({result:{participantType:f.participantType,error:xt},stack:v});var m=zv({individualParticipantIds:l,groupingParticipant:f,tournamentRecord:d,suppressErrors:p}),h=m.removed;if(m.error)return On({result:m,stack:v});if(s){var g=function(e){var t=(null!==(u=e.entries)&&void 0!==u?u:[]).map((function(e){return e.participantId})).filter(Boolean);t.includes(c)&&Bv({participantIds:null==h?void 0:h.filter((function(e){return!t.includes(e)})),entryStatus:Al,tournamentRecord:d,event:e})};try{for(var I=a(null!==(o=d.events)&&void 0!==o?o:[]),y=I.next();!y.done;y=I.next()){g(y.value)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}}return h&&mn({topic:md,payload:{tournamentId:d.tournamentId,participants:[f]}}),t(t({},L),m)}function zv(e){var r,n,i,o=e.individualParticipantIds,u=void 0===o?[]:o,s=e.groupingParticipant,l=e.tournamentRecord,c=e.suppressErrors,d=e.mappedMatchUps,p=e.participants,v=[];if(!s)return{removed:v};var f=[],m=[];p||(r=Rv({withMatchUps:!0,tournamentRecord:l,withEvents:!0}),p=r.participants,d=r.mappedMatchUps);var h=null==p?void 0:p.find((function(e){return e.participantId===s.participantId})),g=null===(n=null==h?void 0:h.events)||void 0===n?void 0:n.map((function(e){return e.eventId})),I=(null!==(i=s.individualParticipantIds)&&void 0!==i?i:[]).filter((function(e){var t,r,n,i,o,c,h,I,y,U,S,w,T,P,D=null==u?void 0:u.includes(e),b=D&&(null===(y=null==p?void 0:p.find((function(t){return t.participantId===e})))||void 0===y?void 0:y.matchUps.filter((function(e){var t=e.eventId;return g.includes(t)})).map((function(e){var t=e.matchUpId;return null==d?void 0:d[t]})).filter((function(e){var t=e.winningSide,r=e.score;return t||Bp({score:r})}))),N=D&&!(null==b?void 0:b.length);if(D&&!N&&m.push(e),N){v.push(e);try{for(var M=a(null!==(U=l.events)&&void 0!==U?U:[]),R=M.next();!R.done;R=M.next()){var A=R.value;try{for(var E=(n=void 0,a(null!==(S=A.drawDefinitions)&&void 0!==S?S:[])),C=E.next();!C.done;C=E.next()){var x=C.value,O=Vn({element:x,name:uo}).extension,F=null==O?void 0:O.value[s.participantId];O&&F&&(O.value[s.participantId]=F.filter((function(t){return t.participantId!==e})),jn({element:x,extension:O}),xp({drawDefinition:x}));var k=null!==(w=Up({drawDefinition:x,inContext:!1}).matchUps)&&void 0!==w?w:[];try{for(var _=(o=void 0,a(k)),L=_.next();!L.done;L=_.next()){var j=L.value,B=null!==(T=j.sides)&&void 0!==T?T:[];try{for(var V=(h=void 0,a(B)),G=V.next();!G.done;G=V.next()){var q=G.value,W=null!==(P=q.lineUp)&&void 0!==P?P:[];W.find((function(t){return t.participantId===e}))&&(q.lineUp=W.filter((function(t){return t.participantId!==e})),Cp({tournamentId:null==l?void 0:l.tournamentId,drawDefinition:x,matchUp:j}))}}catch(e){h={error:e}}finally{try{G&&!G.done&&(I=V.return)&&I.call(V)}finally{if(h)throw h.error}}}}catch(e){o={error:e}}finally{try{L&&!L.done&&(c=_.return)&&c.call(_)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{C&&!C.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{R&&!R.done&&(r=M.return)&&r.call(M)}finally{if(t)throw t.error}}}else f.push(e);return!N}));s.individualParticipantIds=I;var y={groupingParticipantId:s.participantId,cannotRemove:m,notRemoved:f,removed:v};return m.length&&!c&&t(t({},y),{cannotRemove:m,error:Nt})||y}function Yv(e){var t,r=e.participantRole,n=void 0===r?Vv:r,i=e.individualParticipantIds,a=void 0===i?[]:i,o=e.groupingTypes,u=void 0===o?[vs,ms]:o,s=e.tournamentRecord;if(!s)return{error:W};var l=null!==(t=s.participants)&&void 0!==t?t:[],c=Rv({withMatchUps:!0,tournamentRecord:s,withEvents:!0}),d=c.participants,p=c.mappedMatchUps,v=0;return l.filter((function(e){return(e.participantRole===n||!e.participantRole)&&e.participantType&&u.includes(e.participantType)})).forEach((function(e){zv({groupingParticipant:e,individualParticipantIds:a,tournamentRecord:s,mappedMatchUps:p,participants:d}).removed&&v++})),v?L:{error:Bt}}function Kv(e){var r,n,i,o,u,s,l,c;if(!(null==e?void 0:e.tournamentRecord))return{error:W};if(!(null===(u=null==e?void 0:e.participantIds)||void 0===u?void 0:u.length))return{error:Vt};var d=e.addIndividualParticipantsToEvents,p=e.tournamentRecord,v=e.participantIds,f=(null===(s=p.participants)||void 0===s?void 0:s.length)||0;if(!f)return t({},L);var m=null===(l=p.events||[])||void 0===l?void 0:l.filter((function(e){return e.eventType===ga})).map((function(e){var t;return null===(t=null==e?void 0:e.drawDefinitions)||void 0===t?void 0:t.map((function(e){return e.drawId}))})).flat(1/0),h=null!==(c=Rv({participantFilters:{participantIds:v},tournamentRecord:p,withDraws:!0}).participants)&&void 0!==c?c:[],g=(null==m?void 0:m.length)&&function(){var e;return E((null!==(e=Kp({matchUpFilters:{drawIds:m,matchUpTypes:[xs]},tournamentRecord:p}).matchUps)&&void 0!==e?e:[]).map((function(e){var t=e.sides;return null==t?void 0:t.map((function(e){return e.participantId}))})).flat().filter(Boolean),v)}(),I=h.filter((function(e){var t;return null===(t=e.draws)||void 0===t?void 0:t.filter((function(e){return(!(null==m?void 0:m.length)||!(null==m?void 0:m.includes(e.drawId)))&&e.positionAssignments})).length}));if((null==g?void 0:g.length)||I.length)return{error:Ht};var y={},U={};try{for(var S=a(p.events||[]),w=S.next();!w.done;w=S.next()){var T=w.value,P=Lv({participantIds:v,event:T});if(P.error)return P;y[T.eventId]=P.participantIdsRemoved}}catch(e){r={error:e}}finally{try{w&&!w.done&&(n=S.return)&&n.call(S)}finally{if(r)throw r.error}}p.participants=p.participants.filter((function(e){var t,r,n=v.includes(e.participantId)||e.participantType===hs&&e.individualParticipantIds.some((function(e){return v.includes(e)}));if(!n&&e.participantType===ga&&e.individualParticipantIds.some((function(e){return v.includes(e)}))&&(e.individualParticipantIds=e.individualParticipantIds.filter((function(e){return!v.includes(e)}))),n&&d&&[hs,gs].includes(e.participantType))try{for(var i=a(e.individualParticipantIds||[]),o=i.next();!o.done;o=i.next()){var u=o.value;v.includes(u)||(U[e.participantId]||(U[e.participantId]=[]),U[e.participantId].push(u))}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!n}));var D=f-p.participants.length;if(Yv({individualParticipantIds:v,tournamentRecord:p}),d)try{for(var b=a(p.events||[]),N=b.next();!N.done;N=b.next()){var M=N.value;Bv({participantIds:y[M.eventId].map((function(e){return U[e]||[]})).flat(),entryStatus:Al,tournamentRecord:p,event:M})}}catch(e){i={error:e}}finally{try{N&&!N.done&&(o=b.return)&&o.call(b)}finally{if(i)throw i.error}}return D&&mn({payload:{participantIds:v,tournamentId:p.tournamentId},topic:ud}),D?t(t({},L),{participantsRemovedCount:D}):{error:Nt}}function Jv(e){var t,r,n=e.selected,i=void 0===n||n,a=e.drawDefinition,o=e.entryStatuses,u=e.drawId,s=e.event,l=e.stage,c=null!==(t=s.entries)&&void 0!==t?t:[];if(u){var d=_d({event:s}).flightProfile,p=null===(r=null==d?void 0:d.flights)||void 0===r?void 0:r.find((function(e){return e.drawId===u}));p?c=p.drawEntries:a.entries&&(c=null==a?void 0:a.entries)}var v=c.filter((function(e){return(!(null==o?void 0:o.length)||!e.entryStatus||o.includes(e.entryStatus))&&(!l||!e.entryStage||e.entryStage===l)&&(!i||e.entryStatus&&_l.includes(e.entryStatus))}));return{entries:c,stageEntries:v}}function Zv(e){var r,n,i,a=e.removeGroupParticipant,o=e.tournamentRecord,u=e.drawDefinition,s=e.participantId,l=e.drawId,c=e.stage,d=e.event,p="destroyGroupEntry";if(!o)return{error:W};if(!s)return On({result:{error:_t},stack:p});if(!d)return{error:Ae};if(!d.eventType||![ha,Ia].includes(d.eventType))return On({result:{error:Re},stack:p});var v=null!==(r=o.participants)&&void 0!==r?r:[],f=v.find((function(e){return e.participantId===s}));if(!f)return On({result:{error:Lt},stack:p});if(!f.participantType||![hs,vs].includes(f.participantType)||f.participantType===vs&&d.eventType!==Ia||f.participantType===hs&&d.eventType!==ha)return{error:xt};var m=(null!==(n=d.entries)&&void 0!==n?n:[]).find((function(e){return e.participantId===s}));if(!m)return{error:Jt};var h,g=Jv({selected:!1,drawDefinition:u,drawId:l,event:d,stage:c}).stageEntries.map(Mo),I=v.filter((function(e){var t=e.participantId;return g.includes(t)})).map((function(e){return e.individualParticipantIds})).flat().filter(Boolean),y=null===(i=f.individualParticipantIds)||void 0===i?void 0:i.filter((function(e){return 1===A(e,I).length})),U=Lv({participantIds:[s],event:d});if(U.error)return U;if((null==y?void 0:y.length)&&(U=Bv({participantIds:y,entryStatus:Al,entryStage:m.entryStage,tournamentRecord:o,drawDefinition:u,drawId:l,event:d})).error)return U;a&&(Kv({participantIds:[s],tournamentRecord:o}).success&&(h=!0));return t(t({},L),{participantRemoved:h})}function Xv(e){return Zv({removeGroupParticipant:e.removeGroupParticipant,tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,participantId:e.participantId,drawId:e.drawId,event:e.event})}function Qv(e){var t=e.tournamentRecord,r=e.replaceWithBye,n=e.drawDefinition,i=e.destroyPair,a=e.entryStatus,o=e.matchUpsMap,u=e.drawId,s="removeDrawPositionAssignment",l=dv(e);if(l.error)return On({result:l,stack:s});var c=l.participantId,d=e.drawPosition,p=e.event,v=e.structureId;if([Sl,xl].includes(a)&&c){var f=e.tournamentRecord,m=Ps({tournamentRecord:f,participantId:c}).participant,h=null!=m?m:{},g=h.participantType,I=h.individualParticipantIds;if(i&&g===hs){var y=Xv({tournamentRecord:f,drawDefinition:n,participantId:c,event:p});if(y.error)return On({result:y,stack:s});I&&gv({participantIds:I,tournamentRecord:f,drawDefinition:n,entryStatus:a,drawId:u,event:p})}else gv({participantIds:[c],tournamentRecord:f,drawDefinition:n,entryStatus:a,drawId:u,event:p})}if(r){var U=av({tournamentRecord:t,drawDefinition:n,drawPosition:d,structureId:v,matchUpsMap:o,event:p});if(U.error)return On({result:U,stack:s})}return _p({structure:as({drawDefinition:n,structureId:v}).structure,drawPositions:[d]}),Lp({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:r,drawPosition:d,entryStatus:a,structureId:v}}),l}function $v(e){return Pi(e)?e.split(" ").map((function(e){return e.split("").map((function(e,t){return t?e.toLowerCase():e.toUpperCase()})).join("")})).join(" "):e}function ef(e){return Pi(e)?$v(e.replace(/_/g," ")):e}var tf=function(e){var t=e.finishingPosition,r=void 0===t?es:t,n=e.qualifyingRoundNumber,i=e.structureAbbreviation,a=e.seedAssignments,o=void 0===a?[]:a,u=e.stageSequence,s=void 0===u?1:u,l=e.structureOrder,c=e.seedingProfile,d=e.matchUpFormat,p=e.structureType,v=e.structureName,f=e.matchUpType,m=e.matchUps,h=void 0===m?[]:m,g=e.structureId,I=e.roundOffset,y=e.roundLimit,S=e.stageOrder,w=e.structures,T=e.stage,P={structureId:null!=g?g:ed(),structureAbbreviation:i,finishingPosition:r,seedAssignments:o,matchUpFormat:d,stageSequence:s,structureName:v};l&&(P.structureOrder=l),p&&(P.structureType=p),c&&("string"==typeof c?P.seedingProfile=c:"object"==typeof c&&"string"==typeof c.positioning&&(P.seedingProfile=c.positioning)),f&&(P.matchUpType=f),I&&(P.roundOffset=I),S&&(P.stageOrder=S),y&&(P.roundLimit=y),T&&(P.stage=T),n&&(P.qualifyingRoundNumber=n);var D=h.flatMap((function(e){return e.drawPositions})).filter(Boolean);return w?P.structures=w:(P.matchUps=h,P.positionAssignments=U(D).sort((function(e,t){return e-t})).map((function(e){return{drawPosition:e}}))),P};function rf(e){var r=e.structureName,n=void 0===r?ef(uu):r,i=e.structureAbbreviation,a=e.drawDefinition,o=e.matchUpType,u=e.structureId;if(!a)return{error:K};var s=tf({stage:uu,structureAbbreviation:i,structureName:n,matchUps:[],structureId:u,matchUpType:o});return a.structures||(a.structures=[]),a.structures.push(s),Op({drawDefinition:a,structureIds:[s.structureId]}),t({},L)}function nf(e){var t,r=e.tournamentRecord,n=e.drawDefinition,i=e.stage,a=void 0===i?iu:i,o=e.structureId,u=e.structure;if(!r)return{error:W};if(!u&&!n)return{error:K};if(u||o||1!==(null===(t=null==n?void 0:n.structures)||void 0===t?void 0:t.filter((function(e){return e.stage===a})).length)||(u=n.structures.find((function(e){return e.stage===a}))),!u&&!o)return{error:Pe};var s=ss({drawDefinition:n,structureId:o,structure:u}),l=s.error,c=s.positionAssignments;return{positionAssignments:null!=c?c:[],structureId:null==u?void 0:u.structureId,error:l}}function af(e){var r=e.schedulingProfile,n=e.venueIds,i=e.eventIds,a=e.drawIds,o=[];return{updatedSchedulingProfile:null==r?void 0:r.map((function(e){var r=ui(null==e?void 0:e.scheduleDate);if(r){var u=((null==e?void 0:e.venues)||[]).map((function(e){var t=e.rounds,r=e.venueId;if(null==n?void 0:n.includes(r)){var u=t.filter((function(e){var t=i.includes(e.eventId)&&a.includes(e.drawId);return t||o.push("Invalid eventId: ".concat(e.eventId," or drawId: ").concat(e.drawId)),t}));if(u.length)return{venueId:r,rounds:u}}else o.push("Missing venueId: ".concat(r))})).filter(Boolean);return u.length&&r&&t(t({},e),{venues:u})}o.push("Invalid date: ".concat(null==e?void 0:e.scheduledDate))})).filter(Boolean),modifications:o.length,issues:o}}function of(e){var t=e.tournamentRecords,r=e.schedulingProfile;if(!r)return{valid:!0};if(!Array.isArray(r))return{valid:!1,error:xr};var n,i,a=function(e){var t=(null==e?void 0:e.tournamentRecords)&&Object.values(null==e?void 0:e.tournamentRecords)||[],r={},n=t.reduce((function(e,t){var n,i,a,s,l=function(e){var t=e.tournamentRecord,r=void 0===t?{}:t,n=e.tournamentMap,i=void 0===n?{}:n,a=e.requireCourts,o=[],u=[],s=[],l=[],c=((null==r?void 0:r.venues)||[]).map((function(e){var t=e.venueId,r=e.courts;return(!a||(null==r?void 0:r.length))&&t})),d=null==r?void 0:r.tournamentId;if(d){o.push(d),i[d]={},((null==r?void 0:r.events)||[]).forEach((function(e){var t=e.eventId;s.push(t),i[d][t]={},(e.drawDefinitions||[]).forEach((function(e){var r=e.drawId;l.push(r),i[d][t][r]={},(os({drawDefinition:e}).structures||[]).forEach((function(e){var n,a=e.structureId,o=Xs({matchUps:mp({structure:e}).matchUps}).roundMatchUps,s=o&&Object.keys(o).map((function(e){return parseInt(e)}));i[d][t][r][a]=s,u.push(a),(null===(n=e.structures)||void 0===n?void 0:n.length)&&e.structures.forEach((function(e){u.push(e.structureId),i[d][t][r][e.structureId]=s}))}))}))}))}return{tournamentMap:i,tournamentIds:o,structureIds:u,venueIds:c,eventIds:s,drawIds:l}}({tournamentRecord:t}),c=l.tournamentIds,d=l.tournamentMap,p=l.structureIds,v=l.venueIds,f=l.eventIds,m=l.drawIds;return v.forEach((function(t){e.venueIds.includes(t)||e.venueIds.push(t)})),(n=e.tournamentIds).push.apply(n,u([],o(c),!1)),(i=e.structureIds).push.apply(i,u([],o(p),!1)),(a=e.eventIds).push.apply(a,u([],o(f),!1)),(s=e.drawIds).push.apply(s,u([],o(m),!1)),Object.assign(r,d),e}),{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]}),i=n.venueIds,a=n.eventIds,s=n.drawIds,l=n.structureIds,c=n.tournamentIds;return{tournamentsMap:r,tournamentIds:c,structureIds:l,venueIds:i,eventIds:a,drawIds:s}}({tournamentRecords:t}),s=a.venueIds,l=a.tournamentsMap,d=r.every((function(e){var t=e.scheduleDate,r=e.venues;return!!Jn(t)&&r.every((function(e){var t=e.venueId,r=e.rounds;if("string"!=typeof t)return i="venueId should be a string",!1;if(!Array.isArray(r))return i="rounds should be an array",!1;if(!s.includes(t))return n=cr,!1;var a=r.every((function(e){var t,r,n;if(!e)return i="empty round",!1;var a=e.roundSegment,o=e.tournamentId,u=e.structureId,s=e.roundNumber,d=e.eventId,p=e.drawId,v=null===(n=null===(r=null===(t=null==l?void 0:l[o])||void 0===t?void 0:t[d])||void 0===r?void 0:r[p])||void 0===n?void 0:n[u],f=null==v?void 0:v.includes(s);f||(i="Invalid rounds");var m=a||{},h=m.segmentNumber,g=m.segmentsCount,y=!a||I(h)&&c(g)&&h<=g;return y||(i="Invalid segment"),f&&y}));return!!a}))}));return d||n||(n=xr),{valid:!!d,error:n,info:i}}function uf(e){var r,n=e.convertExtensions,i=e.ignoreDisabled,a=e.venue,o=e.court,u=t(t({},Ui(o,n,!0)),{venueId:a.venueId}),s=Vn({name:eo,element:o}).extension;if(i&&s){var l=Di(s.value)?null===(r=s.value)||void 0===r?void 0:r.dates:void 0,c=!0===(null==s?void 0:s.value)?[]:u.dateAvailability.map((function(e){var t=e.date;if(t&&!l.includes(t))return e})).filter(Boolean);u.dateAvailability=c}return{inContextCourt:u}}function sf(e){var t,r=e.dates,n=void 0===r?[]:r,i=e.extension;if(!i)return!1;if("boolean"==typeof i.value&&i.value)return!0;if(!n.length)return!1;var a=Di(i.value)?null===(t=i.value)||void 0===t?void 0:t.dates:void 0;return Array.isArray(a)?!!(null==a?void 0:a.length)&&!!a.filter((function(e){return!n.length||n.includes(e)})).length:void 0}function lf(e){var r,n=e.convertExtensions,i=e.ignoreDisabled,o=e.venueIds,u=void 0===o?[]:o,s=e.dates,l=e.tournamentRecords||e.tournamentRecord&&((r={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,r)||{},c=[],d=[],p=[],v=[];return Object.keys(l).filter((function(t){return!e.tournamentId||t===e.tournamentId})).forEach((function(e){var t,r,o,f,m,h,g=l[e];try{for(var I=a(null!==(m=g.venues)&&void 0!==m?m:[]),y=I.next();!y.done;y=I.next()){var U=y.value;if(!u.length||u.includes(U.venueId)){if(i)if(null==(P=Vn({name:eo,element:U}).extension)?void 0:P.value)continue;c.includes(U.venueId)||(v.push(Ui(U,n,!0)),c.push(U.venueId));try{for(var S=(o=void 0,a(null!==(h=U.courts)&&void 0!==h?h:[])),w=S.next();!w.done;w=S.next()){var T=w.value;if(!d.includes(T.courtId)){var P;if(i)if(sf({extension:P=Vn({name:eo,element:T}).extension,dates:s}))continue;var D=uf({convertExtensions:n,ignoreDisabled:i,venue:U,court:T}).inContextCourt;p.push(D),d.push(T.courtId)}}}catch(e){o={error:e}}finally{try{w&&!w.done&&(f=S.return)&&f.call(S)}finally{if(o)throw o.error}}}}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=I.return)&&r.call(I)}finally{if(t)throw t.error}}})),t({courts:p,venues:v},L)}function cf(e){var t=e.tournamentRecords,r=e.requireCourts,n=e.dates;return"object"==typeof t&&Object.keys(t).length?Object.keys(t).reduce((function(e,i){var a=function(e){var t,r=e.convertExtensions,n=e.tournamentRecord,i=e.ignoreDisabled,a=e.dates;if(!n)return{error:q};var o=Ui(null!==(t=n.venues)&&void 0!==t?t:[],r).filter((function(e){if(!i)return e;var t=Vn({name:eo,element:e}).extension;return!(null==t?void 0:t.value)&&e})).filter(Boolean),u=o.reduce((function(e,t){var n=((null==t?void 0:t.courts)||[]).filter((function(e){return i||(null==a?void 0:a.length)?sf({extension:Vn({name:eo,element:e}).extension,dates:a}):e})).filter(Boolean).map((function(e){return uf({convertExtensions:r,ignoreDisabled:i,venue:t,court:e}).inContextCourt}));return n.length?e.concat(n):e}),[]);return{venues:o,courts:u}}({tournamentRecord:t[i],dates:n}).venues;return null==a||a.forEach((function(t){var n=t.venueId,i=t.courts;(!r||(null==i?void 0:i.length))&&!e.venueIds.includes(n)&&(e.venues.push(t),e.venueIds.push(n))})),e}),{venues:[],venueIds:[]}):{error:q}}function df(e){var t,r=da(e,[(t={},t[xi]=!0,t)]);return r.error?r:Object.keys(e.tournamentRecords).reduce((function(t,r){var n,i,a;t.tournamentIdMap[r]=[];var s=e.tournamentRecords[r].events||[],l=s.map((function(e){return e.eventId})),c=s.map((function(e){return(e.drawDefinitions||[]).map((function(e){return e.drawId}))})).flat();return(n=t.tournamentIdMap[r]).push.apply(n,u(u([],o(l),!1),o(c),!1)),(i=t.eventIds).push.apply(i,u([],o(l),!1)),(a=t.drawIds).push.apply(a,u([],o(c),!1)),t}),{eventIds:[],drawIds:[],tournamentIdMap:{}})}function pf(e){var t=e.tournamentRecords,r=e.tournamentRecord;if("object"!=typeof t||!Object.keys(t).length)return{error:q};var n=Vn({element:r,name:go,tournamentRecords:t,discover:!0}).extension,i=(null==n?void 0:n.value)||[];if(i.length){var a=cf({requireCourts:!0,tournamentRecords:t}).venueIds,o=df({tournamentRecords:t}),u=af({schedulingProfile:i,venueIds:a,eventIds:o.eventIds,drawIds:o.drawIds}),s=u.updatedSchedulingProfile,l=u.modifications,c=u.issues;if(l){var d=vf({tournamentRecords:t,tournamentRecord:r,schedulingProfile:i=s});return d.error?d:{schedulingProfile:i,modifications:l,issues:c}}}return{schedulingProfile:i,modifications:0}}function vf(e){var t=e.tournamentRecords,r=e.tournamentRecord,n=e.schedulingProfile,i=of({tournamentRecords:t,schedulingProfile:n});return i.error?i:n?jn({tournamentRecords:t,discover:!0,extension:{name:go,value:n}}):_n({element:r,name:go,tournamentRecords:t,discover:!0})}function ff(e){var r,n=e.tournamentRecord,i=e.tournamentRecords||n&&((r={})[n.tournamentId]=n,r)||{};if(!e.schedulingProfile){var a=pf({tournamentRecords:i,tournamentRecord:n}),o=a.modifications;return{success:!o,modifications:o,issues:a.issues}}var u=cf({tournamentRecords:i}).venueIds,s=df({tournamentRecords:i}),l=s.eventIds,c=s.drawIds,d=af({schedulingProfile:e.schedulingProfile,venueIds:u,eventIds:l,drawIds:c}),p=d.updatedSchedulingProfile,v=d.modifications,f=d.issues;return t(t({},v?vf({schedulingProfile:p,tournamentRecords:i}):L),{modifications:v,issues:f})}function mf(e){var r,n=e.duplicateValues,i=void 0===n||n,a=e.creationTime,o=void 0===a||a,u=e.removePriorValues,s=e.timeItem,l=e.element;if(!s)return{error:yr};if(!l)return{error:pt,info:Fn};var c=s&&Object.keys(s),d=["itemType","itemValue"];if(!(d.filter((function(e){return c.includes(e)})).length===d.length))return{error:gr};if(l.timeItems){var p=s.itemType,v=s.itemSubTypes,f=s.itemValue,m=p&&(null===(r=Ds({itemSubTypes:v,itemType:p,element:l}))||void 0===r?void 0:r.timeItem);if(m&&JSON.stringify(null==m?void 0:m.itemValue)===JSON.stringify(f)&&!i)return t({},L)}else l.timeItems=[];if(s.itemSubTypes&&!s.itemSubTypes.length&&delete s.itemSubTypes,o){var h=(new Date).toISOString();Object.assign(s,{createdAt:h})}return u&&(l.timeItems=l.timeItems.filter((function(e){var t=e.itemType;return s.itemType!==t}))),u&&!s.itemValue||l.timeItems.push(s),t({},L)}function hf(e){var t=e.creationTime,r=void 0===t||t,n=e.removePriorValues,i=e.tournamentRecord,a=e.duplicateValues,o=e.participantId,u=e.timeItem;if(!i)return{error:W};if(!o)return{error:_t};var s=Ps({tournamentRecord:i,participantId:o});return s.error?s:mf({element:s.participant,removePriorValues:n,duplicateValues:a,creationTime:r,timeItem:u})}function gf(e){var t=e.removePriorValues,r=e.tournamentRecord,n=e.duplicateValues,i=e.creationTime,a=e.timeItem;return r?mf({element:r,removePriorValues:t,duplicateValues:n,creationTime:i,timeItem:a}):{error:W}}function If(e){var t=e.removePriorValues,r=e.duplicateValues,n=e.creationTime,i=e.timeItem,a=e.event;return a?mf({removePriorValues:t,duplicateValues:r,element:a,creationTime:n,timeItem:i}):{error:Ee}}function yf(e){var r,n=e.removePriorValues,i=void 0===n||n,a=e.status,o=void 0===a?Tc:a,u=e.statusObject,s=e.event;if(!Di(u))return{error:xr};var l=Uv({event:s,status:o}),c="".concat(wc,".").concat(Pc);return If({timeItem:{itemValue:(r={},r[o]=t(t({},l),u),r),itemType:c},removePriorValues:i,event:s})}function Uf(e){var r=e.tournamentRecord;if(!r)return{error:W};var n=function(e){return{tournamentId:e.tournamentId,tournamentRank:e.tournamentRank,tournamentStatus:e.tournamentStatus,formalName:e.formalName,tournamentName:e.tournamentName,promotionalName:e.promotionalName,onlineResources:e.onlineResources,localTimeZone:e.localTimeZone,startDate:e.startDate,endDate:e.endDate,hostCountryCode:e.hostCountryCode,tournamentContacts:e.tournamentContacts,tournamentAddresses:e.tournamentAddresses}}(r);return t(t({},L),{tournamentInfo:Ui(n,!1,!0)})}function Sf(e){var t,r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,S,w=e.drawDefinition,T=null!==(c=w.structures)&&void 0!==c?c:[],P=null!==(d=w.links)&&void 0!==d?d:[],D=new Map,b=function(e){var t=D.get(e)||D.set(e,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&D.get(e);if(t&&!(null==t?void 0:t.stage)){var r=T.find((function(t){return t.structureId===e}));t.stage=null==r?void 0:r.stage}return t},N={},M={},A=P.map((function(e){var t=e.source.structureId,r=e.target.structureId,n=b(t),i=b(r);return[wu,Su,Uu,hu].includes(e.target.feedProfile)?(null==n||n.targets.push(r),null==i||i.sources.push(t)):e.target.feedProfile===yu&&(null==i||i.drawSources.push(t),null==n||n.drawTargets.push(r)),M[r]=M[r]||e.target.feedProfile===yu,N[r]=U(u(u([],o(N[r]||[]),!1),[t],!1)).filter(Boolean),[e.source.structureId,e.target.structureId]}));try{for(var C=a(D.keys()),O=C.next();!O.done;O=C.next()){var F=O.value;if(Y=D.get(F)){for(var k=null!==(p=Y.targets)&&void 0!==p?p:[];k.length;){var _=k.pop(),L=_&&D[_];(null===(v=null==L?void 0:L.targets)||void 0===v?void 0:v.length)?k.push.apply(k,u([],o(L.targets),!1)):L&&(Y.rootStage=L.stage)}if(Y.rootStage||(Y.rootStage=Y.stage),!(null===(f=Y.targets)||void 0===f?void 0:f.length))for(var j=null!==(m=Y.sources)&&void 0!==m?m:[];j.length;){var B=j.pop();if(null===(h=null==(Z=B&&D[B])?void 0:Z.sources)||void 0===h?void 0:h.length){try{for(var V=(n=void 0,a(Z.sources)),G=V.next();!G.done;G=V.next()){var q=G.value;(null===(g=Y.progeny)||void 0===g?void 0:g.includes(q))||null===(I=Y.progeny)||void 0===I||I.push(q)}}catch(e){n={error:e}}finally{try{G&&!G.done&&(i=V.return)&&i.call(V)}finally{if(n)throw n.error}}j.push.apply(j,u([],o(Z.sources),!1))}}}}}catch(e){t={error:e}}finally{try{O&&!O.done&&(r=C.return)&&r.call(C)}finally{if(t)throw t.error}}var W=0;try{for(var H=a(D.keys()),z=H.next();!z.done;z=H.next()){var Y;F=z.value;if((Y=D.get(F))&&Y.rootStage===au){for(var K=[null===(y=Y.drawTargets)||void 0===y?void 0:y[0]],J=0;K.length;){J+=1;var Z,X=K.pop();(null===(S=null==(Z=X?D.get(X):void 0)?void 0:Z.drawTargets)||void 0===S?void 0:S.length)&&K.push(Z.drawTargets[0])}Y.distanceFromMain=J,J>W&&(W=J)}}}catch(e){s={error:e}}finally{try{z&&!z.done&&(l=H.return)&&l.call(H)}finally{if(s)throw s.error}}var Q=A.length;R(0,Math.ceil(Q/2)).forEach((function(){A=R(0,Q).map((function(e){var t=A[e],r=A.reduce((function(e,r){return x(t,r)?e.concat.apply(e,u([],o(r),!1)):e}),[])||[];return U(t.concat.apply(t,u([],o(r),!1)))}))}));var $=A[0],ee=A.slice(1).reduce((function(e,t){return e&&E(r=t,$).length===r.length;var r}),!0),te=[$].filter(Boolean),re=[$].filter(Boolean);T.forEach((function(e){var t=e.structureId,r=e.stage;te.find((function(e){return e.includes(t)}))||(te.push([t]),r!==uu&&re.push([t]))}));var ne=ee&&1===re.length;return(null==P?void 0:P.length)||1!==T.length||b(T[0].structureId),{structureProfiles:Object.fromEntries(D),allStructuresLinked:ne,maxQualifyingDepth:W,sourceStructureIds:N,hasDrawFeedProfile:M,structureGroups:te}}function wf(e){var r=e.tournamentParticipants,n=void 0===r?[]:r,i=e.includePositionAssignments,a=e.policyDefinitions,o=e.tournamentRecord,u=e.inContext,s=void 0===u||u,l=e.usePublishState,c=e.drawDefinition,d=e.publishStatus,p=e.noDeepCopy,v=e.sortConfig,f=e.context,m=e.event;if(!c)return{error:K};var h,g,I=function(e){var t=e.matchUpFormat,r=e.updatedAt,n=e.drawType;return{matchUpFormat:t,updatedAt:r,drawName:e.drawName,drawType:n,drawId:e.drawId}}(c),y=Sf({drawDefinition:c}),U=y.allStructuresLinked,S=y.sourceStructureIds,w=y.hasDrawFeedProfile,T=y.structureGroups;if(!U)return{error:Me};var P=!1,D=!1,b=T.map((function(e){var r={},u=e.map((function(e){var t=as({drawDefinition:c,structureId:e}).structure,r=ql({drawDefinition:c,structure:t}).seedAssignments;return(null==t?void 0:t.stage)===iu&&1===t.stageSequence&&(h=r),(null==t?void 0:t.stage)===au&&1===t.stageSequence&&(g=r),t})).sort((function(e,t){return ns(e,t,v)})).map((function(e){var i;if(e){var u=null==e?void 0:e.structureId,p=[];e.stage&&[iu,ou,su].includes(e.stage)&&(p=h),(null==e?void 0:e.stage)===au&&(p=g);var v=mp({seedAssignments:(null===(i=null==e?void 0:e.seedAssignments)||void 0===i?void 0:i.length)?void 0:p,context:t({drawId:I.drawId},f),tournamentParticipants:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:d,drawDefinition:c,inContext:s,structure:e,event:m}),y=v.matchUps,U=v.roundMatchUps,T=v.roundProfile,b=ss({structure:e}).positionAssignments,N=null==b?void 0:b.filter(Ri(Li)).map((function(e){D=!0;var t=e.drawPosition,r=e.participantId,n=Vn({element:e,name:yo}).extension;return n&&{drawPosition:t,participantId:r,participantResult:n.value}})).filter((function(e){return null==e?void 0:e.participantResult})),M=e?function(e){return{stageSequence:e.stageSequence,structureName:e.structureName,structureType:e.structureType,matchUpFormat:e.matchUpFormat,stage:e.stage}}(e):{};M.sourceStructureIds=S[u],M.hasDrawFeedProfile=w[u],M.positionAssignments=b,M.structureActive=y.reduce((function(e,t){var r,n=[_o,ko,jo,Ho,Ko,Go,Bo,Vo].includes(t.matchUpStatus);return e||n||!!t.winningSide||!!(null===(r=t.score)||void 0===r?void 0:r.scoreStringSide1)}),!1);var R=y.reduce((function(e,t){return e&&[Fo,_o,Ho,Ko,jo,xo].includes(t.matchUpStatus)}),!!y.length);return M.structureCompleted=R,r[u]=R,M.structureActive&&(P=!0),t(t({},M),{participantResults:N,seedAssignments:p,roundMatchUps:U,roundProfile:T,structureId:u})}}));return u.forEach((function(e){var t;i||delete e.positionAssignments,e.sourceStructuresComplete=null===(t=e.sourceStructureIds)||void 0===t?void 0:t.every((function(e){return r[e]}))})),u})),N=b.flat();return I.drawActive=P,I.participantPlacements=D,I.drawGenerated=null==N?void 0:N.reduce((function(e,t){return e||!!(null==t?void 0:t.roundMatchUps)}),!1),I.drawCompleted=null==N?void 0:N.reduce((function(e,t){return e&&t.structureCompleted}),!0),t({structures:p?N:Ui(N,!1,!0),drawInfo:p?I:Ui(I,!1,!0)},L)}function Tf(e){var n=e.includePositionAssignments,i=e.tournamentRecord,o=e.participantsProfile,u=e.policyDefinitions,s=e.usePublishState,l=e.status,c=void 0===l?Tc:l,d=e.sortConfig,p=e.event,v=Ui(i,!1,!0),f=Ui(p,!1,!0);if(!v)return{error:W};if(!f)return{error:Ae};var m=f.eventId,h=v.tournamentId,g=v.endDate,y=Uv({event:f,status:c}),U=wv({event:f}).publishState,S=Rv(t(t({withGroupings:!0,withEvents:!1,withDraws:!1},o),{tournamentRecord:v})).participants,w=(f.drawDefinitions||[]).filter((function(e){var t,r,n=e.drawId;return!s||(y.drawDetails?null===(r=null===(t=y.drawDetails[n])||void 0===t?void 0:t.publishingDetail)||void 0===r?void 0:r.published:!y.drawIds||y.drawIds.includes(n))})).map((function(e){return function(e){var r=e.drawInfo,n=e.structures;return t(t({},r),{structures:n})}(wf({context:{eventId:m,tournamentId:h,endDate:g},includePositionAssignments:n,tournamentParticipants:S,noDeepCopy:!0,policyDefinitions:u,tournamentRecord:v,usePublishState:s,drawDefinition:e,publishStatus:y,sortConfig:d,event:f}))})).map((function(e){var n=e.structures,i=r(e,["structures"]),o=null==n?void 0:n.filter((function(e){var t=e.stage;return function(e){var t,r,n,i=e.structureId,a=e.drawId;if(!s)return!0;var o=null===(r=null===(t=null==y?void 0:y.drawDetails)||void 0===t?void 0:t[a])||void 0===r?void 0:r.structureDetails;return!o||!Object.keys(o).length||(null===(n=o[i])||void 0===n?void 0:n.published)}({structureId:e.structureId,drawId:i.drawId})&&function(e){var t,r,n,i=e.stage,a=e.drawId;if(!s)return!0;var o=null===(r=null===(t=null==y?void 0:y.drawDetails)||void 0===t?void 0:t[a])||void 0===r?void 0:r.stageDetails;return!o||!Object.keys(o).length||(null===(n=o[i])||void 0===n?void 0:n.published)}({stage:t,drawId:i.drawId})})).map((function(e){return function(e){var t,r,n,i,o,u,l=e.drawId,c=e.structure;if(!s)return c;var d=null===(u=null===(o=null===(i=null===(n=null==y?void 0:y.drawDetails)||void 0===n?void 0:n[l])||void 0===i?void 0:i.structureDetails)||void 0===o?void 0:o[c.structureId])||void 0===u?void 0:u.roundLimit;if(I(d)){var p=R(1,d+1),v={},f={};try{for(var m=a(p),h=m.next();!h.done;h=m.next()){var g=h.value;c.roundMatchUps[g]&&(v[g]=c.roundMatchUps[g],f[g]=c.roundProfile[g])}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}c.roundMatchUps=v,c.roundProfile=f}return c}({drawId:i.drawId,structure:e})}));return t(t({},i),{structures:o})})).filter((function(e){var t;return null===(t=e.structures)||void 0===t?void 0:t.length})),T=Uf({tournamentRecord:v}).tournamentInfo,P=(v.venues||[]).map((function(e){return function(e){var r=e.venueData;return t({},r)}(Od({tournamentRecord:v,venueId:e.venueId}))})),D=function(e){return{eventId:e.eventId,eventName:e.eventName,eventType:e.eventType,eventLevel:e.eventLevel,surfaceCategory:e.surfaceCategory,matchUpFormat:e.matchUpFormat,category:e.category,gender:e.gender,startDate:e.startDate,endDate:e.endDate,ballType:e.ballType,discipline:e.discipline}}(f),b={tournamentInfo:T,venuesData:P,eventInfo:D,drawsData:w};return b.eventInfo.publishState=U,b.eventInfo.publish=y,t(t({},L),{eventData:b})}function Pf(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U=e.includePositionAssignments,S=e.removePriorValues,w=e.tournamentRecord,T=e.status,P=void 0===T?Tc:T,D=e.event,b=e.drawIdsToRemove,N=e.drawIdsToAdd;if(!w)return{error:W};if(!D)return{error:Ae};var M=tl({tournamentRecord:w,event:D}).appliedPolicies,R=t(t({},M),e.policyDefinitions),A=null!==(l=null===(s=D.drawDefinitions)||void 0===s?void 0:s.map((function(e){return e.drawId})))&&void 0!==l?l:[],E=e.drawDetails?Object.keys(e.drawDetails):[],C=E.length?[]:e.drawIds,x=(r=null!=N?N:[]).concat.apply(r,u(u(u([],o(null!=b?b:[]),!1),o(null!=C?C:[]),!1),o(E),!1)),O=x.filter((function(e){return!A.includes(e)}));if(O.length)return On({result:{error:Z},context:{invalidDrawIds:O}});var F=Uv({event:D,status:P}),k=Object.keys((null==F?void 0:F.drawDetails)||{}).filter((function(e){return A.includes(e)})).reduce((function(e,t){return e[t]=F.drawDetails[t],e}),{}),_=function(r){var n,i,o,u,s,l,U,S,w,T;if(x.length&&!x.includes(r)||((null==b?void 0:b.includes(r))||(null==C?void 0:C.length)&&!C.includes(r)?k[r]=t(t({},k[r]),{publishingDetail:{published:!1}}):((null==N?void 0:N.includes(r))||(null==C?void 0:C.includes(r))||!(null==C?void 0:C.length))&&(k[r]=t(t({},k[r]),{publishingDetail:{published:!0}}))),null===(c=e.drawDetails)||void 0===c?void 0:c[r]){var P=e.drawDetails[r],M=null!==(d=P.structureDetails)&&void 0!==d?d:k[r].structureDetails,R=null!==(v=null!==(p=P.stageDetails)&&void 0!==p?p:k[r].stageDetails)&&void 0!==v?v:{},A=P.structureIdsToRemove,E=void 0===A?[]:A,O=P.structureIdsToAdd,F=void 0===O?[]:O,_=P.publishingDetail,L=void 0===_?{}:_,j=P.stagesToRemove,B=void 0===j?[]:j,V=P.stagesToAdd,G=void 0===V?[]:V;if((F||G)&&(L.published=!0),k[r]={publishingDetail:L,structureDetails:M,stageDetails:R},F.length||E.length){var q=(null!==(h=null===(m=null===(f=D.drawDefinitions)||void 0===f?void 0:f.find((function(e){return e.drawId===r})))||void 0===m?void 0:m.structures)&&void 0!==h?h:[]).map((function(e){return e.structureId})),W=(null!=F?F:[]).concat(null!=E?E:[]).filter((function(e){return!q.includes(e)}));if(W.length)return{value:On({result:{error:De},context:{invalidStructureIds:W}})};M=null!=M?M:{};try{for(var H=(n=void 0,a(q)),z=H.next();!z.done;z=H.next()){var Y=z.value;E.includes(Y)?M[Y]={published:!1}:M[Y]={published:!0}}}catch(e){n={error:e}}finally{try{z&&!z.done&&(i=H.return)&&i.call(H)}finally{if(n)throw n.error}}k[r].structureDetails=M}var K=(null!==(y=null===(I=null===(g=D.drawDefinitions)||void 0===g?void 0:g.find((function(e){return e.drawId===r})))||void 0===I?void 0:I.structures)&&void 0!==y?y:[]).map((function(e){return e.stage}));if(G.length){try{for(var J=(o=void 0,a(G)),Z=J.next();!Z.done;Z=J.next()){R[ne=Z.value]={published:!0}}}catch(e){o={error:e}}finally{try{Z&&!Z.done&&(u=J.return)&&u.call(J)}finally{if(o)throw o.error}}try{for(var X=(s=void 0,a(K)),Q=X.next();!Q.done;Q=X.next()){R[ne=Q.value]||(R[ne]={published:!1})}}catch(e){s={error:e}}finally{try{Q&&!Q.done&&(l=X.return)&&l.call(X)}finally{if(s)throw s.error}}}if(G.length||B.length){try{for(var $=(U=void 0,a(B)),ee=$.next();!ee.done;ee=$.next()){R[ne=ee.value]={published:!1}}}catch(e){U={error:e}}finally{try{ee&&!ee.done&&(S=$.return)&&S.call($)}finally{if(U)throw U.error}}try{for(var te=(w=void 0,a(K)),re=te.next();!re.done;re=te.next()){var ne;R[ne=re.value]||(R[ne]={published:!0})}}catch(e){w={error:e}}finally{try{re&&!re.done&&(T=te.return)&&T.call(te)}finally{if(w)throw w.error}}}(G.length||B.length)&&(k[r].stageDetails=R)}};try{for(var j=a(A),B=j.next();!B.done;B=j.next()){var V=_(B.value);if("object"==typeof V)return V.value}}catch(e){n={error:e}}finally{try{B&&!B.done&&(i=j.return)&&i.call(j)}finally{if(n)throw n.error}}yf({statusObject:{drawDetails:k},removePriorValues:S,status:P,event:D});var G=Tf({includePositionAssignments:U,usePublishState:!0,tournamentRecord:w,policyDefinitions:R,event:D}).eventData;return mn({payload:{eventData:G,tournamentId:w.tournamentId},topic:Sd}),t(t({},L),{eventData:G})}var Df="deleteDrawDefinitions",bf="autoSchedulingAudit",Nf="deleteEvents",Mf={AUTO_SCHEDULING_AUDIT:bf,DELETE_EVENTS:Nf,DELETE_DRAW_DEFINITIONS:Df};function Rf(e){var r,n,i,o,u,s,l,c,d,p;if(!e.tournamentRecord)return{error:W};var v="deleteDrawDefinitions",f=null!==(i=e.drawIds)&&void 0!==i?i:[],m=e.event,h=e.autoPublish,g=void 0===h||h,I=e.tournamentRecord,y=e.auditData,U=e.eventId,S=e.force,w=tl({tournamentRecord:I,event:m}).appliedPolicies,T=t(t({},w),e.policyDefinitions),P=Array.isArray(f)?f[0]:void 0;if(!m){if((_=Ld({tournamentRecord:I,eventId:U,drawId:P})).error)return _;m=_.event}var D=[],b=[],N=[];if(!(null==m?void 0:m.drawDefinitions))return On({info:"event has no drawDefinition",result:t({},L),stack:v});var M=m.drawDefinitions.map((function(e){return e.drawId}));if(f.length||(f=M),f=f.filter((function(e){return M.includes(e)})),!f.length)return On({info:"nothing to do; no matching drawIds in event.",result:t({},L),stack:v});var R,A=Ui(_d({event:m}).flightProfile,!1,!0),E=function(e){var t=e.participantId,r=e.drawPosition,n=e.qualifier;return{bye:e.bye,qualifier:n,drawPosition:r,participantId:t}},C=null!=S?S:null===(u=null===(o=null==w?void 0:w[ja])||void 0===o?void 0:o.allowDeletionWithScoresPresent)||void 0===u?void 0:u.drawDefinitions,x=null!==(s=Uv({event:m}))&&void 0!==s?s:{},O=null!==(c=null!==(l=x.drawIds)&&void 0!==l?l:x.drawDetails&&Object.keys(x.drawDetails))&&void 0!==c?c:[],F=[],k=m.drawDefinitions.filter((function(e){var t,r,n,i,a,o,u,s;if(f.includes(e.drawId)){var l=null!==(r=null===(t=Up({event:m,drawDefinition:e}))||void 0===t?void 0:t.matchUps)&&void 0!==r?r:[],c=l.some((function(e){return Bp({score:e.score})}));if(c&&!C)return F.push(e.drawId),!0;var d=e.drawId,p=e.drawType,v=e.drawName,h=null===(n=null==A?void 0:A.flights)||void 0===n?void 0:n.find((function(t){return t.drawId===e.drawId}));h&&(h.drawEntries=null===(i=h.drawEntries)||void 0===i?void 0:i.filter((function(e){return _l.includes(e.entryStatus)}))),O.includes(d)&&(O=O.filter((function(e){return e!==d})),R=!0);var g=null===(o=null===(a=os({stageSequence:1,drawDefinition:e,stage:iu}))||void 0===a?void 0:a.structures)||void 0===o?void 0:o[0],S=g?nf({structureId:g.structureId,tournamentRecord:I,drawDefinition:e}):void 0,w=null===(u=null==S?void 0:S.positionAssignments)||void 0===u?void 0:u.map(E),T=null===(s=os({stage:au,drawDefinition:e}))||void 0===s?void 0:s.structures,P=(null==T?void 0:T.length)?T.map((function(t){var r=t.stageSequence,n=nf({structureId:t.structureId,tournamentRecord:I,drawDefinition:e});return{positionAssignments:null==n?void 0:n.positionAssignments.map(E),stageSequence:r}})):void 0,M={action:Df,payload:{drawDefinitions:[e],eventId:null!=U?U:null==m?void 0:m.eventId,auditData:y}};N.push(M),D.push(xn({tournamentId:I.tournamentId,eventId:null!=U?U:null==m?void 0:m.eventId,qualifyingPositionAssignments:P,positionAssignments:w,auditData:y,drawType:p,drawName:v,drawId:d})),null==l||l.forEach((function(e){var t=e.matchUpId;return b.push(t)}))}return!f.includes(e.drawId)}));if(F.length&&!S)return On({context:{drawIdsWithScoresPresent:F},result:{error:Jr},stack:v});(m.drawDefinitions=k,A)&&Ya({event:m,extension:{name:ao,value:A}});if(ff({tournamentRecord:I}),R){var _,j={};try{for(var B=a(O),V=B.next();!V.done;V=B.next()){var G=V.value;j[G]=null!==(p=null===(d=x.drawDetails)||void 0===d?void 0:d[G])&&void 0!==p?p:{published:!0}}}catch(e){r={error:e}}finally{try{V&&!V.done&&(n=B.return)&&n.call(B)}finally{if(r)throw r.error}}if((_=yf({statusObject:{drawDetails:j},event:m})).error)return{error:_.error}}if((N.length&&mn({topic:od,payload:N}),b.length&&Ep({tournamentId:null==I?void 0:I.tournamentId,matchUpIds:b}),f.forEach((function(e){!function(e){var r=e.tournamentId,n=e.eventId,i=e.drawId;mn({payload:{drawId:i,tournamentId:r,eventId:n},topic:ld,key:i}),In({key:i}),t({},L)}({drawId:e})})),function(e){var r=e.event,n=e.deletedDrawsDetail,i=e.auditData,a=Vn({name:no,element:r}).extension,o=t(t({},i),{deletedDrawsDetail:n}),u={name:no,value:Array.isArray(null==a?void 0:a.value)?null==a?void 0:a.value.concat(o):[o]};jn({element:r,extension:u})}({event:m,deletedDrawsDetail:D,auditData:y}),g&&R)&&(_=Pf({drawIdsToRemove:f,policyDefinitions:T,tournamentRecord:I,event:m})).error)return t(t({},L),{info:_.error});return t({},L)}function Af(e){var t=e.matchUps,r=e.matchUpId;return{matchUp:(t||[]).find((function(e){return e.matchUpId===r}))}}function Ef(e){var t,r,n=e.tournamentParticipants,i=e.afterRecoveryTimes,o=e.contextContent,u=e.contextProfile,s=e.drawDefinition,l=e.matchUpsMap,c=e.matchUpId,d=e.inContext,p=e.context,v=e.event;if(!s)return{error:K};if(!c)return{error:Ze};if("string"!=typeof c)return{error:xr};var f=os({drawDefinition:s}).structures,m=void 0===f?[]:f;u&&!o&&(o=pl({contextProfile:u,drawDefinition:s}));try{for(var h=a(m),g=h.next();!g.done;g=h.next()){var I=g.value,y=Af({matchUps:mp({tournamentParticipants:n,afterRecoveryTimes:i,contextContent:o,drawDefinition:s,contextProfile:u,matchUpsMap:l,inContext:d,structure:I,context:p,event:v}).matchUps,matchUpId:c}).matchUp;if(y)return{matchUp:y,structure:I}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}return{error:Qe}}function Cf(e){var t=e.sourceMatchUp,r=e.targetMatchUp,n=e.structure,i=e.matchUpsMap,a=e.drawPosition,o=r.roundNumber>1&&r.roundNumber-1,u=ml({structureId:n.structureId,matchUpsMap:i});!t&&a&&(t=u.find((function(e){var t=e.drawPositions;return e.roundNumber===o&&(null==t?void 0:t.includes(a))})));var s=null==t?void 0:t.roundPosition,l=s+(s%2?1:-1),c=o&&u.find((function(e){var t=e.roundNumber,r=e.roundPosition;return t===o&&r===l})),d=null==c?void 0:c.matchUpStatus;return{pairedPreviousMatchUp:c,pairedPreviousMatchUpIsDoubleExit:[Vo,Bo].includes(d)}}function xf(e){var t=e.structureId,r=e.matchUpsMap,n=e.matchUp,i=null==n?void 0:n.roundPosition,a=i+(i%2?1:-1),o=ml({matchUpsMap:r,structureId:t}).find((function(e){var t=e.roundNumber,r=e.roundPosition;return t===(null==n?void 0:n.roundNumber)&&r===a}));return{pairedPreviousMatchUp:o}}function Of(e){var r,n=e.inContextDrawMatchUps,i=e.sourceMatchUpStatus,a=e.sourceMatchUpId,o=e.matchUpsMap,u=e.matchUp,s=n.find((function(e){return e.matchUpId===a})),l=xf({structureId:null==s?void 0:s.structureId,matchUp:s,matchUpsMap:o}).pairedPreviousMatchUp;if(s&&l){var c=null==l?void 0:l.matchUpId,d=n.find((function(e){return e.matchUpId===c})),p=(null==s?void 0:s.structureId)===(null==d?void 0:d.structureId)?(null==s?void 0:s.roundPosition)<(null==d?void 0:d.roundPosition)?1:2:s.structureId===(null==d?void 0:d.structureId)?2:1;u.matchUpStatusCodes=(null!==(r=u.matchUpStatusCodes)&&void 0!==r?r:[]).map((function(e){var r=Pi(e)||!isNaN(e)?{code:e}:e;return r.sideNumber===p?t(t({},r),{previousMatchUpStatus:i}):r}))}}function Ff(e){var t=e.inContextDrawMatchUps,r=e.drawPosition,n=e.matchUpId,i=t.filter((function(e){var t=e.winnerMatchUpId;return e.loserMatchUpId===n||t===n})).sort((function(e,t){return e.roundPosition-t.roundPosition}));return t.find((function(e){return e.matchUpId===n})).feedRound?1:i.reduce((function(e,t,n){var i;return(null===(i=t.drawPositions)||void 0===i?void 0:i.includes(r))?n+1:e}),void 0)}function kf(e){var r,n,i,a,o=e.inContextTargetMatchUp,u=e.drawPositionSideIndex,s=e.teamParticipantId,l=e.tournamentRecord,c=e.drawDefinition,d=e.matchUp,p=e.event,v=null===(n=null===(r=null==o?void 0:o.sides)||void 0===r?void 0:r[u])||void 0===n?void 0:n.sideNumber,f=v&&(null===(i=d.sides)||void 0===i?void 0:i.find((function(e){return e.sideNumber===v}))),m=Vn({element:c,name:uo}).extension,h=Ui(((null==m?void 0:m.value)||{})[s],!1,!0);if(f)null===(a=null==d?void 0:d.sides)||void 0===a||a.forEach((function(e){e.sideNumber===v&&(e.lineUp=h)}));else{d.sides=[1,2].map((function(e){var r,n,i=null!==(n=null===(r=d.sides)||void 0===r?void 0:r.find((function(t){return t.sideNumber===e})))&&void 0!==n?n:{};return t(t({},i),{sideNumber:e})}));var g=d.sides.find((function(e){return e.sideNumber===v}));g&&(g.lineUp=h)}Cp({tournamentId:null==l?void 0:l.tournamentId,context:"updateSidLineUp",eventId:null==p?void 0:p.eventId,drawDefinition:c,matchUp:d})}function _f(e){var r,n,i,a,l,c,d,p=e.inContextDrawMatchUps,v=e.sourceMatchUpStatus,f=e.tournamentRecord,m=e.sourceMatchUpId,h=e.drawDefinition,g=e.matchUpStatus,I=e.drawPosition,y=e.matchUpsMap,U=e.matchUpId,S=e.event,w="assignMatchUpDrawPosition";y||(y=fl({drawDefinition:h})),p||(p=null!==(r=Ip({inContext:!0,drawDefinition:h,matchUpsMap:y}).matchUps)&&void 0!==r?r:[]);var T=p.find((function(e){return e.matchUpId===U})),P=null==T?void 0:T.structureId,D=null===(n=null==h?void 0:h.structures)||void 0===n?void 0:n.find((function(e){return e.structureId===P}));if(!D)return{error:De};var b=null===(i=null==y?void 0:y.drawMatchUps)||void 0===i?void 0:i.find((function(e){return e.matchUpId===U})),N=null!==(a=null==b?void 0:b.drawPositions)&&void 0!==a?a:[],M=function(e){var t=e.drawPosition,r=e.drawPositions,n=!1,i=!!(null==r?void 0:r.includes(t));return{updatedDrawPositions:i?r||[]:u(u([],o(r),!1),[void 0,void 0],!1).slice(0,2).map((function(e){return e||i?e:(i=!0,n=!0,t)})).sort(s).filter(Boolean),positionAdded:n,positionAssigned:i}}({drawPosition:I,drawPositions:N}),R=M.positionAdded,A=M.positionAssigned,E=M.updatedDrawPositions,C=ss({drawDefinition:h,structure:D}).positionAssignments,O=null==C?void 0:C.filter((function(e){return E.includes(e.drawPosition)})),F=null==O?void 0:O.find((function(e){return e.bye})),k=(null==b?void 0:b.matchUpStatus)&&[Ko,jo].includes(b.matchUpStatus)&&E.filter(Boolean).length<2;if(g=F&&Fo||g||k&&b.matchUpStatus||(null==b?void 0:b.matchUpStatus)&&[Vo,Bo].includes(b.matchUpStatus)&&b.matchUpStatus||Yo,b&&R){p=null!==(l=Ip({inContext:!0,drawDefinition:h,matchUpsMap:y}).matchUps)&&void 0!==l?l:[];var _=k&&Ff({inContextDrawMatchUps:p,drawPosition:I,matchUpId:U})||void 0;(null==b?void 0:b.matchUpStatusCodes)&&Of({inContextDrawMatchUps:p,sourceMatchUpStatus:v,sourceMatchUpId:m,matchUpsMap:y,matchUp:b}),Object.assign(b,{drawPositions:E,winningSide:_,matchUpStatus:g}),Cp({tournamentId:null==f?void 0:f.tournamentId,eventId:null==T?void 0:T.eventId,context:w,drawDefinition:h,matchUp:b})}var j=Ks({inContextDrawMatchUps:p,inContextMatchUp:T,drawDefinition:h,matchUpId:U}),B=j.targetMatchUps,V=B.winnerMatchUp,G=B.loserMatchUp,q=B.loserTargetDrawPosition,W=j.targetLinks.loserTargetLink,H=ml({structureId:D.structureId,matchUpsMap:y});if(A&&F){if(V)if([Fo,Vo,Bo].includes(g)){if((J=_f({matchUpId:V.matchUpId,inContextDrawMatchUps:p,tournamentRecord:f,drawDefinition:h,drawPosition:I,matchUpsMap:y})).error)return J}else V.structureId!==D.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}else if(V&&T&&!T.feedRound){if(Cf({targetMatchUp:b,drawPosition:I,matchUpsMap:y,structure:D}).pairedPreviousMatchUpIsDoubleExit)if((J=_f({matchUpId:V.matchUpId,inContextDrawMatchUps:p,tournamentRecord:f,drawDefinition:h,drawPosition:I,matchUpsMap:y})).error)return J}if((null==b?void 0:b.matchUpType)===Fs){var z=null==p?void 0:p.find((function(e){return e.matchUpId===b.matchUpId})),Y=(null!==(c=null==z?void 0:z.sides)&&void 0!==c?c:[]).reduce((function(e,t,r){return t.drawPosition===I?r:e}),void 0),K=null===(d=null==C?void 0:C.find((function(e){return e.drawPosition===I})))||void 0===d?void 0:d.participantId;K&&void 0!==Y&&kf({inContextTargetMatchUp:z,drawPositionSideIndex:Y,teamParticipantId:K,tournamentRecord:f,drawDefinition:h,matchUp:b})}if((null==W?void 0:W.linkCondition)===bu&&2===E.filter(Boolean).length&&!F){var J,Z=H.filter((function(e){var t=e.drawPositions;return 1===e.roundNumber&&x(t,E)})),X=Z.every((function(e){var t=e.matchUpStatus;return[_o,Ho].includes(t)}));if(X&&G)if((J=av({drawPosition:q,tournamentRecord:f,drawDefinition:h,structureId:G.structureId,matchUpsMap:y,event:S})).error)return J}return A?t({},L):On({result:{error:ee},context:{drawPosition:I},stack:w})}function Lf(e){var t=e.drawPositions,r=[].concat.apply([],u([],o(t.map((function(e){return t.filter((function(t){return t!==e})).map((function(t){return[e,t]}))}))),!1)),n=U(r.map(jf)).map((function(e){return e.split("|").map((function(e){return+e}))}));return{groupMatchUps:r,uniqueMatchUpGroupings:n}}function jf(e){return u([],o(e),!1).sort(s).join("|")}function Bf(e){var t=e.groupSize,r=e.drawPositionOffset,n=function(e){return u([],o(Array(e)),!1).map((function(e,t){return t}))},i=n(2*Math.round(t/2)+1).slice(1),a=n(i.length-1).map((function(){return[]})),s=i.slice(0,i.length/2),l=i.slice(i.length/2);i.slice(1).forEach((function(e,t){s.forEach((function(e,r){a[t].push([s[r],l[r]])}));var r=s.shift(),n=s.pop(),i=l.shift();s=u([r,i],o(s),!1).filter(Boolean),l=u(u([],o(l),!1),[n],!1).filter(Boolean)}));var c=s.shift(),d=s.pop(),p=l.shift();s=u([c,p],o(s),!1).filter(Boolean),l=u(u([],o(l),!1),[d],!1).filter(Boolean);var v=function(e){return e[0].reduce((function(e,t){return e+t}))};return u([],o(a),!1).reverse().sort((function(e,t){return v(e)-v(t)})).map((function(e){return e.filter((function(e){return e.every((function(e){return e<=t}))})).map((function(e){return jf(e.map((function(e){return e+r})))}))}))}var Vf={getRoundRobinGroupMatchUps:Lf,determineRoundNumber:function(e){var t=e.rounds,r=e.hash;return t.reduce((function(e,t,n){return t.includes(r)?n+1:e}),void 0)},drawPositionsHash:jf,groupRounds:Bf};function Gf(e){var r,n,i,a,s=e.groupNameBase,l=void 0===s?"Group":s,c=e.playoffAttributes,d=e.stageSequence,p=void 0===d?1:d,v=e.structureOptions,f=e.appliedPolicies,m=e.seedingProfile,h=e.stage,g=void 0===h?iu:h,I=e.matchUpType,y=e.roundTarget,U=e.structureId,S=e.groupNames,w=e.drawSize,T=e.idPrefix,P=e.isMock,D=e.uuids,b=null!==(i=null!==(r=e.structureName)&&void 0!==r?r:null===(n=null==c?void 0:c[0])||void 0===n?void 0:n.name)&&void 0!==i?i:ef(iu),N=function(e){e.appliedPolicies;var t=e.structureOptions,r=e.drawSize,n=null==t?void 0:t.groupSize,i=(null==t?void 0:t.groupSizeLimit)||8,a=qf({groupSizeLimit:i,drawSize:r}).validGroupSizes,s=a&&Math.max.apply(Math,u([],o(a),!1)),l=n&&(null==a?void 0:a.includes(n));l||(n=n&&n>4||!(null==a?void 0:a.includes(4))?s:4);var c=Math.ceil(r/n);return{groupSize:n,groupCount:c}}({structureOptions:v,appliedPolicies:f,drawSize:w}),M=N.groupCount,A=N.groupSize,E=$u,C=R(1,M+1).map((function(e){var t,r=function(e){var t=e.structureOrder,r=e.matchUpType,n=e.groupSize,i=e.drawSize,a=e.idPrefix,o=e.isMock,u=e.uuids,s=(t-1)*n,l=R(1+s,n+1+s),c=Lf({drawPositions:l}).uniqueMatchUpGroupings,d=Bf({groupSize:n,drawPositionOffset:s}),p=c.map(f).sort((function(e,t){return(e.roundNumber||1/0)-(t.roundNumber||1/0)}));return p;function v(e){return d.reduce((function(t,r,n){return r.includes(e)?n+1:t}),void 0)}function f(e){var n=v(jf(e)),s=[1,i],l=function(e){var t=e.structureOrder,r=e.drawPositions,n=e.roundNumber,i=e.idPrefix,a=e.uuids;return i?"".concat(i,"-").concat(t,"-").concat(n,"-DP-").concat(r.join("-")):(null==a?void 0:a.pop())||ed()}({structureOrder:t,drawPositions:e,roundNumber:n,idPrefix:a,uuids:u}),c={matchUpStatus:n?Yo:Fo,matchUpType:r,finishingPositionRange:{winner:s,loser:s},drawPositions:e,roundNumber:n,matchUpId:l};return o&&(c.isMock=!0),c}}({groupSize:A,structureOrder:e,matchUpType:I,drawSize:w,idPrefix:T,isMock:P});a=Math.max.apply(Math,u([],o(r.map((function(e){return e.roundNumber}))),!1));var n=null!==(t=null==S?void 0:S[e-1])&&void 0!==t?t:"".concat(l," ").concat(e);return tf({structureId:null==D?void 0:D.pop(),structureType:gu,finishingPosition:E,structureOrder:e,structureName:n,matchUps:r})})),x=tf({structureId:null!=U?U:null==D?void 0:D.pop(),structureType:Iu,finishingPosition:E,seedingProfile:m,structureName:b,stageSequence:p,structures:C,stage:g});return y&&jn({extension:{name:fo,value:y},element:x}),t({structures:[x],maxRoundNumber:a,groupCount:M,links:[],groupSize:A},L)}function qf(e){var r=e.drawSize,n=e.groupSizeLimit,i=R(3,(void 0===n?10:n)+1).filter((function(e){var t=Math.ceil(r/e),n=t*e-r,i=Math.ceil(r/t),a=Math.ceil(n/t);return(!n||n<e)&&i===e&&i>=3&&a<2}));return t(t({},L),{validGroupSizes:i})}function Wf(e){var r=e.roundRobinGroupsCount,n=e.participantsCount,i=e.cluster;if(!I(n))return t({seedBlocks:void 0},On({result:{error:xr},context:{participantsCount:n},stack:"getSeedBlocks"}));var a=h(n);if(r){var o=Math.min(r,a),u=[],s=1;for(R(0,o).forEach((function(){u.push([s]),s++}));s<a;){var l=R(s,s+o);s+=o,u.push(l)}return t(t({},L),{seedBlocks:u})}for(var c=R(1,a+1),d=[],p=a/2,v=function(){var e=O(c,p),t=e.length;e.forEach((function(e,r){var n,a=r<t/2,o=r%2==0,u=e[0],s=e[e.length-1];n=i&&t>4?8===t?a?s:u:o?u:s:a?u:s,x(e,d)||d.push(n)})),p/=2};p>1;)v();for(var f=c.filter((function(e){return!d.includes(e)}));f.length;)f.length%2==0?d.push(f.pop()):d.push(f.shift());var m=R(0,20).map((function(e){return Math.pow(2,e)}));m.unshift(1);var g=m.indexOf(a),y=0,U=[];return R(0,g).forEach((function(e){U.push(d.slice(y,y+m[e])),y+=m[e]})),t(t({},L),{seedBlocks:U})}function Hf(e){var r=e.roundRobinGroupsCount,n=e.drawSize,i="getSeedGroups";if(!I(n))return t({seedGroups:void 0},On({result:{error:xr},context:{drawSize:n},stack:i}));if(r){if(!I(r))return t({seedGroups:void 0},On({context:{roundRobinGroupsCount:r},result:{error:xr},stack:i}));var a=1;return{seedGroups:R(0,Math.floor(n/r)).map((function(){var e=R(a,a+r);return a+=r,e}))}}var o=Wf({participantsCount:n,roundRobinGroupsCount:r}).seedBlocks,u=0;return{seedGroups:(o||[]).map((function(e){return(e||[]).map((function(){return u+=1}))}))}}function zf(e){if(!e)return 1/0;if(I(e))return l(e);var t=e.split("-")[0];return I(t)?l(t):1/0}function Yf(e){var t,r,n=e.positioning,i=e.size,l=function(e){for(var t=e.size,r=[t],n=t;n/2===Math.floor(n/2);)n/=2,r.push(n);return r.includes(1)||r.push(1),r.sort(s),r.reverse(),r}({size:i}),c=[],d=[],p=function(e){return e[0]},v=function(e,t){return(n&&[mu,hu].includes(n)&&t%2?function(e){return e[e.length-1]}(e):p(e))||p(e)},f=function(e,t){if(e.every((function(e){return!d.includes(e)}))){var r=v(e,t);return d.push(r),r}},m=function(e){var t=e.filter((function(e){return!d.includes(e)}));if(t.length)return d.push.apply(d,u([],o(t),!1)),t},h=function(e,t){var r=v(e,t);if(!d.includes(r))return d.push(r),r},g=R(1,i+1);try{for(var I=a(l),y=I.next();!y.done;y=I.next()){var U=y.value;if(1===U){(T=(w=O(g,2)).map(f).filter(Boolean)).length&&c.push(T);var S=w.flatMap(m).filter(Boolean);S.length&&c.push(S)}else{var w,T;(T=(w=O(g,U)).map(h).filter(Boolean)).length&&c.push(T)}}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=I.return)&&r.call(I)}finally{if(t)throw t.error}}return{divisions:l,divisionGroupings:c}}function Kf(e){var t,r,n=e.provisionalPositioning,i=e.returnAllProxies,s=e.appliedPolicies,l=e.seedingProfile,c=e.drawDefinition,d=e.allPositions,p=e.structure,v=[];if(!p)return{error:Ne};var f=mp({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:n,structure:p}),m=f.matchUps,h=f.roundMatchUps,g=ql({provisionalPositioning:n,returnAllProxies:i,drawDefinition:c,structure:p}).seedAssignments,I=ls({structure:p}).positionAssignments,y=null==I?void 0:I.length,U=null!==(t=null==g?void 0:g.length)&&void 0!==t?t:0,S=[],w=Object.keys(h).map((function(e){return parseInt(e)})).sort((function(e,t){return e-t})).map((function(e){var t=h[e].map((function(e){return e.drawPositions})).flat(1/0).filter(Boolean),r=t.filter((function(e){return!S.includes(e)}));return S=S.concat.apply(S,u([],o(t),!1)),r})).filter((function(e){return e.length})).reverse(),T=w.pop(),P=T&&Math.min.apply(Math,u([],o(T),!1))-1||0;l=null!=l?l:null===(r=null==s?void 0:s.seeding)||void 0===r?void 0:r.seedingProfile;var D=(null==T?void 0:T.length)||0,b=w.filter((function(e){return e.filter((function(e){return e<=U})).length})),N=p.stage,M=p.structureType,A=p.roundLimit,E=M===Iu,C=!E&&(null==w?void 0:w.length),x=!E&&N===au&&A,F=b.flat(1/0),k=C?null==F?void 0:F.length:0,_=d?y:U,L=np({drawDefinition:c,structure:p,matchUps:m}),j=L?0:!C&&_||_&&F.length<_&&_-F.length||0;if(x){var B=(null==p?void 0:p.matchUps)?p.matchUps.filter((function(e){return e.roundNumber===p.roundLimit})).length:0,V=T.length/B;if(C);else{var G=Qf(l),q=O(T,V),W=1,H=R(0,q[0].length).map((function(){var e=R(W,W+q.length);return W+=q.length,e}));v=Jf({drawPositionBlocks:q,nonRandom:null==l?void 0:l.nonRandom,positioning:G,seedGroups:H}).validSeedBlocks}}else if(E){var z=function(e){var t,r,n=e.seedingProfile,i=e.structure,a=e.nonRandom,o=i.structures||[],u=o.length,s=null===(t=ss({structure:i}))||void 0===t?void 0:t.positionAssignments,l=Qf(n),c=null!==(r=null==s?void 0:s.length)&&void 0!==r?r:0,d=Hf({roundRobinGroupsCount:u,drawSize:c}).seedGroups,p=o.map((function(e){var t;return null===(t=ss({structure:e}).positionAssignments)||void 0===t?void 0:t.map((function(e){return e.drawPosition}))}));return Jf({drawPositionBlocks:p,positioning:l,seedGroups:d,nonRandom:a})}({nonRandom:null==l?void 0:l.nonRandom,seedingProfile:l,structure:p});v=z.validSeedBlocks}else if(C)v=b.map((function(e){return{seedNumbers:e,drawPositions:e}}));else if(L){(Y=O(T,2).map((function(e,t){return{drawPositions:[e[0]],seedNumbers:[t+1]}}))).forEach((function(e){return v.push(e)}))}if(!E&&!L&&!x){var Y=function(e){var t,r,n=e.drawPositionOffset,i=void 0===n?0:n,o=e.roundRobinGroupsCount,u=e.seedNumberOffset,s=void 0===u?0:u,l=e.seedingProfile,c=e.seedCountGoal,d=e.baseDrawSize,p=1,v=[],f=Wf({cluster:Qf(l)===mu,participantsCount:d,roundRobinGroupsCount:o}).seedBlocks;p=0;try{for(var m=a(f),h=m.next();!h.done;h=m.next()){var g=h.value;if(p+1>c)break;var I=g.map((function(e){return e+i})),y=U(p+1,g.length).map((function(e){return+e+s}));p+=g.length,v.push({drawPositions:I,seedNumbers:y})}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}return{blocks:v};function U(e,t){return Array.from(new Array(t),(function(t,r){return r+e}))}}({drawPositionOffset:P,seedNumberOffset:k,seedCountGoal:j,seedingProfile:l,baseDrawSize:D}).blocks;Y.forEach((function(e){return v.push(e)}))}var K=v.flatMap((function(e){return e.drawPositions})).reduce((function(e,t){return(null==T?void 0:T.includes(t))&&e}),!0);return L||C||E||K?{isLuckyStructure:L,validSeedBlocks:v,isContainer:E,isFeedIn:C}:{error:Se,validSeedBlocks:[],isContainer:E,isFeedIn:C}}function Jf(e){var t=e.drawPositionBlocks,r=e.positioning,n=e.seedGroups,i=e.nonRandom,o=[],u=Yf({size:n.length,positioning:r}).divisionGroupings,s=[];return n.forEach((function(e,n){var l=function(e){var t,r,n=e.blockPattern,i=e.index,o=0;try{for(var u=a(n),s=u.next();!s.done;s=u.next()){var l=s.value;if(o===i)return l;for(var c=0;c<l.length;){if(o===i)return l;o+=1,c++}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}}({blockPattern:u,index:n});e.forEach((function(e,a){var u=n%2?t.length-a-1:a,c=t[u].slice().filter((function(e,t){return l.includes(t+1)&&e}));r!==hu?c=i?c:S(c):n%2&&c.reverse();var d=c.find((function(e){return!s.includes(e)}));d&&(s.push(d),o.push({drawPositions:[d],seedNumbers:[e]}))}))})),{validSeedBlocks:o}}function Zf(e){var t,r,n,i,a,s=e.appliedPolicies,l=e.drawDefinition,c=e.seedBlockInfo,d=e.drawPosition,p=e.structureId,v=e.seedNumber,f=as({drawDefinition:l,structureId:p}).structure;s||(s=tl({drawDefinition:l}).appliedPolicies);var m=null==c?void 0:c.validSeedBlocks;if(!m&&f&&(m=null===(t=Kf({appliedPolicies:s,drawDefinition:l,structure:f}))||void 0===t?void 0:t.validSeedBlocks),null===(n=null===(r=null==s?void 0:s.seeding)||void 0===r?void 0:r.validSeedPositions)||void 0===n?void 0:n.ignore)return!0;if(null===(a=null===(i=null==s?void 0:s.seeding)||void 0===i?void 0:i.validSeedPositions)||void 0===a?void 0:a.strict){var h=m.find((function(e){return e.seedNumbers.includes(v)}));return((null==h?void 0:h.drawPositions)||[]).includes(d)}return[].concat.apply([],u([],o(m.map((function(e){return e.drawPositions}))),!1)).includes(d)}function Xf(e){var t,r,n,i=e.provisionalPositioning,a=e.drawDefinition,s=e.seedingProfile,l=e.seedBlockInfo,c=e.structureId,d=e.randomize,p=as({drawDefinition:a,structureId:c}).structure,v=ql({returnAllProxies:e.returnAllProxies,provisionalPositioning:i,drawDefinition:a,structure:p}).seedAssignments,f=ls({structure:p}).positionAssignments,m=null==f?void 0:f.filter((function(e){var t,r;return null!==(r=null!==(t=e.participantId)&&void 0!==t?t:e.bye)&&void 0!==r?r:e.qualifier})),h=null==m?void 0:m.map((function(e){return e.drawPosition})).filter(Boolean),g=tl({drawDefinition:a}).appliedPolicies,I=((null==l?void 0:l.validSeedBlocks)||p&&(null===(t=Kf({returnAllProxies:e.returnAllProxies,provisionalPositioning:i,appliedPolicies:g,drawDefinition:a,seedingProfile:s,structure:p}))||void 0===t?void 0:t.validSeedBlocks)||[]).filter((function(e){return e.drawPositions.filter((function(e){return!(null==h?void 0:h.includes(e))})).length}))[0],y=null==v?void 0:v.map((function(e){return e.participantId})).filter(Boolean),U=null==f?void 0:f.map((function(e){return e.participantId})).filter(Boolean),w=null==y?void 0:y.filter((function(e){return null==U?void 0:U.includes(e)})),T=null==y?void 0:y.filter((function(e){return!(null==U?void 0:U.includes(e))})),P=null==v?void 0:v.filter((function(e){return null==T?void 0:T.includes(e.participantId)})),D=null==v?void 0:v.filter((function(e){return!e.participantId})),b=((null==P?void 0:P.length)&&P.length>0?P.length:null!==(r=null==D?void 0:D.length)&&void 0!==r?r:0)&&(null==I?void 0:I.drawPositions.filter((function(e){return!(null==h?void 0:h.includes(e))})))||[],N=d?S(b):b,M=[],R=N.map((function(){var e=function(e,t){var r=e.filter((function(e){return!t.includes(e.participantId)})),n=Math.min.apply(Math,u([],o(r.map((function(e){return zf(e.seedValue)}))),!1)),i=r.filter((function(e){return zf(e.seedValue)===n}));return S(i).pop()}(P,M),t=null==e?void 0:e.participantId;return t&&M.push(t),t})).filter(Boolean),A=null==v?void 0:v.filter((function(e){return null==w?void 0:w.includes(e.participantId)})).map((function(e){return e.seedNumber})),E=((null==I?void 0:I.seedNumbers)||[]).filter((function(e){return!(null==A?void 0:A.includes(e))})),C=null==v?void 0:v.filter((function(e){return E.includes(e.seedNumber)})).map((function(e){return e.participantId})),x=null===(n=null==g?void 0:g.seeding)||void 0===n?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:I,unplacedSeedParticipantIds:void 0===x||x?R:C,unplacedSeedNumbers:E,unfilledPositions:N,unplacedSeedAssignments:P}}function Qf(e){return"string"==typeof e?e:"object"==typeof e?e.positioning:void 0}function $f(e){var r,n,i=e.provisionalPositioning,a=e.tournamentRecord,o=e.drawDefinition,u=e.seedingProfile,s=e.participantId,l=e.seedBlockInfo,c=e.structureId,d=e.seedNumber,p=e.seedValue,v=e.eventId,f=e.event,m="assignSeed",h=as({drawDefinition:o,structureId:c}).structure,g=ls({structure:h}).positionAssignments,I=ql({provisionalPositioning:i,drawDefinition:o,structure:h}).seedAssignments,y=I.map((function(e){return e.seedNumber})),U=Av({drawDefinition:o,participantId:s});if(s&&!U)return On({result:{error:At},context:{participantId:s},stack:m});var S,w=f?null===(n=null===(r=_d({event:f}).flightProfile)||void 0===r?void 0:r.flights)||void 0===n?void 0:n.length:0,T=w&&w>1,P=null==g?void 0:g.find((function(e){return e.participantId===s})),D=null==P?void 0:P.drawPosition;if(D&&!Zf({drawPosition:D,drawDefinition:o,seedBlockInfo:l,structureId:c,seedNumber:d}))return On({result:{error:$},context:{assignedDrawPosition:D},info:"invalid seed position",stack:m});return y.includes(d)||I.push({seedNumber:d,seedValue:p}),I.forEach((function(e){e.participantId===s&&e.seedNumber!==d&&(e.participantId=void 0),e.seedNumber===d&&(e.participantId=s,(null==u?void 0:u.groupSeedingThreshold)||T||(e.seedValue=null!=p?p:d),S=!0)})),S?(Fp({tournamentId:null==a?void 0:a.tournamentId,drawDefinition:o,structure:h,eventId:v}),t({},L)):On({result:{error:Ue},stack:m})}function em(e){var t,r,n,i,a,o=e.inContextDrawMatchUps,u=e.drawDefinition,s=e.assignments,l=e.matchUpsMap,c=e.structure,d=null===(t=jp({drawDefinition:u}))||void 0===t?void 0:t.containedStructures,p=(null===(r=null==d?void 0:d[c.structureId])||void 0===r?void 0:r.map((function(e){return e.structureId})))||[];p.push(null==c?void 0:c.structureId);var v=(null==s?void 0:s.map((function(e){return e.drawPosition})))||[],f=null!==(n=null==o?void 0:o.filter((function(e){var t;return p.includes(e.structureId)&&E(null!==(t=e.drawPositions)&&void 0!==t?t:[],v).length})))&&void 0!==n?n:[],m=f.map((function(e){return e.matchUpId})),h=null!==(a=null===(i=null==l?void 0:l.drawMatchUps)||void 0===i?void 0:i.filter((function(e){return m.includes(e.matchUpId)})))&&void 0!==a?a:[];return{drawPositions:v,matchUps:h,targetMatchUps:f}}function tm(e){var t=e.lineUp;if(Array.isArray(t)){var r={},n=U(t.flatMap((function(e){var t=e.collectionAssignments;return null==t?void 0:t.map((function(e){return[e.collectionId,e.collectionPosition].join("|")}))})).filter(Boolean));return n.forEach((function(e){var n=o(e.split("|"),2),i=n[0],a=n[1],u=parseInt(a);hl({collectionPosition:u,collectionId:i,lineUp:t}).assignedParticipantIds.forEach((function(e){r[e]||(r[e]=[]),r[e].push({collectionId:i,collectionPosition:u})}))})),Object.keys(r).map((function(e){return{participantId:e,collectionAssignments:r[e]}}))}}function rm(e){return"".concat(e," must be an array")}function nm(e){var t=e.lineUp;e.tieFormat;var r=[];if(!Array.isArray(t))return r.push(rm("lineUp")),{valid:!1,errors:r,error:xr};var n=t.every((function(e){if("object"!=typeof e)return r.push("lineUp entries must be objects"),!1;var t=e.participantId,n=e.collectionAssignments;return t?"string"!=typeof t?(r.push("participantIds must be strings"),!1):Array.isArray(n)?n.every((function(e){return"object"!=typeof e?(r.push("collectionAssignments must be objects"),!1):"number"==typeof e.collectionPosition||(r.push("collectionPosition must be a number"),!1)})):(r.push(rm("collectionAssignments")),!1):(r.push("Missing participantId"),!1)})),i=U(t.map(Mo)).length===t.length;return i||r.push("Duplicated participantId(s)"),{valid:n&&i,errors:r,error:r.length?xr:void 0}}function im(e){var r=e.drawDefinition,n=e.participantId,i=e.tieFormat,a=e.lineUp;if("object"!=typeof r)return{error:K};if("string"!=typeof n)return{error:_t};var o=nm({lineUp:a,tieFormat:i});if(!o.valid)return o;var u=Vn({element:r,name:uo}).extension,s=(null==u?void 0:u.value)||{};return s[n]=tm({lineUp:a}),jn({element:r,extension:{name:uo,value:s}}),xp({drawDefinition:r}),t({},L)}function am(e){var r,n,i,o=e.inContextDrawMatchUps,u=e.inheritance,s=void 0===u||u,l=e.tournamentRecord,c=e.drawDefinition,d=e.matchUpsMap,p=e.assignments,v=e.structure,f=e.event;if(!c)return{error:K};var m=em({inContextDrawMatchUps:o,matchUpsMap:d,assignments:p,structure:v}),h=m.drawPositions,g=m.matchUps,I=m.targetMatchUps,y=function(e){if(e.matchUpType!==Os)return"continue";(null!==(i=e.sides)&&void 0!==i?i:[]).forEach((function(t,r){var n;if((null==t?void 0:t.drawPosition)&&(null==h?void 0:h.includes(t.drawPosition))){var i=g.find((function(t){return t.matchUpId===e.matchUpId}));if(null===(n=null==i?void 0:i.sides)||void 0===n?void 0:n[r]){if(delete i.sides[r].lineUp,!1===s){var a=e.tieFormat,o=t.participantId;a&&o&&im({drawDefinition:c,participantId:o,lineUp:[],tieFormat:a})}Cp({tournamentId:null==l?void 0:l.tournamentId,context:"resetLineUps",eventId:null==f?void 0:f.eventId,drawDefinition:c,matchUp:i})}}}))};try{for(var U=a(I),S=U.next();!S.done;S=U.next()){y(S.value)}}catch(e){r={error:e}}finally{try{S&&!S.done&&(n=U.return)&&n.call(U)}finally{if(r)throw r.error}}return t({},L)}function om(e){var r,n,i,a=e.provisionalPositioning,o=e.inContextDrawMatchUps,u=e.isQualifierPosition,s=e.sourceMatchUpStatus,l=e.tournamentRecord,c=e.drawDefinition,d=e.seedingProfile,p=e.participantId,v=e.seedBlockInfo,f=e.drawPosition,m=e.matchUpsMap,h=e.structureId,g=e.event,I="assignDrawPosition";if(!p&&!u)return On({result:{error:_t},stack:I});m=null!=m?m:fl({drawDefinition:c}),o||(o=Ip({inContext:!0,drawDefinition:c,matchUpsMap:m}).matchUps);var y=as({drawDefinition:c,structureId:h});if(y.error)return On({result:y,stack:I});var U=y.structure;if(!U)return{error:De};if(ip({drawDefinition:c,structure:U}))return On({result:{error:tt},stack:I});var S=ql({provisionalPositioning:a,drawDefinition:c,structure:U}).seedAssignments,w=null==S?void 0:S.find((function(e){return e.participantId===p})),T=null==w?void 0:w.seedNumber,P=tl({tournamentRecord:l,drawDefinition:c,structure:U,event:g}).appliedPolicies;if(T&&!Zf({seedNumber:T,appliedPolicies:P,drawDefinition:c,seedBlockInfo:v,drawPosition:f,structureId:h}))return On({result:{error:$},context:{drawPosition:f},stack:I});var D=ls({structure:U}).positionAssignments||[],b=null==D?void 0:D.find((function(e){return e.drawPosition===f}));if(!b)return On({result:{error:oe},context:{drawPosition:f},stack:I});if(null==D?void 0:D.map(Mo).includes(p))return On({result:{error:Ht},context:{drawPosition:f},stack:I});var N=function(e){var t=e.bye,r=e.qualifier,n=e.participantId,i=t||r||n;return{containsBye:t,containsQualifier:r,containsParticipant:n,filled:i}}(b),M=N.containsParticipant;if(N.containsBye){var R=dv({inContextDrawMatchUps:o,tournamentRecord:l,drawDefinition:c,drawPosition:f,structureId:h,matchUpsMap:m,event:g});if(R.error)return On({result:R,stack:I})}if(M&&b.participantId!==p){if(Qp({drawDefinition:c,structureId:h}).activeDrawPositions.includes(f))return On({result:{error:ae},stack:I});am({assignments:[b],inContextDrawMatchUps:o,tournamentRecord:l,drawDefinition:c,matchUpsMap:m,structure:U})}if(b.participantId=p,u&&(b.qualifier=!0),((null==U?void 0:U.stageSequence)||0)>1||U.stage&&[ou,su].includes(U.stage)){var A=U.stage===au?au:iu,E=null===(r=c.structures)||void 0===r?void 0:r.find((function(e){return(null==e?void 0:e.stage)===A&&1===(null==e?void 0:e.stageSequence)})),C=(null!==(n=null==E?void 0:E.seedAssignments)&&void 0!==n?n:[]).find((function(e){return e.participantId===p}));if(null==C?void 0:C.participantId){var x=C.participantId,O=C.seedNumber,F=C.seedValue;$f({eventId:null==g?void 0:g.eventId,provisionalPositioning:a,tournamentRecord:l,drawDefinition:c,seedingProfile:d,participantId:x,seedNumber:O,seedValue:F,structureId:h,event:g})}}if(U.structureType!==Iu)!function(e){var r=e.provisionalPositioning,n=e.inContextDrawMatchUps,i=e.sourceMatchUpStatus,a=e.tournamentRecord,o=e.drawDefinition,u=e.drawPosition,s=e.matchUpsMap,l=e.structure,c=e.event,d=mp({provisionalPositioning:r,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:o,matchUpsMap:s,structure:l,event:c}).matchUps,p=Xs({matchUps:d}).roundMatchUps,v=$p({drawPosition:u,matchUps:d}).initialRoundNumber,f=v&&(null==p?void 0:p[v].find((function(e){var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.includes(u)})));if(f){var m=_f({matchUpId:f.matchUpId,inContextDrawMatchUps:n,sourceMatchUpStatus:i,tournamentRecord:a,drawDefinition:o,drawPosition:u,matchUpsMap:s});if(m.error)return On({stack:"assignDrawPositionToMatchUps",context:{drawPosition:u},result:m})}t({},L)}({provisionalPositioning:a,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:l,drawDefinition:c,drawPosition:f,matchUpsMap:m,structure:U,event:g});else{cv({positionAssignments:D,tournamentRecord:l,drawDefinition:c,matchUpsMap:m,structure:U});var k=em({assignments:[b],inContextDrawMatchUps:o,drawDefinition:c,matchUpsMap:m,structure:U}),_=k.drawPositions,j=k.matchUps,B=k.targetMatchUps;if(_&&1===(null==j?void 0:j.length)&&j[0].matchUpType===Fs){var V=(null!==(i=null==B?void 0:B[0].sides)&&void 0!==i?i:[]).reduce((function(e,t,r){return(null==_?void 0:_.includes(t.drawPosition))?r:e}),void 0);kf({inContextTargetMatchUp:B[0],teamParticipantId:p,matchUp:j[0],drawPositionSideIndex:V,tournamentRecord:l,drawDefinition:c})}}return kp({tournamentId:null==l?void 0:l.tournamentId,drawDefinition:c,structure:U,event:g}),t({positionAssignments:D},L)}function um(e){var r=e.participantIdAttributeName,n=void 0===r?"participantId":r,i=e.isQualifierPosition,a=e.positionActionName,o=e.tournamentRecord,u=e.drawDefinition,s=e.participantId,l=e.drawPosition,c=e.structureId,d=e.event,p="positionParticipantAction";if(!u)return{error:K};var v=e.inContextDrawMatchUps,f=e.matchUpsMap;f||(f=fl({drawDefinition:u}),Object.assign(e,{matchUpsMap:f})),v||(v=Ip({inContext:!0,drawDefinition:u,matchUpsMap:f}).matchUps,Object.assign(e,{inContextDrawMatchUps:v}));var m=ss({drawDefinition:u,structureId:c}).positionAssignments,h=null==m?void 0:m.find((function(e){return e.drawPosition===l}));if(null==h?void 0:h.participantId){var g=h.participantId,I=om({inContextDrawMatchUps:v,tournamentRecord:o,drawDefinition:u,participantId:s,drawPosition:l,structureId:c,matchUpsMap:f,event:d});return I.success?w({removedParticipantId:g}):On({result:I,stack:p})}var y=dv({inContextDrawMatchUps:v,tournamentRecord:o,drawDefinition:u,drawPosition:l,structureId:c,matchUpsMap:f,event:d});if(y.error)return On({result:y,stack:p});var U=y.participantId,S=om({inContextDrawMatchUps:v,isQualifierPosition:i,tournamentRecord:o,drawDefinition:u,participantId:s,drawPosition:l,structureId:c,matchUpsMap:f,event:d});return S.success?w({removedParticipantId:U}):On({result:S,stack:p});function w(e){var r,i=e.removedParticipantId,o=as({drawDefinition:u,structureId:c}).structure;_p({drawPositions:[l],structure:o});var d=((r={})[n]=s,r.name=a,r.drawPosition=l,r.structureId=c,r);return Lp({drawDefinition:u,positionAction:d}),On({context:{removedParticipantId:i},result:t({},L),stack:p})}}function sm(e){Object.assign(e,{inContext:!0});var t=lm(e),r=t.matchUp,n=t.error;return{matchUp:Ui(r,!0,!0),error:n}}function lm(e){var t,r,n,i,a,o,u,s=e.participantsProfile,l=e.afterRecoveryTimes,c=e.tournamentRecord,d=e.contextContent,p=e.contextProfile,v=e.drawDefinition,f=e.nextMatchUps,m=e.matchUpId,h=e.inContext,g=e.eventId,I=e.drawId,y=e.event;if(!c)return{error:W};if("string"!=typeof m)return{error:Ze};if(!v||!y){var U=(null!==(r=Kp({tournamentRecord:c,nextMatchUps:f}).matchUps)&&void 0!==r?r:[]).find((function(e){return e.matchUpId===m}));if(!U)return{error:Qe};y=(t=Ld({tournamentRecord:c,eventId:g=U.eventId,drawId:I=U.drawId})).event,v=t.drawDefinition}if(!v)return{error:Z};p&&!d&&(d=pl({tournamentRecord:c,contextProfile:p}));var S={surfaceCategory:null!==(n=null==y?void 0:y.surfaceCategory)&&void 0!==n?n:c.surfaceCategory,indoorOutDoor:null!==(i=null==y?void 0:y.indoorOutdoor)&&void 0!==i?i:c.indoorOutdoor,endDate:null!==(a=null==y?void 0:y.endDate)&&void 0!==a?a:c.endDate,tournamentId:c.tournamentId,eventId:null!=g?g:null==y?void 0:y.eventId,drawId:I},w=qs({participantsProfile:s,tournamentRecord:c,contextProfile:p,inContext:h}).participants,T=void 0===w?[]:w;if(f){var P=(null!==(o=Up({context:h?S:void 0,participants:T,afterRecoveryTimes:l,contextContent:d,contextProfile:p,drawDefinition:v,nextMatchUps:f,inContext:h,event:y}).matchUps)&&void 0!==o?o:[]).find((function(e){return e.matchUpId===m}));return P?{drawDefinition:v,structure:null===(u=null==v?void 0:v.structures)||void 0===u?void 0:u.find((function(e){return e.structureId===P.structureId})),matchUp:P}:{error:Qe}}var D=Ef({context:h?S:void 0,tournamentParticipants:T,afterRecoveryTimes:l,contextContent:d,drawDefinition:v,contextProfile:p,matchUpId:m,inContext:h,event:y});return{matchUp:D.matchUp,structure:D.structure,drawDefinition:v}}function cm(e,t){var r,n;if(!Di(e))return{error:xr};if(!Array.isArray(t))return{error:xr};var i={};try{for(var o=a(t),u=o.next();!u.done;u=o.next()){var s=u.value,l=s.param,c=s.error,d=dm({params:e,param:l,attr:s.attr,error:c});if(null==d?void 0:d.error)return d;i[l]=d}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return i}function dm(e){var r,n=e.params,i=e.param,a=e.attr,o=e.error;if(i===zi&&Di(n.drawDefinition)&&Pi(n.structureId)){var u=(null!==(r=n.drawDefinition.structures)&&void 0!==r?r:[]).find((function(e){return e.structureId===n.structureId}));return!u.length&&o?{error:o}:{structure:u}}return i===Qi?(u=lm(t(t({},n),a))).error&&o?t(t({},u),{error:o}):u:{error:jr,info:{param:i}}}function pm(e){var t=e.removePriorValues,r=e.tournamentRecord,n=e.duplicateValues,i=e.drawDefinition,a=e.disableNotice,o=e.matchUpId,u=e.timeItem,s=e.event,l=Ef({drawDefinition:i,event:s,matchUpId:o}).matchUp;if(!l)return{error:Qe};var c=mf({removePriorValues:t,element:l,duplicateValues:n,timeItem:u});return a||Cp({tournamentId:null==r?void 0:r.tournamentId,eventId:null==s?void 0:s.eventId,context:"addTimeItem",drawDefinition:i,matchUp:l}),c}function vm(e){var t,r,n,i,a,o,u,s,l=da(e,[(t={},t[Fi]=!0,t),(r={},r[ki]=!0,r),(n={},n[Li]=!0,n),(i={},i[Wi]=!0,i)]);if(l.error)return l;var c=cm(e,[(a={},a[ra]=Qi,a.attr=(o={},o[Hi]=!0,o),a)]);if(c.error)return c;var d=e.tournamentRecord,p=e.drawDefinition,v=e.participantId,f=e.matchUpId,m=null===(u=null==c?void 0:c.matchUp)||void 0===u?void 0:u.matchUp,h=null!=m?m:{},g=h.matchUpStatus,I=h.score;if(g&&tu.includes(g)||g&&eu.includes(g)||Bp({score:I}))return{error:ge};var y=bc({matchUp:m});if(null==y?void 0:y.error)return y;var U=null!=y?y:{},S=U.checkedInParticipantIds,w=U.allRelevantParticipantIds;if(!(null==w?void 0:w.includes(v)))return{error:At};if(!(null==S?void 0:S.includes(v)))return{error:qt};var T=Xl({matchUp:m});if(null==T?void 0:T.error)return T;var P=null!=T?T:{},D=P.sideParticipantIds,b=P.nestedIndividualParticipantIds,N=null==D?void 0:D.indexOf(v);return void 0!==N&&[0,1].includes(N)&&(null!==(s=null==b?void 0:b[N])&&void 0!==s?s:[]).forEach((function(e){pm({drawDefinition:p,matchUpId:f,timeItem:{itemType:$l,itemValue:e}})})),pm({tournamentRecord:d,drawDefinition:p,matchUpId:f,timeItem:{itemValue:v,itemType:$l}})}function fm(e){var r,n,i,a,o,u,s,l,c=da(e,[(r={},r[Fi]=!0,r),(n={},n[ki]=!0,n),(i={},i[Li]=!0,i),(a={},a[Wi]=!0,a)]);if(c[ea])return c;var d=cm(e,[(o={},o[ra]=Qi,o.attr=(u={},u[Hi]=!0,u),o)]);if(d[ea])return d;var p=e.tournamentRecord,v=e.drawDefinition,f=e.participantId,m=e.matchUpId,h=bc({matchUp:null===(l=null==d?void 0:d.matchUp)||void 0===l?void 0:l.matchUp});if(null==h?void 0:h.error)return h;var g=null!=h?h:{},I=g.checkedInParticipantIds,y=g.allRelevantParticipantIds;return(null==I?void 0:I.includes(f))?t({},L):(null==y?void 0:y.includes(f))?pm({tournamentRecord:p,drawDefinition:v,matchUpId:m,timeItem:{itemValue:f,itemType:Ql}}):((s={})[ea]=At,s)}function mm(e){var t,r,n,i,a,o,u=da(e,[(t={},t[Li]=!0,t[ki]=!0,t[Wi]=!0,t)]);if(u.error)return u;var s=null!==(n=e.tournamentId)&&void 0!==n?n:e.activeTournamentId,l=null!==(i=e.tournamentRecord)&&void 0!==i?i:s&&(null===(a=e.tournamentRecords)||void 0===a?void 0:a[s]),c=e.participantId,d=e.matchUpId,p=e.drawDefinition;if(!l)return{error:W};var v=null===(o=cm(e,[(r={},r[ra]=Qi,r[ea]=Qe,r)]).matchUp)||void 0===o?void 0:o.matchUp;if(!v)return{error:Qe};var f=bc({matchUp:v}).checkedInParticipantIds;return c&&(void 0===f?[]:f).includes(c)?vm({tournamentRecord:l,drawDefinition:p,participantId:c,matchUpId:d,matchUp:v}):fm({tournamentRecord:l,drawDefinition:p,participantId:c,matchUpId:d,matchUp:v})}function hm(e){var r,n,i,a,s=e.tournamentRecord,l=e.drawDefinition,c=e.tieMatchUpId,d=e.event;if(!s)return{error:W};if(!l)return{error:pe};if(!d)return{error:Ee};var p=fl({drawDefinition:l}),v=Ef({matchUpId:c,drawDefinition:l,matchUpsMap:p}).matchUp;if(!v)return{error:Qe};var f=Ef({tournamentParticipants:s.participants,matchUpId:c,inContext:!0,drawDefinition:l,matchUpsMap:p,event:d}),m=f.matchUp,h=f.structure;if(!m)return{error:Qe};var g=m.collectionPosition,I=m.drawPositions,y=m.collectionId,U=m.matchUpTieId,S=m.matchUpType;if(S&&![Es,xs].includes(S))return{error:tt};var w=ss({structure:h}).positionAssignments,T=null==w?void 0:w.filter((function(e){return null==I?void 0:I.includes(e.drawPosition)})),P=Ef({matchUpId:U,drawDefinition:l,matchUpsMap:p}).matchUp,D=null!==(n=null===(r=null==P?void 0:P.sides)||void 0===r?void 0:r.map(Ri("participantId")))&&void 0!==n?n:[],b=null!==(i=null==T?void 0:T.map(Ri("participantId")))&&void 0!==i?i:[],N=u(u([],o(D),!1),o(b),!1),M=Rv({tournamentRecord:s,participantFilters:{participantTypes:[gs],participantIds:N}}).participants,R=Ef({matchUpId:U,inContext:!0,drawDefinition:l,matchUpsMap:p}).matchUp,A=null===(a=Gd({matchUp:P,drawDefinition:l,structure:h,event:d}))||void 0===a?void 0:a.tieFormat;return t({inContextDualMatchUp:R,inContextTieMatchUp:m,relevantAssignments:T,collectionPosition:g,teamParticipants:M,collectionId:y,matchUpType:S,dualMatchUp:P,tieMatchUp:v,tieFormat:A,structure:h},L)}function gm(e){var r,n,i,o,u,s,l,c,d="addParticipant",p=e.allowDuplicateParticipantIdPairs,v=e.returnParticipant,f=e.disableNotice,m=e.pairOverride,h=e.participant,g=e.tournamentId?null===(i=e.tournamentRecords)||void 0===i?void 0:i[e.tournamentId]:null!==(o=e.tournamentRecord)&&void 0!==o?o:e.activeTournamentId&&(null===(u=e.tournamentRecords)||void 0===u?void 0:u[e.activeTournamentId]);if(!g)return{error:W};if(!h)return On({result:{error:Ft},stack:d});h.participantId||(h.participantId=ed()),g.participants||(g.participants=[]);var I=h.participantId,y=h.individualParticipantIds;if(g.participants.reduce((function(e,t){return t.participantId===I||e}),!1))return{error:jt};var U=h.participantType,S=h.participantRole;if(!U||!Object.keys(Is).includes(U))return{error:xt,participantType:U};if(!S)return{error:Ot};var w=g.participants||[],T=w.filter((function(e){return e.participantType===fs})).map((function(e){return e.participantId}));if(U!==fs&&h.person)return{error:xr,person:h.person};if(y&&!Array.isArray(y))return{error:xr,individualParticipantIds:y};if(U===hs){if(h.person)return{error:xr,person:h.person};if(!h.individualParticipantIds)return On({result:{error:Vt},stack:d});if(2!==h.individualParticipantIds.length&&!m)return On({info:"PAIR must be 2 individualParticipantIds",result:{error:Et},stack:d});var P=w.filter((function(e){return e.participantType===fs})).map((function(e){return e.participantId}));if(!Array.isArray(h.individualParticipantIds))return On({result:{error:Et},stack:d});var D=h.individualParticipantIds.reduce((function(e,t){return P.includes(t)&&e}),!0);if(!D)return On({result:{error:Et},stack:d});var b=w.filter((function(e){return e.participantType===hs})).map((function(e){return{individualParticipantIds:e.individualParticipantIds,participant:e}})),N=h.participantType===hs&&b.find((function(e){return 2===E(e.individualParticipantIds,h.individualParticipantIds).length}));if(N&&!p)return t(t({},L),{existingParticipant:!0,participant:v&&Ui(N.participant)});if(!h.participantName){var M=w.filter((function(e){var t;return null===(t=h.individualParticipantIds)||void 0===t?void 0:t.includes(e.participantId)})),R=M.map((function(e){var t;return null===(t=e.person)||void 0===t?void 0:t.standardFamilyName})).filter(Boolean).join("/");1===M.length&&(R+="/Unknown"),h.participantName=R}}else if(U===fs){if(!(null===(s=h.person)||void 0===s?void 0:s.standardFamilyName)||!(null===(l=h.person)||void 0===l?void 0:l.standardGivenName))return{error:Wt};if(!h.participantName){R="".concat(h.person.standardFamilyName.toUpperCase(),", ").concat(h.person.standardGivenName);h.participantName=R}}else{if(!U||![gs,ms].includes(U))return{error:xt};if(y||(h.individualParticipantIds=[]),null===(c=h.individualParticipantIds)||void 0===c?void 0:c.length)try{for(var A=a(h.individualParticipantIds),C=A.next();!C.done;C=A.next()){var x=C.value;if("string"!=typeof x)return On({result:{participantId:x,error:xr},stack:d});if(!T.includes(x))return On({result:{participantId:x,error:Lt},stack:d})}}catch(e){r={error:e}}finally{try{C&&!C.done&&(n=A.return)&&n.call(A)}finally{if(r)throw r.error}}}return g.participants.push(h),f||mn({payload:{tournamentId:g.tournamentId,participants:[h]},topic:nd}),xn(t({participant:v&&Ui(h)},L))}function Im(e){var n,i,a=e.inContextDualMatchUp,o=e.drawDefinition,u=e.tournamentId,s=e.dualMatchUp,l=e.eventId;if(s){a||(a=null===(n=Ef({matchUpId:s.matchUpId,inContext:!0,drawDefinition:o}))||void 0===n?void 0:n.matchUp);var c=Vn({element:o,name:uo}).extension,d=Ui((null==c?void 0:c.value)||{},!1,!0);s.sides=null===(i=null==a?void 0:a.sides)||void 0===i?void 0:i.map((function(e){var n,i,a=e.participantId,o=a&&d[a]||void 0,u=null!==(i=null===(n=s.sides)||void 0===n?void 0:n.find((function(t){return t.sideNumber===e.sideNumber})))&&void 0!==i?i:{},l=u.lineUp,c=r(u,["lineUp"]),p=(null==l?void 0:l.length)?l:o;return t(t(t({},function(e){var t=e.displaySideNumber;return{drawPosition:e.drawPosition,sideNumber:e.sideNumber,displaySideNumber:t}}(e)),c),{lineUp:p})})),Cp({context:"ensureSidLineUps",matchUp:s,drawDefinition:o,tournamentId:u,eventId:l})}}function ym(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,S,w,T,P,D,b,N,M,R=hm(e);if(R.error)return R;var A="replaceTieMatchUpParticipantid",E=e.existingParticipantId,C=e.tournamentRecord,x=e.newParticipantId,O=e.drawDefinition,F=e.substitution,k=e.event;if(!E||!x)return On({result:{error:_t},stack:A});if(E===x)return t({},L);var _=R.inContextDualMatchUp,j=R.inContextTieMatchUp,B=R.collectionPosition,V=R.collectionId,G=R.dualMatchUp,q=R.tieMatchUp,W=R.tieFormat,H=null==j?void 0:j.matchUpType,z=null===(i=null==j?void 0:j.sides)||void 0===i?void 0:i.find((function(e){var t,r,n;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===E||(null===(n=null===(r=e.participant)||void 0===r?void 0:r.individualParticipantIds)||void 0===n?void 0:n.includes(E))}));if(!z)return{error:Lt};var Y=null!==(l=null===(s=Rv({tournamentRecord:C,participantFilters:{participantIds:[E,x]}}))||void 0===s?void 0:s.participants)&&void 0!==l?l:[];if(2!==Y.length)return On({result:{error:_t},stack:A});if(Y[0].participantType!==Y[1].participantType)return On({result:{error:xt},stack:A});var K=tl({tournamentRecord:C,drawDefinition:O,event:k}).appliedPolicies,J=null!==(p=null!==(d=null===(c=e.policyDefinitions)||void 0===c?void 0:c[Ca])&&void 0!==d?d:null==K?void 0:K[Ca])&&void 0!==p?p:jv[Ca],Z=Y.find((function(e){return e.participantId===x}));if(!1!==(null!==(v=e.enforceGender)&&void 0!==v?v:null===(f=null==J?void 0:J.participants)||void 0===f?void 0:f.enforceGender)&&[cp,vp].includes(null==j?void 0:j.gender)&&(null==j?void 0:j.gender)!==(null===(m=null==Z?void 0:Z.person)||void 0===m?void 0:m.sex))return{error:Rt,info:"Gender mismatch"};var X=null===(h=null==J?void 0:J.processCodes)||void 0===h?void 0:h.substitution;Im({tournamentId:C.tournamentId,eventId:k.eventId,inContextDualMatchUp:_,drawDefinition:O,dualMatchUp:G});var Q=null===(g=null==G?void 0:G.sides)||void 0===g?void 0:g.find((function(e){return e.sideNumber===z.sideNumber}));if(!Q)return On({result:{sideNumber:z.sideNumber,existingParticipantId:E,error:jr},stack:A});var $=null===(I=null==j?void 0:j.sides)||void 0===I?void 0:I.flatMap((function(e){var t,r;return(null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds)||(null===(r=e.participant)||void 0===r?void 0:r.participantId)||[]}));if(null==$?void 0:$.includes(x))return On({result:{error:zt},stack:A});var ee=null===(S=null===(y=null==_?void 0:_.sides)||void 0===y?void 0:y.find((function(e){return e.sideNumber===z.sideNumber})))||void 0===S?void 0:S.participantId,te=Q.lineUp,re=null==te?void 0:te.find((function(e){var t=e.participantId;return x===t})),ne=null==te?void 0:te.reduce((function(e,t){return t.substitutionOrder>e?t.substitutionOrder:e}),0),ie=null!==(w=null==te?void 0:te.map((function(e){var r,n=Ui(e,!1,!0);if(![E,x].includes(n.participantId))return n;if(!F&&[E,x].includes(n.participantId)&&(n.collectionAssignments=null===(r=n.collectionAssignments)||void 0===r?void 0:r.filter((function(e){return!(e.collectionPosition===B&&e.collectionId===V)}))),F&&E===n.participantId&&(n.collectionAssignments=n.collectionAssignments.map((function(e){return e.collectionPosition===B&&e.collectionId===V&&void 0===e.substitutionOrder?t(t({},e),{substitutionOrder:ne}):e}))),n.participantId===x){n.collectionAssignments||(n.collectionAssignments=[]);var i={collectionId:V,collectionPosition:B};F&&(i.previousParticipantId=E,i.substitutionOrder=(null!=ne?ne:0)+1),n.collectionAssignments.push(i)}return n})))&&void 0!==w?w:[];if(!re){var ae={collectionId:V,collectionPosition:B};F&&(ae.substitutionOrder=(null!=ne?ne:0)+1,ae.previousParticipantId=E);var oe={collectionAssignments:[ae],participantId:x};ie.push(oe)}var ue,se,le=H===xs,ce=hl({lineUp:te,collectionPosition:B,collectionId:V}).assignedParticipantIds,de=hl({lineUp:ie,collectionPosition:B,collectionId:V}).assignedParticipantIds;if(Q.lineUp=ie,ee&&W){if((pe=im({participantId:ee,lineUp:ie,drawDefinition:O,tieFormat:W})).error)return On({result:pe,stack:A})}else console.log("team participantId not found");if(le){var pe,ve=e.tournamentRecord;if(!(pe=gl({participantIds:de,tournamentRecord:ve})).participant){var fe=gm({returnParticipant:!0,pairOverride:!0,tournamentRecord:ve,participant:{participantRole:Vv,individualParticipantIds:de,participantType:hs}});if(fe.error)return On({result:fe,stack:A});ue=null===(T=fe.participant)||void 0===T?void 0:T.participantId}var me=null===(P=(pe=gl({participantIds:ce,tournamentRecord:ve})).participant)||void 0===P?void 0:P.participantId;if(me)Kv({participantIds:[me],tournamentRecord:ve}).success&&(se=me)}if(F||1===(null===(D=z.substitutions)||void 0===D?void 0:D.length)){if(F)X&&q&&(q.processCodes=U(u(u([],o(null!==(b=null==q?void 0:q.processCodes)&&void 0!==b?b:[]),!1),o(X),!1)));else try{for(var he=a(X||[]),ge=he.next();!ge.done;ge=he.next()){var Ie=ge.value,ye=null===(N=null==q?void 0:q.processCodes)||void 0===N?void 0:N.lastIndexOf(Ie);void 0!==ye&&(null===(M=null==q?void 0:q.processCodes)||void 0===M||M.splice(ye,1))}}catch(e){r={error:e}}finally{try{ge&&!ge.done&&(n=he.return)&&n.call(he)}finally{if(r)throw r.error}}q&&Cp({tournamentId:null==C?void 0:C.tournamentId,matchUp:q,context:A,drawDefinition:O})}return G&&Cp({tournamentId:null==C?void 0:C.tournamentId,matchUp:G,context:A,drawDefinition:O}),t(t({},L),{modifiedLineUp:ie,participantRemoved:se,participantAdded:ue})}function Um(e){var r,n=e.collectionPosition,i=e.teamParticipantId,a=e.dualMatchUpSide,o=e.drawDefinition,u=e.participantIds,s=e.collectionId;if(!s||!n||!Array.isArray(u))return{modifiedLineUp:(null==a?void 0:a.lineUp)||[],error:xr};var l=(null==a?void 0:a.lineUp)||(null===(r=Il({participantId:i,drawDefinition:o}))||void 0===r?void 0:r.lineUp),c=[],d=[],p=(null==l?void 0:l.map((function(e){var r;if(!u.includes(e.participantId))return e;var i=null===(r=e.collectionAssignments)||void 0===r?void 0:r.filter((function(r){var i=r.collectionId===s&&r.collectionPosition===n;return i&&(r.previousParticipantId&&c.push(r.previousParticipantId),d.push(t({participantId:e.participantId},r))),!i}));return{participantId:e.participantId,collectionAssignments:i}})).filter(Boolean))||[];return{modifiedLineUp:p,assignmentsRemoved:d,previousParticipantIds:c}}function Sm(e){var r,n,i=e.individualParticipantIds,s=e.groupingParticipantId,l=e.removeFromOtherTeams,c=e.tournamentRecord,d="addIndividualParticipantIds";if(!c)return On({result:{error:W},stack:d});if(!s||!i)return On({result:{error:pt},stack:d});var p=null!==(n=c.participants)&&void 0!==n?n:[],v=p.find((function(e){return e.participantId===s}));if(!v)return On({result:{error:Lt},stack:d});if((null==v?void 0:v.participantType)&&![gs,ms].includes(v.participantType))return On({context:{participantType:v.participantType},result:{error:xt},stack:d});var f=i.filter((function(e){var t=p.find((function(t){return t.participantId===e}));return(null==t?void 0:t.participantType)!==fs}));if(f.length)return On({result:{error:Et,invalidParticipantIds:f},stack:d});v.individualParticipantIds||(v.individualParticipantIds=[]);var m=v.individualParticipantIds,h=i.filter((function(e){return!m.includes(e)}));if(h.length&&(l&&Yv({individualParticipantIds:h,tournamentRecord:c}),v.individualParticipantIds=(r=v.individualParticipantIds).concat.apply(r,u([],o(h),!1))),Un().topics.includes(md)){var g=p.find((function(e){return e.participantId===s}));mn({topic:md,payload:{participants:[g]}})}return function(e){var r,n,i,o,u=e.individualParticipantIds,s=e.groupingParticipantId,l=(e.tournamentRecord.events||[]).filter((function(e){var t;return(null==e?void 0:e.eventType)===ga&&(null===(t=null==e?void 0:e.entries)||void 0===t?void 0:t.some((function(e){return e.participantId===s})))})),c=function(e){return!u.includes(e.participantId)};try{for(var d=a(l),p=d.next();!p.done;p=d.next()){var v=p.value;v.entries=(v.entries||[]).filter(c);var f=_d({event:v}).flightProfile;null===(i=null==f?void 0:f.flights)||void 0===i||i.forEach((function(e){e.drawEntries=(e.drawEntries||[]).filter(c)})),null===(o=null==v?void 0:v.drawDefinitions)||void 0===o||o.forEach((function(e){e.entries=(e.entries||[]).filter(c)}))}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}t({},L)}({individualParticipantIds:i,groupingParticipantId:s,tournamentRecord:c}),t({groupingParticipant:Ui(v,!1,!0),added:h.length},L)}function wm(e){var r=e.updateParticipantName,n=void 0===r||r,i=e.groupingParticipantId,a=e.removeFromOtherTeams,o=e.tournamentRecord,u=e.pairOverride,s=e.participant;if(!o)return{error:W};if(!s)return{error:Ft};if(!s.participantId)return gm({tournamentRecord:o,participant:s});var l=Ps({participantId:s.participantId,tournamentRecord:o}).participant;if(!l)return gm({tournamentRecord:o,participant:s});var c=s.participantRoleResponsibilties,d=s.individualParticipantIds,p=s.participantOtherName,v=s.participantName,f=s.participantRole,m=s.participantType,h=s.onlineResources,g=s.contacts,I=s.person;if(m&&l.participantType!==m)return{error:bt};var y={};if(g&&(y.contacts=g),h&&(y.onlineResources=h),v&&"string"==typeof v&&(y.participantName=v),p&&"string"==typeof p&&(y.participantOtherName=p),Array.isArray(d)){var U=Rv({participantFilters:{participantTypes:[fs]},tournamentRecord:o}).participants,S=null==U?void 0:U.map(Mo);if(S){var w=d.filter((function(e){return"string"==typeof e&&S.includes(e)}));([ms,Fs].includes(m||l.participantType)||m===hs&&(2===w.length||u))&&(y.individualParticipantIds=w),l.participantType===Is.PAIR&&n&&(y.participantName=function(e){var t=e.individualParticipants,r=e.newValues,n=r.individualParticipantIds,i=t.filter((function(e){var t=e.participantId;return n.includes(t)})).map((function(e){var t=e.person;return null==t?void 0:t.standardFamilyName})).filter(Boolean).sort().join("/");1===n.length&&(i+="/Unknown");return i}({individualParticipants:U,newValues:y}))}}return Object.keys(Wv).includes(f)&&(y.participantRole=f),Object.keys(Is).includes(m)&&(y.participantType=m),Array.isArray(c)&&(y.participantRoleResponsibilties=c),l.participantType===Is.INDIVIDUAL&&I&&function(e){var t,r=e.updateParticipantName,n=e.existingParticipant,i=e.newValues,a=e.person,o={},u=a.standardFamilyName,s=a.standardGivenName,l=a.nationalityCode,c=a.personId,d=a.sex;d&&Object.keys(fp).includes(d)&&(o.sex=d);c&&"string"==typeof c&&(o.personId=c);l&&"string"==typeof l&&(p=l,ws.flatMap((function(e){return[e.iso,e.ioc]})).filter(Boolean).includes(p)||""===l)&&(o.nationalityCode=l);var p;u&&"string"==typeof u&&u.length>1&&(o.standardFamilyName=u,t=!0);s&&"string"==typeof s&&s.length>1&&(o.standardGivenName=s,t=!0);if(t&&r){var v="".concat(o.standardGivenName," ").concat(o.standardFamilyName);i.participantName=v}Object.assign(n.person,o)}({updateParticipantName:n,existingParticipant:l,newValues:y,person:I}),Object.assign(l,xn(y)),i&&Sm({individualParticipantIds:[l.participantId],groupingParticipantId:i,removeFromOtherTeams:a,tournamentRecord:o}),mn({topic:md,payload:{tournamentId:o.tournamentId,participants:[l]}}),t({participant:Ui(l)},L)}function Tm(e){var r,n,i,o,u,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D,b=hm(e);if(b.error)return b;var N="assignTieMatchUpParticipantId",M=e.teamParticipantId,R=e.tournamentRecord,A=e.drawDefinition,E=e.participantId,C=e.event;if(!E)return On({result:{error:_t},stack:N});if(e.sideNumber&&![1,2].includes(e.sideNumber))return On({result:{error:lt},stack:N});var O=b.inContextDualMatchUp,F=b.inContextTieMatchUp,k=b.relevantAssignments,_=b.collectionPosition,j=b.teamParticipants,B=b.collectionId,V=b.matchUpType,G=b.dualMatchUp,q=b.tieFormat,W=null===(i=null==F?void 0:F.sides)||void 0===i?void 0:i.flatMap((function(e){var t,r;return(null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds)||(null===(r=e.participant)||void 0===r?void 0:r.participantId)||[]}));if(null==W?void 0:W.includes(E))return On({result:t({},L),stack:N});M=null!=M?M:e.sideNumber?null===(u=null===(o=null==O?void 0:O.sides)||void 0===o?void 0:o.find((function(t){return t.sideNumber===e.sideNumber})))||void 0===u?void 0:u.participantId:void 0;var H=null===(l=null===(s=Rv({participantFilters:{participantIds:[E]},tournamentRecord:R}))||void 0===s?void 0:s.participants)||void 0===l?void 0:l[0];if(!H)return On({result:{error:Lt},stack:N});var z=tl({tournamentRecord:R,drawDefinition:A,event:C}).appliedPolicies,Y=null!==(p=null!==(d=null===(c=e.policyDefinitions)||void 0===c?void 0:c[Ca])&&void 0!==d?d:null==z?void 0:z[Ca])&&void 0!==p?p:jv[Ca];if(!1!==(null!==(v=e.enforceGender)&&void 0!==v?v:null===(f=null==Y?void 0:Y.participants)||void 0===f?void 0:f.enforceGender)&&[cp,vp].includes(null==F?void 0:F.gender)&&(null==F?void 0:F.gender)!==(null===(m=H.person)||void 0===m?void 0:m.sex))return{error:Rt,info:"Gender mismatch"};var K=H.individualParticipantIds,J=H.participantType;if(V===Es&&J!==fs)return{error:xt};var Z=J===fs?[E]:K,X=M&&(null==j?void 0:j.find((function(e){return e.participantId===M})))||(null==j?void 0:j.find((function(e){var t=e.individualParticipantIds;return x(Z,t)})));if(!X)return{error:Fr};if(M||(M=X.participantId),!M)return{error:Lt};var Q=null==k?void 0:k.find((function(e){return e.participantId===(null==X?void 0:X.participantId)})),$=null==Q?void 0:Q.drawPosition,ee=null===(g=null===(h=null==G?void 0:G.sides)||void 0===h?void 0:h.find((function(e){return e.participantId===M})))||void 0===g?void 0:g.sideNumber,te=null===(y=null===(I=null==F?void 0:F.sides)||void 0===I?void 0:I.find((function(e){return $&&e.drawPosition===$})))||void 0===y?void 0:y.sideNumber,re=null!==(U=null!=ee?ee:te)&&void 0!==U?U:e.sideNumber;if(!q)return{error:Je};if(!(null===(S=q.collectionDefinitions)||void 0===S?void 0:S.find((function(e){return e.collectionId===B}))))return{error:Ke};Im({tournamentId:R.tournamentId,eventId:C.eventId,inContextDualMatchUp:O,drawDefinition:A,dualMatchUp:G});var ne=null===(w=null==G?void 0:G.sides)||void 0===w?void 0:w.find((function(e){return e.sideNumber===re})),ie=null===(T=null==F?void 0:F.sides)||void 0===T?void 0:T.find((function(e){return e.sideNumber===re})),ae=null!==(P=null==ne?void 0:ne.lineUp)&&void 0!==P?P:null===(D=Il({participantId:M,drawDefinition:A}))||void 0===D?void 0:D.lineUp,oe=null==ae?void 0:ae.filter((function(e){var t;return null===(t=e.collectionAssignments)||void 0===t?void 0:t.find((function(e){return e.collectionPosition===_&&e.collectionId===B&&!e.previousParticipantId}))})),ue=null==oe?void 0:oe.map((function(e){return null==e?void 0:e.participantId})),se=(null==ue?void 0:ue.length)>1&&ue||(J===hs?H.individualParticipantIds:[E]),le=Um({collectionPosition:_,teamParticipantId:M,dualMatchUpSide:ne,drawDefinition:A,participantIds:se,collectionId:B});if(le.error)return On({result:le,stack:N});var ce,de=le.modifiedLineUp;if(V===xs){if(J!==hs){var pe;if(null==(pe=Pm({collectionPosition:_,teamParticipantId:M,drawDefinition:A,modifiedLineUp:de,participantId:E,collectionId:B,tieFormat:q}))?void 0:pe.error)return On({result:pe,stack:N});if(pe=function(e){var r,n=e.side;if(n.participant){var i=n.participant.individualParticipantIds||[];if(1===i.filter(Boolean).length){var a=gl({participantIds:i,tournamentRecord:R}).participant;if(i.push(E),!gl({participantIds:i,tournamentRecord:R}).participant&&a){if(a.individualParticipantIds=i,(o=wm({pairOverride:!0,tournamentRecord:R,participant:a})).error)return o}else r=null==a?void 0:a.participantId}}else{var o;if((o=gm({participant:{individualParticipantIds:[E],participantRole:Vv,participantType:hs},pairOverride:!0,tournamentRecord:R})).error)return o}return t(t({},L),{deletedParticipantId:r})}({side:ie}),pe.error)return pe;ce=pe.deletedParticipantId,ne&&(ne.lineUp=de),G&&Cp({tournamentId:null==R?void 0:R.tournamentId,matchUp:G,context:N,drawDefinition:A})}else if(J===hs)try{for(var ve=a(se),fe=ve.next();!fe.done;fe=ve.next()){var me=fe.value;Pm({collectionPosition:_,teamParticipantId:M,drawDefinition:A,modifiedLineUp:de,participantId:me,collectionId:B,tieFormat:q})}}catch(e){r={error:e}}finally{try{fe&&!fe.done&&(n=ve.return)&&n.call(ve)}finally{if(r)throw r.error}}}else if(null==(pe=Pm({collectionPosition:_,teamParticipantId:M,drawDefinition:A,modifiedLineUp:de,participantId:E,collectionId:B,tieFormat:q}))?void 0:pe.error)return pe;(ne&&(ne.lineUp=de),G&&Cp({tournamentId:null==R?void 0:R.tournamentId,matchUp:G,context:N,drawDefinition:A}),ce)&&(Kv({participantIds:[ce],tournamentRecord:R}).error&&console.log("cleanup"));return t(t({},L),{modifiedLineUp:de})}function Pm(e){var t,r,n=e.collectionPosition,i=e.teamParticipantId,a=e.drawDefinition,o=e.modifiedLineUp,u=e.participantId,s=e.collectionId,l=e.tieFormat,c=null===(t=Il({participantId:i,drawDefinition:a}))||void 0===t?void 0:t.lineUp,d=null===(r=o||c)||void 0===r?void 0:r.find((function(e){return(null==e?void 0:e.participantId)===u})),p={collectionId:s,collectionPosition:n};if(d)d.collectionAssignments.push(p);else{var v={collectionAssignments:[p],participantId:u};o.push(v)}return im({participantId:i,lineUp:o,drawDefinition:a,tieFormat:l})}function Dm(e){var r,n,i=e.collectionValueProfiles,o=e.matchUpCount,u=[];if(!Array.isArray(i))return u.push("collectionValueProfiles is not an array: ".concat(i)),{errors:u};if(i.length&&i.length!==o)return u.push("collectionValueProfiles do not align with matchUpsCount"),{errors:u};try{for(var s=a(i),l=s.next();!l.done;l=s.next()){var c=l.value;if("object"!=typeof c)return u.push("valueProfile is not type object: ".concat(c)),{errors:u};var d=c.matchUpValue,p=c.collectionPosition;if("number"!=typeof d||"number"!=typeof p||p>o||p<1)return u.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:u}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}var v=i.map((function(e){return e.collectionPosition}));return v.length!==U(v).length?(u.push("collectionPositions are not unique"),{errors:u}):t({},L)}function bm(e){if(e)return Ui(e,!1,!0)}function Nm(e){var r=e.collectionGroups,n=void 0===r?[]:r,i=Object.assign.apply(Object,u([{}],o(n.filter((function(e){return I(null==e?void 0:e.groupValue)&&(null==e?void 0:e.groupNumber)})).map((function(e){var r;return(r={})[e.groupNumber]=t(t({},e),{allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}),r}))),!1));return{groupValueGroups:i,groupValueNumbers:Object.keys(i).map((function(e){return l(e)}))}}function Mm(e){var r,n,i,o,u,s,l,c,d=e.collectionDefinitions,p=void 0===d?[]:d,v=e.collectionGroups,f=void 0===v?[]:v,m=0,h=Nm({collectionGroups:f}).groupValueNumbers;try{for(var g=a(p||[]),y=g.next();!y.done;y=g.next()){var U=y.value,S=U.collectionValueProfiles,w=U.collectionGroupNumber,T=U.collectionValue,P=U.matchUpCount,D=U.matchUpValue,b=U.scoreValue,N=U.setValue,M=w&&h.includes(w);if(I(N||b))c=!0;else{if(M)continue;if("number"==typeof T&&I(T))m+=T;else if(null==S?void 0:S.length)try{for(var R=(i=void 0,a(S)),A=R.next();!A.done;A=R.next()){m+=A.value.matchUpValue}}catch(e){i={error:e}}finally{try{A&&!A.done&&(o=R.return)&&o.call(R)}finally{if(i)throw i.error}}else"number"==typeof D&&I(D)&&(m+=(null!=P?P:0)*D)}}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}try{for(var E=a(f),C=E.next();!C.done;C=E.next()){m+=null!==(l=C.value.groupValue)&&void 0!==l?l:0}}catch(e){u={error:e}}finally{try{C&&!C.done&&(s=E.return)&&s.call(E)}finally{if(u)throw u.error}}if(c||!m)return t({aggregateValue:!0},L);var x=Math.floor(m/2)+1;return t({valueGoal:x},L)}function Rm(e){var r,n,i,a,o=e.drawDefinition,u=e.structureId,s=e.matchUpId,l=e.structure,c=e.matchUp,d=e.eventId,p=e.event,v="getTieFormat";if(u=null!==(r=null==l?void 0:l.structureId)&&void 0!==r?r:u,((s=null!==(n=null==c?void 0:c.matchUpId)&&void 0!==n?n:s)||u)&&!o)return{error:K};if(d&&p)a=Bd(p);else if(s){if(o&&(!c||!l)){if((f=Ef({drawDefinition:o,matchUpId:s})).error)return f;if((null===(i=f.matchUp)||void 0===i?void 0:i.matchUpType)!==Os)return On({result:{error:tt},stack:v});l||(l=f.structure),c||(c=f.matchUp)}a=Vd({item:c,drawDefinition:o,structure:l,event:p})||Vd({item:l,drawDefinition:o,structure:l,event:p})||Bd(o)||Bd(p)}else if(o&&u){if(!l){var f;if((f=as({drawDefinition:o,structureId:u})).error)return f;l=null==f?void 0:f.structure}a=Vd({item:l,drawDefinition:o,structure:l,event:p})||Bd(o)||Bd(p)}else a=Bd(o)||Bd(p);return a?t(t({},L),{structure:l,tieFormat:a,matchUp:c}):On({result:{error:Je},stack:v})}function Am(e,t){if(((null==e?void 0:e.bestOf)||(null==e?void 0:e.exactly))&&(null==e?void 0:e.setFormat))return function(e,t){var r,n=Em(e.bestOf)||void 0,i=Em(e.exactly)||void 0,a=n||i;if((null===(r=e.setFormat)||void 0===r?void 0:r.timed)&&e.simplified&&1===a)return Cm(e.setFormat);var o=a&&"".concat(Kd).concat(a)||"",u=xm(e.setFormat,t),s=u&&"S:".concat(u)||"",l=xm(e.finalSetFormat,t),c=a&&a>1&&l&&u!==l&&"F:".concat(l)||"";if(o&&u)return[o,s,c].filter((function(e){return e})).join("-");return}(e,t)}function Em(e){return!isNaN(Number(e))&&Number(e)}function Cm(e){var t="T".concat(e.minutes);return e.based&&(t+=e.based),e.modifier&&(t+="@".concat(e.modifier)),t}function xm(e,t){if("object"==typeof e&&Object.keys(e).length){if(e.timed)return Cm(e);if(e.tiebreakSet)return Om(e.tiebreakSet);var r=Em(e.setTo);if(r){var n=e.NoAD&&Yd||"",i=Om(e.tiebreakFormat),a=i&&"/".concat(i)||"",o=Em(e.tiebreakAt),u=o&&(o!==r||t)&&"@".concat(o)||"";if(!1!==i)return"".concat(r).concat(n).concat(a).concat(u)}}}function Om(e){if(e){if("object"!=typeof e||e.tiebreakTo){if("object"==typeof e&&Em(e.tiebreakTo)){var t="TB".concat(e.tiebreakTo).concat(e.NoAD?Yd:"");return e.modifier&&(t+="@".concat(e.modifier)),t}return!1}return""}}function Fm(e){var t=e.matchUpFormat;if("string"!=typeof t)return!1;var r=Zd(t),n=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),i=null==n?void 0:n[1],a=null==n?void 0:n[2],o=null==n?void 0:n[3],u=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=null==u?void 0:u[1],l=null==u?void 0:u[2],c=null==u?void 0:u[3];return Am(r,!!(n&&a&&i===o||u&&l&&s===c))===t}var km="MIXED events can not contain mixed singles or { gender: ANY } collections",_m="events with { gender: ANY } can not contain MIXED singles collections";function Lm(e){var t="tieFormatGenderValidityCheck",r=e.referenceGender,n=e.matchUpType,i=e.gender;return r&&i&&[cp,vp].includes(r)&&r!==i?On({result:{valid:!1,error:Er},context:{gender:i},stack:t}):r===dp&&(i===lp||i===dp&&n!==xs)?On({result:{error:Er,valid:!1},info:km,stack:t}):r===lp&&i===dp&&n!==xs?On({result:{error:Er,valid:!1},info:_m,stack:t}):{valid:!0}}var jm=function(e,t){return e.filter(Boolean).every((function(e){return typeof e===t}))},Bm=function(e){return e.filter(Boolean).every(f)};function Vm(e){var t,r,n=e.category;if("object"!=typeof n)return{error:Cr};var i,a=n.ageCategoryCode,u=n.ageMaxDate,s=n.ageMinDate,l=n.ageMax,c=n.ageMin,d=n.categoryName;if(!jm([a,u,s,d],"string")||!Bm([l,c]||![u,s].filter(Boolean).every(Jn)))return{error:Cr};var p=null!==(t=e.consideredDate)&&void 0!==t?t:ui((new Date).toLocaleDateString("sv"));if(!Jn(p))return{error:It};var v=o(p.split("-").slice(0,3).map((function(e){return parseInt(e)})),1)[0],f=o(si(p,-1).split("-").slice(1,3).map((function(e){return parseInt(e)})),2),m=f[0],h=f[1],g="".concat(gi(m),"-").concat(gi(h)),I=o(si(p,1).split("-").slice(1,3).map((function(e){return parseInt(e)})),2),y=I[0],U=I[1],S="".concat(gi(y),"-").concat(gi(U)),w=c&&si(p,-365*c),T=l&&si(p,-365*l),P=[],D=function(e){return!P.includes(e)&&P.push(e)},b=/^([UO]?)(\d{1,2})([UO]?)$/,N=/^C(\d{1,2})-(\d{1,2})$/,M=null==(a=null!=a?a:d)?void 0:a.includes("-"),R=M&&(null==a?void 0:a.match(N)),A=null==a?void 0:a.match(b),E=function(e,t){return"".concat(e,"-").concat(t)},C=function(e){var t=E(v-e-1,S);n.ageMin&&n.ageMin>e&&D("Invalid submitted ageMin: ".concat(c)),n.ageMax&&n.ageMax>e&&D("Invalid submitted ageMax: ".concat(l)),n.ageMinDate&&n.ageMinDate!==t&&D("Invalid submitted ageMinDate: ".concat(s)),s=t,a&&(n.ageMax&&n.ageMax!==e&&(D("Invalid submitted ageMax: ".concat(l)),w=void 0),l=e)},x=function(e){var t=E(v-e,g);n.ageMaxDate&&n.ageMaxDate!==t&&D("Invalid submitted ageMaxDate: ".concat(u)),u=t,a&&(n.ageMin&&n.ageMin!==e+1&&(D("Invalid submitted ageMin: ".concat(c)),w=void 0),c=e+1)},O=function(e){var t=o((e.match(b)||[]).slice(1),3),r=t[0],i=t[1],d=t[2],p=parseInt(i);"U"===r?(n.ageMaxDate&&n.ageMaxDate!==u&&D("Invalid submitted ageMaxDate: ".concat(n.ageMaxDate)),function(e){var t=E(v-e,S);n.ageMinDate&&n.ageMinDate!==t&&D("Invalid submitted ageMinDate: ".concat(s)),s=t,a&&(n.ageMax&&n.ageMax!==e-1&&(D("Invalid submitted ageMax: ".concat(l)),T=void 0),l=e-1)}(p)):"O"===r&&x(p),"U"===d?(n.ageMaxDate&&n.ageMaxDate!==u&&D("Invalid submitted ageMaxDate: ".concat(n.ageMaxDate)),C(p)):"O"===d&&function(e){var t=E(v-e-1,g);n.ageMaxDate&&n.ageMaxDate!==t&&D("Invalid submitted ageMaxDate: ".concat(u)),u=t,a&&(n.ageMin&&n.ageMin!==e&&(D("Invalid submitted ageMin: ".concat(c)),w=void 0),c=e)}(p),u=null!=u?u:w,s=null!=s?s:T};if(R){if(u=void 0,s=void 0,l=void 0,c=void 0,n.ageMin){var F=v-n.ageMin;u=E(F,g)}if(n.ageMax){var k=v-n.ageMax-1;s=E(k,S)}var _=o((null!==(r=null==a?void 0:a.match(N))&&void 0!==r?r:[]).slice(1).map((function(e){return parseInt(e)})),2),L=_[0],j=_[1];L<=j?(c=L,l=j,i=!0):D("Invalid combined age range ".concat(a))}else M?null==a||a.split("-").forEach(O):A?O(a):(c&&x(c),l&&C(l));l&&n.ageMin&&n.ageMin>l&&(D("Invalid submitted ageMin: ".concat(n.ageMin)),c=void 0);var B=xn({consideredDate:p,combinedAge:i,ageMaxDate:u,ageMinDate:s,ageMax:l,ageMin:c});return P.length&&(B.errors=P),B}function Gm(e){var r=e.category;if(!Di(r))return{error:xr};var n=Vm({category:r});if(n.error)return{error:n};var i=r.ratingMax,a=r.ratingMin;return i&&!f(i)?On({result:{error:xr},context:{ratingMax:i}}):a&&!f(a)?On({result:{error:xr},context:{ratingMin:a}}):t({},n)}function qm(e){var t=e.childCategory,r=e.withDetails,n=e.category,i=Gm({category:n}),a=Gm({category:t}),o=a.ageMin&&(i.ageMin&&a.ageMin<i.ageMin||i.ageMax&&a.ageMin>i.ageMax),u=a.ageMax&&(i.ageMax&&a.ageMax>i.ageMax||i.ageMin&&a.ageMax<i.ageMin),s=a.ageMinDate&&i.ageMaxDate&&new Date(a.ageMinDate)>new Date(i.ageMaxDate),l=a.ageMaxDate&&i.ageMinDate&&new Date(a.ageMaxDate)<new Date(i.ageMinDate),c=(null==n?void 0:n.ratingType)&&(null==t?void 0:t.ratingType)&&n.ratingType===t.ratingType&&(n.ratingMin&&t.ratingMin&&t.ratingMin<n.ratingMin||n.ratingMax&&t.ratingMax&&t.ratingMax>n.ratingMax||n.ratingMin&&t.ratingMax&&t.ratingMax<n.ratingMin||n.ratingMax&&t.ratingMin&&t.ratingMin>n.ratingMax),d=(null==n?void 0:n.ballType)&&(null==t?void 0:t.ballType)&&n.ballType!==t.ballType,p=xn({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:d,invalidAgeMax:u,invalidAgeMin:o,valid:!(c||s||l||d||u||o)},!0);return r&&Object.assign(p,{categoryDetails:i,childCategoryDetails:a}),p}var Wm={isValid:Fm,isValidMatchUpFormat:Fm,stringify:Am,parse:Zd};function Hm(e){var t=e.checkCategory,r=void 0===t||t,n=e.collectionDefinition,i=e.checkCollectionIds,a=e.checkGender,s=void 0===a||a,l=e.referenceCategory,c=e.referenceGender,d=e.event;c=null!=c?c:null==d?void 0:d.gender;var p="validateCollectionDefinition",v=[];if("object"!=typeof n)return v.push("collectionDefinition must be an object: ".concat(n)),On({result:{errors:v,error:Ar},stack:p});var f,m=n.collectionValueProfiles,h=n.collectionGroupNumber,g=n.collectionValue,y=n.collectionId,U=n.matchUpCount,S=n.matchUpFormat,w=n.matchUpValue,T=n.matchUpType,P=n.scoreValue,D=n.setValue,b=n.category,N=n.gender;(i&&"string"!=typeof y&&v.push("collectionId is not type string: ".concat(y)),"number"!=typeof U&&v.push("matchUpCount is not type number: ".concat(U)),T&&![Es,xs].includes(T)&&v.push("matchUpType must be SINGLES or DOUBLES: ".concat(T)),1!==[!!(null==m?void 0:m.length)].concat([w,g,P,D].map(I)).filter(Boolean).length&&v.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),w&&"number"!=typeof w&&v.push("matchUpValue is not type number: ".concat(w)),g&&"number"!=typeof g&&v.push("collectionValue is not type number: ".concat(g)),m&&U)&&((f=Dm({collectionValueProfiles:m,matchUpCount:U})).errors&&v.push.apply(v,u([],o(f.errors),!1)));if((h&&"number"!=typeof h&&v.push("collectionGroupNumber is not type number: ".concat(g)),S&&!Wm.isValidMatchUpFormat({matchUpFormat:S})&&v.push("Invalid matchUpFormat: ".concat(S)),s)&&(f=Lm({referenceGender:c,matchUpType:T,gender:N})).error)return On({context:{referenceGender:c,gender:N},result:f,stack:p});if(r&&l&&b&&!(f=qm({category:l,childCategory:b})).valid)return On({result:{error:Cr},context:f,stack:p});return v.length?On({result:{errors:v,error:Rr},stack:p}):{valid:!0}}function zm(e){var t,r,n,i,a,s=!(!1===(null==e?void 0:e.enforceCategory)||!(null==e?void 0:e.category)),l=!(!1===(null==e?void 0:e.enforceGender)||!(null==e?void 0:e.gender)),c=null==e?void 0:e.checkCollectionIds,d=null==e?void 0:e.tieFormat,p=null==e?void 0:e.event,v="validateTieFormat",f=[];if(!e||!d||"object"!=typeof d)return f.push("tieFormat must be an object"),On({result:{error:He},context:{tieFormat:d,errors:f},stack:v});if("object"!=typeof d.winCriteria)return f.push("tieFormat.winCriteria must be an object"),On({result:{error:He},context:{tieFormat:d,errors:f},stack:v});if(!Array.isArray(d.collectionDefinitions))return f.push(rm("tieFormat.collectionDefinitions")),On({result:{error:He},context:{tieFormat:d,errors:f},stack:v});var m=d.collectionDefinitions.every((function(t){var r=t.setValue,n=t.scoreValue,i=t.collectionValue;!r&&!n||i||(a=!0);var d=Hm({referenceCategory:e.category,referenceGender:e.gender,collectionDefinition:t,checkCollectionIds:c,checkCategory:s,checkGender:l,event:p}),v=d.valid,m=d.errors;return!!v||(Array.isArray(m)&&f.push.apply(f,u([],o(m),!1)),!1)})),h="number"==typeof(null===(t=d.winCriteria)||void 0===t?void 0:t.valueGoal)&&(null===(r=d.winCriteria)||void 0===r?void 0:r.valueGoal)>0&&!a||(null===(n=d.winCriteria)||void 0===n?void 0:n.aggregateValue);if(!h&&!(null===(i=d.winCriteria)||void 0===i?void 0:i.aggregateValue))return a?f.push("aggregateValue is required"):f.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),On({context:{tieFormat:d,errors:f,aggregateValueImperative:a},result:{error:He},stack:v});var g=d.collectionDefinitions.map((function(e){return e.collectionId})),I=!c||g.length===U(g).length,y=m&&h&&I;return y?{valid:y,errors:f}:On({result:{error:He},context:{tieFormat:d,errors:f},stack:v})}function Ym(e){var t=e.matchUp,r=e.tieFormat,n=e.isMock,i=e.uuids,a=(null!=r?r:{}).collectionDefinitions;return{tieMatchUps:(null!=a?a:[]).map((function(e){return Km({matchUp:t,collectionDefinition:e,uuids:i,isMock:n})})).filter(Boolean).flat()}}function Km(e){var t,r=e.collectionPositionOffset,n=void 0===r?0:r,i=e.collectionDefinition,a=e.matchUpsLimit,o=e.matchUp,u=e.isMock,s=e.uuids,l=i||{},c=l.matchUpCount,d=l.matchUpType,p=l.collectionId,v=l.processCodes,f=null!==(t=null!=a?a:c)&&void 0!==t?t:0,m=function(e){var t,r;if(!u&&!(null==o?void 0:o.isMock))return null!==(t=null==s?void 0:s.pop())&&void 0!==t?t:ed();var n=null==i?void 0:i.collectionId;return null!==(r=null==s?void 0:s.pop())&&void 0!==r?r:"".concat(null==o?void 0:o.matchUpId,"-").concat(n,"-TMU-").concat(e+1)};return R(0,f).map((function(e){var t=n+e+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:m(e),matchUpStatus:Yo,collectionPosition:t,collectionId:p,processCodes:v,matchUpType:d,isMock:u}}))}function Jm(e){var t;if(!e)return{};var r=[],n=e.tieFormatName,i=null===(t=e.collectionDefinitions)||void 0===t?void 0:t.map((function(e){var t=e.matchUpType,n=e.matchUpFormat,i=e.matchUpCount,a=e.category,o=e.gender;r.includes(n)||r.push(n);var u=null==a?void 0:a.ageCategoryCode;return[i,t===Cs?"D":"S",u,n,o].join(";")})).join("|");return{tieFormatName:e&&n||"UNNAMED",matchUpFormats:r,tieFormatDesc:i}}function Zm(e){var r,n,i,a,s=e.considerations,l=void 0===s?{}:s,c=e.descendant,d=e.ancestor,p={},v={},f=Jm(c),m=f.matchUpFormats,h=f.tieFormatDesc,g=Jm(d),I=g.matchUpFormats,y=g.tieFormatDesc,S=U((null!=m?m:[]).filter((function(e){return!(null!=I?I:[]).includes(e)})).concat((null!=I?I:[]).filter((function(e){return!(null!=m?m:[]).includes(e)})))),w=!(!(null==l?void 0:l.collectionName)||c.collectionDefinitions.map((function(e){return e.collectionName})).join("|")===d.collectionDefinitions.map((function(e){return e.collectionName})).join("|")),T=!(!(null==l?void 0:l.collectionOrder)||c.collectionDefinitions.map((function(e){return e.collectionOrder})).join("|")===d.collectionDefinitions.map((function(e){return e.collectionOrder})).join("|")),P=Object.assign.apply(Object,u([{}],o(((null==c?void 0:c.collectionDefinitions)||[]).map((function(e){var t;return(t={})[e.collectionId]=e,t}))),!1)),D=Object.assign.apply(Object,u([{}],o(((null==d?void 0:d.collectionDefinitions)||[]).map((function(e){var t;return(t={})[e.collectionId]=e,t}))),!1));p.collectionIds=C(Object.keys(P),Object.keys(D)),v.collectionIds=C(Object.keys(D),Object.keys(P)),p.collectionsValue=Xm(P),v.collectionsValue=Xm(D),p.groupsCount=null!==(n=null===(r=null==d?void 0:d.collectionGroups)||void 0===r?void 0:r.length)&&void 0!==n?n:0-(null!==(a=null===(i=null==c?void 0:c.collectionGroups)||void 0===i?void 0:i.length)&&void 0!==a?a:0)||0,v.groupsCount=p.groupsCount?-1*p.groupsCount:0;var b=p.collectionsValue.totalValue-v.collectionsValue.totalValue,N=p.collectionsValue.totalMatchUps-v.collectionsValue.totalMatchUps,M=v.collectionsValue.assignmentValues.length!==p.collectionsValue.assignmentValues.length,R=v.collectionsValue.assignmentValues.some((function(e,t){var r=p.collectionsValue.assignmentValues[t];return!r||(e.valueKey!==r.valueKey||(e.value!==r.value||!!Array.isArray(e.value)&&e.value.every((function(e,t){return r.value[t]===e}))))})),A=w||T||y!==h||M||R||0!==b,E=u(u([],o(v.collectionsValue.invalidValues),!1),o(p.collectionsValue.invalidValues),!1),x=E.length&&E;return t(t({matchUpFormatDifferences:S,matchUpCountDifference:N,descendantDifferences:p,ancestorDifferences:v,orderDifference:T,valueDifference:b,nameDifference:w,descendantDesc:h,ancestorDesc:y},L),{different:A,invalid:x})}function Xm(e){var t=[],r=[],n=0;return{totalValue:Object.keys(e).sort(Pv).reduce((function(i,a){var o=e[a],u=o.collectionValueProfiles,s=o.collectionValue,l=o.matchUpCount,c=o.matchUpValue,d=o.scoreValue,p=o.setValue,v={collectionValueProfiles:u,collectionValue:s,matchUpValue:c,scoreValue:d,setValue:p},f=Object.keys(v).filter((function(e){return![void 0,null].includes(v[e])}));1!==f.length&&t.push({collectionId:a});var m=f[0];if(m){var h="collectionValueProfiles"===m?Object.values(u):v[m];r.push({valueKey:m,value:h})}return n+=l,u?i+u.reduce((function(e,t){return e+t.value}),0):l?I(c)?i+c*l:I(d)?i+d*l:I(p)?i+p*l:i+s:i}),0),totalMatchUps:n,invalidValues:t,assignmentValues:r}}function Qm(e){var t=e.matchUp,r=e.updateInProgressMatchUps;return!t.winningSide&&![eu].includes(t.matchUpStatus)&&(r||t.matchUpStatus!==Go&&!Bp(t))}function $m(e){var t=e.from,r=e.to,n=Object.keys(t),i=E(n,Object.keys(r)).length===n.length,a=n.filter((function(e){return t[e]!==r[e]})).map((function(e){return{countChange:r[e]-t[e],collectionId:e}})),o=n.every((function(e){return t[e]===r[e]}));return{equivalent:i&&o,matchUpsCountChanges:a}}function eh(e){var t=e.check,r=e.matchUp,n="",i=[],a=t.matchUpsCountChanges.every((function(e){var t=e.collectionId,a=e.countChange,o=r.tieMatchUps.filter((function(e){return e.collectionId===t&&e.matchUpStatus===Yo})).map(Ri("matchUpId")),u=o.length+a>=0||a>0;return!u&&a<0&&(n="Insufficient TO_BE_PLAYED matchUps"),i.push({toBePlayedTieMatchUpIds:o,collectionId:t,countChange:a}),u}));return{changesArePossible:a,changes:i,cannotChangeReaon:n}}function th(e){var t=e.drawDefinition,r=e.auditData,n=Vn({name:Uo,element:t}).extension;jn({element:t,extension:{name:Uo,value:Array.isArray(null==n?void 0:n.value)?null==n?void 0:n.value.concat(r):[r]}})}function rh(e){var n,i,s,l,c=e.updateInProgressMatchUps,d=void 0!==c&&c,p=e.tournamentRecord,v=e.collectionOrder,f=e.collectionName,m=e.tieFormatName,h=e.drawDefinition,g=e.matchUpFormat,y=e.matchUpCount,U=e.collectionId,S=e.matchUpType,w=e.structureId,P=e.matchUpId,D=e.category,b=e.eventId,N=e.gender,M=e.event,R=e.collectionValueProfiles,A=e.collectionValue,C=e.matchUpValue,x=e.scoreValue,O=e.setValue,F="modifyCollectionDefinition";if(g&&!Fm({matchUpFormat:g}))return On({result:{error:xr},context:{matchUpFormat:g},stack:F});if(f&&"string"!=typeof f)return On({result:{error:xr},context:{collectionName:f},stack:F});if(N&&!Object.values(fp).includes(N))return On({result:{error:xr},context:{gender:N},stack:F});if(D&&"object"!=typeof D)return On({result:{error:xr},context:{category:D},stack:F});var k={collectionValueProfiles:R,collectionValue:A,matchUpValue:C,scoreValue:x,setValue:O};if(!(Object.values(k).filter(Boolean).length||v||f||g||y||S))return On({result:{error:pt},stack:F});if(Object.values(k).filter(Boolean).length>1)return On({info:"Only one value assignment allowed per collectionDefinition",result:{error:xr},stack:F});var _=Rm({drawDefinition:h,structureId:w,matchUpId:P,eventId:b,event:M});if(_.error)return On({result:_,stack:F});var j=_.matchUp,B=_.structure,V=_.tieFormat,G=bm(V),q=null==V?void 0:V.collectionDefinitions.find((function(e){return e.collectionId===U})),W=null==G?void 0:G.collectionDefinitions.find((function(e){return e.collectionId===U}));if(!q)return On({info:"source collectionDefinition",result:{error:jr},context:{collectionId:U},stack:F});var H=null!==(i=null!==(n=null!=A?A:C)&&void 0!==n?n:x)&&void 0!==i?i:O;if(R){var z=Dm({matchUpCount:null!==(s=null!=y?y:null==q?void 0:q.matchUpCount)&&void 0!==s?s:0,collectionValueProfiles:R});if(z.errors)return On({result:{error:xr},info:z.errors,stack:F})}else if(H&&!I(H))return On({result:{error:xr},info:"value is not an integer",context:{value:H},stack:F});var Y,J,Z=R&&(!q.collectionValueProfiles||(Y=q.collectionValueProfiles,J=R,!(E(Object.keys(Y),Object.keys(J)).length===Object.keys(Y).length&&E(Object.values(Y),Object.values(J)).length===Object.values(Y).length))),X=[];if((I(A)&&q.collectionValue!==A||I(C)&&q.matchUpValue!==C||I(x)&&q.scoreValue!==x||I(O)&&q.setValue!==O||Z)&&(W.collectionValueProfiles=void 0,W.collectionValue=void 0,W.matchUpValue=void 0,W.scoreValue=void 0,W.setValue=void 0,Object.assign(W,k),X.push(t({collectionId:U},xn(k)))),(I(x)||I(O))&&W.collectionGroupNumber){var Q=W.collectionGroupNumber;G.collectionDefinitions=G.collectionDefinitions.map((function(e){var t=e.collectionGroupNumber,n=r(e,["collectionGroupNumber"]);return t===Q?n:e})),G.collectionGroups=G.collectionGroups.filter((function(e){return e.groupNumber!==Q})),X.push({collectionId:U,change:"collectionGroupNumber removed"})}var $=Mm(G),ee=xn({aggregateValue:$.aggregateValue,valueGoal:$.valueGoal});if(ee.aggregateValue===(null==V?void 0:V.winCriteria.aggregateValue)&&ee.valueGoal===(null==V?void 0:V.winCriteria.valueGoal)||(G.winCriteria=ee,X.push({collectionId:U,winCriteria:ee})),I(v)&&q.collectionOrder!==v&&(W.collectionOrder=v,X.push({collectionId:U,collectionOrder:v})),f&&q.collectionName!==f&&(W.collectionName=f,X.push({collectionId:U,collectionName:f})),g&&q.matchUpFormat!==g&&(W.matchUpFormat=g,X.push({collectionId:U,matchUpFormat:g})),I(y)&&q.matchUpCount!==y&&(W.matchUpCount=y,X.push({collectionId:U,matchUpCount:y})),S&&q.matchUpType!==S)return On({result:{error:Br},context:{matchUpType:S},stack:F});D&&q.category!==D&&(W.category=D,X.push({collectionId:U,category:D})),N&&q.gender!==N&&(W.gender=N,X.push({collectionId:U,gender:N}));var te=xn(G);if((_=zm({tieFormat:te})).error)return On({result:_,stack:F});if(!X.length)return On({result:t(t({},L),{modifications:X})});if((null==V?void 0:V.tieFormatName)!==m?(te.tieFormatName=m,X.push({tieFormatName:m})):X.length&&(delete te.tieFormatName,X.push("tieFormatName removed: modifications without new tieFormatName")),_=function(e){var r,n,i,s,l,c,d,p=e.updateInProgressMatchUps,v=e.tournamentRecord,f=e.drawDefinition,m=e.structure,h=e.tieFormat,g=e.eventId,I=e.matchUp,y=e.event,U=e.uuids,S="updateTieFormat",w=null==v?void 0:v.tournamentId,P=0,D=0,b=0,N=0,M=null==h?void 0:h.collectionDefinitions.reduce((function(e,t){return e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e}),{}),R=function(e){var t=e.tieFormat;return $m({from:null==t?void 0:t.collectionDefinitions.reduce((function(e,t){return e[t.collectionId]=(e[t.collectionId]||0)+t.matchUpCount,e}),{}),to:M}).equivalent},A=null===(i=Rm({drawDefinition:f}))||void 0===i?void 0:i.tieFormat,E=null===(s=Rm({event:y}))||void 0===s?void 0:s.tieFormat;if(y&&g){try{for(var C=a(null!==(l=y.drawDefinitions)&&void 0!==l?l:[]),x=C.next();!x.done;x=C.next())q({drawDefinition:x.value})}catch(e){r={error:e}}finally{try{x&&!x.done&&(n=C.return)&&n.call(C)}finally{if(r)throw r.error}}y.tieFormat=bm(h),N+=1}else if(I){if(!I.tieMatchUps)return On({result:{error:tt},stack:S});var O=T(null===(c=I.tieMatchUps)||void 0===c?void 0:c.map((function(e){return e.collectionId}))),F=$m({to:M,from:O}),k=eh({matchUp:I,check:F}),_=k.changes,j=k.changesArePossible,B=k.cannotChangeReaon;if(F.equivalent){if(!Qm({matchUp:I,updateInProgressMatchUps:p}))return On({result:{error:Dt},info:"matchUp is IN_PROGRESS or COMPLETE",stack:S});I.tieFormat=bm(h),N+=1}else{if(!j)return On({context:{collectionMap:M,matchUpMap:O},result:{error:He},info:B||"specified changes not possible",stack:S});H({tieFormat:h,matchUp:I,changes:_,uuids:U})}D+=1,Cp({eventId:null==y?void 0:y.eventId,context:S,drawDefinition:f,tournamentId:w,matchUp:I})}else if(m){var V=null===(d=W({inheritedTieFormat:null!=A?A:E,structure:m}))||void 0===d?void 0:d.modifiedMatchUpsCount;V&&(D+=V,P+=1,N+=1);var G=!m.tieFormat||Zm({ancestor:m.tieFormat,descendant:h}).different;G&&(m.tieFormat=bm(h),P+=1,N+=1),(V||G)&&f&&Op({structureIds:[m.structureId],eventId:null==y?void 0:y.eventId,drawDefinition:f})}else{if(!f)return{error:K};q({drawDefinition:f}),f.tieFormat=bm(h),N+=1}return t(t({modifiedStructuresCount:P,modifiedMatchUpsCount:D,addedMatchUpsCount:b,modifiedCount:N},L),{tieFormat:h});function q(e){var t,r,n,i=e.drawDefinition,o=i.structures||[],u=[];try{for(var s=a(o),l=s.next();!l.done;l=s.next()){var c=l.value;if(!c.tieFormat){var d=null===(n=W({inheritedTieFormat:E,structure:c}))||void 0===n?void 0:n.modifiedMatchUpsCount;if(d){P+=1,D+=d;var p=c.structureId;u.push(p)}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return Op({structureIds:u,eventId:null==y?void 0:y.eventId,drawDefinition:i}),u.length}function W(e){var t,r,n,i,o=e.inheritedTieFormat,u=e.structure,s=0,l=(null===(n=mp({matchUpFilters:{matchUpTypes:[Fs]},structure:u}))||void 0===n?void 0:n.matchUps)||[];try{for(var c=a(l),d=c.next();!d.done;d=c.next()){var m=d.value,I=Qm({matchUp:m,updateInProgressMatchUps:p}),y=!1,w=T(null===(i=m.tieMatchUps)||void 0===i?void 0:i.map((function(e){return e.collectionId}))),P=$m({from:w,to:M});if(P.equivalent)m.tieFormat&&R(m)&&I&&(m.tieFormat=bm(h),y=!0);else{var D=eh({matchUp:m,check:P}),b=D.changes;if(D.changesArePossible&&!m.tieFormat)H({changes:b,matchUp:m,tieFormat:h,uuids:U});else{if(!o)return On({result:{error:Je},stack:S});(!m.tieFormat||Zm({ancestor:o,descendant:m.tieFormat}).different)&&(m.tieFormat=o,y=!0)}}y&&(s+=1,Cp({tournamentId:null==v?void 0:v.tournamentId,drawDefinition:f,context:S,eventId:g,matchUp:m}))}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}return{modifiedMatchUpsCount:s}}function H(e){var t=e.uuids,r=e.matchUp,n=e.tieFormat,i=e.changes;r.tieFormat=bm(n);var a=[],s=[];return i.forEach((function(e){var i;if(e.countChange>0){var l=Math.max.apply(Math,u([0],o(r.tieMatchUps.filter((function(t){return t.collectionId===e.collectionId})).map(Ri("collectionPosition"))),!1)),c=n.collectionDefinitions.find((function(t){return t.collectionId===e.collectionId})),d=Km({matchUpsLimit:e.countChange,collectionPositionOffset:l,collectionDefinition:c,matchUp:r,uuids:t});s.push.apply(s,u([],o(Ui(d,!1,!0)),!1)),b+=s.length,(i=r.tieMatchUps).push.apply(i,u([],o(d),!1))}else{var p=e.toBePlayedTieMatchUpIds.slice(0,Math.abs(e.countChange));console.log("remove",p.length),a.push.apply(a,u([],o(p),!1)),r.tieMatchUps=r.tieMatchUps.filter((function(e){var t=e.matchUpId;return!p.includes(t)}))}})),s.length&&Ap({matchUps:s,drawDefinition:f,tournamentId:w,eventId:g}),a.length&&Ep({matchUpIds:a,action:"updateTieFormat",drawDefinition:f,tournamentId:w,eventId:g}),{matchUpIdsRemoved:a,matchUpsAdded:s}}}({tieFormat:te,updateInProgressMatchUps:d,tournamentRecord:p,drawDefinition:h,structure:B,eventId:b,matchUp:j,event:M}),!_.error){var re=tl({tournamentRecord:p}).appliedPolicies;if(null===(l=null==re?void 0:re.audit)||void 0===l?void 0:l[Uo])th({drawDefinition:h,auditData:xn({collectionDefinition:W,drawId:null==h?void 0:h.drawId,action:F,structureId:w,matchUpId:P,eventId:b})})}return On({result:t(t({},_),{modifications:X}),stack:F})}function nh(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.drawPositions,a=e.structureId,s=e.event;if(!n)return{error:K};if(!a)return{error:Pe};if(2!==(null==i?void 0:i.length))return{error:xr,drawPositions:i};var l,c=fl({drawDefinition:n}),d=Ip({inContext:!0,drawDefinition:n,matchUpsMap:c}).matchUps,p=as({drawDefinition:n,structureId:a}).structure;if(!p)return{error:De};if(l=p.structureType===Iu?function(e){var r,n=e.inContextDrawMatchUps,i=e.tournamentRecord,a=e.drawDefinition,s=e.drawPositions,l=e.matchUpsMap,c=e.structure,d=e.event,p=null===(r=c.structures)||void 0===r?void 0:r.reduce((function(e,t){var r=null==t?void 0:t.positionAssignments.filter((function(e){return null==s?void 0:s.includes(e.drawPosition)}));return r&&e.push.apply(e,u([],o(r),!1)),e}),[]);if(2===p.filter((function(e){return e.bye})).length)return t({},L);if(2===p.filter((function(e){return e.qualifier})).length)return t({},L);am({inContextDrawMatchUps:n,tournamentRecord:i,drawDefinition:a,matchUpsMap:l,assignments:p,structure:c,event:d});var v=p.some((function(e){return e.qualifier})),f=p.some((function(e){return e.bye}));if(f&&!v)ih({inContextDrawMatchUps:n,tournamentRecord:i,drawDefinition:a,assignments:p,matchUpsMap:l,structure:c,event:d});else{var m=Ui(p,!1,!0);p.forEach((function(e,t){var r=m[1-t].participantId;e.qualifier=m[1-t].qualifier,e.participantId=r}))}return t({},L)}({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:n,drawPositions:i,matchUpsMap:c,structure:p,event:s}):function(e){var r=e.inContextDrawMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.drawPositions,s=e.matchUpsMap,l=e.structure,c=e.event,d=null==l?void 0:l.positionAssignments.filter((function(e){return null==a?void 0:a.includes(e.drawPosition)}));if(!d)return{error:xr,structure:l,info:"Missing positionAssignments"};if(2===d.filter((function(e){return e.bye})).length)return t({},L);if(2===d.filter((function(e){return e.qualifier})).length)return t({},L);var p=d.some((function(e){return e.qualifier})),v=d.some((function(e){return e.bye}));return v&&!p?ih({inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,assignments:d,matchUpsMap:s,structure:l,event:c}):function(e){var r=e.inContextDrawMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.assignments,s=e.matchUpsMap,l=e.structure,c=e.event,d=Object.assign.apply(Object,u([{}],o(a.map((function(e,r){var n,i=e.drawPosition,o=t(t({},a[1-r]),{drawPosition:i});return(n={})[i]=o,n}))),!1));return l.positionAssignments=l.positionAssignments.map((function(e){return d[e.drawPosition]||e})),am({inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,matchUpsMap:s,assignments:a,structure:l,event:c}),t({},L)}({inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,assignments:d,matchUpsMap:s,structure:l,event:c})}({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:n,drawPositions:i,matchUpsMap:c,structure:p,event:s}),l.error)return l;if(_p({structure:p,drawPositions:i}),Lp({drawDefinition:n,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:a}}),kp({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:n,structure:p,event:s}),s.eventType===Ia){var v=mp({matchUpFilters:{matchUpTypes:[Os]},inContext:!0,structure:p}).matchUps.filter((function(e){var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.some((function(e){return i.includes(e)}))})),f=mp({structure:p,matchUpFilters:{matchUpTypes:[Os]}}).matchUps;v.forEach((function(e){(e.sides||[]).forEach((function(t){var a,o=null==t?void 0:t.drawPosition;if(i.includes(o)){var u=t.participantId,l=f.find((function(t){return t.matchUpId===e.matchUpId})),c=null===(a=null==e?void 0:e.sides)||void 0===a?void 0:a.reduce((function(e,t,r){return t.drawPosition===o?r:e}),void 0);kf({inContextTargetMatchUp:e,drawPositionSideIndex:c,teamParticipantId:u,tournamentRecord:r,drawDefinition:n,matchUp:l,event:s})}}))}))}return Op({drawDefinition:n,structureIds:[a]}),t({},L)}function ih(e){var r=e.inContextDrawMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.assignments,o=e.matchUpsMap,u=e.structure,s=e.event,l=a.find((function(e){return e.bye})),c=a.find((function(e){return e.participantId})),d=l.drawPosition,p=c.participantId,v=c.drawPosition,f=u.structureId,m=Qv({drawPosition:d,inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,structureId:f,matchUpsMap:o});return m.error||(m=Qv({drawPosition:v,inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,structureId:f,matchUpsMap:o})).error?m:(av({drawPosition:v,tournamentRecord:n,drawDefinition:i,structureId:f,matchUpsMap:o,event:s}),(m=om({drawPosition:d,inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,structureId:f,participantId:p,matchUpsMap:o,event:s})).error?m:t({},L))}function ah(e){var t=e.drawDefinition,r=e.structureId;if(!t)return{error:K};var n=as({drawDefinition:t,structureId:r}).structure,i=((null==t?void 0:t.links)||[]).filter((function(e){var t;return(null===(t=e.source)||void 0===t?void 0:t.structureId)===r})).map((function(e){var t;return null===(t=e.target)||void 0===t?void 0:t.structureId})),a=((null==t?void 0:t.structures)||[]).filter((function(e){return i.includes(e.structureId)}));return{playoffStructures:a,structure:n}}function oh(e){var t,r,n,i,s,l=e.withStageGrouping,c=e.stageSequences,d=e.stageSequence,p=e.roundTarget,v=e.stages,f=e.event,m=e.stage;if(!f)return{error:Ae};var h={},g=[];try{for(var I=a(f.drawDefinitions||[]),y=I.next();!y.done;y=I.next()){var U=os({withStageGrouping:l,stageSequences:c,drawDefinition:y.value,stageSequence:d,roundTarget:p,stages:v,stage:m}),S=U.structures,w=U.stageStructures;if(g.push.apply(g,u([],o(S),!1)),w)try{for(var T=(n=void 0,a(Object.keys(w))),P=T.next();!P.done;P=T.next()){var D=P.value;h[D]||(h[D]=[]),(s=h[D]).push.apply(s,u([],o(w[D]),!1))}}catch(e){n={error:e}}finally{try{P&&!P.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=I.return)&&r.call(I)}finally{if(t)throw t.error}}return{structures:g,stageStructures:h}}function uh(e){if(!(null==e?void 0:e.drawDefinition))return!1;var t=gp(e),r=null==t?void 0:t.includesTeamMatchUps,n=t||{},i=n.completedMatchUps,a=n.pendingMatchUps,o=n.upcomingMatchUps;return r&&(i=null==i?void 0:i.filter((function(e){return e.matchUpType===Fs})),a=null==a?void 0:a.filter((function(e){return e.matchUpType===Fs})),o=null==o?void 0:o.filter((function(e){return e.matchUpType===Fs}))),!!((null==i?void 0:i.length)&&!(null==a?void 0:a.length)&&!(null==o?void 0:o.length))}function sh(e){var t=e.significantCharacters,r=e.accessors,n=void 0===r?[]:r,i=e.value,a=[],s=n[0];if(null==i?void 0:i[s]){var l=n.slice(1);if(Array.isArray(i[s]))i[s].forEach((function(e){var r=sh({accessors:l,significantCharacters:t,value:e});a.push.apply(a,u([],o(r),!1))}));else if(i=i[s],l.length){var c=sh({accessors:l,significantCharacters:t,value:i});a.push.apply(a,u([],o(c),!1))}else!function(e){var r=e.value;if(r&&["string","number"].includes(typeof r)){var n=t?r.slice(0,t):r;a.push(n)}}({value:i})}return a}function lh(e){var t=e.policyAttributes,r=e.idCollections,n=e.participants,i=e.participant;if(!Array.isArray(t))return{error:at};if(!i)return{error:Ft};var a=[];return t.forEach((function(e){var t=e||{},s=t.directive,l=t.groupings,c=t.key,d=t.significantCharacters;if(c){var p=c.split(".");a.push.apply(a,u([],o(sh({significantCharacters:d,value:i,accessors:p})),!1))}else if(s){var v=null==e?void 0:e.includeIds,f=((null==r?void 0:r[s])||[]).filter((function(e){return!v||v.includes(e)}));(null==f?void 0:f.length)&&(null==n?void 0:n.length)&&f.forEach((function(e){var t,r=n.find((function(t){return t.participantId===e}));if(null===(t=null==r?void 0:r.individualParticipantIds)||void 0===t?void 0:t.includes(i.participantId)){var o=null==r?void 0:r.participantId;a.push(o)}}))}else l&&Object.keys(l).forEach((function(e){l[e].includes(i.participantId)&&a.push(e)}))})),{values:U(a)}}function ch(e){var r=e.candidatePositionAssignments,n=e.participantsWithGroupings,i=e.policyAttributes,a=e.idCollections,s=Object.assign.apply(Object,u([{}],o(n.map((function(e){var t;return(t={})[e.participantId]=e,t}))),!1));return r.map((function(e){var r=s[e.participantId],o=lh({participants:n,policyAttributes:i,idCollections:a,participant:r}).values;return t(t({},e),{values:o})}))}function dh(e){var t=e.participantIdGroups,r=e.positionAssignments,n=e.groupsToAvoid;return Object.assign.apply(Object,u([{}],o(r.filter((function(e){return null==e?void 0:e.participantId})).map((function(e){var r,i=e.drawPosition,a=e.participantId,o=t&&t[a]||[],u=!!n.some((function(e){return o.includes(e)}));return(r={})[i]={participantGroups:o,includesGroupsToAvoid:u},r}))),!1))}function ph(e){var t=e.unfilledPositions,r=e.chunkedDrawPositions,n=dh(e),i=r.map((function(e){var r=t.filter((function(t){return e.includes(t)})),i=function(e){return e.filter((function(e){return!t(e)}));function t(t){var r=vh(t);return!e.includes(r)}}(r),a=r.filter((function(e){return!i.includes(e)})).filter((function(e){var t,r=vh(e);return!(null===(t=n[r])||void 0===t?void 0:t.includesGroupsToAvoid)}));return{unassigned:r,unpaired:i,pairedNoConflict:a}}));return i}function vh(e){return Number(e%2?e+1:e-1)}function fh(e){var t=e.selectedParticipantGroups,r=e.participantIdGroups,n=e.positionAssignments,i=e.drawPositionChunks,a=e.unfilledPositions,o=e.isRoundRobin,u=i.map((function(e){return o?function(e){var t=e.unfilledPositions,r=e.chunkedDrawPositions,n=dh(e);return r.map((function(e){var r=t.filter((function(t){return e.includes(t)})),i=r.length===e.length?r:[],a=e.filter((function(e){var t;return null===(t=n[e])||void 0===t?void 0:t.includesGroupsToAvoid})).length;return{unassigned:r,unpaired:i,pairedNoConflict:a?[]:r,conflictsCount:a}}))}({groupsToAvoid:t,chunkedDrawPositions:e,participantIdGroups:r,positionAssignments:n,unfilledPositions:a}):ph({groupsToAvoid:t,chunkedDrawPositions:e,participantIdGroups:r,positionAssignments:n,unfilledPositions:a})}));return o?{unassigned:u.map((function(e){return e.map((function(e){return e.unassigned})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length})).sort((function(e,t){return(t.length||0)-(e.length||0)})),unpaired:u.map((function(e){return e.map((function(e){return e.unpaired})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length})),pairedNoConflict:u.map((function(e){return e.map((function(e){return e.pairedNoConflict})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length})).sort((function(e,t){return(t.length||0)-(e.length||0)}))}:{unassigned:u.map((function(e){return e.map((function(e){return e.unassigned})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length})),unpaired:u.map((function(e){return e.map((function(e){return e.unpaired})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length})),pairedNoConflict:u.map((function(e){return e.map((function(e){return e.pairedNoConflict})).filter((function(e){return null==e?void 0:e.length}))})).filter((function(e){return null==e?void 0:e.length}))}}function mh(e){var t=e.positionAssignments,r=e.participantIds,n=t.map((function(e){return e.participantId}));return r.filter((function(e){return!n.includes(e)}))}function hh(e){var t,r=e.candidatePositionAssignments,n=e.unseededParticipantIds,i=e.participantIdGroups,a=e.drawPositionChunks,s=e.drawPositionGroups,l=e.pairedPriority,c=e.allGroups,d=e.groupKey,p=s.reduce((function(e,t){return t.length>e?t.length:e}),0)<=2,v=mh({positionAssignments:r,participantIds:n}),f=function(e){var t=e.drawPositionGroups,r=e.positionAssignments,n=Object.assign.apply(Object,u([{}],o(r.map((function(e){var t;return(t={})[e.drawPosition]=e,t}))),!1));return t.map((function(e){return e.filter(Boolean).map((function(e){return n[e]})).filter(Boolean).filter((function(e){return!e.participantId&&!e.bye})).map((function(e){return e.drawPosition}))})).flat().filter(Boolean)}({positionAssignments:r,drawPositionGroups:s}),m=function(e){var t,r=e.useSpecifiedGroupKey,n=void 0!==r&&r,i=e.targetParticipantIds,a=e.largestFirst,s=void 0===a||a,l=e.allGroups,c=e.groupKey,d=Object.assign.apply(Object,u([{}],o(Object.keys(l).map((function(e){return[e,l[e].filter((function(e){return i.includes(e)}))]})).filter((function(e){return e[1].length})).map((function(e){var t,r=o(e,2),n=r[0],i=r[1];return(t={})[n]=i,t}))),!1)),p=Object.keys(d).reduce((function(e,t){return d[t].length>e?d[t].length:e}),0),v=Object.keys(d).filter((function(e){return d[e].length===p})),f=M(s?v:Object.keys(d));return{participantId:(c=n&&(null===(t=d[c])||void 0===t?void 0:t.length)?c:f)&&d[c]?M(d[c]):M(i),groupKey:c}}({targetParticipantIds:v,useSpecifiedGroupKey:p,allGroups:c,groupKey:d}),h=m.participantId,g=m.groupKey,I=function(e){var t=e.allGroups,r=e.participantId;return Object.keys(t).filter((function(e){return t[e].includes(r)}))}({participantId:h,allGroups:c}),y=fh({positionAssignments:r,isRoundRobin:p,selectedParticipantGroups:I,participantIdGroups:i,drawPositionChunks:a,unfilledPositions:f}),U=y.unassigned,S=y.unpaired,w=y.pairedNoConflict,T=(null==w?void 0:w.length)&&w[0],P=(null==S?void 0:S.length)&&S[0],D=l&&T?T:P,b=l?P:T,R=(null==D?void 0:D.length)&&D||(null==b?void 0:b.length)&&b;if(null==R?void 0:R.length){var A=N(R);t=N(A)}else{A=N(U[0]);t=N(A)}return{newGroupKey:g,selectedParticipantId:h,targetDrawPosition:t}}function gh(e){var t=e.isRoundRobin,r=e.groupedParticipants,n=[];return t?r.forEach((function(e){var t=Lf({drawPositions:e.map((function(e){return e.drawPosition}))}).uniqueMatchUpGroupings,r=Object.assign.apply(Object,u([{}],o(e.map((function(e){var t;return(t={})[e.drawPosition]=e,t}))),!1));t.forEach((function(t){x(r[t[0]].values||[],r[t[1]].values||[])&&(n.push(t),e.conflict=!0)}))})):r.forEach((function(e){var t,r;x((null===(t=e[0])||void 0===t?void 0:t.values)||[],(null===(r=e[1])||void 0===r?void 0:r.values)||[])&&(n.push(e),e.conflict=!0)})),n}function Ih(e){var t=e.positionedParticipants,r=e.potentialDrawPositions,n=e.drawPositionGroups,i=e.avoidanceConflicts,a=e.isRoundRobin;return i.map((function(e){var i=e.map((function(e){return e.drawPosition}));return e.filter((function(e){return r.includes(e.drawPosition)})).map((function(e){var o=r.filter((function(e){return!(null==i?void 0:i.includes(e))})).filter((function(r){var i=n.find((function(e){return e.includes(r)})).find((function(e){return e!==r})),o=t.find((function(e){return e.drawPosition===i})),u=gh({isRoundRobin:a,groupedParticipants:[[e,o]]}),s=t.find((function(e){return e.drawPosition===r})),l=gh({isRoundRobin:a,groupedParticipants:[[s,o]]});return!u.length&&!l.length}));if(o.length)return{drawPosition:e.drawPosition,possibleDrawPositions:o}})).filter(Boolean)})).flat(1)}function yh(e){var r,n=e.initialPositionAssignments,i=e.participantsWithGroupings,a=e.opponentsToPlaceCount,s=e.unseededByePositions,l=e.drawPositionGroups,c=e.policyAttributes,d=e.idCollections,p=e.allGroups,v=[],f=Math.min.apply(Math,u([],o((l||[]).map((function(e){return null==e?void 0:e.length})).filter(Boolean)),!1)),m=f>2,h=Ui(n,!1,!0).filter((function(e){return!e.qualifier})),g=n.filter((function(e){return!e.participantId&&(!e.bye||(null==s?void 0:s.includes(e.drawPosition)))})).map((function(e){return e.drawPosition}));R(0,a).forEach((function(){var n=hh(t(t({},e),{candidatePositionAssignments:h,allGroups:p,groupKey:r})),i=n.newGroupKey,a=n.selectedParticipantId,o=n.targetDrawPosition;r=i,h.forEach((function(e){e.drawPosition===o&&(e.participantId=a)}))}));for(var I=ch({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:c,idCollections:d}),y=O(I,f),U=gh({groupedParticipants:y,isRoundRobin:m}),S=0;S<20&&U.length;){var w=Ih({positionedParticipants:I,potentialDrawPositions:g,avoidanceConflicts:U,drawPositionGroups:l,isRoundRobin:m});if(w.length){var T=Uh({candidatePositionAssignments:h,swapOptions:w});T.error&&console.log({result:T}),U=gh({groupedParticipants:y=O(I=ch({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:c,idCollections:d}),f),isRoundRobin:m}),S++}else S=20}return h.forEach((function(e){if(e.bye&&e.participantId){var t=Ie;v.push(t)}if(e.qualifier&&e.participantId){t=Ie;v.push(t)}})),{positionAssignments:h,conflicts:U.length,groupedParticipants:y,errors:v}}function Uh(e){var r,n=e.candidatePositionAssignments,i=N(e.swapOptions);if(!i)return{error:{message:"No swap options"}};var a=i.drawPosition,o=N(i.possibleDrawPositions),u=n.find((function(e){return e.drawPosition===a})),s=null!==(r=n.find((function(e){return e.drawPosition===o})))&&void 0!==r?r:{},l={participantId:null==s?void 0:s.participantId,qualifier:null==s?void 0:s.qualifier,bye:null==s?void 0:s.bye},c={participantId:u.participantId,qualifier:u.qualifier,bye:u.bye};return Object.assign(u,l),Object.assign(s,c),t({},L)}function Sh(e){var r,n,i,l,d=e.provisionalPositioning,p=e.unseededParticipantIds,f=e.inContextDrawMatchUps,m=e.unseededByePositions,h=e.tournamentRecord,g=e.drawDefinition,I=e.seedBlockInfo,y=e.participants,U=e.matchUpsMap,S=e.structureId,w=e.avoidance,T=e.drawSize,P=e.event;if(!w)return{error:it};var D=w.candidatesCount,b=void 0===D?1:D,N=w.policyAttributes,M=w.targetDivisions,A=w.roundsToSeparate,E="randomUnseededSeparation",C=as({drawDefinition:g,structureId:S}).structure,x=mp({provisionalPositioning:d,matchUpsMap:U,structure:C,event:P}).matchUps;if(M&&c(M)&&!A){var F=function(e){if(!c(e))return!1;for(var t=e,r=1;2!==t;)r+=1,t/=2;return r}(M)||0,k=x.reduce((function(e,t){return t.roundNumber>e?t.roundNumber:e}),0);A=k<F?1:k-F+1}var _=ls({structure:C}).positionAssignments,j=Us({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:y}).participantsWithGroupings,B=null==_?void 0:_.filter((function(e){return!e.participantId})),V=null==_?void 0:_.map((function(e){return e.drawPosition})),G=(null==C?void 0:C.structureType)===Iu,q=G?{structure:C,matchUps:x,allDrawPositions:V,roundsToSeparate:A}:{matchUps:x,allDrawPositions:V,roundsToSeparate:A},W=G?function(e){var t=e.structure.structures,r=t.map((function(e){return e.positionAssignments.map((function(e){return e.drawPosition}))}));return{drawPositionGroups:r,drawPositionChunks:[r]}}(q):function(e){var t=e.allDrawPositions,r=e.roundsToSeparate,n=e.matchUps,i=n.filter((function(e){return 1===e.roundNumber})).map((function(e){return e.drawPositions})),a=i.flat().sort(s),l=Math.max.apply(Math,u([],o(a),!1)),c=t.filter((function(e){return e>l})),d=a.length,p=R(2===d?1:2,d).filter((function(e){return e===v(e)})),f=p.slice(0,r||p.length).reverse(),m=f.map((function(e){return O(a,e)}));c.length&&console.log({fedDrawPositions:c});return{drawPositionGroups:i,drawPositionChunks:m}}(q),H=W.drawPositionGroups,z=W.drawPositionChunks,Y={groupParticipants:y.filter((function(e){return e.participantType===ms})).map((function(e){return e.participantId})),teamParticipants:y.filter((function(e){return e.participantType===gs})).map((function(e){return e.participantId})),pairParticipants:y.filter((function(e){return e.participantType===hs})).map((function(e){return e.participantId}))},K=function(e){var t=e.targetParticipantIds,r=e.policyAttributes,n=e.idCollections,i=e.participants;if(!Array.isArray(r))return{error:at};if(!Array.isArray(i))return{error:kt};var a={};return t.forEach((function(e){var t=i.find((function(t){return t.participantId===e})),o=lh({policyAttributes:r,idCollections:n,participants:i,participant:t}).values;o&&o.forEach((function(t){a[t]||(a[t]=[]),a[t].includes(e)||a[t].push(e)}))})),a}({targetParticipantIds:p,policyAttributes:N,idCollections:Y,participants:y});if(K.error)return On({result:K,stack:E});var J,Z=Object.assign.apply(Object,u([{}],o(p.map((function(e){var t,r=Object.keys(K).filter((function(t){var r;return(null!==(r=K[t])&&void 0!==r?r:[]).includes(e)}));return(t={})[e]=r,t}))),!1)),X=mh({participantIds:p,positionAssignments:_});if(X.length>((null==B?void 0:B.length)||0))return{error:rr};var Q=X.length,$=R(0,b).map((function(){return yh({initialPositionAssignments:_,participantsWithGroupings:j,unseededParticipantIds:p,opponentsToPlaceCount:Q,pairedPriority:!1,unseededByePositions:m,participantIdGroups:Z,drawPositionChunks:z,drawPositionGroups:H,policyAttributes:N,idCollections:Y,allGroups:K,drawSize:T})}));if(!(J=$.reduce((function(e,t){return!e||(t.conflicts||0)<(e.conflicts||0)?t:e}),void 0))||J.conflicts){var ee=R(0,b).map((function(){return yh({initialPositionAssignments:_,participantsWithGroupings:j,unseededParticipantIds:p,opponentsToPlaceCount:Q,pairedPriority:!0,unseededByePositions:m,participantIdGroups:Z,drawPositionChunks:z,drawPositionGroups:H,policyAttributes:N,idCollections:Y,allGroups:K,drawSize:T})})),te=$.concat.apply($,u([],o(ee),!1)).filter((function(e){var t;return!(null===(t=e.errors)||void 0===t?void 0:t.length)}));J=te.reduce((function(e,t){return!e||(t.conflicts||0)<(e.conflicts||0)?t:e}),void 0)}if(!J)return{error:Nr};var re=(null!==(l=null===(i=ss({structure:C}))||void 0===i?void 0:i.positionAssignments)&&void 0!==l?l:[]).filter((function(e){return e.participantId})).map((function(e){return e.participantId})),ne=J.positionAssignments.filter((function(e){return!re.includes(e.participantId)}));try{for(var ie=a(ne),ae=ie.next();!ae.done;ae=ie.next()){var oe=ae.value;if(oe.bye){if((ue=av(t({tournamentRecord:h,drawDefinition:g,seedBlockInfo:I,structureId:S,matchUpsMap:U,event:P},oe))).error)return On({result:ue,stack:E})}else if(oe.participantId){var ue;if((ue=om(t({automaticPlacement:!0,inContextDrawMatchUps:f,tournamentRecord:h,drawDefinition:g,seedBlockInfo:I,structureId:S,matchUpsMap:U,event:P},oe))).error)return On({result:ue,stack:E,context:{assignment:oe}})}}}catch(e){r={error:e}}finally{try{ae&&!ae.done&&(n=ie.return)&&n.call(ie)}finally{if(r)throw r.error}}return t({},L)}function wh(e){var r,n,i=e.provisionalPositioning,o=e.inContextDrawMatchUps,u=e.unseededByePositions,s=e.multipleStructures,l=e.tournamentRecord,c=e.drawDefinition,d=e.seedBlockInfo,p=e.participants,v=e.matchUpsMap,f=e.structureId,m=e.structure,h=e.drawSize,g=e.event;m||(m=as({drawDefinition:c,structureId:f}).structure),f||(f=m.structureId);var I=ls({structure:m}).positionAssignments,y=ql({provisionalPositioning:i,drawDefinition:c,structure:m}).seedAssignments,U=null==y?void 0:y.map((function(e){return e.participantId})).filter(Boolean),w=m.stage,T=m.stageSequence,P=w===au?null===(n=null===(r=Vn({element:m,name:fo}))||void 0===r?void 0:r.extension)||void 0===n?void 0:n.value:void 0,D=Gl({provisionalPositioning:i,drawDefinition:c,stageSequence:T,entryStatuses:kl,structureId:f,roundTarget:P,stage:w}),b=D.filter((function(e){return!(null==U?void 0:U.includes(e.participantId))})).map((function(e){return e.participantId})),N=null==I?void 0:I.filter((function(e){return!e.participantId&&!e.bye&&!e.qualifier})).map((function(e){return e.drawPosition}));if(!s&&b.length>((null==N?void 0:N.length)||0))return On({result:{error:rr},context:{unseededParticipantsCount:b.length,unfilledDrawPositionsCount:null==N?void 0:N.length},stack:"positionUnseededParticipants"});var M=tl({tournamentRecord:l,drawDefinition:c,event:g}).appliedPolicies,R=null==M?void 0:M[La];if(m.stage===su){var A=D.reduce((function(e,t){return e[t.groupingValue]||(e[t.groupingValue]=[]),e[t.groupingValue].push(t.participantId),e}),{});Object.keys(A).length&&(R||(R={policyName:"Playoff Avoidance"}),R.policyAttributes||(R.policyAttributes=[]),R.policyAttributes.push({groupings:A}))}return R&&p?Sh({provisionalPositioning:i,unseededParticipantIds:b,inContextDrawMatchUps:o,unseededByePositions:u,tournamentRecord:l,drawDefinition:c,seedBlockInfo:d,participants:p,matchUpsMap:v,structureId:f,avoidance:R,drawSize:h,entries:D}):function(e){var r,n,i=e.provisionalPositioning,o=e.unseededParticipantIds,u=e.inContextDrawMatchUps,s=e.unfilledDrawPositions,l=e.multipleStructures,c=e.tournamentRecord,d=e.drawDefinition,p=e.seedBlockInfo,v=e.matchUpsMap,f=e.structureId,m=e.drawSize,h=e.event,g=m>2?S(s):s.reverse();try{for(var I=a(o),y=I.next();!y.done;y=I.next()){var U=y.value,w=g.pop();if(!l||w){var T=om({provisionalPositioning:i,inContextDrawMatchUps:u,tournamentRecord:c,drawDefinition:d,seedBlockInfo:p,participantId:U,drawPosition:w,matchUpsMap:v,structureId:f,event:h});if((null==T?void 0:T.error)&&console.log("!!!!!",{result:T}),null==T?void 0:T.error)return On({result:T,stack:"randomUnseededDistribution"})}}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}return t({},L)}({provisionalPositioning:i,unseededParticipantIds:b,inContextDrawMatchUps:o,unfilledDrawPositions:N,multipleStructures:s,tournamentRecord:l,drawDefinition:c,seedBlockInfo:d,structureId:f,matchUpsMap:v,drawSize:h,event:g})}function Th(e){var r,n,i,s=null!==(i=e.structure)&&void 0!==i?i:as(e).structure,c="positionQualifiers",d=[];if(s.stage===ou)return On({result:{error:_e},stack:c});var p=function(e){var t,r=e.drawDefinition,n=e.structure,i=e.structureId;n||(n=as({drawDefinition:r,structureId:i}).structure);i||(i=n.structureId);var a=ls({structure:n}).positionAssignments,s=n.stage,c=n.stageSequence,d=Ev({drawDefinition:r,stageSequence:c,structureId:i,stage:s}),p=d.qualifiersCount,v=d.roundQualifiersCounts,f=(v?Object.keys(v):[]).map((function(e){return l(e)})),m=mp({structure:n}).matchUps,h=Xs({matchUps:m}).roundProfile,g=Object.assign.apply(Object,u([{}],o(f.filter((function(e){return null==h?void 0:h[e]})).map((function(e){var t,r,n,i;return(t={})[e]=null!==(i=null===(n=null===(r=null==h?void 0:h[e])||void 0===r?void 0:r.drawPositions)||void 0===n?void 0:n.filter(Boolean))&&void 0!==i?i:[],t}))),!1)),I=null==a?void 0:a.filter((function(e){return e.qualifier})).map((function(e){return e.drawPosition})),y=p-(null!==(t=null==I?void 0:I.length)&&void 0!==t?t:0),U=null==I?void 0:I.length,S=Object.assign.apply(Object,u([{}],o(f.map((function(e){var t,r,n,i=null==a?void 0:a.filter((function(t){var r,n;return t.qualifier&&(null===(n=null===(r=g[e])||void 0===r?void 0:r.drawPositions)||void 0===n?void 0:n.includes(t.drawPosition))})).map((function(e){return e.drawPosition}));return(t={})[e]=(null!==(r=null==v?void 0:v[e])&&void 0!==r?r:0)-(null!==(n=null==i?void 0:i.length)&&void 0!==n?n:0),t}))),!1));return{unplacedRoundQualifierCounts:S,unplacedQualifiersCount:y,placedQualifiersCount:U,roundQualifiersCounts:v,positionAssignments:a,roundDrawPositions:g,qualifiersCount:p}}(e),v=p.unplacedRoundQualifierCounts,f=p.positionAssignments,m=p.roundDrawPositions,h=function(e){var t=null==f?void 0:f.filter((function(t){return m[e].includes(t.drawPosition)&&!t.participantId&&!t.qualifier&&!t.bye})).map((function(e){return e.drawPosition}));if(v[e]>(t||0))return{value:On({result:{error:tr},context:{unfilledDrawPositions:t},stack:c})};R(0,v[e]).forEach((function(){var e=N(t);d.push(e),null==f||f.forEach((function(t){t.drawPosition===e&&(t.qualifier=!0,delete t.participantId,delete t.bye)}))}))};try{for(var g=a(Object.keys(v)),I=g.next();!I.done;I=g.next()){var y=h(I.value);if("object"==typeof y)return y.value}}catch(e){r={error:e}}finally{try{I&&!I.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}return t(t({},L),{qualifierDrawPositions:d})}function Ph(e){var t=e.orderedSortedFirstRoundSeededDrawPositions,r=e.validSeedBlocks,n=e.byesToPlace,i=[];r.forEach((function(e){if(n-i.length>e.drawPositions.length)i.push.apply(i,u([],o(e.drawPositions),!1));else for(var r=bh(O(e.drawPositions,2)),a=void 0,s=t[i.length];a=Dh(r,s);)i.push(a),s=t[i.length]}));var a=i.map((function(e){return Array.isArray(e)?S(e):e})).flat(1/0);if(m(n)&&r.map((function(e){return e.seedNumbers[0]})).includes(n))return t;return a}function Dh(e,t){if(Array.isArray(e)&&2!==e.length)return e.pop();if(!Array.isArray(e[0]))return e.includes(t)?e.indexOf(t)?e.pop():e.shift():Math.round(Math.random())?e.pop():e.shift();var r=e[0].flat(1/0).length,n=e[1].flat(1/0).length;if(r===n){var i=e[0].flat(1/0).includes(t)?e[0]:e[1];return Dh(t?i:e[Math.round(Math.random())],t)}return Dh(r<n?e[1]:e[0],t)}function bh(e){var t=Math.floor(e.length/2);return e.length>2?[bh(e.slice(0,t)),bh(e.slice(t))]:e}function Nh(e){var r,n,i=e.provisionalPositioning,a=e.relevantMatchUps,s=e.appliedPolicies,l=e.drawDefinition,c=e.seedingProfile,d=e.seedBlockInfo,p=e.byesToPlace,v=e.structure;d||(d=Kf({provisionalPositioning:i,appliedPolicies:s,drawDefinition:l,seedingProfile:c,structure:v}));var f=d.isFeedIn,m=d.isLuckyStructure,h=d.isContainer,g=d.validSeedBlocks;(null===(r=null==s?void 0:s.seeding)||void 0===r?void 0:r.containerByesIgnoreSeeding)&&(g=[]);var I=null!==(n=function(e){var r=e.provisionalPositioning,n=e.drawDefinition,i=e.structure,a=ls({structure:i}).positionAssignments,s=ql({provisionalPositioning:r,drawDefinition:n,structure:i}).seedAssignments,l=Object.assign.apply(Object,u([{}],o((s||[]).filter((function(e){return e.participantId})).map((function(e){var t;return(t={})[e.participantId]=e,t}))),!1));return null==a?void 0:a.map((function(e){return l[e.participantId]?t(t({},e),{seedNumber:l[e.participantId].seedNumber,seedValue:l[e.participantId].seedValue}):""})).filter(Boolean)}({provisionalPositioning:i,drawDefinition:l,structure:v}))&&void 0!==n?n:[],y=U([].concat.apply([],u([],o(a.map((function(e){return e.drawPositions}))),!1))),S=I.filter((function(e){return y.includes(e.drawPosition)})),w=function(e,t){return zf(e.seedValue)-zf(t.seedValue)},T=g.reduce((function(e,t){var r=S.filter((function(e){var r;return null===(r=t.drawPositions)||void 0===r?void 0:r.includes(e.drawPosition)})).sort(w);return e.concat.apply(e,u([],o(r),!1))}),[]),P=T.map((function(e){return e.drawPosition})),D=Ph({orderedSortedFirstRoundSeededDrawPositions:P,validSeedBlocks:g,byesToPlace:p});return{strictSeedOrderByePositions:Mh({orderedSeedDrawPositions:P,relevantMatchUps:a}).slice(0,p),blockSeedOrderByePositions:Mh({orderedSeedDrawPositions:D,relevantMatchUps:a}).slice(0,p),isLuckyStructure:m,positionedSeeds:I,isContainer:h,isFeedIn:f}}function Mh(e){var t=e.orderedSeedDrawPositions,r=e.relevantMatchUps.map((function(e){return e.drawPositions})).map((function(e){return null==e?void 0:e.sort((function(e,t){return e-t}))})).filter((function(e){return(null==e?void 0:e[0])+1===(null==e?void 0:e[1])}));return t.map((function(e){return r.find((function(t){return null==t?void 0:t.includes(e)}))})).filter(Boolean).map((function(e){return null==e?void 0:e.reduce((function(e,r){return t.includes(r)?e:r}),void 0)})).filter(Boolean)}function Rh(e){var r,n,i,l,c=e.provisionalPositioning,d=e.tournamentRecord,p=e.appliedPolicies,v=e.drawDefinition,f=e.seedBlockInfo,m=e.seedingProfile,h=e.matchUpsMap,g=e.structureId,I=e.structure,y=e.seedLimit,w=e.seedsOnly,T=e.event;I||(I=as({drawDefinition:v,structureId:g}).structure),g||(g=null==I?void 0:I.structureId);var P=!(null!==(i=null==I?void 0:I.structures)&&void 0!==i?i:(null==I?void 0:I.stage)===au),D=function(e){var t,r=e.provisionalPositioning,n=e.drawDefinition,i=e.matchUpsMap,a=e.structure,o=mp({afterRecoveryTimes:!1,provisionalPositioning:r,drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:i,structure:a,event:e.event}),u=o.matchUps,s=o.roundMatchUps,l=(null==s?void 0:s[1])||[],c=(null==a?void 0:a.structureType)===Iu,d=c?u:l,p=c?(null===(t=null==a?void 0:a.structures)||void 0===t?void 0:t.length)||0:u.length,v=a.structureId,f=a.stage,m=a.stageSequence,h=Gl({entryStatuses:_l,provisionalPositioning:r,drawDefinition:n,stageSequence:m,structureId:v,stage:f}),g=Ev({provisionalPositioning:r,drawDefinition:n,stageSequence:m,structureId:v,stage:f}).qualifiersCount,I=h.length+g,y=ls({structure:a}),U=y.positionAssignments,S=y.unassignedPositions,w=null==S?void 0:S.map((function(e){return e.drawPosition})),T=null==U?void 0:U.filter((function(e){return e.bye})).length,P=null==U?void 0:U.filter((function(e){return e.bye})).map((function(e){return e.drawPosition})),D=d.map((function(e){return e.drawPositions})).filter((function(e){return null==e?void 0:e.reduce((function(e,t){return!(null==P?void 0:P.includes(t))&&e}),!0)})).flat(1/0).filter((function(e){return null==w?void 0:w.includes(e)})),b=null==U?void 0:U.length,N=b?b-I:0;return N>p&&1===a.stageSequence&&a.stage!==ou&&(N=p),{placedByes:T,byesCount:N,relevantMatchUps:d,placedByePositions:P,roundMatchUps:s,positionsToAvoidDoubleBye:D}}({provisionalPositioning:c,drawDefinition:v,matchUpsMap:h,structure:I,event:T}),b=D.byesCount,N=D.placedByes,M=D.relevantMatchUps,R=b-(N||0);if(R<=0)return t({},L);var A=Nh({provisionalPositioning:c,relevantMatchUps:M,appliedPolicies:p,drawDefinition:v,seedingProfile:m,seedBlockInfo:f,byesToPlace:R,structure:I}),E=A.strictSeedOrderByePositions,C=A.blockSeedOrderByePositions,x=A.isLuckyStructure,F=A.isFeedIn,k=(null==I?void 0:I.structureType)&&[Iu,gu].includes(I.structureType)&&(null===(l=null==p?void 0:p.seeding)||void 0===l?void 0:l.containerByesIgnoreSeeding),_=P&&(null==C?void 0:C.length)?C:E,j=function(e){var t,r,n=e.provisionalPositioning,i=e.seedOrderByePositions;e.isLuckyStructure;var a,l=e.appliedPolicies,c=e.drawDefinition,d=e.seedLimit,p=e.structure,v=e.isFeedIn,f=null===(t=null==l?void 0:l.seeding)||void 0===t?void 0:t.seedingProfile,m=p.stage===au,h=ls({structure:p}).positionAssignments,g=null==h?void 0:h.filter((function(e){return e.participantId})).map((function(e){return e.drawPosition})),I=mp({provisionalPositioning:n,matchUpFilters:{isCollectionMatchUp:!1},structure:p}),y=I.matchUps,w=I.roundMatchUps,T=(null==w?void 0:w[1])||[],P=p.structureType===Iu?y:T,D=U([].concat.apply([],u([],o(P.map((function(e){return e.drawPositions}))),!1))),b=Math.min.apply(Math,u([],o(D),!1))-1,N=null==g?void 0:g.filter((function(e){return D.includes(e)})),M=function(e){var t=Math.ceil(e.length/2),r=[e.slice(0,t),e.slice(t)],n=r.map((function(e){return[].concat.apply([],u([],o(e.flat(1/0)),!1)).length})),i=Math.min.apply(Math,u([],o(n.flat(1/0)),!1)),a=Math.max.apply(Math,u([],o(n.flat(1/0)),!1)),s=n.indexOf(a),l=i!==a,c=S(r),d=o(!i||l?[r[s],r[1-s]]:[c[0],c[1]],2);return{greaterHalf:d[0],lesserHalf:d[1]}},R=function(e){var t=M(e),r=t.greaterHalf,n=t.lesserHalf,i=M(r),a=i.greaterHalf,s=i.lesserHalf,l=S(a.flat(1/0)).pop(),c=a.flat().filter((function(e){return e!==l}));return{newlyFilteredChunks:u(u(u([],o(n),!1),o(s),!1),[c],!1),drawPosition:l}},A=function(e){return!(null==N?void 0:N.includes(e))},E=function(e){for(var t=O(e.sort(s),Math.ceil(e.length/4)).map((function(e){return e.filter(A)})),r=[].concat.apply([],u([],o(t.flat(1/0)),!1)).length,n=[],i=0;i<r;i++){var a=R(t),l=a.newlyFilteredChunks,c=a.drawPosition;n.push(c),t=l}return n},C=Kf({provisionalPositioning:n,allPositions:!0,appliedPolicies:l,drawDefinition:c,structure:p}).validSeedBlocks,x=null==C?void 0:C.map((function(e){var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.map((function(e){return e+b}))}));if(v){var F=D.length;a=Wf({cluster:Qf(f)===mu,participantsCount:F}).seedBlocks.map((function(e){return e.map((function(e){return e+b}))})).map(E).filter((function(e){return e.length}))}else a=m?null==x?void 0:x.map((function(e){return e.filter(A)})):null==x?void 0:x.map(E).filter((function(e){return e.length}));var k=P.map((function(e){return e.drawPositions})).map((function(e){return null==e?void 0:e.sort((function(e,t){return e-t}))})).filter((function(e){return(null==e?void 0:e[0])+1===(null==e?void 0:e[1])})),_=function(e){return k.reduce((function(t,r){return r.includes(e)?r.reduce((function(t,r){return r!==e?r:t}),void 0):t}),void 0)},L=a.map((function(e){return e.map(_)})).flat(1/0).filter(A).filter((function(e){return!i.includes(e)})).filter(Boolean);if(m&&!p.structures){var j=d%4,B=L.slice(0,j),V=null===(r=w[p.roundLimit])||void 0===r?void 0:r.length,G=O(L.slice(j),V).map(S).flat();L=B.concat(G)}return{unseededByePositions:L}}({provisionalPositioning:c,seedOrderByePositions:_,isLuckyStructure:x,appliedPolicies:p,drawDefinition:v,seedLimit:y,structure:I,isFeedIn:F}).unseededByePositions,B=[].concat.apply([],u([],o(_),!1));if(!w)for(var V=function(){var e=j.find((function(e){return t=e,(B||[]).every((function(e){return e%2?t!==e+1:t!==e-1}));var t}));e?(B.push(e),j=j.filter((function(t){return t!==e}))):(B.push.apply(B,u([],o(j),!1)),j=[])};j.length;)V();k&&(B=S(B),on({ignoreSeededByes:k})&&console.log({byePositions:B}));var G=B.slice(0,R);try{for(var q=a(G),W=q.next();!W.done;W=q.next()){var H=av({provisionalPositioning:c,tournamentRecord:d,drawDefinition:v,drawPosition:W.value,matchUpsMap:h,structureId:g,structure:I,event:T});if(null==H?void 0:H.error)return H}}catch(e){r={error:e}}finally{try{W&&!W.done&&(n=q.return)&&n.call(q)}finally{if(r)throw r.error}}return t(t({},L),{unseededByePositions:j,byeDrawPositions:G})}function Ah(e){var r,n=e.provisionalPositioning,i=e.inContextDrawMatchUps,s=e.tournamentRecord,l=e.appliedPolicies,c=e.validSeedBlocks,d=e.drawDefinition,p=e.seedingProfile,v=e.seedBlockInfo,f=e.participants,m=e.groupsCount,h=e.structureId,g=e.matchUpsMap,I=e.structure,y=e.event,U=[],S=[],w=0;if(I||(I=as({drawDefinition:d,structureId:h}).structure),h||(h=null==I?void 0:I.structureId),l||(l=tl({drawDefinition:d}).appliedPolicies),!c){var T=I&&Kf({provisionalPositioning:n,appliedPolicies:l,drawDefinition:d,seedingProfile:p,structure:I});(null==T?void 0:T.error)&&S.push(T.error),c=null==T?void 0:T.validSeedBlocks}return R(0,m=null!==(r=null!=m?m:null==c?void 0:c.length)&&void 0!==r?r:0).forEach((function(){var e;if(w<(m||0)){var r=function(e){var r,n,i=e.provisionalPositioning,o=e.inContextDrawMatchUps,u=e.tournamentRecord,s=e.drawDefinition,l=e.seedingProfile,c=e.seedBlockInfo,d=e.participants,p=e.structureId,v=e.matchUpsMap,f=e.event,m=Xf({provisionalPositioning:i,randomize:!0,drawDefinition:s,seedingProfile:l,seedBlockInfo:c,structureId:p,event:f}),h=m.unplacedSeedParticipantIds,g=m.unfilledPositions,I=tl({drawDefinition:s}).appliedPolicies,y=(null!=I?I:{}).avoidance;y&&d&&(null==h||h.length);var U=[];try{for(var S=a(h),w=S.next();!w.done;w=S.next()){var T=w.value,P=g.pop();if(!P)return{error:ue};U.push(P);var D=om({provisionalPositioning:i,inContextDrawMatchUps:o,tournamentRecord:u,drawDefinition:s,seedingProfile:l,participantId:T,seedBlockInfo:c,drawPosition:P,matchUpsMap:v,structureId:p,event:f});if(!D.success)return D}}catch(e){r={error:e}}finally{try{w&&!w.done&&(n=S.return)&&n.call(S)}finally{if(r)throw r.error}}return t(t({},L),{seedPositions:U})}({provisionalPositioning:n,inContextDrawMatchUps:i,tournamentRecord:s,drawDefinition:d,seedingProfile:p,seedBlockInfo:v,participants:f,structureId:h,matchUpsMap:g,event:y});(null==r?void 0:r.success)&&(w++,U.push.apply(U,u([],o(null!==(e=r.seedPositions)&&void 0!==e?e:[]),!1))),r.error&&S.push({seedPositionError:r.error})}})),S.length?{error:S}:t(t({},L),{seedPositions:U})}function Eh(e){var r,n,i=e.applyPositioning,a=void 0===i||i,o=e.provisionalPositioning,u=e.inContextDrawMatchUps,s=e.multipleStructures,l=e.placeByes,c=void 0===l||l,d=e.tournamentRecord,p=e.appliedPolicies,v=e.placementGroup,f=e.drawDefinition,m=e.seedingProfile,h=e.structureId,g=e.matchUpsMap,I=e.seedLimit,y=e.seedsOnly,U=e.drawType,S=e.drawSize,w=e.event,T=[];a||(ln(),f=Ui(f,!1,!0));var P=function(e){return a||cn(),On({result:e,stack:"automatedPositioning"})},D=as({drawDefinition:f,structureId:h});if(D.error)return P(D);var b=D.structure;if(!b)return{error:De};p||(p=null===(r=tl({drawDefinition:f,structure:b,event:w}))||void 0===r?void 0:r.appliedPolicies);var N=Ev({stageSequence:b.stageSequence,provisionalPositioning:o,stage:b.stage,drawDefinition:f,structureId:h}).qualifiersCount,M=kl,R=Gl({stageSequence:b.stageSequence,provisionalPositioning:o,stage:b.stage,placementGroup:v,drawDefinition:f,entryStatuses:M,structureId:h});if(!(null==R?void 0:R.length)&&!N)return function(e){return a||cn(),e}(t({},L));g=null!=g?g:fl({drawDefinition:f}),u||(u=Ip({inContext:!0,drawDefinition:f,matchUpsMap:g}).matchUps);var A=[],E=Kf({provisionalPositioning:o,appliedPolicies:p,drawDefinition:f,seedingProfile:m,structure:b});if(E.error)return E;var C=E.validSeedBlocks;T.push({validSeedBlocks:C});var x=d?null===(n=Rv({withIndividualParticipants:!0,tournamentRecord:d}))||void 0===n?void 0:n.participants:[];if(Qf(b.seedingProfile||m)===hu){var O=c?Rh({provisionalPositioning:o,tournamentRecord:d,appliedPolicies:p,drawDefinition:f,seedBlockInfo:E,matchUpsMap:g,structure:b,seedLimit:I,seedsOnly:y,event:w}):void 0;if(null==O?void 0:O.error)return P(O);if(A=O.unseededByePositions,T.push({action:"positionByes",unseededByePositions:A}),(O=Ah({seedingProfile:b.seedingProfile?{positioning:b.seedingProfile}:m,provisionalPositioning:o,inContextDrawMatchUps:u,tournamentRecord:d,appliedPolicies:p,validSeedBlocks:C,drawDefinition:f,seedBlockInfo:E,participants:x,matchUpsMap:g,structure:b,event:w})).error)return P(O);T.push({seedPositions:O.seedPositions,action:"positionSeedBlocks"})}else{if(U!==Fu){var F=Ah({seedingProfile:b.seedingProfile?{positioning:b.seedingProfile}:m,provisionalPositioning:o,inContextDrawMatchUps:u,tournamentRecord:d,appliedPolicies:p,validSeedBlocks:C,drawDefinition:f,seedBlockInfo:E,participants:x,matchUpsMap:g,structure:b,event:w});if(F.error)return P(F);T.push({action:"positionSeedBlocks",seedPositions:F.seedPositions})}var k=c?Rh({provisionalPositioning:o,tournamentRecord:d,appliedPolicies:p,drawDefinition:f,seedBlockInfo:E,matchUpsMap:g,structure:b,seedLimit:I,seedsOnly:y,event:w}):void 0;if(null==k?void 0:k.error)return P(k);A=null==k?void 0:k.unseededByePositions,T.push({action:"positionByes",byeDrawPositions:null==k?void 0:k.byeDrawPositions,unseededByePositions:A})}var _={};if(!y){var j=Th({inContextDrawMatchUps:u,tournamentRecord:d,appliedPolicies:p,validSeedBlocks:C,drawDefinition:f,seedBlockInfo:E,participants:x,matchUpsMap:g,structure:b});if(j.error)return P(j);if(j.conflicts&&(_.qualifierConflicts=j.conflicts),T.push({action:"positionQualifiers",qualifierDrawPositions:j.qualifierDrawPositions}),(j=wh({provisionalPositioning:o,inContextDrawMatchUps:u,unseededByePositions:A,multipleStructures:s,tournamentRecord:d,drawDefinition:f,seedBlockInfo:E,participants:x,matchUpsMap:g,structureId:h,structure:b,drawSize:S,event:w})).error)return P(j);j.conflicts&&(_.unseededConflicts=j.conflicts),T.push({action:"positionUnseededParticipants"})}var B=ss({drawDefinition:f,structure:b}).positionAssignments;return Op({drawDefinition:f,structureIds:[h]}),a||cn(),t(t({positionAssignments:B,conflicts:_},L),{positioningReport:T})}function Ch(e){var r,n,i,o=e.applyPositioning,u=void 0===o||o,s=e.provisionalPositioning,l=e.tournamentRecord,c=e.drawDefinition,d=e.seedingProfile,p=e.structureId,v=e.placeByes,f=e.seedsOnly;if(!e.event)return{error:Ee};if(!c)return{error:Z};if(!uh({drawDefinition:c,structureId:p})&&!s)return{error:Q};var m=null===(i=ah({drawDefinition:c,structureId:p}).playoffStructures)||void 0===i?void 0:i.sort((function(e,t){return is(e)-is(t)})),h=[],g=[];if(m)try{for(var I=a(m),y=I.next();!y.done;y=I.next()){var U=y.value.structureId,S=Eh({structureId:U,provisionalPositioning:s,applyPositioning:u,tournamentRecord:l,drawDefinition:c,seedingProfile:d,placeByes:v,seedsOnly:f});if(S.error)return S;S.positionAssignments&&h.push({positionAssignments:S.positionAssignments,structureId:U}),S.positioningReport&&g.push(S.positioningReport)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}return t(t({},L),{structurePositionAssignments:h,positioningReports:g})}function xh(e){var r,n,i=e.drawDefinition,o=Sf({drawDefinition:i}),u=o.maxQualifyingDepth,s=o.structureProfiles;try{for(var l=a(i.structures),c=l.next();!c.done;c=l.next()){var d=c.value,p=s[d.structureId];p.distanceFromMain&&(d.stageSequence=u+1-p.distanceFromMain)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return t({},L)}function Oh(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.structure,a=e.link;if(!r)return{error:W};if(!n)return{error:K};var o=function(e){var r,n=e.drawDefinition,i=e.tournamentId,a=e.structure,o=e.eventId,u=e.link;if(!n)return{error:K};if(!a)return{error:Ne};if(!u)return{error:we};var s=u.target.structureId,l=as({drawDefinition:n,structureId:s});if(l.error)return On({stack:"attachQualifyingStructure",context:{targetStructureId:s},result:l});n.structures||(n.structures=[]);n.links||(n.links=[]);n.structures.push(a),n.links.push(u),xh({drawDefinition:n});var c=(null===(r=mp({structure:a}))||void 0===r?void 0:r.matchUps)||[];return Ap({drawDefinition:n,tournamentId:i,matchUps:c,eventId:o}),Op({drawDefinition:n,structureIds:[a.structureId]}),t({},L)}({tournamentId:r.tournamentId,drawDefinition:n,structure:i,link:a});return o.error||gf({tournamentRecord:r,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:n.drawId}}}),o}var Fh="SET3-S:6/TB7",kh="SET3-S:6/TB7-F:TB10",_h={FORMAT_STANDARD:Fh,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:kh,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"};function Lh(e){var t,r,n,i=e.winningSide,o=e.matchUpFormat,u=void 0===o?Fh:o,s=e.matchUpStatus,l=e.tallyPolicy,c=e.score,d=[0,0],p=null==c?void 0:c.sets,v="number"==typeof i&&i-1,f=Zd(u),m=Vh(null!==(n=null==f?void 0:f.bestOf)&&void 0!==n?n:1);if("number"==typeof v&&(s===jo&&(null==l?void 0:l.setsCreditForDefaults)||s===Ko&&(null==l?void 0:l.setsCreditForWalkovers)))d[v]=m;else try{for(var h=a(p||[]),g=h.next();!g.done;g=h.next()){var I=g.value.winningSide;I&&(d[I-1]+=1)}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}return"number"==typeof v&&s===Ho&&(+d[1-v]===m&&(d[1-v]-=1),(null==l?void 0:l.setsCreditForRetirements)&&(d[v]=m)),d}function jh(e){var t,r,n,i=e.matchUpFormat,a=void 0===i?Fh:i,o=e.winningSide,u=e.matchUpStatus,s=e.tallyPolicy,c=(e.score||{}).sets;if(!c)return[0,0];var d="number"==typeof o&&o-1,p=Zd(a),v=Vh(null!==(t=null==p?void 0:p.bestOf)&&void 0!==t?t:1),f=(null===(r=null==p?void 0:p.setFormat)||void 0===r?void 0:r.tiebreakAt)||0,m=[[],[]];if("number"==typeof d&&(u===jo&&(null==s?void 0:s.gamesCreditForDefaults)||u===Ko&&(null==s?void 0:s.gamesCreditForWalkovers))){var h=(null===(n=null==p?void 0:p.setFormat)||void 0===n?void 0:n.setTo)||0,g=v*h;m[d].push(g)}else c.forEach((function(e,t){var r,n=(e.setNumber||t+1)>v&&(null==p?void 0:p.finalSetFormat)?"finalSetFormat":"setFormat",i=null===(r=null==p?void 0:p[n])||void 0===r?void 0:r.based,a=null==p?void 0:p[n].tiebreakSet,o=e.side1Score,u=e.side2Score;qh(i)&&(m[0].push(l(o||0)),m[1].push(l(u||0))),a&&e.winningSide&&!1!==(null==s?void 0:s.gamesCreditForTiebreakSets)&&m[e.winningSide-1].push(1)}));if(u===Ho&&"number"==typeof d){var I=c.length>v&&(null==p?void 0:p.finalSetFormat)?"finalSetFormat":"setFormat",y=null==p?void 0:p[I];if(qh(y.based)){var U=(null==y?void 0:y.setTo)||0,S=Lh({winningSide:o,score:{sets:c},matchUpStatus:u,matchUpFormat:a,tallyPolicy:s});if(m.map((function(e){return e[d]<=e[1-d]})).reduce((function(e,t){return e+(t?1:0)}),0)>S[1-d]){var w=m[d].length,T=function(e){if(p&&""!==e)return+e==f-1||+e===f?l(f||0)+1:+e<f?U:f}(m[1-d][w-1]);T&&(m[d][w-1]=T)}v>m[d].length&&(null==s?void 0:s.gamesCreditForRetirements)&&m[d].push(U)}}return[m[0].reduce((function(e,t){return e+t}),0),m[1].reduce((function(e,t){return e+t}),0)]}function Bh(e){var t,r,n=e.matchUpFormat,i=e.score,a=n?Zd(n):void 0,o=Vh(null!==(t=null==a?void 0:a.bestOf)&&void 0!==t?t:1),u=[0,0],s=[0,0];return null===(r=null==i?void 0:i.sets)||void 0===r||r.forEach((function(e,t){var r,n=(e.setNumber||t+1)>o&&(null==a?void 0:a.finalSetFormat)?"finalSetFormat":"setFormat";if(Gh(null===(r=null==a?void 0:a[n])||void 0===r?void 0:r.based)){var i=e.side1Score,c=e.side2Score;i&&(s[0]+=l(i||0)),c&&(s[1]+=l(c||0))}else e.side1TiebreakScore&&(s[0]+=l(e.side1TiebreakScore||0)),e.side2TiebreakScore&&(s[1]+=l(e.side2TiebreakScore||0)),(e.side1TiebreakScore||e.side2TiebreakScore)&&e.winningSide&&(u[e.winningSide-1]+=1)})),{pointsTally:s,tiebreaksTally:u}}function Vh(e){return e&&Math.ceil(e/2)||1}function Gh(e){return"P"===e}function qh(e){return!Gh(e)}function Wh(e){var t,r,n,i,o,u,s,l,c,d,p,v,f,m=e.participantIds,h=e.matchUpFormat,g=e.tallyPolicy,I=e.perPlayer,y=e.matchUps,U={},S=(null==g?void 0:g.excludeMatchUpStatuses)||[],w=y.filter((function(e){return(e.tieMatchUps||!S.includes(e.matchUpStatus))&&(!(null==m?void 0:m.length)||2===E(m,[Yh(e,0),Yh(e,1)]).length)})),T=w.flatMap((function(e){var t,r,n=e.score,i=e.tieMatchUps;return i?i.filter((function(e){var t=e.matchUpStatus;return!S.includes(t)})).flatMap((function(e){var t,r,n=e.score;return null!==(r=null===(t=null==n?void 0:n.sets)||void 0===t?void 0:t.length)&&void 0!==r?r:0})):null!==(r=null===(t=null==n?void 0:n.sets)||void 0===t?void 0:t.length)&&void 0!==r?r:0})),P=T.reduce((function(e,t){return e+t}),0);try{for(var D=a(w),b=D.next();!b.done;b=D.next()){var N=b.value,M=N.matchUpStatus,R=N.tieMatchUps,A=N.tieFormat,C=N.score,x=N.winningSide,O=N.sides,F=A&&N._disableAutoCalc&&A.collectionDefinitions.every((function(e){return e.scoreValue})),k=x&&Hh(N),_=x&&zh(N);if(k||_)if(Kh(U,k),Kh(U,_),null==R?void 0:R.length){I=0;try{for(var L=(o=void 0,a(R)),j=L.next();!j.done;j=L.next()){var B=(K=j.value).matchUpType,V=B===xs,G=B===Es;K.winningSide&&(K.winningSide===x?(k&&(U[k].tieMatchUpsWon+=1,G&&(U[k].tieSinglesWon+=1),V&&(U[k].tieDoublesWon+=1)),_&&(U[_].tieMatchUpsLost+=1,G&&(U[_].tieSinglesLost+=1),V&&(U[_].tieDoublesLost+=1))):K.winningSide!==x&&(_&&(U[_].tieMatchUpsWon+=1,G&&(U[_].tieSinglesWon+=1),V&&(U[_].tieDoublesWon+=1)),k&&(U[k].tieMatchUpsLost+=1,G&&(U[k].tieSinglesLost+=1),V&&(U[k].tieDoublesLost+=1)))),Zh({matchUpFormat:K.matchUpFormat,matchUpStatus:K.matchUpStatus,score:K.score,winningParticipantId:k,losingParticipantId:_,participantResults:U,isTieMatchUp:!0,manualGamesOverride:F,tallyPolicy:g,winningSide:x})}}catch(e){o={error:e}}finally{try{j&&!j.done&&(u=L.return)&&u.call(L)}finally{if(o)throw o.error}}Xh({winningParticipantId:k,losingParticipantId:_,participantResults:U,matchUpStatus:M})}else Zh({matchUpFormat:null!==(c=N.matchUpFormat)&&void 0!==c?c:h,isTieMatchUp:void 0,winningParticipantId:k,manualGamesOverride:F,losingParticipantId:_,participantResults:U,matchUpStatus:M,tallyPolicy:g,winningSide:x,score:C});else if(M&&eu.includes(M)){var q=Yh(N,0),W=Yh(N,1);q&&(Kh(U,q),U[q].matchUpsCancelled+=1),W&&(Kh(U,W),U[W].matchUpsCancelled+=1)}else if(null==R?void 0:R.length){I=0;var H=function(e){if(e.winningSide){var t=null===(s=null==O?void 0:O.find((function(t){return t.sideNumber===e.winningSide})))||void 0===s?void 0:s.participantId,r=null===(l=null==O?void 0:O.find((function(t){return t.sideNumber===e.winningSide})))||void 0===l?void 0:l.participantId;t&&r&&(Kh(U,t),Kh(U,r),U[t].tieMatchUpsWon+=1,U[r].tieMatchUpsLost+=1,e.matchUpType===Es?(U[t].tieSinglesWon+=1,U[r].tieSinglesLost+=1):e.matchUpType===xs&&(U[t].tieDoublesWon+=1,U[r].tieDoublesLost+=1))}Jh({score:e.score,manualGamesOverride:F,participantResults:U,sides:O})};try{for(var z=(n=void 0,a(R)),Y=z.next();!Y.done;Y=z.next()){var K;H(K=Y.value)}}catch(e){n={error:e}}finally{try{Y&&!Y.done&&(i=z.return)&&i.call(z)}finally{if(n)throw n.error}}}else Jh({manualGamesOverride:F,participantResults:U,score:C,sides:O});if(F){var J=null===(d=null==O?void 0:O.find((function(e){return 1===e.sideNumber})))||void 0===d?void 0:d.participantId,Z=null===(p=null==O?void 0:O.find((function(e){return 2===e.sideNumber})))||void 0===p?void 0:p.participantId;Kh(U,J),Kh(U,Z);var X=null===(v=null==C?void 0:C.sets)||void 0===v?void 0:v.reduce((function(e,t){var r;return e+(null!==(r=null==t?void 0:t.side1Score)&&void 0!==r?r:0)}),0),Q=null===(f=null==C?void 0:C.sets)||void 0===f?void 0:f.reduce((function(e,t){var r;return e+(null!==(r=t.side2Score)&&void 0!==r?r:0)}),0);J&&(U[J].gamesWon+=X,U[J].gamesLost+=Q),Z&&(U[Z].gamesWon+=Q,U[Z].gamesLost+=X)}}}catch(e){t={error:e}}finally{try{b&&!b.done&&(r=D.return)&&r.call(D)}finally{if(t)throw t.error}}return function(e){var t,r=e.participantResults,n=e.matchUpFormat,i=e.tallyPolicy,a=e.perPlayer,o=e.totalSets,u=n&&Zd(n)||{},s=u.bestOf,l=s&&Math.ceil(s/2)||1,c=null===(t=u.setFormat)||void 0===t?void 0:t.setTo;Object.keys(r).forEach((function(e){var t=r[e].setsWon,n=r[e].setsLost,u=(null==i?void 0:i.groupTotalSetsPlayed)?o:a*(l||0)||t+n,s=Math.round(t/u*1e3)/1e3;(s===1/0||isNaN(s))&&(s=u);var d=r[e].tieMatchUpsWon,p=d+r[e].tieMatchUpsLost,v=Math.round(d/p*1e3)/1e3;(v===1/0||isNaN(v))&&(v=d);var f=r[e].matchUpsWon,m=f+r[e].matchUpsLost,h=Math.round(f/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=f);var g=r[e].gamesWon||0,I=r[e].gamesLost||0,y=(a||0)*(l||0)*(c||0),U=Math.max(y,g+I),S=Math.round(g/U*1e3)/1e3;(S===1/0||isNaN(S))&&(S=0);var w=Math.round(r[e].pointsWon/r[e].pointsLost*1e3)/1e3;(w===1/0||isNaN(w))&&(w=0),r[e].setsWon=t,r[e].setsLost=n,r[e].setsPct=s,r[e].tieMatchUpsWon=d,r[e].tieMatchUpsPct=v,r[e].matchUpsPct=h,r[e].gamesWon=g,r[e].gamesLost=I,r[e].gamesPct=S,r[e].pointsPct=w,r[e].result="".concat(r[e].matchUpsWon,"/").concat(r[e].matchUpsLost)}))}({participantResults:U,matchUpFormat:h,tallyPolicy:g,perPlayer:I,totalSets:P}),{participantResults:U}}function Hh(e){return Yh(e,e.winningSide-1)}function zh(e){return Yh(e,1-(e.winningSide-1))}function Yh(e,t){if(!(null==e?void 0:e.sides))return console.log("no sides:",{matchUp:e}),"foo";var r=e.sides[t];return r?r.participantId:(console.log("No Side",{matchUp:e,index:t}),"foo")}function Kh(e,t){t&&!e[t]&&(e[t]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function Jh(e){var t,r,n=e.manualGamesOverride,i=e.participantResults,o=e.score,u=e.sides,s=(o||{}).sets,c=[[],[]],d=[0,0];try{for(var p=a(s||[]),v=p.next();!v.done;v=p.next()){var f=v.value,m=f.winningSide,h=f.side1Score,g=f.side2Score;m&&(d[m-1]+=1),c[0].push(l(h||0)),c[1].push(l(g||0))}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}var I=[c[0].reduce((function(e,t){return e+t}),0),c[1].reduce((function(e,t){return e+t}),0)];u.forEach((function(e,t){var r=e.participantId;r&&(Kh(i,r),i[r].setsWon+=d[t],i[r].setsLost+=d[1-t],n||(i[r].gamesWon+=I[t],i[r].gamesLost+=I[1-t]))}))}function Zh(e){var t=e.winningParticipantId,r=e.losingParticipantId,n=e.participantResults,i=e.manualGamesOverride,a=e.matchUpFormat,o=e.matchUpStatus,u=e.isTieMatchUp,s=e.tallyPolicy,l=e.winningSide,c=e.score,d=l&&l-1,p=1-d;u||Xh({winningParticipantId:t,losingParticipantId:r,participantResults:n,matchUpStatus:o});var v=Lh({matchUpStatus:o,matchUpFormat:a,tallyPolicy:s,winningSide:l,score:c}),f=jh({matchUpStatus:o,matchUpFormat:a,tallyPolicy:s,winningSide:l,score:c}),m=Bh({score:c,matchUpFormat:a}).pointsTally;t&&(n[t].setsWon+=v[d],n[t].setsLost+=v[p],i||(n[t].gamesWon+=f[d],n[t].gamesLost+=f[p]),n[t].pointsWon+=m[d],n[t].pointsLost+=m[p]),r&&(n[r].setsWon+=v[p],n[r].setsLost+=v[d],i||(n[r].gamesWon+=f[p],n[r].gamesLost+=f[d]),n[r].pointsWon+=m[p],n[r].pointsLost+=m[d])}function Xh(e){var t=e.winningParticipantId,r=e.losingParticipantId,n=e.participantResults,i=e.matchUpStatus;r&&(i===Ko&&(n[r].walkovers+=1),i===jo&&(n[r].defaults+=1),i===Ho&&(n[r].retirements+=1),[jo,Ho,Ko].includes(i)&&(n[r].allDefaults+=1),n[r].matchUpsLost+=1),t&&(n[t].matchUpsWon+=1),r&&t&&(n[r].defeats.push(t),n[t].victories.push(r))}function Qh(e){var t=e.participantResults,r=e.participantIds,n=e.attribute;return $h({participantResults:t,participantIds:r}).reduce((function(e,t){var r=t.participantId,i=t.results,a=null==i?void 0:i[n];return!isNaN(a)&&r&&(e[a]?e[a].push(r):e[a]=[r]),e}),{})}function $h(e){return(e.participantIds||Object.keys(e.participantResults)).reduce((function(t,r,n){return t.push({participantId:r,i:n,results:e.participantResults[r]}),t}),[])}var eg=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],tg={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function rg(e){var r=e.requireCompletion,n=void 0===r||r,i=e.participantResults,a=e.subOrderMap,s=e.tallyPolicy,l=[];if(n&&!function(e){var t=e.participantResults,r=e.participantsCount,n=$h({participantResults:t}),i=n.filter((function(e){return r-1===e.results.matchUpsWon+e.results.matchUpsLost+e.results.matchUpsCancelled}));return r===i.length}(e))return{};var c=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(null==s?void 0:s.groupOrderKey)?s.groupOrderKey:"matchUpsWon",d=Qh({participantResults:i,attribute:c});l.push({attribute:c,groups:d});var p,v=Object.keys(d).map((function(e){return parseFloat(e)})).sort((function(e,t){return t-e})).map((function(e){return d[e]})).map((function(r){var n,i=ng(t({participantIds:r},e));return l.push.apply(l,u([],o(null!==(n=i.report)&&void 0!==n?n:[]),!1)),i.order})).flat(1/0),f=1;v.forEach((function(e,t){t&&(e.resolved||p&&!e.resolved)&&(f+=1),p=e.resolved,e.resolved?(e.position=t+1,f=e.position):e.position=f}));var m=v.map((function(e){return e.position})),h=T(m);return v.forEach((function(e){var t,r,n,o=e||{},u=o.participantId,l=o.position,c=i[u];e.GEMscore=(t=c,r=Array.isArray(null==s?void 0:s.GEMscore)?Object.keys(tg).filter((function(e){return s.GEMscore.includes(e)})):Object.keys(tg),n=r.map((function(e){return(t[e]||0)*Math.pow(10,tg[e].toFixed(3))})),n.reduce((function(e,t){return e+t}),0));var d=h[l];void 0!==(null==e?void 0:e.position)&&(d>1&&(e.ties=d,a&&(e.subOrder=a[u])),e.rankOrder=l,e.groupOrder=l+(e.subOrder||1)-1)})),{groupOrder:v,report:l.flat(1/0).filter(Boolean)}}function ng(e){var t,r=e.participantResults,n=e.disableHeadToHead,i=e.participantIds,a=e.matchUpFormat,s=e.tallyPolicy,l=e.matchUps,c=[],d=[];if(1===(null==i?void 0:i.length))return{order:[{resolved:!0,participantId:i[0]}]};if(2===(null==i?void 0:i.length)&&(!(null==s?void 0:s.headToHead)||!s.headToHead.disabled&&!n)){var p=function(e){var t=e.participantIds,r=e.participantResults;if(!t)return;if(r[t[0]].victories.includes(t[1]))return t.map((function(e){return{resolved:!0,participantId:e}}));if(r[t[1]].victories.includes(t[0]))return t.reverse().map((function(e){return{resolved:!0,participantId:e}}))}({participantIds:i,participantResults:r});if(p){var v=p[0].participantId;return d.push({attribute:"head2Head",participantIds:i,headToHeadWinner:v}),{order:[p],headToHeadWinner:v,report:d}}}var m=((null==s?void 0:s.tallyDirectives)||eg).filter((function(e){var t=!(f(e.maxParticipants)&&(null==i?void 0:i.length)>e.maxParticipants);return t||c.push(e),t}));return c.length&&d.push({excludedDirectives:c,participantIds:i}),m.every((function(e){var r=e.attribute,n=e.reversed,c=e.idsFilter,p=e.disableHeadToHead;return t=function(e){var t,r=e.disableHeadToHead,n=e.participantIds,i=e.matchUpFormat,a=e.tallyPolicy,s=e.attribute,l=e.idsFilter,c=e.matchUps,d=e.reversed,p=Wh({participantIds:l&&n,matchUpFormat:i,tallyPolicy:a,matchUps:c}).participantResults,v=Qh({participantResults:p,participantIds:n,attribute:s}),f=[{attribute:s,reversed:d,groups:v,idsFilter:l}];return Object.keys(v).length>1&&n.length&&(t=Object.keys(v).map((function(e){return parseFloat(e)})).sort((function(e,t){return d?e-t:t-e})).map((function(e){return v[e]})).map((function(e){var t,n=ng({participantResults:p,disableHeadToHead:r,participantIds:e,matchUpFormat:i,tallyPolicy:a,matchUps:c});return f.push.apply(f,u([],o(null!==(t=n.report)&&void 0!==t?t:[]),!1)),n.order})).flat(1/0)),{order:t,report:f}}({disableHeadToHead:p,participantIds:i,matchUpFormat:a,tallyPolicy:s,attribute:r,idsFilter:c,matchUps:l,reversed:n}),d.push(t.report),!t.order})),t.order?{order:t.order,report:d}:{order:null==i?void 0:i.map((function(e){return{participantId:e}})),report:d}}function ig(e){var t=e.policyDefinitions,r=e.generateReport,n=e.matchUpFormat,i=e.matchUps,a=void 0===i?[]:i,o=e.subOrderMap,u=e.perPlayer;if(!Zs(a))return{error:$e};var s=a.reduce((function(e,t){var r=t.structureId;return e.includes(r)?e:e.concat(r)}),[]);if(1!==s.length)return{error:xr,info:"Maximum one structureId"};var l=a.filter((function(e){return e&&e.matchUpStatus!==Fo})),c=l.length&&U(l.map((function(e){return e.drawPositions})).flat()).length,d=l.filter((function(e){return hp({matchUp:e})})).length===l.length;d||(u=0);var p,v,f=a.every((function(e){var t=e.matchUpType,r=e.tieMatchUps;return t===Fs&&(null==r?void 0:r.every((function(e){return hp({matchUp:e})})))})),m=null==t?void 0:t[Aa],h=a.filter((function(e){return hp({matchUp:e})||e.matchUpType===Fs})),g=Wh({matchUps:h,matchUpFormat:n,tallyPolicy:m,perPlayer:u}).participantResults,I=rg({matchUps:h,participantResults:g,participantsCount:c,matchUpFormat:n,tallyPolicy:m,subOrderMap:o}),y=I.groupOrder,S=I.report;if(d&&y)p=S,v=y,y.forEach((function(e){var t=e.participantId,r=e.groupOrder,n=e.rankOrder,i=e.subOrder,a=e.ties,o=e.GEMscore,u=g[t];Object.assign(u,{groupOrder:r,rankOrder:n,GEMscore:o,subOrder:i,ties:a})}));else{var w=rg({requireCompletion:!1,participantResults:g,participantsCount:c,matchUpFormat:n,tallyPolicy:m,subOrderMap:o,matchUps:a}),T=w.groupOrder;p=w.report,v=T,T&&T.forEach((function(e){var t=e.participantId,r=e.groupOrder,n=e.GEMscore,i=g[t];Object.assign(i,{provisionalOrder:r,GEMscore:n})}))}var P={completedTieMatchUps:f,readableReport:"",participantResults:g,bracketComplete:d,order:[],report:p};if((d||f)&&(P.order=v),r||on({tally:!0})){var D=function(e){var t=e.matchUps,r=e.order,n=e.report,i={};t.forEach((function(e){e.sides.forEach((function(e){e.participantId&&e.participant&&(i[e.participantId]=e.participant.participantName)}))}));var a=[];return Array.isArray(n)&&n.forEach((function(e,t){var r,n,o;if(null===(r=e.excludedDirectives)||void 0===r?void 0:r.length){var u=e.excludedDirectives.map((function(e){return e.attribute})).join(", "),s="".concat(u.length," directives were excluded due to participants limit}");a.push(s);var l="Excluded: ".concat(u);a.push(l)}else{var c=function(t,r){return parseFloat(e.reversed?t:r)-parseFloat(e.reversed?r:t)},d=e.groups?Object.values(e.groups).flat(1/0).length:null!==(o=null===(n=e.participantIds)||void 0===n?void 0:n.length)&&void 0!==o?o:0,p=e.reversed?" in reverse order":"",v=e.groups?"grouped":"separated",f="Step ".concat(t+1,": ").concat(d," particiants were ").concat(v).concat(p," by ").concat(e.attribute);a.push(f),e.idsFilter&&(s="".concat(e.attribute," was calculated considering ONLY TIED PARTICIPANTS"),a.push(s)),function(e){e.groups&&Object.keys(e.groups).sort(c).forEach((function(t){var r=e.groups[t].map((function(e){return i[e]})).join(", "),n="".concat(t," ").concat(e.attribute,": ").concat(r);a.push(n)}))}(e)}a.push("----------------------")})),a.push("Final Order:"),r.forEach((function(e){var t=e.participantId,r=e.resolved,n=e.groupOrder||e.provisionalOrder;a.push("".concat(n,": ").concat(i[t]," => resolved: ").concat(!!r))})),a.join("\r\n")}({matchUps:a,report:p,order:v});on({tally:!0})&&console.log(D),P.readableReport=D}return P}function ag(e){var t=e.collectionDefinition,r=e.groupValueNumbers,n=e.groupValueGroups,i=e.sideTieValues,a=e.tieMatchUps.filter((function(e){return e.collectionId===t.collectionId})),o=[0,0],u=[0,0],s=a.every((function(e){return eu.includes(e.matchUpStatus)})),l=t.collectionValueProfiles,c=t.collectionGroupNumber,d=t.collectionValue,p=t.matchUpValue,v=t.winCriteria,f=t.scoreValue,m=t.setValue,h=c&&r.includes(c),g=[0,0];if(a.forEach((function(e){e.winningSide&&(g[e.winningSide-1]+=1)})),I(p)?a.forEach((function(e){e.winningSide&&(o[e.winningSide-1]+=p)})):I(m)?a.forEach((function(e){var t,r;null===(r=null===(t=e.score)||void 0===t?void 0:t.sets)||void 0===r||r.forEach((function(e){e.winningSide&&(o[e.winningSide-1]+=m)}))})):I(f)?a.forEach((function(e){var t,r;null===(r=null===(t=e.score)||void 0===t?void 0:t.sets)||void 0===r||r.forEach((function(t){var r=t.side1TiebreakScore,n=void 0===r?0:r,i=t.side2TiebreakScore,a=void 0===i?0:i,u=t.side1Score,s=void 0===u?0:u,l=t.side2Score,c=void 0===l?0:l;(e.matchUpStatus===_o||e.winningSide||t.winningSide)&&(s||c?(o[0]+=s,o[1]+=c):(n||a)&&t.winningSide&&(o[t.winningSide-1]+=1))}))})):Array.isArray(l)&&a.forEach((function(e){if(e.winningSide){var r=e.collectionPosition,n=function(e){var t=e.collectionDefinition,r=e.collectionPosition,n=t.collectionValueProfiles||[],i=null==n?void 0:n.find((function(e){return e.collectionPosition===r}));return null==i?void 0:i.matchUpValue}({collectionDefinition:t,collectionPosition:r});I(n)&&(o[e.winningSide-1]+=n)}})),I(d)){var y=void 0;if(null==v?void 0:v.aggregateValue)s&&(I(p||m||f)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:g[0]!==g[1]&&(y=g[0]>g[1]?1:2));else if(null==v?void 0:v.valueGoal)y=o.reduce((function(e,t,r){return t>=v.valueGoal?r+1:e}),0);else{var U=Math.floor(t.matchUpCount/2)+1;y=g.reduce((function(e,t,r){return t>=U?r+1:e}),0)}y&&(h?n[c].values[y-1]+=d:u[y-1]+=d)}else h?(n[c].values[0]+=o[0]||0,n[c].values[1]+=o[1]||0):u=o;h?(n[c].sideWins[0]+=g[0]||0,n[c].sideWins[1]+=g[1]||0,n[c].allGroupMatchUpsCompleted=n[c].allGroupMatchUpsCompleted&&s,n[c].matchUpsCount+=a.length):u.forEach((function(e,t){return i[t]+=e||0}))}function og(e){var t,r,n,i,o,u,s,l,c,d=e.sideAdjustments,p=void 0===d?[0,0]:d,v=e.separator,f=void 0===v?"-":v,m=e.drawDefinition,h=e.matchUpsMap,g=e.structure,I=e.matchUp,y=e.event;if(!Array.isArray(p)||2!==p.length||isNaN(p.reduce((function(e,t){return e+t}))))return{error:xr};if(!I)return{error:et};var U=(null===(o=Gd({matchUp:I,drawDefinition:m,structure:g,event:y}))||void 0===o?void 0:o.tieFormat)||(null==e?void 0:e.tieFormat);if(!U)return{error:Je};var S=zm({tieFormat:U});if(S.error)return S;var w=(null==U?void 0:U.collectionDefinitions)||[],T=null!==(u=null==I?void 0:I.tieMatchUps)&&void 0!==u?u:[],P=[0,0],D=Nm(U),b=D.groupValueGroups,N=D.groupValueNumbers;try{for(var M=a(w),R=M.next();!R.done;R=M.next()){ag({collectionDefinition:R.value,groupValueNumbers:N,groupValueGroups:b,sideTieValues:P,tieMatchUps:T})}}catch(e){t={error:e}}finally{try{R&&!R.done&&(r=M.return)&&r.call(M)}finally{if(t)throw t.error}}var A=function(e){var t=b[e],r=t.allGroupMatchUpsCompleted,n=t.matchUpCount,i=t.winCriteria,a=t.groupValue,o=t.sideWins,u=t.values,s=void 0;if(null==i?void 0:i.aggregateValue)r&&u[0]!==u[1]&&(s=u[0]>u[1]?1:2);else if(null==i?void 0:i.valueGoal)s=u.reduce((function(e,t,r){return t>=i.valueGoal?r+1:e}),void 0);else{var l=Math.floor(n/2)+1;s=o.reduce((function(e,t,r){return t>=l?r+1:e}),void 0)}s&&(P[s-1]+=a||0)};try{for(var E=a(N),C=E.next();!C.done;C=E.next()){A(C.value)}}catch(e){n={error:e}}finally{try{C&&!C.done&&(i=E.return)&&i.call(E)}finally{if(n)throw n.error}}var x,O=P.map((function(e,t){return(e||0)+p[t]})),F={side1Score:O[0],side2Score:O[1],winningSide:void 0},k=O.join(f),_=O.slice().reverse().join(f);if(null==U?void 0:U.winCriteria){var L=U.winCriteria,j=L.valueGoal,B=L.aggregateValue,V=L.tallyDirectives;if(j){var G=O.map((function(e,t){return{sideNumber:t+1,points:e}})).find((function(e){return e.points>=j}));x=null==G?void 0:G.sideNumber}else if(B){var q=T.every((function(e){return e.matchUpStatus&&eu.includes(e.matchUpStatus)||e.winningSide}));q&&O[0]!==O[1]&&(x=O[0]>O[1]?1:2)}if(!x&&V){var W=I.matchUpId,H=I.hasContext?I:(null===(s=null==h?void 0:h.drawMatchUps)||void 0===s?void 0:s[W])||m&&(null===(l=Ef({inContext:!0,drawDefinition:m,matchUpId:W}))||void 0===l?void 0:l.matchUp);if(H){var z=ig({matchUps:[H]}),Y=z.completedTieMatchUps,K=z.order;if(Y&&(null==K?void 0:K.length)){var J=K[0].participantId;x=null===(c=H.sides.find((function(e){return e.participantId===J})))||void 0===c?void 0:c.sideNumber}}}}return x&&(F.winningSide=x),{scoreStringSide1:k,scoreStringSide2:_,winningSide:x,set:F}}var ug={matchUpStatus:Yo,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function sg(e){var r,n,i,a=e.inContextDrawMatchUps,o=e.positionAssignments,u=e.sourceMatchUpStatus,s=e.targetDrawPosition,l=e.tournamentRecord,c=e.sourceMatchUpId,d=e.drawDefinition,p=e.dualMatchUp,v=e.matchUpsMap,f=e.matchUp,m=e.event;if(p){var h=a.find((function(e){var t=e.matchUpId;return f.matchUpId===t})),g=null===(n=null===(r=h.sides)||void 0===r?void 0:r.find((function(e){return e.drawPosition===s})))||void 0===n?void 0:n.sideNumber,I=null===(i=f.sides)||void 0===i?void 0:i.find((function(e){return e.sideNumber===g}));I&&delete I.lineUp}f.drawPositions=(f.drawPositions||[]).map((function(e){return e===s?void 0:e})).filter(Boolean);var y=o.filter((function(e){var t,r=e.drawPosition;return null===(t=f.drawPositions)||void 0===t?void 0:t.includes(r)})),U=y.filter((function(e){return e.bye})).length;return f.matchUpStatus=U&&Fo||[jo,Ko].includes(f.matchUpStatus)&&f.matchUpStatus||Yo,[Ko,jo].includes(f.matchUpStatus)&&(f.winningSide=void 0),f.matchUpStatusCodes&&Of({inContextDrawMatchUps:a,sourceMatchUpStatus:u,sourceMatchUpId:c,matchUpsMap:v,matchUp:f}),Cp({tournamentId:null==l?void 0:l.tournamentId,eventId:null==m?void 0:m.eventId,context:"".concat("removeSubsequentDrawPosition","-").concat(s),drawDefinition:d,matchUp:f}),t({},L)}function lg(e){var t=e.tournamentRecords,r=e.eventId,n=e.drawId,i=df({tournamentRecords:t}).tournamentIdMap;return(i?Object.keys(i):[]).find((function(e){return r&&(null==i?void 0:i[e].includes(r))||n&&(null==i?void 0:i[e].includes(n))}))}function cg(e){var r=e.positionAssignments,n=e.tournamentRecord,i=e.drawDefinition,a=e.matchUpFormat,s=e.matchUps,c=e.event;if(!Zs(s))return{error:xr};if(!r)return{error:xr};var d=rl({policyTypes:[Aa],tournamentRecord:n,drawDefinition:i,event:c}).policyDefinitions,p=function(e){var t=(e.positionAssignments||[]).filter(Ri(Li)).map((function(e){var t=Vn({element:e,name:Io}).extension,r=l(null==t?void 0:t.value),n=!isNaN(r)&&r;return n&&{participantId:e.participantId,subOrder:n}})).filter(Boolean),r=t.map((function(e){return e.subOrder})),n=T(r),i=Object.assign.apply(Object,u([{}],o(t.filter((function(e){var t=e.subOrder;return 1===n[t]})).map((function(e){var t,r=e.participantId,n=e.subOrder;return(t={})[r]=n,t}))),!1));return{subOrderMap:i}}({positionAssignments:r}).subOrderMap,v=ig({policyDefinitions:d,matchUpFormat:a,subOrderMap:p,matchUps:s});if(v.error)return v;var f=v.participantResults,m=v.bracketComplete,h=v.report,g=Object.keys(f);return r.forEach((function(e){var t=e.participantId;g.includes(t)?(jn({element:e,extension:{value:f[t],name:yo}}),f[t].ties||_n({element:e,name:Io})):(_n({element:e,name:yo}),_n({element:e,name:Io}))})),Op({drawDefinition:i}),t(t({},L),{participantResults:f,bracketComplete:m,report:h})}function dg(e){var r;return"object"!=typeof e?{error:pt}:"object"!=typeof e.element?{error:xr}:e.notes?"string"==typeof e.notes||(null===(r=e.notes)||void 0===r?void 0:r.testing)?(Object.assign(e.element,{notes:e.notes}),t({},L)):{error:xr}:{error:pt}}function pg(e){var r,n,i,s,l,c,d,p,v,f,m,h,g=e.matchUpStatusCodes,I=e.removeWinningSide,y=e.tournamentRecord,S=e.drawDefinition,w=e.matchUpFormat,T=e.matchUpStatus,P=e.removeScore,D=e.winningSide,b=e.matchUpId,N=e.matchUp,M=e.event,R=e.notes,A=e.score,E="modifyMatchUpScore",C=N.matchUpType===Fs;if(C&&S){if(b&&N.matchUpId!==b){var x=Ef({drawDefinition:S,matchUpId:b,event:M});if(!x.matchUp)return{error:Qe};N=x.matchUp,h=x.structure}}else N.matchUpId!==b&&console.log("!!!!!");T&&[Ko,Vo].includes(T)||P?Object.assign(N,t({},ug)):A&&(N.score=A);var O,F=T&&(null==N?void 0:N.matchUpStatus)===jo&&T!==jo;if(T&&(N.matchUpStatus=T),w&&(N.matchUpFormat=w),g&&(N.matchUpStatusCodes=g),D&&(N.winningSide=D),I&&(N.winningSide=void 0),!h&&S&&(h=Ef({drawDefinition:S,matchUpId:b,event:M}).structure),!T||N.winningSide||!Bp(N)||eu.includes(T)||[Oo,zo].includes(T)||(N.matchUpStatus=Go),F&&(null===(i=null==N?void 0:N.processCodes)||void 0===i?void 0:i.length)||T===jo){var k=null===(s=tl({tournamentRecord:y,drawDefinition:S,structure:h,event:M}))||void 0===s?void 0:s.appliedPolicies;O=null===(c=null===(l=null==k?void 0:k[ja])||void 0===l?void 0:l.processCodes)||void 0===c?void 0:c.incompleteAssignmentsOnDefault}if(!N.collectionId){var _=(null==h?void 0:h.structureType)===Iu,j=ip({drawDefinition:S,structure:h});if(np({drawDefinition:S,structure:h})||j||_){var B=_&&h.structures.find((function(e){return null==e?void 0:e.matchUps.find((function(e){return e.matchUpId===b}))})),V=function(e){var t,r,n;w=C?"SET1-S:T100":null!==(n=null!==(r=null!==(t=null!=w?w:N.matchUpFormat)&&void 0!==t?t:null==e?void 0:e.matchUpFormat)&&void 0!==r?r:null==S?void 0:S.matchUpFormat)&&void 0!==n?n:null==M?void 0:M.matchUpFormat;var i=mp({afterRecoveryTimes:!1,tournamentRecord:y,inContext:!0,matchUpFilters:C?{matchUpTypes:[Fs]}:void 0,drawDefinition:S,structure:e,event:M}).matchUps;return j&&(e.positionAssignments=U(i.flatMap((function(e){var t;return(null!==(t=e.sides)&&void 0!==t?t:[]).map((function(e){return e.participantId}))})).filter(Boolean)).map((function(e){return{participantId:e}}))),cg({positionAssignments:e.positionAssignments,tournamentRecord:y,drawDefinition:S,matchUpFormat:w,matchUps:i,event:M})}(B||h);if(V.error)return On({result:V,stack:E})}}if(R&&(V=dg({element:N,notes:R})).error)return On({result:V,stack:E});var G=null==y?void 0:y.tournamentId,q=Un().topics.includes(Nd),W=(q||O)&&fl({drawDefinition:S}),H=W&&(null===(d=Ip({matchUpFilters:{matchUpIds:[b]},nextMatchUps:!0,tournamentRecord:y,inContext:!0,drawDefinition:S,matchUpsMap:W}).matchUps)||void 0===d?void 0:d[0]);if(q&&H&&function(e){var r=e.tournamentId,n=e.inContextMatchUp;n&&(mn({payload:{inContextMatchUp:n,tournamentId:r},topic:Nd,key:n.matchUpId}),t({},L))}({tournamentId:G,inContextMatchUp:H}),Array.isArray(O)&&H&&!(null===(p=H.sides)||void 0===p?void 0:p.every((function(e){return e.participantId}))))if(T===jo)N.processCodes=U(u(u([],o(null!==(v=N.processCodes)&&void 0!==v?v:[]),!1),o(O),!1));else try{for(var z=a(O||[]),Y=z.next();!Y.done;Y=z.next()){var K=Y.value,J=K&&(null===(f=null==N?void 0:N.processCodes)||void 0===f?void 0:f.lastIndexOf(K));null===(m=null==N?void 0:N.processCodes)||void 0===m||m.splice(J,1)}}catch(e){r={error:e}}finally{try{Y&&!Y.done&&(n=z.return)&&n.call(z)}finally{if(r)throw r.error}}return Cp({eventId:null==M?void 0:M.eventId,context:E,drawDefinition:S,tournamentId:G,matchUp:N}),t({},L)}function vg(e){var r,n,i,a,o,u=e.exitWhenNoValues,s=e.drawDefinition,l=e.matchUpStatus,c=e.removeScore,d=e.matchUpsMap,p=e.matchUpId,v=e.event,f=e.tournamentRecords||e.tournamentRecord&&((r={})[null===(n=e.tournamentRecord)||void 0===n?void 0:n.tournamentId]=e.tournamentRecord,r)||{},m=e.tournamentId||(null===(i=e.tournamentRecord)||void 0===i?void 0:i.tournamentId);f&&lg(t({tournamentRecords:f},e));var h=m&&f[m];if(!h)return{error:W};var g=Ef({drawDefinition:s,event:v,matchUpId:p});if(g.error)return g;if(!g.matchUp)return{error:Qe};var I=g.matchUp,y=g.structure;if(!I.tieMatchUps)return{error:tt};Im({tournamentId:null==h?void 0:h.tournamentId,eventId:null==v?void 0:v.eventId,dualMatchUp:I,drawDefinition:s});var U=Vn({name:ro,element:I}).extension;if(null==U?void 0:U.value){if(!c)return t(t({},L),{score:I.score});_n({element:I,name:ro})}var S=null===(a=Gd({drawDefinition:s,structure:y,matchUp:I,event:v}))||void 0===a?void 0:a.tieFormat;I.tieFormat=bm(S);var w=og({drawDefinition:s,matchUpsMap:d,structure:y,matchUp:I,event:v}),T=w.winningSide,P=w.set,D=w.scoreStringSide1,b=w.scoreStringSide2,N=(null==P?void 0:P.side1Score)||(null==P?void 0:P.side2Score);if(u&&!I.score&&!N)return t({},L);var M,R={scoreStringSide1:D,scoreStringSide2:b,sets:P?[P]:[]},A=T&&[1,2].includes(T),E=A&&_o||qp({matchUpStatus:null!=l?l:I.matchUpStatus,tieMatchUps:I.tieMatchUps,winningSide:I.winningSide,score:R})&&Go||Yo,C=!(!I.winningSide||A),x=I.tieMatchUps.find((function(e){var t,r=e.score,n=e.winningSide,i=e.matchUpStatus;return(null===(t=null==r?void 0:r.sets)||void 0===t?void 0:t.length)&&(r.sets[0].side1Score||r.sets[0].side2Score)||i&&eu.includes(i)||n}));if(I.tieFormat&&!A&&!x){var O=null===(o=Gd({drawDefinition:s,structure:y,event:v}))||void 0===o?void 0:o.tieFormat;O&&JSON.stringify(S)===JSON.stringify(O)&&(I.tieFormatId=void 0,I.tieFormat=void 0,M=!0)}return pg({matchUpStatus:E,score:R,removeWinningSide:C,tournamentRecord:h,drawDefinition:s,removeScore:c,winningSide:T,matchUpId:p,matchUp:I,event:v}),t(t({},L),{score:R,removeWinningSide:C,tieFormatRemoved:M,winningSide:T})}function fg(e){var r=e.dualWinningSideChange,n=e.inContextDrawMatchUps,i=e.tournamentRecord,a=e.drawDefinition,s=e.matchUpStatus,l=e.matchUpsMap,c=e.dualMatchUp,d=e.targetData,p=e.matchUpId,v=e.structure,f=e.event,m=Boolean(e.matchUp.collectionId),h=ip({drawDefinition:a,structure:v}),g=d.matchUp||{},I=g.drawPositions,y=g.winningSide;if(!h&&!I)return{error:ie};var U,S=d.targetLinks,w=S.loserTargetLink,T=S.winnerTargetLink,P=S.byeTargetLink,D=d.targetMatchUps,b=D.loserMatchUp,N=D.winnerMatchUp,M=D.byeMatchUp,R=pg(t(t({},e),{matchUpStatus:s||Yo,removeWinningSide:!0}));if(R.error)return R;if(m&&(U=vg({matchUpId:e.matchUpTieId,tournamentRecord:i,drawDefinition:a,matchUpsMap:e.matchUpsMap,event:f}),!r&&!U.removeWinningSide))return t({},L);if(h)return t({},L);var A=mp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:a,matchUpsMap:l,structure:v}).matchUps,E=ls({structure:v}).positionAssignments,C=y-1,O=1-C,F=I[C],k=I[O],_=(null==E?void 0:E.reduce((function(e,t){return t.drawPosition===k&&(e.loserParticipantId=t.participantId),t.drawPosition===F&&(e.winnerParticipantId=t.participantId),e}),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},j=_.winnerParticipantId,B=_.loserParticipantId,V=A.filter((function(e){var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.includes(k)}));if(N&&mg({sourceMatchUpStatus:s,sourceMatchUpId:p,inContextDrawMatchUps:n,winningDrawPosition:F,winnerParticipantId:j,tournamentRecord:i,winnerTargetLink:T,drawDefinition:a,winnerMatchUp:N,dualMatchUp:c,matchUpsMap:l}),b){var G=function(e){var t,r=e.matchUpStatuses,n=void 0===r?[Fo,Ko,jo]:r,i=e.drawPositionMatchUps,a=e.loserDrawPosition,o=e.sourceMatchUps,u=null==i?void 0:i.reduce((function(e,t){return!e||t.roundNumber>e.roundNumber?t:e}),void 0),s=null===(t=null==u?void 0:u.drawPositions)||void 0===t?void 0:t.find((function(e){return e!==a})),l=o.filter((function(e){var t;return null===(t=null==e?void 0:e.drawPositions)||void 0===t?void 0:t.includes(s)})).map((function(e){return e.matchUpStatus})),c=o.filter((function(e){var t;return null===(t=null==e?void 0:e.drawPositions)||void 0===t?void 0:t.includes(a)})).map((function(e){return e.matchUpStatus}));return{sourceMatchUp:u,winnerHadMatchUpStatus:x(l||[],n),winnerMatchUpStatuses:l,loserHadMatchUpStatus:x(c||[],n),loserMatchUpStatuses:c}}({drawPositionMatchUps:V,loserDrawPosition:k,sourceMatchUps:A}).winnerHadMatchUpStatus,q=w.linkCondition;if(G&&q===bu)hg({targetLink:w,inContextDrawMatchUps:n,drawDefinition:a,drawPosition:Math.min.apply(Math,u([],o(b.drawPositions),!1)),matchUpsMap:l,event:f});var W=function(e){var r,n,i,a;e.sourceMatchUpStatus;var o=e.loserParticipantId,u=e.tournamentRecord,s=e.loserTargetLink;e.sourceMatchUpId;var l=e.drawDefinition,c=e.loserMatchUp,d=e.matchUpsMap,p=e.dualMatchUp,v=e.event,f="removeDirectedLoser",m=s.target.structureId,h=as({drawDefinition:l,structureId:m}).structure;if(!h)return{error:De};var g=ls({structure:h}).positionAssignments,I=null===(r=null==g?void 0:g.find((function(e){return e.participantId===o})))||void 0===r?void 0:r.drawPosition;if(null==g||g.forEach((function(e){e.participantId===o&&delete e.participantId})),h.seedAssignments=(null!==(n=h.seedAssignments)&&void 0!==n?n:[]).filter((function(e){return e.participantId!==o})),p){var y=null==c?void 0:c.sides.reduce((function(e,t,r){return t.drawPosition===I?r:e}),void 0),U=null===(i=null==d?void 0:d.drawMatchUps)||void 0===i?void 0:i.find((function(e){return e.matchUpId===c.matchUpId})),S=null===(a=null==U?void 0:U.sides)||void 0===a?void 0:a[y];S&&(delete S.lineUp,Cp({tournamentId:null==u?void 0:u.tournamentId,eventId:null==v?void 0:v.eventId,matchUp:U,context:f,drawDefinition:l}))}return t({},L)}({sourceMatchUpStatus:s,sourceMatchUpId:p,loserParticipantId:B,tournamentRecord:i,loserTargetLink:w,drawDefinition:a,loserMatchUp:b,dualMatchUp:c,matchUpsMap:l,event:f});if(W.error)return W}M&&hg({sourceMatchUpId:p,targetLink:P,inContextDrawMatchUps:n,drawDefinition:a,drawPosition:Math.min.apply(Math,u([],o(M.drawPositions),!1)),matchUpsMap:l,event:f});var H=U&&{tieMatchUpResult:U};return t(t({},L),H)}function mg(e){var r,n,i=e.inContextDrawMatchUps,o=e.winningDrawPosition,u=e.sourceMatchUpStatus,s=e.winnerParticipantId,l=e.tournamentRecord,c=e.winnerTargetLink,d=e.sourceMatchUpId,p=e.drawDefinition,v=e.winnerMatchUp,f=e.matchUpsMap,m=e.dualMatchUp,h=e.event,g=v.structureId,I=v.roundNumber;if(c){var y=as({drawDefinition:p,structureId:c.target.structureId}).structure;if(!y)return{error:De};var U=ls({structure:y}).positionAssignments;y.seedAssignments=(null!==(r=y.seedAssignments)&&void 0!==r?r:[]).filter((function(e){return e.participantId!==s}));var S=null==U?void 0:U.find((function(e){return e.participantId===s})),w=null==S?void 0:S.drawPosition,P=mp({drawDefinition:p,structure:y,event:h}).matchUps,D=T(P.map((function(e){return e.drawPositions})).flat(1/0).filter(Boolean));if(1===(w?D[w]:void 0))null==U||U.forEach((function(e){e.participantId===s&&delete e.participantId}));else{var b=P.filter((function(e){return e.drawPositions.includes(w)}));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:b,winnerTargetLink:c})}var N=null===(n=null==f?void 0:f.drawMatchUps)||void 0===n?void 0:n.find((function(e){return e.matchUpId===v.matchUpId}));N&&Cp({tournamentId:null==l?void 0:l.tournamentId,eventId:null==h?void 0:h.eventId,matchUp:N,context:"removeDirectedWinner",drawDefinition:p})}return I&&function(e){var r,n,i=e.inContextDrawMatchUps,o=e.sourceMatchUpStatus,u=e.targetDrawPosition,s=e.tournamentRecord,l=e.sourceMatchUpId,c=e.drawDefinition,d=e.structureId,p=e.dualMatchUp,v=e.roundNumber,f=e.matchUpsMap,m=e.event,h=as({drawDefinition:c,structureId:d}).structure;if((null==h?void 0:h.structureType)===Iu)return t({},L);var g=((null==(f=null!=f?f:fl({drawDefinition:c}))?void 0:f.mappedMatchUps)||{})[d].matchUps,I=$p({drawPosition:u,matchUps:g}).initialRoundNumber,y=null==g?void 0:g.filter((function(e){var t;return e.roundNumber>=v&&e.roundNumber!==I&&(null===(t=e.drawPositions)||void 0===t?void 0:t.includes(u))})),U=ss({drawDefinition:c,structureId:d}).positionAssignments;try{for(var S=a(null!=y?y:[]),w=S.next();!w.done;w=S.next()){var T=w.value;sg({inContextDrawMatchUps:i,sourceMatchUpStatus:o,positionAssignments:U,targetDrawPosition:u,tournamentRecord:s,sourceMatchUpId:l,drawDefinition:c,dualMatchUp:p,matchUpsMap:f,matchUp:T,event:m})}}catch(e){r={error:e}}finally{try{w&&!w.done&&(n=S.return)&&n.call(S)}finally{if(r)throw r.error}}t({},L)}({targetDrawPosition:o,inContextDrawMatchUps:i,sourceMatchUpStatus:u,tournamentRecord:l,sourceMatchUpId:d,drawDefinition:p,dualMatchUp:m,matchUpsMap:f,roundNumber:I,structureId:g}),t({},L)}function hg(e){var r=e.inContextDrawMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.drawPosition,o=e.matchUpsMap,u=e.targetLink,s=e.event;return dv({inContextDrawMatchUps:r,tournamentRecord:n,drawDefinition:i,matchUpsMap:o,drawPosition:a,structureId:u.target.structureId,event:s}),t({},L)}function gg(e){var r,n=e.tournamentRecord,i=e.appliedPolicies,a=e.drawDefinition,o=e.matchUpsMap,u=e.targetData,s=e.structure,l=e.event,c="doubleExitAdvancement";if(s.structureType===Iu)return On({result:t({},L),stack:c});var d=u.matchUp,p=u.targetMatchUps,v=u.targetLinks,f=p.loserMatchUp,m=p.winnerMatchUp,h=p.loserTargetDrawPosition;if(f&&f.matchUpStatus!==Fo){var g=v.loserTargetLink;if(null===(r=null==i?void 0:i.progression)||void 0===r?void 0:r.doubleExitPropagateBye){if((I=yg({loserTargetDrawPosition:h,tournamentRecord:n,loserTargetLink:g,drawDefinition:a,loserMatchUp:f,matchUpsMap:o,event:l})).error)return On({result:I,stack:c})}else{var I,y=f.feedRound,U=f.drawPositions,S=f.matchUpId,w=y?2:2-U.indexOf(h);if((I=Ig(t(t({},e),{targetMatchUp:f,walkoverWinningSide:w,tournamentRecord:n,sourceMatchUp:d,matchUpId:S}))).error)return On({result:I,stack:c})}}if(m&&(I=Ig(t(t({},e),{matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:n,sourceMatchUp:d}))).error)return On({result:I,stack:c});return On({result:t({},L),stack:c})}function Ig(e){var r,n,i,a=e.inContextDrawMatchUps,o=e.tournamentRecord,u=e.drawDefinition,s=e.sourceMatchUp,l=e.targetMatchUp,c=e.matchUpsMap,d=u.structures.find((function(e){return e.structureId===l.structureId})),p=e.matchUpStatus===Bo?Bo:Vo,v=e.matchUpStatus===Bo?jo:Ko,f="conditionallyAdvanceDrawPosition",m=c.drawMatchUps.find((function(e){return e.matchUpId===l.matchUpId}));if(!m)return{error:et};var h=(null==s?void 0:s.drawPositions)||[],g=null===(r=m.drawPositions)||void 0===r?void 0:r.filter(Boolean),I=(null==s?void 0:s.structureId)===l.structureId;if(I&&x(h,g)&&(g=g.filter((function(e){return!h.includes(e)}))),I&&g.length>1)return On({result:{error:ee},stack:f});var y=Cf(e),U=y.pairedPreviousMatchUpIsDoubleExit,S=y.pairedPreviousMatchUp,w=Ks({matchUpId:l.matchUpId,inContextDrawMatchUps:a,drawDefinition:u}),T=w.targetMatchUps,P=w.targetLinks,D=T.loserTargetDrawPosition,b=T.winnerMatchUp,N=T.loserMatchUp;if(N){var M=yg({loserTargetDrawPosition:D,loserMatchUp:N,tournamentRecord:o,loserTargetLink:P.loserTargetLink,drawDefinition:u,matchUpsMap:c});if(M.error)return On({result:M,stack:f})}var R,A=(null===(n=m.drawPositions)||void 0===n?void 0:n.filter(Boolean))||[],E=1===A.length,C=e.walkoverWinningSide||E&&Ff({drawPosition:A[0],matchUpId:l.matchUpId,inContextDrawMatchUps:a})||void 0,O=[Ko,jo].includes(m.matchUpStatus)&&!A.length,F=1===m.finishingRound,k=O&&!F?p:v,_=a.find((function(e){return e.matchUpId===S.matchUpId})),j=[];s&&((null==s?void 0:s.structureId)===(null==_?void 0:_.structureId)?R=s.roundPosition<(null==S?void 0:S.roundPosition)?1:2:l.feedRound?R=s.structureId===l.structureId?2:1:C&&(R=3-C));var B=e.matchUpStatus,V=null==S?void 0:S.matchUpStatus;1===R?j=[{matchUpStatus:Ug(B),previousMatchUpStatus:B,sideNumber:1},{matchUpStatus:Ug(V),previousMatchUpStatus:V,sideNumber:2}]:2===R&&(j=[{matchUpStatus:Ug(V),previousMatchUpStatus:V,sideNumber:1},{matchUpStatus:Ug(B),previousMatchUpStatus:B,sideNumber:2}]),j.length&&(j=j.map((function(e){return xn(e)})));var G=pg(t(t({},e),{matchUp:m,winningSide:C,matchUpStatusCodes:j,matchUpStatus:k}));if(G.error)return On({result:G,stack:f});if(O)return gg(t(t({},e),{matchUpStatus:k,targetData:w}));if(!b)return On({result:t({},L),stack:f});var q=2===g.length?g[C-1]:g[0],W=ss({structure:d}).positionAssignments,H=null==W?void 0:W.find((function(e){return e.drawPosition===q})),z=c.drawMatchUps.find((function(e){return e.matchUpId===b.matchUpId})),Y=null===(i=null==z?void 0:z.drawPositions)||void 0===i?void 0:i.filter(Boolean),K=1===Y.length;if(q){if(null==H?void 0:H.bye){var J=Ks({matchUpId:z.matchUpId,inContextDrawMatchUps:a,drawDefinition:u});if(K){var Z=Y.filter(Boolean)[0],X=Ff({drawPosition:Z,matchUpId:z.matchUpId,inContextDrawMatchUps:a}),Q=pg({matchUpId:z.matchUpId,matchUp:z,matchUpStatus:v,matchUpStatusCodes:[],removeScore:!0,drawDefinition:u,winningSide:X});return Q.error?On({result:Q,stack:f}):sv({drawPositionToAdvance:Z,matchUpId:z.matchUpId,inContextDrawMatchUps:a,drawDefinition:u,matchUpsMap:c})}if([Ko,jo].includes(b.matchUpStatus)){var $=gg(t(t({},e),{matchUpId:z.matchUpId,matchUpStatus:k,targetData:J}));if($.error)return On({result:$,stack:f})}return On({result:t({},L),stack:f})}return _f({matchUpId:b.matchUpId,drawPosition:q,inContextDrawMatchUps:a,drawDefinition:u})}if(U){if(!z)return{error:et};if(K){var te=Y[0],re=Ff({matchUpId:l.matchUpId,inContextDrawMatchUps:a,drawPosition:te});console.log("existing drawPosition is winningSide",{walkoverWinningSide:re})}var ne=[Ko,jo].includes(z.matchUpStatus)?v:p,ie=pg({matchUpId:z.matchUpId,matchUp:z,matchUpStatusCodes:[],removeScore:!0,drawDefinition:u,matchUpStatus:ne});if(ie.error)return On({result:ie,stack:f});if(ne===p){var ae=gg(t(t({},e),{matchUpId:l.matchUpId,matchUpStatus:ne,targetData:w}));if(ae.error)return ae}}return On({result:t({},L),stack:f})}function yg(e){var t,r=e.loserTargetDrawPosition,n=e.tournamentRecord,i=e.loserTargetLink,a=e.drawDefinition,o=e.matchUpsMap,u=e.event,s=null===(t=null==i?void 0:i.target)||void 0===t?void 0:t.structureId;return as({drawDefinition:a,structureId:s}).structure?av({drawPosition:r,tournamentRecord:n,drawDefinition:a,structureId:s,matchUpsMap:o,event:u}):{error:Ne}}function Ug(e){return e===Vo?Ko:e===Bo?jo:e}function Sg(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.matchUpStatus,a=e.structure,o=e.matchUp,u=!(!o.tieMatchUps||o.rondPosition||!e.inContextDrawMatchUps.find((function(e){return e.matchUpId===o.matchUpId})).containerStructureId),s=i===Fo,l=o.winningSide,c=[Vo,Bo].includes(i),d=Vp({matchUpStatus:i}),p=Gp({matchUpStatus:i}),v=!d&&!p,f=e.matchUpTieId||l&&d&&!c,m=l&&c;return v&&{error:Ve}||f&&wg(e)||m&&function(e){var t=fg(e);return t.error?t:gg(e)}(e)||l&&fg(e)||p&&pg(t(t({},e),{removeScore:[ko,Ko].includes(i),matchUpStatus:i||Yo}))||s&&function(e){var r,n=e.tournamentRecord,i=e.drawDefinition,a=e.structure,o=e.matchUp,u="attemptToSetMatchUpStatusBYE";if(null==o?void 0:o.winningSide)return On({result:{error:We},context:{matchUpStatus:Fo},stack:u});var s=ls({structure:a}).positionAssignments,l=null==s?void 0:s.filter((function(e){return e.bye})).map((function(e){return e.drawPosition}));return(null===(r=o.drawPositions)||void 0===r?void 0:r.some((function(e){return null==l?void 0:l.includes(e)})))?(o.matchUpStatus=Fo,o.matchUpStatusCodes=[],Cp({tournamentId:null==n?void 0:n.tournamentId,context:u,drawDefinition:i,matchUp:o}),t({},L)):On({result:{error:Be},info:"matchUp does not include BYE",stack:u})}({tournamentRecord:r,drawDefinition:n,structure:a,matchUp:o})||!d&&{error:Ve}||c&&function(e){var r=wg(t(t({},e),{removeScore:!0}));return r.error?r:gg(e)}(e)||u&&wg(e)||On({result:{error:We},stack:"attemptToSetMatchUpStatus"})}function wg(e){var t,r="scoreModification";if(e.isCollectionMatchUp&&(null===(t=e.dualMatchUp)||void 0===t?void 0:t.winningSide)&&!e.projectedWinningSide){var n=fg(e);if(n.error)return On({result:n,stack:r})}var i=Boolean(e.matchUp.collectionId),a=pg(e);if(i){var o=e.matchUpTieId,u=e.drawDefinition,s=e.matchUpsMap,l=vg({tournamentRecord:e.tournamentRecord,matchUpId:o,event:e.event,drawDefinition:u,matchUpsMap:s});if(l.error)return On({result:l,stack:r});Object.assign(a,{tieMatchUpResult:l})}return On({result:a,stack:r})}function Tg(e){var t=e.drawDefinition,r=e.structure,n=e.matchUp,i=[];if(r.finishingPosition===$u&&uh({drawDefinition:t,structure:r})){var a=function(e){var t,r,n=e.drawDefinition,i=e.structure,a=e.matchUp.drawPositions,o=ss({drawDefinition:n,structure:i}).positionAssignments,u=null==o?void 0:o.filter((function(e){var t=e.drawPosition;return null==a?void 0:a.includes(t)})),s=null==u?void 0:u.map((function(e){var t,r=Vn({element:e,name:yo}).extension;return null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.groupOrder})),l=null===(r=null===(t=Ys({drawDefinition:n,structureId:jp({drawDefinition:n}).containerStructures[i.structureId]}))||void 0===t?void 0:t.links)||void 0===r?void 0:r.source,c=null==l?void 0:l.filter((function(e){var t;return x(s,(null===(t=e.source)||void 0===t?void 0:t.finishingPositions)||[])})).map((function(e){return e.source.structureId}));return{structureIds:c}}({drawDefinition:t,structure:r,matchUp:n}).structureIds;(null==a?void 0:a.length)&&i.push.apply(i,u([],o(a),!1))}return{connectedStructureIds:i}}function Pg(e){var t=e.dualWinningSideChange,r=e.matchUpStatusCodes,n=e.tournamentRecord,i=e.drawDefinition,a=e.matchUpFormat,o=e.matchUpStatus,u=e.winningSide,s=e.matchUpId,l=e.structure,c=e.matchUp,d=e.event,p=e.score,v=Vp({matchUpStatus:o})||[ko,xo].includes(o)&&t,f=Boolean(c.collectionId),m=ip({drawDefinition:i,structure:l}),h=f||m||function(e){var t=e.structure,r=e.matchUp,n=r.drawPositions,i=ls({structure:t}).positionAssignments,a=null==i?void 0:i.filter((function(e){return(null==n?void 0:n.includes(e.drawPosition))&&e.participantId}));return 2===(null==a?void 0:a.length)}({structure:l,matchUp:c});if(!h)return{error:Fe};var g=[Ko].includes(o);return On({result:pg({matchUpStatusCodes:v&&r||[],matchUpStatus:v&&o||_o,tournamentRecord:n,drawDefinition:i,matchUpFormat:a,removeScore:g,winningSide:u,matchUpId:s,matchUp:c,event:d,score:p}),stack:"attemptToModifyScore"})}function Dg(e){var r=Pg(e);if(r.error)return r;var n,i=Vp({matchUpStatus:e.matchUpStatus}),a=e.dualWinningSideChange,l=e.projectedWinningSide,c=e.inContextDrawMatchUps,d=e.tournamentRecord,p=e.drawDefinition,v=e.matchUpStatus,f=e.dualMatchUp,m=e.matchUpsMap,h=e.winningSide,g=e.targetData,I=e.matchUpId,y=e.structure,U=e.matchUp,S=e.event,w="directParticipants",T=Boolean(U.collectionId),P=ip({drawDefinition:p,structure:y}),D=U.drawPositions;if(T){var b=e.matchUpTieId,N=e.matchUpsMap,M=vg({matchUpId:b,tournamentRecord:d,drawDefinition:p,matchUpsMap:N,event:S});n=M&&{tieMatchUpResult:M};var R=c.find((function(e){return e.matchUpId===b}));if(D=null==R?void 0:R.drawPositions,!a)return On({result:t(t({},L),n),stack:w})}if(P)return On({result:t(t({},L),n),stack:w});if(!D)return On({result:{error:ie},stack:w});var A=l?l-1:h-1,E=1-A,C=D[A],x=D[E],O=g.targetLinks,F=O.loserTargetLink,k=O.winnerTargetLink,_=O.byeTargetLink,j=g.targetMatchUps,B=j.winnerMatchUpDrawPositionIndex,V=j.loserMatchUpDrawPositionIndex,G=j.winnerMatchUp,q=j.loserMatchUp,W=j.byeMatchUp;if(G){var H=function(e){var r,n,i,a=e.winnerMatchUpDrawPositionIndex,o=e.inContextDrawMatchUps,u=e.projectedWinningSide,s=e.sourceMatchUpStatus,l=e.winningDrawPosition,c=e.tournamentRecord,d=e.winnerTargetLink,p=e.sourceMatchUpId,v=e.drawDefinition,f=e.winnerMatchUp,m=e.dualMatchUp,h=e.matchUpsMap,g=e.event,I="directWinner";if(d){var y=f.drawPositions||[],U=y[a],S=d.source.structureId;if((_=as({structureId:S,drawDefinition:v})).error)return _;var w=_.structure,T=ls({structureId:S,drawDefinition:v}).positionAssignments,P=null==T?void 0:T.find((function(e){return e.drawPosition===l})),D=null==P?void 0:P.participantId,b=d.target.structureId,N=ls({structureId:b,drawDefinition:v}).positionAssignments,M=null==N?void 0:N.find((function(e){return e.participantId===D})),R=null==M?void 0:M.drawPosition,A=null==N?void 0:N.filter((function(e){var t=y.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((function(e){return e.drawPosition})),E=null==A?void 0:A.includes(U);if(D&&1===d.target.roundNumber&&E)om({drawPosition:U,participantId:D,structureId:b,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:v,matchUpsMap:h,event:g});else if(D&&(null==A?void 0:A.length)){var C=A.pop();C&&om({participantId:D,structureId:b,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:v,drawPosition:C,matchUpsMap:h,event:g})}else if(R){var x=_f({drawPosition:R,matchUpId:f.matchUpId,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,sourceMatchUpId:p,drawDefinition:v,matchUpsMap:h});if(x.error)return On({result:x,stack:I})}else if((null==w?void 0:w.stage)!==au){var O="winner target position unavaiallble";return console.log(O),{error:O}}if((null==w?void 0:w.seedAssignments)&&w.structureId!==b){var F=w.seedAssignments.find((function(e){return e.participantId===D})),k=null==F?void 0:F.participantId;F&&k&&$f(t(t({eventId:null==f?void 0:f.eventId,structureId:b},F),{tournamentRecord:c,drawDefinition:v,participantId:k}))}}else{var _;if((_=_f({matchUpId:f.matchUpId,drawPosition:l,inContextDrawMatchUps:o,sourceMatchUpStatus:s,tournamentRecord:c,sourceMatchUpId:p,drawDefinition:v,matchUpsMap:h})).error)return _}if(m&&u){var j=null===(r=m.sides)||void 0===r?void 0:r.find((function(e){return e.sideNumber===u}));if(null==j?void 0:j.lineUp){var B=m.roundPosition,V=f.roundPosition,G=B===V&&1!==B||Math.floor(B/2)===V?2:1,q=null===(n=null==h?void 0:h.drawMatchUps)||void 0===n?void 0:n.find((function(e){return e.matchUpId===f.matchUpId})),W=[1,2].map((function(e){var r,n=(null===(r=q.sides)||void 0===r?void 0:r.find((function(t){return t.sideNumber===e})))||{};return t(t({},n),{sideNumber:e})}));q.sides=W;var H=q.sides.find((function(e){return e.sideNumber===G}));if(H){var z=null===(i=j.lineUp)||void 0===i?void 0:i.filter((function(e){return null==e?void 0:e.participantId}));H.lineUp=tm({lineUp:z}),Cp({tournamentId:null==c?void 0:c.tournamentId,eventId:null==f?void 0:f.eventId,matchUp:q,context:I,drawDefinition:v})}}}return t({},L)}({sourceMatchUpStatus:i&&v||_o,winnerMatchUpDrawPositionIndex:B,sourceMatchUpId:I,inContextDrawMatchUps:c,projectedWinningSide:l,winningDrawPosition:C,tournamentRecord:d,winnerTargetLink:k,drawDefinition:p,winnerMatchUp:G,dualMatchUp:f,matchUpsMap:m,event:S});if(H.error)return On({result:H,stack:w})}if(q){var z=function(e){var r,n,i=e.loserMatchUpDrawPositionIndex,a=e.inContextDrawMatchUps,l=e.projectedWinningSide,c=e.sourceMatchUpStatus,d=e.loserDrawPosition,p=e.tournamentRecord,v=e.loserTargetLink,f=e.drawDefinition,m=e.loserMatchUp,h=e.dualMatchUp,g=e.matchUpsMap,I=e.event,y="directLoser",U=v.linkCondition,S=m.drawPositions||[],w=U===bu&&2===m.roundNumber&&Math.min.apply(Math,u([],o(S.filter(Boolean)),!1)),T=w||S[i],P=w||S[1-i],D=v.source.structureId,b=as({structureId:D,drawDefinition:f}).structure,N=mp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:f,structure:b,event:I}).matchUps.filter((function(e){var t;return null===(t=e.drawPositions)||void 0===t?void 0:t.includes(d)})),M=N.filter((function(e){var t=e.sides.find((function(e){return e.drawPosition===d})),r=e.matchUpStatus===Ko||e.matchUpStatus===jo&&!Bp(e);return(null==t?void 0:t.sideNumber)===e.winningSide&&!r})),R=U===bu&&0===M.length,A=ls({structureId:D,drawDefinition:f}).positionAssignments,E=null==A?void 0:A.find((function(e){return e.drawPosition===d})),C=null==E?void 0:E.participantId,x=v.target.structureId,O=ls({structureId:x,drawDefinition:f}).positionAssignments,F=null==O?void 0:O.filter((function(e){var t=e.drawPosition;return S.includes(t)}));if(null==F?void 0:F.some((function(e){return e.participantId===C})))return t({},L);var k=null==F?void 0:F.filter((function(e){var t=S.includes(e.drawPosition),r=!e.participantId&&!e.bye&&!e.qualifier;return t&&r})).map((function(e){return e.drawPosition})),_=null==k?void 0:k.includes(T),j=v.target.roundNumber>1&&(null==k?void 0:k.length),B=1===v.target.roundNumber&&_;if(w){var V=function(){var e="loserLinkFedFMLC";return On(R?{result:ee(),stack:e}:{result:$(),stack:e})}();if(V.error)return On({result:V,stack:y})}else if(B){if((V=ee()).error)return On({result:V,stack:y})}else{if(!C||!j)return On({result:{error:oe},context:{loserDrawPosition:d,loserTargetLink:v},stack:y});k.sort(s);var G=k[0];if((V=om({participantId:C,structureId:x,drawPosition:G,inContextDrawMatchUps:a,sourceMatchUpStatus:c,tournamentRecord:p,drawDefinition:f,matchUpsMap:g,event:I})).error)return On({result:V,stack:y})}if((null==b?void 0:b.seedAssignments)&&b.structureId!==x){var q=b.seedAssignments.find((function(e){return e.participantId===C})),W=null==q?void 0:q.participantId;q&&W&&$f(t(t({eventId:null==m?void 0:m.eventId,structureId:x},q),{tournamentRecord:p,drawDefinition:f,participantId:W}))}if(h&&l){var H=null===(r=h.sides)||void 0===r?void 0:r.find((function(e){return e.sideNumber===3-l}));if(null==H?void 0:H.lineUp){var z=m.roundNumber,Y=m.eventId,K=h.roundPosition,J=1===z?2-K%2:1,Z=null===(n=null==g?void 0:g.drawMatchUps)||void 0===n?void 0:n.find((function(e){return e.matchUpId===m.matchUpId})),X=[1,2].map((function(e){var r,n=(null===(r=Z.sides)||void 0===r?void 0:r.find((function(t){return t.sideNumber===e})))||{};return t(t({},n),{sideNumber:e})}));Z.sides=X;var Q=Z.sides.find((function(e){return e.sideNumber===J}));Q&&(Q.lineUp=tm({lineUp:H.lineUp}),Cp({tournamentId:null==p?void 0:p.tournamentId,matchUp:Z,context:y,drawDefinition:f,eventId:Y}))}}return t({},L);function $(){return On({result:av({drawPosition:P,structureId:x,tournamentRecord:p,drawDefinition:f,event:I}),stack:"assignLoserPositionBye"})}function ee(){return On({result:C?om({drawPosition:T,participantId:C,structureId:x,inContextDrawMatchUps:a,sourceMatchUpStatus:c,tournamentRecord:p,drawDefinition:f,matchUpsMap:g,event:I}):{error:_t},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:i&&v||_o,loserMatchUpDrawPositionIndex:V,sourceMatchUpId:I,inContextDrawMatchUps:c,projectedWinningSide:l,loserDrawPosition:x,tournamentRecord:d,loserTargetLink:F,drawDefinition:p,loserMatchUp:q,winningSide:h,matchUpsMap:m,dualMatchUp:f,event:S});if(z.error)return On({result:z,stack:w})}if(W){var Y=W.drawPositions||[],K=av({drawPosition:Math.min.apply(Math,u([],o(Y.filter(Boolean)),!1)),structureId:_.target.structureId,tournamentRecord:d,drawDefinition:p,event:S});if(K.error)return On({result:K,stack:w})}return On({result:t(t({},L),n),stack:w})}function bg(e){var t,r,n=e.inContextDrawMatchUps,i=e.targetData,a=e.drawDefinition,o=e.relevantLink;if((null==o?void 0:o.linkCondition)===bu&&(null===(t=null==i?void 0:i.matchUp)||void 0===t?void 0:t.matchUpStatus)===Fo)return!1;var u=i.targetMatchUps,s=u.loserMatchUp,l=u.winnerMatchUp,c=i.targetLinks,d=[jo,Ko].includes(null==s?void 0:s.matchUpStatus),p=(null===(r=null==l?void 0:l.drawPositions)||void 0===r?void 0:r.filter(Boolean).length)||0;if((null==s?void 0:s.winningSide)&&!d||(null==l?void 0:l.winningSide)&&2===p&&(!l.feedRound||![Ko,jo].includes(null==l?void 0:l.matchUpStatus)))return!0;var v=s&&Ks({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),f=l&&Ks({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),m=v&&bg({relevantLink:null==c?void 0:c.loserTargetLink,targetData:v,inContextDrawMatchUps:n,drawDefinition:a});return!(!(f&&bg({targetData:f,inContextDrawMatchUps:n,drawDefinition:a}))&&!m)}function Ng(e){var r,n,i,s="attemptToSetWinningSide",l=e.appliedPolicies,c=e.disableAutoCalc,d=e.drawDefinition,p=e.dualMatchUp,v=e.winningSide,f=e.structure,m=e.matchUp;if((null==p?void 0:p._disableAutoCalc)&&!1!==c)return Pg(e);if(m.winningSide&&m.winningSide!==v){var h=Tg({drawDefinition:d,structure:f,matchUp:m}).connectedStructureIds;h.length&&(console.log({connectedStructureIds:h}),i=!0);var g=fg(e);if(g.error)return g}var I,y,U=Dg(e);return U.error?On({result:U,stack:s}):(e.qualifierChanging&&(null===(r=null==l?void 0:l[ka])||void 0===r?void 0:r.autoReplaceQualifiers)&&(I=function(e){var r,n,i,s,l,c,d=e.inContextDrawMatchUps,p=e.inContextMatchUp,v=e.drawDefinition,f=e.winningSide,m=null===(i=e.targetData.targetLinks)||void 0===i?void 0:i.winnerTargetLink;if(m.target.feedProfile===yu){var h=p.sides.find((function(e){return e.sideNumber!==f})).participantId,g=d.find((function(e){return e.structureId===m.target.structureId&&e.roundNumber===m.target.roundNumber&&e.sides.some((function(e){return e.participantId===h}))}));if((null==g?void 0:g.matchUpStatus)===Yo){var I=Ks({matchUpId:g.matchUpId,inContextDrawMatchUps:d,drawDefinition:v});if(!bg({inContextDrawMatchUps:d,drawDefinition:v,targetData:I})){var y=as({structureId:g.structureId,drawDefinition:v}).structure,U=ss({structure:y}).positionAssignments,S=function(t){var r,n;if(t.participantId===h){var i=p.sides.find((function(e){return e.sideNumber===f})).participantId;if(t.participantId=i,null==y?void 0:y.positionAssignments)y.positionAssignments=U;else if(null==y?void 0:y.structures){var d=Object.assign.apply(Object,u([{}],o((U||[]).map((function(e){var t;return(t={})[e.drawPosition]=e.participantId,t}))),!1));try{for(var m=(r=void 0,a(y.structures)),g=m.next();!g.done;g=m.next()){var I=g.value;null===(s=I.positionAssignments)||void 0===s||s.forEach((function(e){return e.participantId=d[e.drawPosition]}))}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}}kp({tournamentId:null===(l=e.tournamentRecord)||void 0===l?void 0:l.tournamentId,event:e.event,drawDefinition:v,structure:y}),c=!0}};try{for(var w=a(U||[]),T=w.next();!T.done;T=w.next())S(T.value)}catch(e){r={error:e}}finally{try{T&&!T.done&&(n=w.return)&&n.call(w)}finally{if(r)throw r.error}}}}}return t(t({},L),{qualifierReplaced:c})}(e).qualifierReplaced),e.qualifierAdvancing&&(null===(n=null==l?void 0:l[ka])||void 0===n?void 0:n.autoPlaceQualifiers)&&(y=function(e){var r,n,i,s,l,c,d,p,v=e.inContextDrawMatchUps,f=e.inContextMatchUp,m=e.drawDefinition,h=e.winningSide,g=null===(i=e.targetData.targetLinks)||void 0===i?void 0:i.winnerTargetLink;if(g.target.feedProfile===yu){var I=null===(s=f.sides.find((function(e){return e.sideNumber===h})))||void 0===s?void 0:s.participantId,y=v.filter((function(e){return e.structureId===g.target.structureId&&e.roundNumber===g.target.roundNumber&&e.sides.some((function(e){var t=e.participantId;return e.qualifier&&!t}))})),U=M(y);if((null==U?void 0:U.matchUpStatus)===Yo){var S=Ks({matchUpId:U.matchUpId,inContextDrawMatchUps:v,drawDefinition:m});if(!bg({inContextDrawMatchUps:v,drawDefinition:m,targetData:S})){var w=null===(l=U.sides.find((function(e){return e.qualifier&&!e.participantId})))||void 0===l?void 0:l.drawPosition,T=as({structureId:U.structureId,drawDefinition:m}).structure;if(!T)return{error:De};var P=ss({structure:T}).positionAssignments,D=function(t){var r,n;if(t.drawPosition===w&&!t.participantId){if(t.participantId=I,T.positionAssignments)T.positionAssignments=P;else if(T.structures){var i=Object.assign.apply(Object,u([{}],o((P||[]).map((function(e){var t;return(t={})[e.drawPosition]=e.participantId,t}))),!1));try{for(var s=(r=void 0,a(T.structures)),l=s.next();!l.done;l=s.next()){var v=l.value;null===(c=v.positionAssignments)||void 0===c||c.forEach((function(e){return e.participantId=i[e.drawPosition]}))}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}kp({tournamentId:null===(d=e.tournamentRecord)||void 0===d?void 0:d.tournamentId,event:e.event,drawDefinition:m,structure:T}),p=!0}};try{for(var b=a(P||[]),N=b.next();!N.done;N=b.next())D(N.value)}catch(e){r={error:e}}finally{try{N&&!N.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}}}}return t(t({},L),{qualifierPlaced:p})}(e).qualifierPlaced),On({result:xn(t(t(t({},L),U),{connectedStructures:i,qualifierReplaced:I,qualifierPlaced:y})),stack:s}))}var Mg={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Rg(e){var r,n=e.inContextDrawMatchUps,i=e.appliedPolicies,a=e.drawDefinition,o=e.matchUpsMap,u=e.targetData,s=e.matchUp,l=e.iteration,c=void 0===l?0:l,d="removeDoubleExit";nv({method:d,color:"brightyellow",iteration:c+=1,keyColors:Mg});var p=u.targetLinks.loserTargetLink,v=u.targetMatchUps,f=v.loserMatchUp,m=v.winnerMatchUp,h=v.loserTargetDrawPosition;m&&m.matchUpStatus!==Fo&&(nv({winner:"winner",stage:y=m.stage,roundNumber:U=m.roundNumber,roundPosition:S=m.roundPosition,keyColors:Mg}),Ag(t(t({},e),{targetMatchUp:m,sourceMatchUp:s,iteration:c})));if(f&&f.matchUpStatus!==Fo){var g=n.find((function(e){return e.matchUpId===f.matchUpId})),I=as({drawDefinition:a,structureId:g.structureId}).structure,y=f.stage,U=f.roundNumber,S=f.roundPosition,w=f.feedRound;if(nv({loser:"loser",stage:y,roundNumber:U,roundPosition:S,keyColors:Mg,feedRound:w}),null===(r=null==i?void 0:i.progression)||void 0===r?void 0:r.doubleExitPropagateBye)hg({drawPosition:h,targetLink:p,inContextDrawMatchUps:n,drawDefinition:a,matchUpsMap:o});else{var T=Ag(t(t({},e),{structure:I,targetMatchUp:f,iteration:c}));if(T.error)return On({result:T,stack:d})}}return On({result:t({},L),stack:d})}function Ag(e){var r,n,i,a,s,l=e.inContextDrawMatchUps,c=e.appliedPolicies,d=e.drawDefinition,p=e.sourceMatchUp,v=e.targetMatchUp,f=e.matchUpsMap,m=e.structure,h=e.iteration,g="conditionallyRemoveDrawPosition";nv({method:g});var I,y,U,S=Ks({matchUpId:v.matchUpId,inContextDrawMatchUps:l,drawDefinition:d}),w=S.targetMatchUps.winnerMatchUp,T=null==f?void 0:f.drawMatchUps.find((function(e){return e.matchUpId===v.matchUpId})),P=[];if(v.feedRound){var D=null===(r=null==w?void 0:w.drawPositions)||void 0===r?void 0:r.filter(Boolean);U=null==D?void 0:D.find((function(e){return v.drawPositions.includes(e)}))}else if(p){if(y=null===(i=xf({structureId:m.structureId,matchUp:p,matchUpsMap:f}))||void 0===i?void 0:i.pairedPreviousMatchUp,I=[Vo,Bo].includes(null==y?void 0:y.matchUpStatus),P=(null===(a=null==y?void 0:y.drawPositions)||void 0===a?void 0:a.filter(Boolean))||[],u(u([],o(eu),!1),[Fo],!1).includes(null==y?void 0:y.matchUpStatus)||(null==y?void 0:y.winningSide)){var b=p.drawPositions||[],N=null===(s=v.drawPositions)||void 0===s?void 0:s.filter(Boolean);x(b,N)&&(N=null==N?void 0:N.filter((function(e){return!b.includes(e)}))),U=b.concat(P).find((function(e){return null==N?void 0:N.includes(e)}))}}else U=null===(n=E((null==v?void 0:v.drawPositions)||[],(null==w?void 0:w.drawPositions)||[]))||void 0===n?void 0:n[0];if(w&&U){var M=w.stage,R=w.roundNumber,A=w.roundPosition;nv({method:"removeDirectedWinner",drawPositionToRemove:U,keyColors:Mg,color:"brightgreen",stage:M,roundNumber:R,roundPosition:A}),mg({winningDrawPosition:U,winnerMatchUp:w,inContextDrawMatchUps:l,drawDefinition:d,matchUpsMap:f})}var C=Rg({targetData:S,matchUp:v,inContextDrawMatchUps:l,appliedPolicies:c,drawDefinition:d,matchUpsMap:f,structure:m,iteration:h});if(C.error)return On({result:C,stack:g});var O=function(e){var t=e.pairedPreviousDoubleExit,r=e.noContextTargetMatchUp;return r.matchUpStatus===Fo?Fo:t?[Bo,jo].includes(null==r?void 0:r.matchUpStatus)?jo:Ko:Yo}({pairedPreviousDoubleExit:I,noContextTargetMatchUp:T}),F=!I;return(C=pg(t(t({},e),{matchUpStatus:O,removeScore:F,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:T,matchUpId:v.matchUpId,matchUpStatusCodes:[]}))).error?On({result:C,stack:g}):t({},L)}function Eg(e){var r,n=e.matchUp,i=e.matchUpStatus,s=e.score,l=e.winningSide,c="noDownStreamDependencies";if([Vo,Bo].includes(null==n?void 0:n.matchUpStatus)&&![Vo,Bo].includes(i)){var d=Rg(e);if(d.error)return On({result:d,stack:c})}var p=i===Vo,v=Bp({score:s})&&!p&&(e.isCollectionMatchUp&&!e.projectedWinningSide||!l),f=(null===(r=null==e?void 0:e.inContextMatchUp)||void 0===r?void 0:r.collectionId)&&function(e){var t,r=e.matchUpFormat,n=e.score,i=null===(t=null==n?void 0:n.sets)||void 0===t?void 0:t.length,a=r&&Zd(r),o=null!=a?a:{},u=o.setFormat,s=o.finalSetFormat,l=o.bestOf,c=l&&i===l&&s||u;return(null==c?void 0:c.timed)||!1}(e.inContextMatchUp),m=e.removeScore||!f&&![qo,xo].includes(i||qo),h=e.isCollectionMatchUp&&e.dualMatchUp.winningSide&&!e.projectedWinningSide||n.winningSide&&!l&&!Bp({score:s}),g=i&&i!==Yo,I=function(r){var i,s,l,c=e.structure,d=e.drawDefinition,p=e.dualMatchUp,v=e.disableAutoCalc;if((null==p?void 0:p._disableAutoCalc)&&!1!==v)return Pg(e);var f=Tg({drawDefinition:d,structure:c,matchUp:n}).connectedStructureIds;f.length&&(console.log({connectedStructureIds:f}),l=!0),Object.assign(e,{removeScore:r});var m=fg(e);if(m.error)return m;if(e.removingQualifier&&(null===(s=null===(i=e.appliedPolicies)||void 0===i?void 0:i[ka])||void 0===s?void 0:s.autoRemoveQualifiers)){var h=function(e){var t,r,n,i,s,l,c,d,p=e.inContextDrawMatchUps,v=e.inContextMatchUp,f=e.drawDefinition,m=null===(n=e.targetData.targetLinks)||void 0===n?void 0:n.winnerTargetLink;if(m.target.feedProfile===yu){var h=null===(s=null===(i=v.sides)||void 0===i?void 0:i.find((function(e){return e.sideNumber===v.winningSide})))||void 0===s?void 0:s.participantId,g=p.find((function(e){var t;return e.structureId===m.target.structureId&&e.roundNumber===m.target.roundNumber&&(null===(t=e.sides)||void 0===t?void 0:t.some((function(e){return e.participantId===h})))}));if(g&&g.matchUpStatus===Yo){var I=Ks({matchUpId:g.matchUpId,inContextDrawMatchUps:p,drawDefinition:f});if(!bg({inContextDrawMatchUps:p,drawDefinition:f,targetData:I})){var y=as({structureId:g.structureId,drawDefinition:f}).structure,U=ss({structure:y}).positionAssignments,S=function(t){var r,n;if(t.participantId===h){if(t.participantId=void 0,null==y?void 0:y.positionAssignments)y.positionAssignments=U;else if(null==y?void 0:y.structures){var i=Object.assign.apply(Object,u([{}],o((U||[]).map((function(e){var t;return(t={})[e.drawPosition]=e.participantId,t}))),!1));try{for(var s=(r=void 0,a((null==y?void 0:y.structures)||[])),p=s.next();!p.done;p=s.next()){var v=p.value;null===(l=v.positionAssignments)||void 0===l||l.forEach((function(e){return e.participantId=i[e.drawPosition]}))}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}kp({tournamentId:null===(c=e.tournamentRecord)||void 0===c?void 0:c.tournamentId,event:e.event,drawDefinition:f,structure:y}),d=!0}};try{for(var w=a(U||[]),T=w.next();!T.done;T=w.next())S(T.value)}catch(e){t={error:e}}finally{try{T&&!T.done&&(r=w.return)&&r.call(w)}finally{if(t)throw t.error}}}}}return{qualifierRemoved:d}}(e);return t(t(t({},L),{connectedStructures:l}),h)}return t(t({},L),{connectedStructures:l})};if(h&&l&&e.isCollectionMatchUp)return Cg(e);var y=[ko,xo].includes(i)&&e.dualWinningSideChange;return On({result:(l||y)&&Ng(e)||v&&I(m)||g&&Sg(e)||h&&I(m)||n&&Cg(t(t({},e),{removeScore:!0}))||t({},L),stack:c})}function Cg(e){var r;if(e.isCollectionMatchUp&&(null===(r=e.dualMatchUp)||void 0===r?void 0:r.winningSide)&&!e.projectedWinningSide){var n=fg(e);if(n.error)return n}var i=pg(t({},e));if(e.isCollectionMatchUp){var a=e.matchUpTieId,o=e.drawDefinition,u=e.event,s=e.matchUpsMap;vg({tournamentRecord:e.tournamentRecord,matchUpId:a,drawDefinition:o,matchUpsMap:s,event:u}).removeWinningSide&&console.log("REMOVE WINNING SIDE")}return On({result:i,stack:"scoreModification"})}function xg(e){var t,r,n,i=e.removePriorValues,a=e.tournamentRecords,o=e.tournamentRecord,u=e.drawDefinition,s=e.disableNotice,l=e.courtDayDate,c=e.matchUpId,d=e.courtIds;if(!o&&!a)return{error:W};if(!c)return{error:Ze};var p,v=Ef({drawDefinition:u,matchUpId:c});if(v.error)return v;if((null===(r=null==v?void 0:v.matchUp)||void 0===r?void 0:r.matchUpType)!==Os)return{error:tt};if(!(void 0===d||Array.isArray(d)&&d.length&&d.every((function(e){return"string"==typeof e}))))return{error:xr,context:{courtIds:d}};if(d){var f=lf({tournamentRecords:a||o&&((t={})[o.tournamentId]=o,t)});if(f.error)return f;var m=null===(n=f.courts)||void 0===n?void 0:n.filter((function(e){return d.includes(e.courtId)}));if((null==m?void 0:m.length)!==d.length)return{error:xr,context:{courtIds:d}};p=null==m?void 0:m.map((function(e){return{venueId:e.venueId,courtId:e.courtId}}))}return pm({duplicateValues:!1,removePriorValues:i,tournamentRecord:o,drawDefinition:u,disableNotice:s,matchUpId:c,timeItem:{itemType:tc,itemDate:l,itemValue:p}})}function Og(e){var t=e.removePriorValues,r=e.tournamentRecords,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.matchUpId,u=e.venueId;if(!n)return{error:W};if(!o)return{error:Ze};if(u){var s=Ed({tournamentRecords:r,tournamentRecord:n,venueId:u});if(s.error)return s}return pm({duplicateValues:!1,removePriorValues:t,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:o,timeItem:{itemType:ec,itemValue:u}})}function Fg(e){var t,r=e.removePriorValues,n=e.tournamentRecords,i=e.tournamentRecord,a=e.drawDefinition,o=e.disableNotice,u=e.courtDayDate,s=e.matchUpId,l=e.courtId;if(!i&&!n)return{error:W};if(!s)return{error:Ze};if(l){var c=Cd({tournamentRecords:n,tournamentRecord:i,courtId:l});if(c.error)return c;Og({tournamentRecords:n,tournamentRecord:i,drawDefinition:a,disableNotice:o,matchUpId:s,venueId:null===(t=c.venue)||void 0===t?void 0:t.venueId})}return pm({duplicateValues:!1,removePriorValues:r,tournamentRecord:i,drawDefinition:a,disableNotice:o,matchUpId:s,timeItem:{itemType:rc,itemDate:u,itemValue:l}})}function kg(e){var t="addMatchUpScheduledTime",r=e.matchUp,n=e.removePriorValues,i=e.tournamentRecord,a=e.drawDefinition,o=e.disableNotice,u=e.scheduledTime,s=e.matchUpId;if(!s)return On({result:{error:Ze},stack:t});if(!Kn(u))return On({result:{error:yt},stack:t});if(!r){if((l=Ef({drawDefinition:a,matchUpId:s})).error)return On({result:l,stack:t});r=l.matchUp}var l,c=ui(u),d=Kc({matchUp:r}).scheduledDate,p=c&&!d,v=Fd({matchUp:r}).timeModifiers||[];if((null==v?void 0:v.length)&&(null==(l=_g({disableNotice:!0,removePriorValues:n,tournamentRecord:i,timeModifiers:[],drawDefinition:a,matchUpId:s,matchUp:r}))?void 0:l.error))return On({result:l,stack:t});var f=ci(u,!0,p);return pm({duplicateValues:!1,removePriorValues:n,tournamentRecord:i,drawDefinition:a,disableNotice:o,matchUpId:s,timeItem:{itemType:oc,itemValue:f}})}function _g(e){var r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,s=e.timeModifiers,l=e.matchUpId,c=e.matchUp,d="addMatchUpTimeModifiers";if(!l)return On({result:{error:Ze},stack:d});if(void 0!==s&&!Array.isArray(s))return On({info:rm("timeModifiers"),result:{error:xr},stack:d});if(!c){if((p=Ef({drawDefinition:i,matchUpId:l})).error)return On({result:p,stack:d});c=p.matchUp}var p,v=Fd({matchUp:c}).timeModifiers||[],f=s.filter((function(e){return!v.includes(e)}));if(s.length&&!f.length)return t({},L);if(f.some((function(e){return gc.includes(e)}))&&(v=v.filter((function(e){return!gc.includes(e)})),(p=kg({disableNotice:!0,removePriorValues:r,scheduledTime:"",tournamentRecord:n,drawDefinition:i,matchUpId:l})).error))return On({result:p,stack:d});var m=(null==s?void 0:s.length)?u(u([],o(f),!1),o(v),!1):void 0;return pm({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:l,timeItem:{itemType:dc,itemValue:m}})}function Lg(e,t){var r=qn.test(e)?e:oi(e),n=ui(e)||ui(t)||Xn(new Date);return new Date("".concat(n,"T").concat(r)).getTime()}function jg(e){var r,n,i=e.errorOnAnachronism,a=void 0!==i&&i,s=e.checkChronology,l=void 0===s||s,c=e.matchUpDependencies,d=e.inContextMatchUps,p=e.removePriorValues,v=e.tournamentRecords,f=e.tournamentRecord,m=e.drawDefinition,h=e.disableNotice,g=e.drawMatchUps,y=e.matchUpId,U=e.schedule,S=e.event;if(!U)return{error:pt,info:"Missing schedule"};if(!m)return{error:K};if(!y)return{error:Ze};var w,T,P="addMatchUpScheduleItems";if(g)w=g.find((function(e){return e.matchUpId===y}));else{if((k=Ef({drawDefinition:m,event:S,matchUpId:y})).error)return k;w=k.matchUp}var D=U.endTime,b=U.courtId,N=U.courtIds,M=U.courtOrder,R=U.resumeTime,A=U.scheduledDate,E=U.scheduledTime,C=U.startTime,x=U.stopTime,O=U.timeModifiers,F=U.venueId;!l||c&&d||(c=(r=Xp({drawDefinition:m})).matchUpDependencies,d=r.matchUps);var k,_=null===(n=null==c?void 0:c[y])||void 0===n?void 0:n.matchUpIds;if(U.scheduledDate&&l&&_){var j=null==d?void 0:d.filter((function(e){var t,r;return((null===(t=e.schedule)||void 0===t?void 0:t.scheduledDate)||ui(null===(r=e.schedule)||void 0===r?void 0:r.scheduledTime))&&_.includes(e.matchUpId)})).map((function(e){var t=zn(e.schedule);return new Date(t).getTime()}));if(null==j?void 0:j.length){var V=zn(U),G=new Date(V).getTime();if(Math.max.apply(Math,u([],o(j),!1))>=G){if(a)return On({result:{error:B},stack:P});T=B}}}if(void 0!==A&&(null==(k=Bg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,scheduledDate:A,matchUpId:y}))?void 0:k.error))return On({result:k,stack:P,context:{scheduledDate:A}});if(void 0!==E&&(null==(k=kg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,scheduledTime:E,matchUpId:y,matchUp:w}))?void 0:k.error))return On({result:k,stack:P,context:{scheduledTime:E}});if(void 0!==C&&(null==(k=Gg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,matchUpId:y,startTime:C,event:S}))?void 0:k.error))return On({result:k,stack:P,context:{startTime:C}});if(void 0!==x&&(null==(k=Wg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,matchUpId:y,stopTime:x,event:S}))?void 0:k.error))return On({result:k,stack:P,context:{stopTime:x}});if(void 0!==R&&(null==(k=Hg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,resumeTime:R,matchUpId:y,event:S}))?void 0:k.error))return On({result:k,stack:P,context:{resumeTime:R}});if(void 0!==D&&(null==(k=qg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,matchUpId:y,endTime:D,event:S}))?void 0:k.error))return On({result:k,stack:P,context:{endTime:D}});if(void 0!==N&&(null==(k=xg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,matchUpId:y,courtIds:N}))?void 0:k.error))return On({result:k,stack:P,context:{courtIds:N}});if(void 0!==b&&void 0!==A&&(null==(k=Fg({courtDayDate:A,disableNotice:!0,removePriorValues:p,tournamentRecords:v,tournamentRecord:f,drawDefinition:m,matchUpId:y,courtId:b}))?void 0:k.error))return On({result:k,stack:P,context:{courtId:b}});if(void 0!==F&&(null==(k=Og({disableNotice:!0,removePriorValues:p,tournamentRecords:v,tournamentRecord:f,drawDefinition:m,matchUpId:y,venueId:F}))?void 0:k.error))return On({result:k,stack:P,context:{venueId:F}});if(void 0!==M&&I(M)&&(null==(k=Vg({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,courtOrder:M,matchUpId:y}))?void 0:k.error))return On({result:k,stack:P,context:{courtOrder:M}});if(void 0!==O&&(null==(k=_g({disableNotice:!0,removePriorValues:p,tournamentRecord:f,drawDefinition:m,timeModifiers:O,matchUpId:y,matchUp:w}))?void 0:k.error))return On({result:k,stack:P,context:{timeModifiers:O}});return h||Cp({tournamentId:null==f?void 0:f.tournamentId,eventId:null==S?void 0:S.eventId,context:P,drawDefinition:m,matchUp:w}),T?t(t({},L),{warnings:[T]}):t({},L)}function Bg(e){var t=e.scheduledDate,r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.matchUpId;if(!o)return{error:Ze};var u=t&&Wn.test(t);return t&&!u?{error:It}:pm({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:o,timeItem:{itemValue:ui(t),itemType:ic}})}function Vg(e){var t=e.removePriorValues,r=e.tournamentRecord,n=e.drawDefinition,i=e.disableNotice,a=e.courtOrder,o=e.matchUpId;if(!o)return{error:Ze};if(a&&!I(a))return{error:xr,info:"courtOrder must be numeric"};var u=a&&l(a);return pm({duplicateValues:!1,removePriorValues:t,tournamentRecord:r,drawDefinition:n,disableNotice:i,matchUpId:o,timeItem:{itemType:nc,itemValue:u}})}function Gg(e){var t,r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.matchUpId,u=e.startTime,s=e.event;if(!o)return{error:Ze};if(!Kn(u))return{error:yt};var l=Ef({drawDefinition:i,event:s,matchUpId:o}).matchUp,c=Kc({matchUp:l}).scheduledDate,d=(null!==(t=null==l?void 0:l.timeItems)&&void 0!==t?t:[]).filter((function(e){return[sc,lc,cc].includes(null==e?void 0:e.itemType)})).map((function(e){return Lg(e.itemValue,c)})).reduce((function(e,t){return!e||t<e?t:e}),void 0);if(!d||Lg(u,c)<d){(null==l?void 0:l.timeItems)&&(l.timeItems=l.timeItems.filter((function(e){return e.itemType!==uc})));var p=ci(u,!0,!0);return pm({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:o,timeItem:{itemType:uc,itemValue:p}})}return{error:mr}}function qg(e){var t,r=e.validateTimeSeries,n=void 0===r||r,i=e.removePriorValues,a=e.tournamentRecord,o=e.drawDefinition,u=e.disableNotice,s=e.matchUpId,l=e.endTime,c=e.event;if(!s)return{error:Ze};if(!Kn(l))return{error:yt};var d=Ef({drawDefinition:o,event:c,matchUpId:s}).matchUp,p=Kc({matchUp:d}).scheduledDate,v=(null!==(t=null==d?void 0:d.timeItems)&&void 0!==t?t:[]).filter((function(e){return[uc,lc,sc].includes(null==e?void 0:e.itemType)})).map((function(e){return Lg(e.itemValue,p)})).reduce((function(e,t){return!e||t>e?t:e}),void 0);if(!n||!v||Lg(l,p)>v){(null==d?void 0:d.timeItems)&&(d.timeItems=d.timeItems.filter((function(e){return e.itemType!==cc})));var f=ci(l,!0,!0);return pm({duplicateValues:!1,removePriorValues:i,tournamentRecord:a,drawDefinition:o,disableNotice:u,matchUpId:s,timeItem:{itemType:cc,itemValue:f}})}return{error:pr}}function Wg(e){var t,r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.matchUpId,u=e.stopTime,s=e.event;if(!o)return{error:Ze};if(!Kn(u))return{error:yt};var l=Ef({drawDefinition:i,event:s,matchUpId:o}).matchUp,c=Kc({matchUp:l}).scheduledDate,d=null!==(t=null==l?void 0:l.timeItems)&&void 0!==t?t:[],p=d.reduce((function(e,t){return t.itemType===cc||e}),void 0);if(p)return{error:vr};var v=d.filter((function(e){return[uc,lc,sc].includes(null==e?void 0:e.itemType)})).sort((function(e,t){return Lg(e.itemValue,c)-Lg(t.itemValue,c)})),f=v[v.length-1],m=f&&f.itemType===sc,h=v.filter((function(e){return!m||e.createdAt!==f.createdAt})).map((function(e){return Lg(e.itemValue,c)})).reduce((function(e,t){return!e||t>e?t:e}),void 0);if(Lg(u,c)>h){if((null==l?void 0:l.timeItems)&&m){var g=f.createdAt;l.timeItems=l.timeItems.filter((function(e){return e.createdAt!==g}))}return pm({duplicateValues:!0,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:o,timeItem:{itemValue:ci(u,!0,!0),itemType:sc}})}return{error:fr}}function Hg(e){var t,r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.resumeTime,u=e.matchUpId,s=e.event;if(!u)return{error:Ze};if(!Kn(o))return{error:yt};var l=Ef({drawDefinition:i,event:s,matchUpId:u}).matchUp,c=Kc({matchUp:l}).scheduledDate,d=null!==(t=null==l?void 0:l.timeItems)&&void 0!==t?t:[],p=d.reduce((function(e,t){return t.itemType===cc||e}),void 0);if(p)return{error:vr};var v=d.filter((function(e){return[uc,lc,sc].includes(null==e?void 0:e.itemType)})).sort((function(e,t){return Lg(e.itemValue,c)-Lg(t.itemValue,c)})),f=v[v.length-1],m=f&&f.itemType===lc,h=v.filter((function(e){return!m||e.createdAt!==f.createdAt})).map((function(e){return Lg(e.itemValue,c)})).reduce((function(e,t){return!e||t>e?t:e}),void 0);if(Lg(o,c)>h){if((null==l?void 0:l.timeItems)&&m){var g=f.createdAt;l.timeItems=l.timeItems.filter((function(e){return e.createdAt!==g}))}return pm({duplicateValues:!0,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:u,timeItem:{itemValue:ci(o,!0,!0),itemType:lc}})}return{error:hr}}function zg(e){var t,r,n=e.existingMatchUpStatus,i=e.matchUpFormat,s=e.matchUpStatus,l=e.winningSide,c=e.score;if("object"!=typeof c)return{error:xr};var d=c.sets,p=c.scoreStringSide1,v=c.scoreStringSide2,f="scoreString must be a string!";if(void 0!==p&&"string"!=typeof p)return{error:xr,info:f};if(void 0!==v&&"string"!=typeof v)return{error:xr,info:f};if(void 0!==d&&!Array.isArray(d))return{error:xr,info:rm("sets")};if(null==d?void 0:d.length){var m=d.map((function(e){return null==e?void 0:e.setNumber})).filter(Boolean);if(m.length!==U(m).length)return{error:xr,info:"setNumbers not unique"};try{for(var h=a(d),g=h.next();!g.done;g=h.next()){var y=g.value,S=y.side1Score,w=y.side2Score,P=y.side1TiebreakScore,D=y.side2TiebreakScore,b=y.side1PointScore,N=y.side2PointScore,M=y.winningSide,R=y.setNumber;if(![[S,w],[P,D],[b,N]].filter((function(e){return e.some((function(e){return void 0!==e}))})).every((function(e){return e.every((function(e){return I(e)}))})))return{error:xr,info:"non-numeric values"};if(![R,M].filter((function(e){return void 0!==e})).every((function(e){return I(e)})))return{error:xr,info:"non-numeric values"};if(M&&![1,2].includes(M))return{error:xr,info:"winningSide must be 1 or 2"}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}var A=function(e){var t,r=e.existingMatchUpStatus,n=e.matchUpFormat,i=e.matchUpStatus,a=e.winningSide,s=e.score,l=null!==(t=null==s?void 0:s.sets)&&void 0!==t?t:[],c=((null==l?void 0:l.filter((function(e){return null==e?void 0:e.winningSide})))||[]).reduce((function(e,t){var r=t.winningSide;return r?(e[r-1]++,e):e}),[0,0]),d=a?a-1:void 0,p=void 0!==d?1-d:void 0,v=void 0!==d&&c[d],f=void 0!==p&&c[p],m=n?Zd(n):void 0,h=Math.max.apply(Math,u([],o(c),!1)),g=T(c)[h],I=null==m?void 0:m.bestOf,y=I&&Math.ceil(I/2)||1,U=null!=i?i:r,S=U&&[jo,Ho,Ko].includes(U),w=!m||!l.length||l.every((function(e,t){var r=t+1,n=r===I,i=r===l.length,a=e.side1Score,o=e.side2Score,u=e.side1TiebreakScore,s=e.side2TiebreakScore,c=e.winningSide,d=Math.max(null!=a?a:0,null!=o?o:0),p=null!=u?u:s,v=m.finalSetFormat,f=m.setFormat,h=n&&v||f;if(p){var g=(null==h?void 0:h.tiebreakFormat)||{},y=g.tiebreakTo,U=g.NoAD,w=Math.max(null!=u?u:0,null!=s?s:0);if(U&&w>y)return!1;if(w<y&&c){if(i&&!S)return!1;if(!i)return!1}}return!h.setTo||!(!h.noTiebreak&&d>h.setTo+1)})),P=(!n||h===y)&&1===g&&c.indexOf(h)+1||void 0;return{valid:w&&(a&&v>f&&a===P||!a&&!P||S)}}({existingMatchUpStatus:n,matchUpStatus:s,matchUpFormat:i,winningSide:l,score:c}).valid;if(!A)return{error:wt,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}function Yg(e){var r,n,i,s,l,c,d,p,v="setMatchUpStatus";e.matchUpStatus&&[Ko,Vo].includes(e.matchUpStatus)&&(e.score=void 0);var f=e.allowChangePropagation,m=e.disableScoreValidation,h=e.tournamentRecords,g=e.tournamentRecord,I=e.disableAutoCalc,y=e.enableAutoCalc,U=e.drawDefinition,S=e.matchUpStatus,w=e.winningSide,T=e.matchUpId,P=e.event,D=e.score;if(!U)return{error:K};if(S&&[ko,qo,xo,Yo].includes(S)&&w)return{error:xr,winningSide:w,matchUpStatus:S};if(!u([void 0],o(Xo),!1).includes(S))return On({result:{error:We},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});var b=fl({drawDefinition:U}),N=Ip({nextMatchUps:!0,inContext:!0,drawDefinition:U,matchUpsMap:b,event:P}).matchUps,M=b.drawMatchUps.find((function(e){return e.matchUpId===T})),R=null==N?void 0:N.find((function(e){return e.matchUpId===T}));if(!M||!N)return{error:Qe};if((M.winningSide||w)&&S===Fo)return{context:"Cannot have Bye with winningSide",error:qe,matchUpStatus:S};var A,E=null==R?void 0:R.structureId,C=as({drawDefinition:U,structureId:E}).structure,x=null===(r=null==R?void 0:R.drawPositions)||void 0===r?void 0:r.filter(Boolean);if(M.matchUpType===Fs){if(I)jn({extension:{name:ro,value:!0},element:M});else if(y){var O=M.winningSide;_n({name:ro,element:M});var F=og({drawDefinition:U,matchUpsMap:b,structure:C,matchUp:M,event:P}),k=F.winningSide,_=F.scoreStringSide1,L=F.scoreStringSide2,j=F.set,B={scoreStringSide1:_,scoreStringSide2:L,sets:j?[j]:[]};A=k!==O,Object.assign(e,{winningSide:k,dualWinningSideChange:A,projectedWinningSide:k,score:B})}Im({tournamentId:null==g?void 0:g.tournamentId,inContextDualMatchUp:R,eventId:null==P?void 0:P.eventId,drawDefinition:U,dualMatchUp:M})}if(M.matchUpType===Fs&&S&&[Oo].includes(S))return{error:xr,info:"Not supported for matchUpType: TEAM"};var V=null==R?void 0:R.matchUpTieId,G=Ks({matchUpId:V||T,inContextDrawMatchUps:N,drawDefinition:U});if(D&&M.matchUpType!==Fs&&!m){var q=null!==(s=null!==(i=null!==(n=M.matchUpFormat)&&void 0!==n?n:null==C?void 0:C.matchUpFormat)&&void 0!==i?i:null==U?void 0:U.matchUpFormat)&&void 0!==s?s:null==P?void 0:P.matchUpFormat,W=zg({existingMatchUpStatus:M.matchUpStatus,matchUpFormat:q,matchUpStatus:S,winningSide:w,score:D});if(W.error)return W}var H=(null==M?void 0:M.sides)?[]:ss({drawDefinition:U,structureId:E}).positionAssignments,z=2===(null===(l=M.sides)||void 0===l?void 0:l.map((function(e){return e.participantId})).filter(Boolean).length)||2===(null==x?void 0:x.length)&&(null==H?void 0:H.filter((function(e){return x.includes(e.drawPosition)})).every((function(e){return e.participantId})));if(S&&Zo.includes(S)&&!z)return On({info:"present in participantRequiredMatchUpStatuses",context:{matchUpStatus:S,bothSideParticipants:z},result:{error:We}});var Y=null!==(d=null===(c=tl({policyTypes:[ka],tournamentRecord:g,drawDefinition:U,event:P}))||void 0===c?void 0:c.appliedPolicies)&&void 0!==d?d:{};"object"==typeof e.policyDefinitions&&Object.assign(Y,e.policyDefinitions);var J=(null==R?void 0:R.stage)===au&&1===R.finishingRound,Z=J&&w,X=J&&M.winningSide&&!w&&(!e.matchUpStatus||e.matchUpStatus&&Gp({matchUpStatus:e.matchUpStatus}))&&(!e.outcome||!Bp({outcome:e.outcome})),Q=Z&&w!==M.winningSide&&M.winningSide;if(Object.assign(e,{inContextDrawMatchUps:N,qualifierAdvancing:Z,qualifierChanging:Q,removingQualifier:X,inContextMatchUp:R,appliedPolicies:Y,matchUpTieId:V,matchUpsMap:b,targetData:G,structure:C,matchUp:M}),V){var $=Ef({matchUpId:V,inContext:!0,drawDefinition:U,matchUpsMap:b,event:P}).matchUp;if($){var ee=null===(p=Gd({matchUp:$,drawDefinition:U,structure:C,event:P}))||void 0===p?void 0:p.tieFormat;k=function(e){var r,n,i,o=e.drawDefinition,u=e.matchUpStatus,s=e.matchUpsMap,l=e.winningSide,c=e.dualMatchUp,d=e.tieFormat,p=e.structure,v=e.matchUp,f=e.event,m=e.score,h=Ui(c,void 0,!0);try{for(var g=a((null==h?void 0:h.tieMatchUps)||[]),I=g.next();!I.done;I=g.next()){var y=I.value;y.matchUpId===v.matchUpId&&(y.winningSide=l,y.score=m,Bp({score:m})||u?u&&(y.matchUpStatus=u):Object.assign(y,t({},ug)))}}catch(e){r={error:e}}finally{try{I&&!I.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}return{projectedWinningSide:og({matchUp:h,drawDefinition:o,matchUpsMap:s,structure:p,tieFormat:d=null!=d?d:null===(i=Gd({matchUp:v,structure:p,drawDefinition:o,event:f}))||void 0===i?void 0:i.tieFormat,event:f}).winningSide}}({drawDefinition:U,matchUpStatus:S,dualMatchUp:$,matchUpsMap:b,winningSide:w,tieFormat:ee,structure:C,matchUp:M,event:P,score:D}).projectedWinningSide;A=k!==(O=$.winningSide),Object.assign(e,{isCollectionMatchUp:!0,dualWinningSideChange:A,projectedWinningSide:k,matchUpTieId:V,dualMatchUp:$,tieFormat:ee})}}var te=bg(e),re=Vp({matchUpStatus:S});if(!V){if(te&&!w&&(S&&Gp({matchUpStatus:S})||S&&[Vo,Bo].includes(S)))return{error:qe,activeDownstream:te,winningSide:w};if(w&&w===M.winningSide&&S&&!re)return{context:"winningSide must include directing matchUpStatus",error:qe,directingMatchUpStatus:re,matchUpStatus:S}}var ne=e.schedule;if(ne){var ie=jg({disableNotice:!0,tournamentRecords:h,tournamentRecord:g,drawDefinition:U,matchUpId:T,schedule:ne});if(ie.error)return ie}var ae=M.matchUpType!==Fs&&!A&&w&&M.winningSide&&M.winningSide!==w;if(f&&ae&&M.roundPosition)return function(e){var t,r=e.tournamentRecord,n=e.inContextMatchUp,i=e.structure,a=e.drawDefinition,o=n.roundNumber,u=n.sides.find((function(e){return e.sideNumber===n.winningSide})),s=n.sides.find((function(e){return e.sideNumber!==n.winningSide})),l=u.drawPosition,c=u.participantId,d=s.drawPosition,p=s.participantId,v=mp(e).matchUps.filter((function(e){var t=e.drawPositions,r=e.roundNumber;return(null==t?void 0:t.includes(l))&&r>o}));on({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:v}),v.forEach((function(t){var n,i;t.drawPositions=(null===(n=t.drawPositions)||void 0===n?void 0:n.map((function(e){return e===l?d:e})))||[],Cp({tournamentId:null==r?void 0:r.tournamentId,eventId:null===(i=e.event)||void 0===i?void 0:i.eventId,context:"swapWinnerLoser",drawDefinition:a,matchUp:t})}));var f=i.stage,m=i.stageSequence,h=a.structures.filter((function(e){var t=e.stage,r=e.stageSequence;return t===f&&r>m})).map((function(e){return e.structureId})),g=e.targetData.targetLinks,I=g.loserTargetLink,y=g.winnerTargetLink,U=[null==I?void 0:I.target.structureId,null===(t=null==y?void 0:y.target)||void 0===t?void 0:t.structureId].filter(Boolean);a.structures.filter((function(e){var t=e.stage,r=e.structureId;return t!==f&&U.includes(r)})).forEach((function(e){var t=e.stage,r=e.stageSequence,n=e.structureId;h.includes(n)||h.push(n),a.structures.filter((function(e){var n=e.stage,i=e.stageSequence;return n===t&&i>r})).forEach((function(e){var t=e.structureId;h.includes(t)||h.push(t)}))}));var S=a.structures.filter((function(e){var t=e.structureId;return h.includes(t)}));return S.forEach((function(e){var t=ss({structure:e}).positionAssignments,r=null==t?void 0:t.find((function(e){return e.participantId===c})),n=null==t?void 0:t.find((function(e){return e.participantId===p}));r&&(r.participantId=p),n&&(n.participantId=c)})),pg(e)}(e);var oe=w&&!V||e.projectedWinningSide;nv({method:v,activeDownstream:te,matchUpWinner:oe,winningSide:w});var ue=!te&&Eg(e)||oe&&function(e){var t=e.matchUp,r=e.winningSide,n=e.matchUpTieId,i=e.dualWinningSideChange;return r===t.winningSide||n&&!i?Kg(e):On({stack:"winningSideWithDownstreamDependencies",result:{error:Mt},context:{winningSide:r,matchUp:t}})}(e)||re&&Kg(e)||{error:kr};return On({result:ue,stack:v})}function Kg(e){var r=e.tournamentRecord,n=e.matchUp,i=e.event,a=e.isCollectionMatchUp&&n.winningSide&&!e.winningSide&&!Bp({score:e.score}),o=e.isCollectionMatchUp?e.matchUpStatus||a&&Yo||_o:e.matchUpStatus||_o,u=e.removeScore||[ko,Ko].includes(o)&&![qo,xo].includes(o),s=pg(t(t({},e),{matchUpStatus:o,removeWinningSide:a,removeScore:u}));if(s.error)return s;if(e.isCollectionMatchUp){var l=vg({matchUpId:e.matchUpTieId,tournamentRecord:r,drawDefinition:e.drawDefinition,matchUpsMap:e.matchUpsMap,event:i});if(l.error)return l;Object.assign(s,{tieMatchUpResult:l})}return s}function Jg(e){var r,n,i=e.event,a=e.orderedDrawIdsMap;if("object"!=typeof i)return{error:Ae};if(!a)return{error:pt,info:"Missing drawIdsOrderMap"};if("object"!=typeof a)return{error:xr,info:"orderedDrawIdsMap must be an object"};var o=Object.values(a);if(!o.every((function(e){return!isNaN(e)})))return{error:xr,info:"drawOrder must be numeric"};if(U(o).length!==o.length)return{error:xr,info:"drawOrder values must be unique"};if(null===(r=i.drawDefinitions)||void 0===r?void 0:r.length){var u=(i.drawDefinitions||[]).map((function(e){return e.drawId})),s=Object.keys(a);if((null==s?void 0:s.length)&&E(u,s).length!==u.length)return{error:xr,info:"Missing drawIds"};i.drawDefinitions.forEach((function(e){e.drawOrder=a[e.drawId]}))}var l=_d({event:i}).flightProfile;return null===(n=null==l?void 0:l.flights)||void 0===n||n.forEach((function(e){e.flightNumber=a[e.drawId]})),t({},L)}function Zg(e){var r,n=e.tournamentRecord,i=e.event;if(!n)return{error:W};if(!i)return{error:Ae};var a=_d({event:i}).flightProfile,s=(null==a?void 0:a.flights)&&Object.assign.apply(Object,u([{}],o(a.flights.sort((function(e,t){return e.flightNumber-t.flightNumber})).map((function(e,t){var r;return(r={})[e.drawId]=t+1,r}))),!1))||(null===(r=i.drawDefinitions)||void 0===r?void 0:r.length)&&Object.assign.apply(Object,u([{}],o(i.drawDefinitions.sort((function(e,t){return e.drawOrder-t.drawOrder})).map((function(e,t){var r;return(r={})[e.drawId]=t+1,r}))),!1))||void 0;return s?Jg({event:i,orderedDrawIdsMap:s}):t({},L)}function Xg(e){var r=e.drawDefinition,n=e.timeItem;if(!r)return{error:Z};if(!n)return{error:yr};var i=n&&Object.keys(n),a=["itemType","itemValue"];if(!(a.filter((function(e){return i.includes(e)})).length===a.length))return{error:gr};r.timeItems||(r.timeItems=[]);var o=(new Date).toISOString();return Object.assign(n,{createdAt:o}),r.timeItems.push(n),xp({drawDefinition:r}),t({},L)}function Qg(e){var r,n=e.stageSequence,i=void 0===n?1:n,a=e.drawDefinition,o=e.drawSize,u=e.stage;if(!a)return{error:K};if(!Bl({drawDefinition:a,stage:u}))return{error:_e};var s=function(e){var t=e.stage,r=e.drawDefinition;return kl.reduce((function(e,n){return(Vl({drawDefinition:r,entryStatus:n,stage:t})||0)+e}),0)}({drawDefinition:a,stage:u});if(o<s+Ev({drawDefinition:a,stageSequence:i,stage:u}).qualifiersCount)return{error:ce};var l=yl({attributes:[(r={},r[u]={drawSize:o},r)],drawDefinition:a}).entryProfile;return Op({drawDefinition:a}),t(t({},L),{entryProfile:l})}function $g(e){var r,n=e.qualifiersCount,i=void 0===n?0:n,a=e.drawDefinition,o=e.stage;return a?Bl({drawDefinition:a,stage:o})?o!==iu?{error:ce,info:"qualifiersCount can only be set for main stage"}:(yl({attributes:[(r={},r[o]={qualifiersCount:i},r)],drawDefinition:a}),Op({drawDefinition:a}),t({},L)):{error:_e}:{error:K}}function eI(e){var r=e.updateInProgressMatchUps,n=e.originalValueGoal,i=e.tournamentRecord,o=e.wasAggregateValue,u=e.tieFormatName,s=e.drawDefinition,l=e.structureId,c=e.structure,d=e.tieFormat,p=e.matchUpId,v=e.matchUp,f=e.eventId,m=e.event,h=Mm(d),g=h.aggregateValue,I=h.valueGoal;d.winCriteria=xn({aggregateValue:g,valueGoal:I}),(n&&n!==I||g&&!o)&&(u?d.tieFormatName=u:delete d.tieFormatName);var y=function(e){var t,r,n,i,a=e.updateInProgressMatchUps,o=e.drawDefinition,u=e.structureId,s=e.structure,l=e.matchUpId,c=e.matchUp,d=[];l&&c?d=[c]:u&&s?d=null!==(r=null===(t=mp({matchUpFilters:{matchUpTypes:[Fs]},structure:s}))||void 0===t?void 0:t.matchUps)&&void 0!==r?r:[]:o&&(d=null!==(i=null===(n=Up({matchUpFilters:{matchUpTypes:[Fs]},drawDefinition:o}))||void 0===n?void 0:n.matchUps)&&void 0!==i?i:[]);var p=d.filter((function(e){return!e.winningSide&&e.matchUpStatus!==_o&&(a||e.matchUpStatus!==Go&&!Bp(e))}));return{targetMatchUps:p}}({updateInProgressMatchUps:r,drawDefinition:s,structureId:l,structure:c,matchUpId:p,matchUp:v}).targetMatchUps;!function(e){var r,n,i=e.updateInProgressMatchUps,o=e.tournamentRecord,u=e.drawDefinition,s=e.targetMatchUps,l=e.tieFormat,c=e.event;try{for(var d=a(s),p=d.next();!p.done;p=d.next()){var v=p.value,f=!!v.tieFormat;f&&(v.tieFormat=bm(l));var m=void 0;if(i){var h=vg({matchUpId:v.matchUpId,exitWhenNoValues:!0,tournamentRecord:o,drawDefinition:u,event:c});if(h.error)return h;m=h.score}f&&!m&&Cp({tournamentId:null==o?void 0:o.tournamentId,context:"updateTargetTeamMatchUps",eventId:null==c?void 0:c.eventId,matchUp:v,drawDefinition:u})}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}t({},L)}({updateInProgressMatchUps:r,tournamentRecord:i,targetMatchUps:y,drawDefinition:s,tieFormat:d,event:m});var U=xn(d),S=zm({tieFormat:U});if(S.error)return S;if(f&&m)m.tieFormat=U;else if(p&&v)v.tieFormat=d;else if(c)c.tieFormat=U;else if(s)s.tieFormat=U;else if(!v||!s)return{error:K};return Op({drawDefinition:s,eventId:null==m?void 0:m.eventId}),t({},L)}function tI(e){var t=e.tieFormat,r=e.orderMap,n=bm(t);return n.collectionDefinitions.forEach((function(e){var t=r[e.collectionId];t&&(e.collectionOrder=t)})),n.collectionDefinitions.sort((function(e,t){return w(e.collectionOrder)-w(t.collectionOrder)})),n}function rI(e){var t,r,n,i=e.tournamentRecord,o=e.structureIds,u=e.orderMap,s=e.event,l=tI({tieFormat:s.tieFormat,orderMap:u});(null==o?void 0:o.length)||(s.tieFormat=l);try{for(var c=a(null!==(n=s.drawDefinitions)&&void 0!==n?n:[]),d=c.next();!d.done;d=c.next()){nI({tournamentRecord:i,drawDefinition:d.value,structureIds:o,orderMap:u,event:s})}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}function nI(e){var t,r,n,i,o,u,s=e.tournamentRecord,l=e.drawDefinition,c=e.structureIds,d=e.orderMap,p=e.event,v=tI({tieFormat:null!==(n=l.tieFormat)&&void 0!==n?n:null==p?void 0:p.tieFormat,orderMap:d});(null==c?void 0:c.length)||(l.tieFormat=v);var f=[];try{for(var m=a(null!==(i=l.structures)&&void 0!==i?i:[]),h=m.next();!h.done;h=m.next()){var g=h.value;(null==c?void 0:c.length)&&!c.includes(g.structureId)||((g.tieFormat||(null==c?void 0:c.includes(g.structureId)))&&(g.tieFormat=tI({tieFormat:null!==(u=null!==(o=g.tieFormat)&&void 0!==o?o:l.tieFormat)&&void 0!==u?u:null==p?void 0:p.tieFormat,orderMap:d})),iI({eventId:null==p?void 0:p.eventId,tournamentRecord:s,drawDefinition:l,structure:g,orderMap:d}),f.push(g.structureId))}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}Op({drawDefinition:l,structureIds:f})}function iI(e){var t,r,n,i=e.tournamentRecord,o=e.drawDefinition,u=e.structure,s=e.orderMap,l=e.eventId,c=null===(n=mp({matchUpFilters:{matchUpTypes:[Fs]},structure:u}))||void 0===n?void 0:n.matchUps;try{for(var d=a(c),p=d.next();!p.done;p=d.next()){var v=p.value;v.tieFormat&&(v.tieFormat=tI({tieFormat:v.tieFormat,orderMap:s}),Cp({tournamentId:null==i?void 0:i.tournamentId,drawDefinition:o,eventId:l,matchUp:v}))}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}}function aI(e){var n,i,o,u,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w=e.updateInProgressMatchUps,T=void 0===w||w,P=e.tieFormatComparison,D=e.tournamentRecord,b=e.drawDefinition,N=e.tieFormatName,M=e.collectionId,R=e.structureId,A=e.matchUpId,E=e.eventId,C=e.matchUp,x=e.event,O="removeCollectionDefinition",F=C?void 0:Rm({drawDefinition:b,structureId:R,matchUpId:A,eventId:E,event:x});if(null==F?void 0:F.error)return On({result:F,stack:O});var k=null==F?void 0:F.structure;C=null!=C?C:null==F?void 0:F.matchUp;var _=null==F?void 0:F.tieFormat,j=bm(_);if((F=zm({tieFormat:j})).error)return On({result:F,stack:O});var B=null===(c=null==j?void 0:j.collectionDefinitions)||void 0===c?void 0:c.find((function(e){return e.collectionId===M}));if(!B)return On({result:{error:jr,collectionId:M}});j.collectionDefinitions=j.collectionDefinitions.filter((function(e){return e.collectionId!==M})),B.collectionGroupNumber&&(j.collectionDefinitions=j.collectionDefinitions.map((function(e){return e.collectionGroupNumber,r(e,["collectionGroupNumber"])})),j.collectionGroups=j.collectionGroups.filter((function(e){return e.groupNumber!==B.collectionGroupNumber})));var V=Mm(j),G=V.aggregateValue,q=V.valueGoal;j.winCriteria=xn({aggregateValue:G,valueGoal:q});var W=null==_?void 0:_.winCriteria.valueGoal,H=null==_?void 0:_.winCriteria.aggregateValue;(W&&W!==q||G&&!H)&&(N?j.tieFormatName=N:delete j.tieFormatName);var z=[];A&&C?z=[C]:R&&k?z=null!==(p=null===(d=mp({matchUpFilters:{matchUpTypes:[Fs]},structure:k}))||void 0===d?void 0:d.matchUps)&&void 0!==p?p:[]:b?z=null!==(f=null===(v=Up({matchUpFilters:{matchUpTypes:[Fs]},drawDefinition:b}))||void 0===v?void 0:v.matchUps)&&void 0!==f?f:[]:x&&(z=null!==(h=null===(m=Yp({matchUpFilters:{matchUpTypes:[Fs]},drawDefinition:b}))||void 0===m?void 0:m.matchUps)&&void 0!==h?h:[]);var Y=(z||[]).filter((function(e){var t,r,n=null===(t=e.tieMatchUps)||void 0===t?void 0:t.filter((function(e){return e.collectionId===M})),i=null==n?void 0:n.some(Bp),a=!(!P||!e.tieFormat)&&(null===(r=Zm({descendant:e.tieFormat,ancestor:j}))||void 0===r?void 0:r.different);return T&&!i||!e.winningSide&&e.matchUpStatus!==_o&&(T||e.matchUpStatus!==Go&&!Bp(e)&&!a)}));if(!Y.length)return{error:Dr};if(A&&C&&T){var J=null===(g=C.tieMatchUps)||void 0===g?void 0:g.filter((function(e){return e.collectionId===M}));try{for(var Z=a(null!=J?J:[]),X=Z.next();!X.done;X=Z.next()){var Q=Yg({matchUpId:X.value.matchUpId,tieMatchUpId:null==C?void 0:C.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:D,drawDefinition:b,event:x});if(Q.error)return Q;if((Q=Ef({drawDefinition:b,matchUpId:A})).error)return Q;C=null==Q?void 0:Q.matchUp}}catch(e){n={error:e}}finally{try{X&&!X.done&&(i=Z.return)&&i.call(Z)}finally{if(n)throw n.error}}}var $=[];try{for(var ee=a(Y),te=ee.next();!te.done;te=ee.next()){var re=te.value;try{for(var ne=(s=void 0,a(null!==(I=null==re?void 0:re.sides)&&void 0!==I?I:[])),ie=ne.next();!ie.done;ie=ne.next()){var ae=ie.value;ae.lineUp=(null!==(y=ae.lineUp)&&void 0!==y?y:[]).map((function(e){var t;return{participantId:e.participantId,collectionAssignments:(null!==(t=null==e?void 0:e.collectionAssignments)&&void 0!==t?t:[]).filter((function(e){return e.collectionId!==M}))}}))}}catch(e){s={error:e}}finally{try{ie&&!ie.done&&(l=ne.return)&&l.call(ne)}finally{if(s)throw s.error}}if(re.tieMatchUps=(null!==(U=re.tieMatchUps)&&void 0!==U?U:[]).filter((function(e){var t=e.collectionId===M;return t&&$.push(e.matchUpId),!t})),re.tieFormat&&(re.tieFormat=bm(j)),T){var oe=vg({matchUpId:re.matchUpId,exitWhenNoValues:!0,tournamentRecord:D,drawDefinition:b,event:x});if(oe.error)return oe}Cp({tournamentId:null==D?void 0:D.tournamentId,eventId:null==x?void 0:x.eventId,drawDefinition:b,context:O,matchUp:re})}}catch(e){o={error:e}}finally{try{te&&!te.done&&(u=ee.return)&&u.call(ee)}finally{if(o)throw o.error}}$.length&&Ep({tournamentId:null==D?void 0:D.tournamentId,matchUpIds:$,eventId:null==x?void 0:x.eventId,drawDefinition:b});var ue=xn(j);if((F=zm({tieFormat:ue})).error)return On({result:F,stack:O});if(E&&x)x.tieFormat=ue;else if(A&&C)C.tieFormat=ue;else if(k)k.tieFormat=ue;else if(b)b.tieFormat=ue;else if(!C||!b)return{error:K};Op({drawDefinition:b,eventId:null==x?void 0:x.eventId});var se=tl({tournamentRecord:D}).appliedPolicies;(null===(S=null==se?void 0:se.audit)||void 0===S?void 0:S[Uo])&&th({drawDefinition:b,auditData:xn({drawId:null==b?void 0:b.drawId,action:O,collectionId:M,structureId:R,matchUpId:A,eventId:E})});return t({tieFormat:ue,deletedMatchUpIds:$,targetMatchUps:Y},L)}function oI(e){var t=e.targetEntryRound,r=void 0===t?1:t,n=e.finishingPositions,i=e.sourceRoundNumber,a=e.sourceStructureId,o=e.targetStructureId,u=e.linkType;return a&&o?{link:xn({linkType:void 0===u?Pu:u,source:{roundNumber:i,structureId:a,finishingPositions:n},target:{feedProfile:yu,roundNumber:r,structureId:o}})}:{error:Pe}}function uI(e){var t=e.roundPosition,r=e.roundNumber,n=e.idPrefix,i=e.uuids;return n?"".concat(n,"-").concat(r,"-").concat(t):(null==i?void 0:i.pop())||ed()}function sI(e){for(var t=e.includeMatchUpType,r=e.matchUpType,n=e.roundNumber,i=e.matchUps,a=e.idPrefix,o=e.isMock,u=e.uuids,s=e.nodes,l=0,c=[],d=1,p=n-1,v=null==s?void 0:s.length;l<(v||0);){var f=null==s?void 0:s[l],m=null==s?void 0:s[l+1];p&&(f.roundNumber=p),m&&p&&(m.roundNumber=p);var h={roundPosition:d,children:[f,m],matchUpId:uI({roundPosition:d,roundNumber:n,idPrefix:a,uuids:u})};c.push(h);var g={drawPositions:h.children.map((function(e){return null==e?void 0:e.drawPosition})).filter(Boolean),matchUpStatus:Yo,matchUpId:h.matchUpId,roundPosition:d,roundNumber:n};t&&r&&(g.matchUpType=r),o&&(g.isMock=!0),i.push(g),d++,l+=2}return{roundNodes:c,matchUps:i}}function lI(e){var t,r,n=e.finishingPositionOffset,i=e.finishingPositionLimit,a=e.qualifyingRoundNumber,o=e.qualifyingPositions,u=e.matchUpType,s=e.roundLimit,l=e.idPrefix,d=e.drawSize,p=e.isMock,v=e.uuids;if(isNaN(d)||d<2||o&&d<=o)return{matchUps:[],roundsCount:0};if(o&&(!c(d)||d%o)){for(var f=o;f<d;)f*=2;d=f}var m=o&&!(d%2)&&(!isNaN(o)||a&&!isNaN(a))&&(d/o===Math.round(d/o)||a&&d/a===Math.round(d/a));if(!c(d)&&!m)return{matchUps:[],roundsCount:0};var h,g=[],I=1;for(h=(t=sI({matchUpType:u,roundNumber:I,idPrefix:l,matchUps:g,isMock:p,nodes:R(1,d+1).map((function(e){return{drawPosition:e}})),uuids:v})).roundNodes,g=t.matchUps,I++,s=null!=s?s:a;h.length>1;)o&&h.length===o&&(s=I-1),h=(r=sI({nodes:h,matchUpType:u,roundNumber:I,idPrefix:l,matchUps:g,isMock:p,uuids:v})).roundNodes,g=r.matchUps,I++;var y=I-1;return g=Hp({finishingPositionOffset:n,finishingPositionLimit:i,roundsCount:y,roundLimit:s,matchUps:g}),s?g=g.filter((function(e){var t;return s&&(null!==(t=e.roundNumber)&&void 0!==t?t:0)<=s})):s=I-1,{drawSize:d,matchUps:g,roundsCount:y,roundLimit:s}}function cI(e){var r,n,i,a,o,u,s,l,c,d="generateQualifyingStructure";if(!e.drawDefinition)return On({result:{error:K},stack:d});if(e.drawSize&&!I(e.drawSize)||e.participantsCount&&!I(e.participantsCount)||e.qualifyingPositions&&!I(e.qualifyingPositions))return On({result:{error:xr},stack:d});var v,f,m,h,g=null!==(n=e.drawSize)&&void 0!==n?n:p(e.participantsCount),y=e.qualifyingRoundNumber,U=e.qualifyingPositions,S=e.targetStructureId,w=e.structureOptions,T=e.appliedPolicies,P=e.drawDefinition,D=e.matchUpFormat,b=e.structureName,N=e.structureId,M=e.roundTarget,R=e.drawType,A=e.idPrefix,E=e.isMock,C=e.uuids;if(!e.drawSize)return On({result:{error:de},context:{drawSize:g},stack:d});if(U&&U>=e.drawSize)return On({result:{error:xr},context:{drawSize:g,qualifyingPositions:U},stack:d});var x,O=0,F=Sf({drawDefinition:P}).structureProfiles[S];if(!F)return On({result:{error:De},context:{targetStructureId:S},stack:d});var k=P.matchUpType,_=M?"".concat(M,"-"):"",j=F.stage===au,B=null!==(o=null===(a=null===(i=null==T?void 0:T[Oa])||void 0===i?void 0:i.namingConventions)||void 0===a?void 0:a.pre)&&void 0!==o?o:null===(s=null===(u=ap[Oa])||void 0===u?void 0:u.namingConventions)||void 0===s?void 0:s.pre,V=j&&B?"".concat(B,"-"):"",G=null!=b?b:_?"".concat(V).concat(ef(au)," ").concat(_):"".concat(V).concat(ef(au));if(R===Yu){var q=Gf({structureName:null!=b?b:G,structureId:null!=N?N:null==C?void 0:C.pop(),stage:au,structureOptions:w,appliedPolicies:T,stageSequence:1,matchUpType:k,roundTarget:M,idPrefix:A,drawSize:g,isMock:E,uuids:C}),W=q.maxRoundNumber,H=q.structures;O=q.groupCount,v=W,m=H[0],x=[1]}else g=(r=lI({qualifyingRoundNumber:y,qualifyingPositions:U,matchUpType:k,idPrefix:A,drawSize:g,isMock:E,uuids:C})).drawSize,h=r.matchUps,v=r.roundLimit,f=r.roundsCount,v||(v=f),m=tf({structureName:null!=b?b:G,structureId:null!=N?N:null==C?void 0:C.pop(),qualifyingRoundNumber:v,stage:au,matchUpFormat:D,stageSequence:1,matchUpType:k,roundLimit:v,matchUps:h}),M&&jn({extension:{name:fo,value:M},element:m}),O=null===(l=null==h?void 0:h.filter((function(e){return e.roundNumber===v})))||void 0===l?void 0:l.length;var z=R===Yu?Tu:Pu,Y=m&&v&&(null===(c=oI({sourceStructureId:m.structureId,sourceRoundNumber:v,targetStructureId:S,finishingPositions:x,linkType:z}))||void 0===c?void 0:c.link);return t(t({qualifyingDrawPositionsCount:g,qualifiersCount:O},L),{structure:m,link:Y})}function dI(e){var r,n,i=e.structureIds,o=e.tournamentRecord,u=e.drawDefinition,s=e.matchUpFormat,l=e.structureId,c=e.matchUpId,d=e.event;if(!u)return{error:K};if(!s)return{error:Ye};if(!Fm({matchUpFormat:s}))return{error:Ge};if(c){if((m=Ef({drawDefinition:u,matchUpId:c,event:d})).error)return m;if(!m.matchUp)return{error:Qe};var p=m.matchUp;if((null==p?void 0:p.matchUpType)===ga)return{error:tt,info:"Cannot set matchUpFormat when { matchUpType: TEAM }"};p.matchUpFormat=s,Cp({tournamentId:null==o?void 0:o.tournamentId,eventId:null==d?void 0:d.eventId,context:"setMatchUpFormat",drawDefinition:u,matchUp:p})}else if(Array.isArray(i)){if((null==d?void 0:d.eventType)===ga)return{error:Re};try{for(var v=a(i),f=v.next();!f.done;f=v.next()){if((m=as({drawDefinition:u,structureId:f.value})).error)return m;if(!m.structure)return{error:De};m.structure.matchUpFormat=s}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}}else if(l){if((null==d?void 0:d.eventType)===ga)return{error:Re};var m;if((m=as({drawDefinition:u,structureId:l})).error)return m;if(!m.structure)return{error:De};m.structure.matchUpFormat=s}else u&&(u.matchUpFormat=s);return Op({drawDefinition:u,structureIds:i=null!=i?i:l?[l]:void 0}),t({},L)}function pI(e){var t,r,n,i=e.drawSize,s=e.feedRoundsProfile,l=e.feedRounds,c=void 0===l?0:l,d=e.skipRounds,p=void 0===d?0:d,f=e.baseDrawSize,m=e.linkFedFinishingRoundNumbers,h=e.finishingPositionOffset,g=e.linkFedRoundNumbers,I=e.feedsFromFinal,y=e.isConsolation,U=e.matchUpType,S=e.idPrefix,w=e.isMock,P=e.uuids,D=e.fmlc;f=null!=f?f:function(e){var t=v(e);return t>e?t/2:t}(i);var b=function(e){var t=e.drawSize,r=Math.ceil(Math.log(t)/Math.log(2));return R(0,r).reverse().map((function(e){return Math.pow(2,e)}))}({drawSize:f}),N=b.length,M=0;if(null==s?void 0:s.length)M=s.reduce((function(e,t){return e+t}),0);else if(i){var A=i-f;s=b.filter((function(e){return e<=A&&(A-=e,!0)})),M=s.reduce((function(e,t){return e+t}),0),c=s.length}else p>=N?c=0:I&&(c=N-I,p=0),s=b.filter((function(e,t){return I&&!c||c&&t>=p+c||t<p?0:e})),M=s.reduce((function(e,t){return e+t}),0),c=s.length;var E=u(u([],o(b),!1),o(s),!1).sort((function(e,t){return t-e})),C=E.length,x=u(u([],o((null!=g?g:[]).map((function(e){return e-1}))),!1),o((null!=m?m:[]).map((function(e){return C-e}))),!1).map((function(e){return E[e]})).reduce((function(e,t){return e+t}),0);M-=x;var O,F=0,k=[],_=1,L=R(0,f).map((function(e,t){return{drawPosition:t+1+M}})),j=M+1,B=function(e){var t;if(t=sI({matchUpType:U,roundNumber:_,idPrefix:S,matchUps:k,isMock:w,nodes:L,uuids:P}),O=t.roundNodes,k=t.matchUps,_++,s.includes(e)){var r=R(0,T(s)[e]),i=C+1-_,a=null!==(n=null==m?void 0:m.includes(i))&&void 0!==n?n:null==g?void 0:g.includes(_);r.forEach((function(){var e;e=function(e){for(var t=e.includeMatchUpType,r=e.drawPosition,n=e.roundNumber,i=e.matchUpType,a=e.idPrefix,o=e.matchUps,u=e.isMock,s=e.uuids,l=e.nodes,c=e.fed,d=l.length,p=r?r-d:void 0,v=R(0,d).map((function(e){return p?p+e:void 0})),f=[],m=0;m<d;m++){var h=v.shift(),g={drawPosition:h,fed:c+1,feed:!0},I=l[m];I.roundNumber=n-1;var y=uI({roundPosition:I.roundPosition,roundNumber:n,idPrefix:a,uuids:s}),U={roundPosition:I.roundPosition,drawPositions:[h],matchUpStatus:Yo,roundNumber:n,matchUpId:y};t&&(U.matchUpType=i),u&&(U.isMock=!0),o.push(U);var S={children:[I,g]};f.push(S)}return{roundNodes:f,matchUps:o,drawPosition:r?r-d:void 0}}({drawPosition:!a&&j||void 0,nodes:O,matchUpType:U,roundNumber:_,idPrefix:S,matchUps:k,isMock:w,uuids:P,fed:F}),O=e.roundNodes,k=e.matchUps,j=e.drawPosition,_++,F+=1}))}L=O};try{for(var V=a(b),G=V.next();!G.done;G=V.next()){B(G.value)}}catch(e){t={error:e}}finally{try{G&&!G.done&&(r=V.return)&&r.call(V)}finally{if(t)throw t.error}}C!==_-1&&console.log("ERROR"),k=Hp({finishingPositionOffset:y?f-M:h,positionsFed:M,roundsCount:C,matchUps:k,fmlc:D});var q=(null==O?void 0:O.length)?O[0]:O;return q&&(q.roundNumber=_-1,q.matchUps=k),{draw:q,matchUps:k,roundsCount:C}}function vI(e){var r,n,i,a,s,l=e.finishingPositionOffset,c=void 0===l?0:l,d=e.addNameBaseToAttributeName,p=e.playoffStructureNameBase,v=e.finishingPositionNaming,f=e.finishingPositionLimit,m=e.playoffAttributes,h=e.stageSequence,g=void 0===h?1:h,I=e.exitProfile,y=void 0===I?"0":I,U=e.exitProfileLimit,S=e.roundOffsetLimit,w=e.roundOffset,T=void 0===w?0:w,P=e.drawDefinition,D=e.staggeredEntry,b=e.sequenceLimit,N=e.stage,M=void 0===N?iu:N,A=e.drawSize,E=e.idPrefix,C=e.isMock,x=e.uuids;if(!(!m||!U||(null==m?void 0:m[y]))||A<2||b&&g>b)return{};var O=[],F=[],k=[],_=null!==(r=e.matchUpType)&&void 0!==r?r:null==P?void 0:P.matchUpType,j=c+1,B=c+A,V="".concat(j,"-").concat(B),G=null==m?void 0:m[y],q=p&&"".concat(p," ")||"",W=null!==(n=null==m?void 0:m[V])&&void 0!==n?n:null==v?void 0:v[V],H=e.structureName||(null==W?void 0:W.name)||(null==G?void 0:G.name)&&(d?"".concat(q).concat(null==G?void 0:G.name):G.name)||"".concat(q).concat(V),z=null!==(i=null==W?void 0:W.abbreviation)&&void 0!==i?i:null==G?void 0:G.abbreviation,Y=null!==(s=null!==(a=e.structureId)&&void 0!==a?a:null==G?void 0:G.structureId)&&void 0!==s?s:null==x?void 0:x.pop(),K={idPrefix:E&&"".concat(E,"-").concat(H,"-RP"),finishingPositionOffset:c,matchUpType:_,drawSize:A,isMock:C,uuids:x},J=(D?pI(K):lI(K)).matchUps,Z=tf({structureAbbreviation:z,stageSequence:g,structureName:H,matchUpType:_,roundOffset:T,structureId:Y,matchUps:J,stage:M});O.push.apply(O,u([],o(J),!1)),F.push(Z);var X=Math.ceil(Math.log(A)/Math.log(2)),Q=S?Math.min(S-T,X):!f||j<f?X:0;return A>2&&R(1,Q+1).forEach((function(e){return function(e){var t=A/Math.pow(2,e);if(t<2)return;var r=A/Math.pow(2,e)+c;if(f&&r+1>f)return;var n=vI({finishingPositionOffset:r,exitProfile:"".concat(y,"-").concat(e),roundOffset:T+e,stageSequence:g+1,drawSize:t,addNameBaseToAttributeName:d,playoffStructureNameBase:p,finishingPositionNaming:v,finishingPositionLimit:f,playoffAttributes:m,exitProfileLimit:U,roundOffsetLimit:S,drawDefinition:P,sequenceLimit:b,matchUpType:_,idPrefix:E,uuids:x,stage:M}),i=n.structures,a=n.structureId,s=n.matchUps,l=n.links;if(Z.structureId&&a){var h={linkType:Du,source:{roundNumber:e,structureId:Z.structureId},target:{roundNumber:1,feedProfile:Su,structureId:a}};l&&Z&&l.push(h),(null==l?void 0:l.length)&&k.push.apply(k,u([],o(l),!1))}(null==i?void 0:i.length)&&F.push.apply(F,u([],o(i),!1));(null==s?void 0:s.length)&&O.push.apply(O,u([],o(s),!1));return{structureId:a,childLinks:l,structures:F}}(e)})),t({structureId:Z.structureId,matchUps:O,structureName:H,structures:F,links:k},L)}function fI(e){var r,n,i,a,o=e.finishingPositionOffset,u=void 0===o?0:o,s=e.playoffAttributes,l=e.stageSequence,c=void 0===l?1:l,d=e.staggeredEntry,p=e.structureName,v=e.stage,f=void 0===v?iu:v,m=e.matchUpType,h=e.structureId,g=e.idPrefix,I=e.drawSize,y=e.isMock,U=e.uuids,S={finishingPositionOffset:u,matchUpType:m,drawSize:I,idPrefix:g,isMock:y,uuids:U},w=(d?pI(S):lI(S)).matchUps,T=tf({structureName:p||(null===(r=null==s?void 0:s[0])||void 0===r?void 0:r.name)||ef(iu),structureId:h||(null==U?void 0:U.pop()),stageSequence:c,matchUpType:m,matchUps:w,stage:f}),P=[T],D=[];if(I>2){var b=I/2,N=lI({finishingPositionOffset:u+b,idPrefix:g&&"".concat(g,"-c"),drawSize:b,matchUpType:m,isMock:y}).matchUps,M=ef(ou),R=null!==(a=null!==(i=null===(n=null==s?void 0:s["0-1"])||void 0===n?void 0:n.name)&&void 0!==i?i:e.consolationStructureName)&&void 0!==a?a:p?"".concat(p," ").concat(M):M,A=tf({structureName:R,matchUps:N,structureId:null==U?void 0:U.pop(),stage:ou,stageSequence:1,matchUpType:m});P.push(A);var E={linkType:Du,source:{roundNumber:1,structureId:T.structureId},target:{roundNumber:1,feedProfile:Su,structureId:A.structureId}};D.push(E)}return t(t({},L),{structures:P,links:D})}function mI(e){var t=e.consolationStructure,r=e.roundOffset,n=void 0===r?0:r,i=e.mainStructure,a=e.roundsCount,o=e.feedPolicy,u=e.fmlc,s=t.matchUps.reduce((function(e,t){return(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e}),[]),l=(null==o?void 0:o.roundGroupedOrder)||[],c=null==o?void 0:o.roundFeedProfiles;return R(1+n,a+1+n).map((function(e){var r=c&&c[e-1]?c[e-1]:e%2?Su:wu,a=e-n<=2?e-n:2*(e-n-2)+2,o={linkType:Du,source:{roundNumber:e,structureId:i.structureId},target:{feedProfile:r,roundNumber:a,structureId:t.structureId}},d=l[e-1];return d&&(o.target.groupedOrder=d),on()&&(o.source.structureName=i.structureName,o.target.structureName=t.structureName),2===e&&u&&(o.linkCondition=bu,o.target.feedProfile=Su),s.includes(a)?o:void 0})).filter(Boolean)}function hI(e){var r,n,i,a,s,l=e.playoffStructureNameBase,c=e.finishingPositionOffset,d=e.stageSequence,p=void 0===d?1:d,v=e.playoffAttributes,f=e.structureNameMap,m=e.staggeredEntry,h=e.stage,g=void 0===h?iu:h,I=e.matchUpType,y=e.structureId,U=e.drawSize,S=e.idPrefix,w=e.isMock,T=e.uuids,P={finishingPositionOffset:c,matchUpType:I,drawSize:U,idPrefix:S,isMock:w,uuids:T},D=m?pI(P):lI(P),b=D.matchUps,N=D.roundsCount,M=null!==(i=null!==(r=e.structureName)&&void 0!==r?r:null===(n=null==v?void 0:v[0])||void 0===n?void 0:n.name)&&void 0!==i?i:ef(iu),R=tf({structureId:y||(null==T?void 0:T.pop()),structureName:M,stageSequence:p,matchUpType:I,matchUps:b,stage:g}),A=[R],E=[];if(U>2){var C=[0,2].slice(0,U/16).map((function(e,t){var r=t+1,n=function(e){var t,r,n=e.playoffStructureNameBase,i=e.stageSequence,a=void 0===i?1:i,o=e.playoffAttributes,u=e.structureNameMap,s=e.roundOffset,l=void 0===s?0:s,c=e.matchUpType,d=e.structureId,p=e.idPrefix,v=e.drawSize,f=e.isMock,m=e.index,h=e.uuids,g=v/(2*Math.pow(2,l)),I=pI({finishingPositionOffset:g,baseDrawSize:g,isConsolation:!0,feedRounds:1,matchUpType:c,idPrefix:p,isMock:f,uuids:h}),y=I.matchUps,U=I.roundsCount,S=0===m&&(null===(t=null==o?void 0:o["0-1"])||void 0===t?void 0:t.name)||1===m&&(null===(r=null==o?void 0:o["0-3"])||void 0===r?void 0:r.name),w=S||"".concat(ef(ou)," ").concat(m+1),T=(null==u?void 0:u[w])||w,P=n?"".concat(n," ").concat(T):T,D=tf({matchUps:y,stage:ou,structureName:P,stageSequence:a,matchUpType:c,structureId:d});return{consolationStructure:D,consolationRoundsCount:U}}({idPrefix:S&&"".concat(S,"-c").concat(t),structureId:null==T?void 0:T.pop(),playoffStructureNameBase:l,playoffAttributes:v,structureNameMap:f,stageSequence:r,roundOffset:e,matchUpType:I,drawSize:U,isMock:w,index:t,uuids:T}).consolationStructure;return A.push(n),{consolationStructure:n,links:mI({consolationStructure:n,roundsCount:2,mainStructure:R,roundOffset:e})}})),x=C.map((function(e){return e.links})).flat();if(E.push.apply(E,u([],o(x),!1)),U>=4&&U<=16||U>32){var O=lI({idPrefix:S&&"".concat(S,"-p3t4"),finishingPositionOffset:2,drawSize:2,matchUpType:I,isMock:w}).matchUps,F=null!==(s=null===(a=null==v?void 0:v["3-4"])||void 0===a?void 0:a.name)&&void 0!==s?s:ef(su),k=(null==f?void 0:f[F])||F,_=l?"".concat(l," ").concat(k):k,j=tf({structureId:null==T?void 0:T.pop(),matchUps:O,stageSequence:2,stage:su,structureName:_,matchUpType:I}),B={linkType:Du,source:{roundNumber:N-1,structureId:R.structureId},target:{structureId:j.structureId,feedProfile:Su,roundNumber:1}};A.push(j),E.push(B)}}return t({structures:A,links:E},L)}function gI(e){var r,n,i,a=e.finishingPositionOffset,s=e.stageSequence,l=void 0===s?1:s,c=e.playoffAttributes,d=e.policyDefinitions,p=e.feedsFromFinal,v=e.staggeredEntry,f=e.structureName,m=e.stage,h=void 0===m?iu:m,g=e.structureId,I=e.matchUpType,y=e.skipRounds,U=e.feedRounds,S=e.idPrefix,w=e.drawSize,T=e.isMock,P=e.uuids,D=e.fmlc,b=e.feedPolicy||(null==d?void 0:d[Va]),N={finishingPositionOffset:a,matchUpType:I,skipRounds:y,drawSize:w,idPrefix:S,isMock:T,uuids:P},M=(v?pI(N):lI(N)).matchUps,R=tf({structureName:f||(null===(r=null==c?void 0:c[0])||void 0===r?void 0:r.name)||ef(iu),structureId:g||(null==P?void 0:P.pop()),stageSequence:l,matchUpType:I,matchUps:M,stage:h}),A=[R],E=[],C=w/2,x=pI({finishingPositionOffset:C,idPrefix:S&&"".concat(S,"-c"),isConsolation:!0,feedsFromFinal:p,baseDrawSize:C,matchUpType:I,feedRounds:U,skipRounds:y,isMock:T,uuids:P,fmlc:D}),O=x.matchUps,F=x.roundsCount;if(w>2){var k=null!==(i=null===(n=null==c?void 0:c["0-1"])||void 0===n?void 0:n.name)&&void 0!==i?i:ef(ou),_=e.playoffStructureNameBase?"".concat(e.playoffStructureNameBase," ").concat(k):k,j=tf({matchUps:O,structureId:null==P?void 0:P.pop(),stage:ou,stageSequence:1,structureName:_,matchUpType:I});A.push(j);var B=mI({consolationStructure:j,mainStructure:R,roundsCount:F,feedPolicy:b,fmlc:D});E.push.apply(E,u([],o(B),!1))}return t(t({},L),{structures:A,links:E})}function II(e){var r,n,i,l,c,d,p,v,f,m,g,I,y,U,S,w,T,P,D=e.requireSequential,b=void 0===D||D,N=e.playoffMatchUpFormat,M=e.playoffAttributes,R=e.sourceStructureId,A=e.policyDefinitions,E=e.stageSequence,C=e.drawDefinition,x=e.playoffGroups,O=e.matchUpType,F=e.feedPolicy,k=e.groupCount,_=e.idPrefix,L=e.isMock,j=e.uuids;F=F||(null==A?void 0:A[Va]);var B="processPlayoffGroups",V=0,G=[],q=[],W=[],H=function(e){var t,r=e.playoffGroups,n=e.drawDefinition,i=e.structureId;if(!n)return{error:K};if("string"!=typeof i||!Array.isArray(r))return{error:xr};var a=r.map((function(e){return e.finishingPositions})).flat(),o=null===(t=Np({drawDefinition:n,structureId:i}).playoffFinishingPositionRanges)||void 0===t?void 0:t.filter((function(e){return a.includes(e.finishingPosition)}));return{positionRangeMap:null==o?void 0:o.reduce((function(e,t){return e[t.finishingPosition]=t,e}),{})}}({structureId:R,drawDefinition:C,playoffGroups:x}),z=H.error,Y=H.positionRangeMap;if(z)return On({result:{error:z},stack:B});var J=!Y||(null==x?void 0:x.every((function(e){var t=e.finishingPositions,r=void 0===t?[]:t;if(!r.length)return!1;var n=u([],o(r),!1).sort(s).map((function(e,t){return(r[t+1]||e)-e})).every((function(e){return e<2}));return(!b||n)&&r.every((function(e){return Y[e]}))})));if(!J)return On({context:{validFinishingPositions:Object.values(Y)},result:{error:xr},stack:B});var Z=function(e){var r,n=e.finishingPositions,a=Y&&n.map((function(e){var t;return null===(t=Y[e])||void 0===t?void 0:t.finishingPositions})).flat(),s=k*n.length,D=h(s),b=2===D&&Eu||e.drawType||Eu;a&&(V=Math.min.apply(Math,u([],o(a),!1))-1);var C=a&&"".concat(Math.min.apply(Math,u([],o(a),!1)),"-").concat(Math.max.apply(Math,u([],o(a),!1))),x=e.structureName||C&&(null===(l=null===(i=e.playoffAttributes)||void 0===i?void 0:i[C])||void 0===l?void 0:l.name)||(null===(d=null===(c=e.playoffAttributes)||void 0===c?void 0:c[0])||void 0===d?void 0:d.name),B={addNameBaseToAttributeName:e.addNameBaseToAttributeName,playoffStructureNameBase:e.playoffStructureNameBase,finishingPositionNaming:e.finishingPositionNaming,finishingPositionLimit:e.finishingPositionLimit,structureId:null!==(p=e.structureId)&&void 0!==p?p:null==j?void 0:j.pop(),playoffAttributes:e.playoffAttributes,structureNameMap:e.structureNameMap,sequenceLimit:e.sequenceLimit,structureName:x},H=t(t({},B),{idPrefix:_&&"".concat(_,"-po"),appliedPolicies:A,finishingPositionOffset:V,stage:su,stageSequence:E,matchUpType:O,drawSize:D,isMock:L,uuids:j}),z=function(e){var t=e.playoffStructures,r=e.playoffLinks,i=o(t,1)[0],a=yI({playoffStructureId:i.structureId,finishingPositions:n,sourceStructureId:R});W.push(a),W.push.apply(W,u([],o(r),!1)),q.push.apply(q,u([],o(t),!1)),G.push({structureId:i.structureId,finishingPositions:n}),V+=s};if(b===Eu){var K=lI({finishingPositionLimit:V+s,idPrefix:_&&"".concat(_,"-po"),finishingPositionOffset:V,matchUpType:O,drawSize:D,isMock:L,uuids:j}).matchUps,J=tf({structureId:null!==(v=e.structureId)&&void 0!==v?v:null==j?void 0:j.pop(),matchUpFormat:N,stage:su,structureName:x,stageSequence:E,matchUps:K});q.push(J);var Z=yI({playoffStructureId:J.structureId,finishingPositions:n,sourceStructureId:R});W.push(Z),V+=s,G.push({structureId:J.structureId,finishingPositions:n})}else if([Ru,Au,su].includes(b)){var X={playoffAttributes:null!==(f=e.playoffAttributes)&&void 0!==f?f:M,playoffStructureNameBase:e.playoffStructureNameBase,structureId:null!==(m=e.structureId)&&void 0!==m?m:null==j?void 0:j.pop(),structureName:e.structureName,idPrefix:_&&"".concat(_,"-po"),addNameBaseToAttributeName:!0,finishingPositionOffset:V,stage:su,roundOffset:0,stageSequence:E,drawSize:D,isMock:L,uuids:j};b===Ru?Object.assign(X,{playoffAttributes:null!==(I=null!==(g=null==e?void 0:e.playoffAttributes)&&void 0!==g?g:M)&&void 0!==I?I:Xu,roundOffsetLimit:3}):b===Au&&Object.assign(X,{playoffAttributes:null!==(U=null!==(y=null==e?void 0:e.playoffAttributes)&&void 0!==y?y:M)&&void 0!==U?U:Qu,roundOffsetLimit:2});var Q=vI(X);if(Q.error)return{value:Q};if((null===(S=Q.links)||void 0===S?void 0:S.length)&&W.push.apply(W,u([],o(Q.links),!1)),(null===(w=Q.structures)||void 0===w?void 0:w.length)&&q.push.apply(q,u([],o(Q.structures),!1)),q.sort(ns),Q.structureId){Z=yI({playoffStructureId:Q.structureId,finishingPositions:n,sourceStructureId:R});W.push(Z),G.push({structureId:Q.structureId,finishingPositions:n})}V+=s}else if([xu,zu,qu,Vu,ju,Hu].includes(b)){var $=[null==j?void 0:j.pop(),null==j?void 0:j.pop()],ee={playoffStructureNameBase:e.playoffStructureNameBase,structureId:null!==(T=e.structureId)&&void 0!==T?T:null==j?void 0:j.pop(),playoffAttributes:e.playoffAttributes,idPrefix:_&&"".concat(_,"-po"),finishingPositionOffset:V,uuids:$,stage:su,structureName:x,matchUpType:O,feedPolicy:F,drawSize:D,isMock:L},te=((r={})[xu]={fmlc:!0,feedRounds:1},r[Hu]={feedRounds:1},r[qu]={feedsFromFinal:3},r[Vu]={feedsFromFinal:2},r[ju]={feedsFromFinal:1},r);Object.assign(ee,te[b]||{});var re=gI(ee),ne=re.structures,ie=re.links;Z=yI({playoffStructureId:(J=o(ne,1)[0]).structureId,finishingPositions:n,sourceStructureId:R});W.push(Z),W.push.apply(W,u([],o(ie),!1)),q.push.apply(q,u([],o(ne),!1)),G.push({structureId:J.structureId,finishingPositions:n}),V+=s}else if([Yu].includes(b)){var ae=Gf(t(t({},H),{structureOptions:e.structureOptions||{groupSize:4}}));z({playoffStructures:ae.structures,playoffLinks:ae.links})}else if([Ou].includes(b)){var oe=fI(H);z({playoffStructures:oe.structures,playoffLinks:oe.links})}else if([_u].includes(b)){var ue=hI(H);z({playoffStructures:ue.structures,playoffLinks:ue.links})}else if([Nu].includes(b)){z({playoffStructures:[tf({structureId:null!==(P=e.structureId)&&void 0!==P?P:null==j?void 0:j.pop(),structureName:e.structureName,finishingPosition:cl,stage:su,stageSequence:E,matchUps:[]})],playoffLinks:[]})}};try{for(var X=a(x),Q=X.next();!Q.done;Q=X.next()){var $=Z(Q.value);if("object"==typeof $)return $.value}}catch(e){r={error:e}}finally{try{Q&&!Q.done&&(n=X.return)&&n.call(X)}finally{if(r)throw r.error}}return{finishingPositionTargets:G,positionRangeMap:Y,structures:q,links:W}}function yI(e){var t=e.playoffStructureId,r=e.finishingPositions,n=e.sourceStructureId;return{linkType:Tu,source:{structureId:n,finishingPositions:r},target:{structureId:t,feedProfile:yu,roundNumber:1}}}function UI(e){var r,n,i,s,c,d,p="genPlayoffStructure";if(!e.drawDefinition)return On({result:{error:K},stack:p});var v=Np(e);if(v.error)return On({result:v,stack:p});var f=e.structureId,m=e.addNameBaseToAttributeName,h=e.playoffStructureNameBase,g=e.finishingPositionNaming,I=e.finishingPositionLimit,y=e.playoffAttributes,U=e.playoffPositions,S=e.roundOffsetLimit,w=e.tournamentRecord,T=e.exitProfileLimit,P=e.roundProfiles,D=e.roundNumbers,b=e.idPrefix,N=e.isMock,M=e.event,R=e.uuids,A=Ui(e.drawDefinition,!1,!0),E=as({structureId:f,drawDefinition:A}).structure;if(!E)return On({result:{error:De},stack:p});if(E.structureType===Iu||E.structures)return function(e){var r,n,i,a,s,l="generateAndPopulateRRplayoffStructures";if(!e.playoffGroups)return On({result:{error:pt},info:"playoffGroups required",stack:l});var c=e.sourceStructureId,d=e.requireSequential,p=e.tournamentRecord,v=e.drawDefinition,f=e.playoffGroups,m=e.groupCount,h=e.groupSize,g=e.event,I=II(t({requireSequential:d,sourceStructureId:c,playoffGroups:f,groupCount:m,groupSize:h},e)),y=I.structures,U=void 0===y?[]:y,S=I.links,w=void 0===S?[]:S,T=I.finishingPositionTargets,P=I.positionRangeMap,D=I.error;if(D)return{error:D};var b=null==T?void 0:T.map((function(e){return e.finishingPositions})).flat().map((function(e){return P[e].finishingPositions})).flat();(r=v.structures).push.apply(r,u([],o(U),!1)),(n=v.links).push.apply(n,u([],o(w),!1));var N=Ip({inContext:!0,drawDefinition:v}),M=N.matchUps,R=N.matchUpsMap,A=U.map((function(e){return e.structureId})),E=null==M?void 0:M.filter((function(e){var t=e.structureId;return A.includes(t)})).map(Ro),C=null===(i=null==R?void 0:R.drawMatchUps)||void 0===i?void 0:i.filter((function(e){var t=e.matchUpId;return null==E?void 0:E.includes(t)}));if(null==C?void 0:C.length){var x=null===(a=Gd({drawDefinition:v,event:g}))||void 0===a?void 0:a.tieFormat;x&&C.forEach((function(t){var r=Ym({isMock:e.isMock,tieFormat:x,matchUp:t}).tieMatchUps;Object.assign(t,{tieMatchUps:r,matchUpType:Os})}))}var O=ss({structureId:c,drawDefinition:v}).positionAssignments,F={};null==O||O.forEach((function(e){var t,r=Vn({element:e,name:yo}),n=null===(t=null==r?void 0:r.extension)||void 0===t?void 0:t.value,i=null==n?void 0:n.groupOrder;i&&(F[i]||(F[i]=[]),F[i].push(e.participantId))}));var k=Ch({provisionalPositioning:e.provisionalPositioning,structureId:c,applyPositioning:!0,event:e.event,tournamentRecord:p,drawDefinition:v});return k.error&&(null===(s=k.error)||void 0===s?void 0:s.code)!==Q.code?On({result:k,stack:l}):t({structures:U,links:w,positionsPlayedOff:b,drawDefinition:v},L)}(t(t(t({sourceStructureId:E.structureId},e),v),{drawDefinition:A}));var C=v.playoffRoundsRanges,x=v.playoffRounds,O=bp(e),F=O.playoffPositionsReturned,k=O.error,_=O.playoffSourceRounds,j=O.playoffRoundsRanges;if(k)return On({result:{error:k},stack:p});var B=(null==P?void 0:P.length)&&Object.assign.apply(Object,u([{}],o(P),!1)),V=D||"object"==typeof P&&P.map((function(e){return Object.keys(e)})).flat(),G=Array.isArray(V)&&V.map((function(e){return!isNaN(e)&&l(e)})).filter(Boolean);if(G){if(!Array.isArray(G))return On({result:{error:xr},context:{validRoundNumbers:G},stack:p});G.forEach((function(e){if(!(null==x?void 0:x.includes(e)))return On({result:{error:xr},context:{roundNumber:e},stack:p})}))}U&&U.forEach((function(e){if(!(null==F?void 0:F.includes(e)))return On({result:{error:xr},context:{playoffPosition:e},stack:p})}));var q=G||_,W=G?C:j,H=[],z=[],Y=function(e){var t=null==W?void 0:W.find((function(t){return t.roundNumber===e}));if(!t)return{value:On({result:{error:xr},context:{roundNumber:e},stack:p})};var r=t.finishingPositions.length,n=Math.min.apply(Math,u([],o(t.finishingPositions),!1))-1,i=e&&(null==B?void 0:B[e])&&2+B[e]-1,a=vI({exitProfile:"0-".concat(e),addNameBaseToAttributeName:m,playoffStructureNameBase:h,finishingPositionOffset:n,playoffAttributes:y,exitProfileLimit:T,stage:su,roundOffset:0,drawDefinition:A,sequenceLimit:i,stageSequence:2,drawSize:r,idPrefix:b,isMock:N,uuids:R,finishingPositionNaming:g,finishingPositionLimit:I,roundOffsetLimit:S});if(a.error)return{value:On({result:a,stack:p})};var s=a.structures,l=a.links;if((null==s?void 0:s.length)&&H.push.apply(H,u([],o(s),!1)),(null==l?void 0:l.length)&&z.push.apply(z,u([],o(l),!1)),a.structureId&&e){var c={linkType:Du,source:{structureId:f,roundNumber:e},target:{structureId:a.structureId,feedProfile:Su,roundNumber:1}};z.push(c)}};try{for(var J=a(null!=q?q:[]),Z=J.next();!Z.done;Z=J.next()){var X=Y(Z.value);if("object"==typeof X)return X.value}}catch(e){r={error:e}}finally{try{Z&&!Z.done&&(n=J.return)&&n.call(J)}finally{if(r)throw r.error}}if(!H.length)return On({result:{error:xr},info:"No structures generated",stack:p});(i=A.structures).push.apply(i,u([],o(H),!1)),(s=A.links).push.apply(s,u([],o(z),!1));var $=Ip({inContext:!0,drawDefinition:A}),ee=$.matchUps,te=$.matchUpsMap,re=H.map((function(e){return e.structureId})),ne=null==ee?void 0:ee.filter((function(e){var t=e.structureId;return re.includes(t)})).map(Ro),ie=null===(c=null==te?void 0:te.drawMatchUps)||void 0===c?void 0:c.filter((function(e){var t=e.matchUpId;return null==ne?void 0:ne.includes(t)}));if(null==ie?void 0:ie.length){var ae=null===(d=Gd({drawDefinition:A,event:M}))||void 0===d?void 0:d.tieFormat;ae&&ie.forEach((function(e){var t=Ym({matchUp:e,tieFormat:ae,isMock:N}).tieMatchUps;Object.assign(e,{tieMatchUps:t,matchUpType:Fs})}))}var oe=null==ee?void 0:ee.filter((function(e){return hp({matchUp:e})&&e.structureId===f}));null==oe||oe.forEach((function(e){var t=e.matchUpId,r=e.score,n=e.winningSide,i=Ks({inContextDrawMatchUps:ee,drawDefinition:A,matchUpId:t}),a=Dg({inContextDrawMatchUps:ee,tournamentRecord:w,drawDefinition:A,matchUpsMap:te,winningSide:n,targetData:i,matchUpId:t,structure:E,matchUp:e,score:r,event:M});a.error&&console.log(a.error)}));var ue=null==ee?void 0:ee.filter((function(e){return e.matchUpStatus===Fo&&e.structureId===f}));null==ue||ue.forEach((function(e){var t=e.matchUpId,r=Ks({inContextDrawMatchUps:ee,drawDefinition:A,matchUpId:t}),n=r.targetLinks.loserTargetLink,i=r.targetMatchUps,a=i.loserMatchUpDrawPositionIndex,o=i.loserMatchUp;if(n&&o){var u=n.target.structureId,s=av({drawPosition:o.drawPositions[a],structureId:u,tournamentRecord:w,drawDefinition:A,event:M});s.error&&console.log(s.error)}}));var se=[],le=zp({inContextDrawMatchUps:ee,drawDefinition:A,matchUpsMap:te}).goesToMap;return mp({structure:as({drawDefinition:e.drawDefinition,structureId:f}).structure}).matchUps.forEach((function(t){var r,n,i=null==le?void 0:le.loserMatchUpIds[t.matchUpId];if(i&&t.loserMatchUpId!==i){t.loserMatchUpId=i;var a={tournamentId:null==w?void 0:w.tournamentId,eventId:null===(r=e.event)||void 0===r?void 0:r.eventId,context:p,matchUp:t};se.push(a)}var o=null==le?void 0:le.winnerMatchUpIds[t.matchUpId];if(o&&t.winnerMatchUpId!==o){t.winnerMatchUpId=o;a={tournamentId:null==w?void 0:w.tournamentId,eventId:null===(n=e.event)||void 0===n?void 0:n.eventId,context:p,matchUp:t};se.push(a)}})),t({structures:H,matchUpModifications:se,links:z,drawDefinition:A},L)}function SI(e){return wI(t(t({},e),{itemType:"attachPlayoffStructures"}))}function wI(e){var n,i,s,l,c,d=e.itemType,p=void 0===d?"attachStructures":d,v=e.matchUpModifications,f=e.tournamentRecord,m=e.drawDefinition,h=e.structures,g=e.links,I=void 0===g?[]:g,y=e.event,U="attachStructures";if(!m)return{error:K};if(!Array.isArray(h)||!Array.isArray(I))return On({result:{error:xr},stack:U});var S=function(e){var t;return[e.source.structureId,e.source.roundNumber||(null===(t=e.source.finishingPositions)||void 0===t?void 0:t.join("|")),e.target.roundNumber].join("|")},w=null===(i=m.links)||void 0===i?void 0:i.map(S);if(I.some((function(e){var t=S(e);return null==w?void 0:w.includes(t)})))return On({result:{error:zr},info:"playoff structure exists",stack:U});I.length&&(null===(s=m.links)||void 0===s||s.push.apply(s,u([],o(I),!1)));var T=h.map((function(e){return e.structureId})),P=null===(l=m.structures)||void 0===l?void 0:l.map((function(e){return e.structureId}));m.structures=(null!==(c=m.structures)&&void 0!==c?c:[]).map((function(e){return T.includes(e.structureId)?h.find((function(t){return t.structureId===e.structureId})):e}));var D=null==h?void 0:h.filter((function(e){var t=e.structureId;return!(null==P?void 0:P.includes(t))}));D.length&&(n=m.structures).push.apply(n,u([],o(D),!1)),zp({drawDefinition:m});var b=h.map((function(e){var t;return(null===(t=mp({structure:e}))||void 0===t?void 0:t.matchUps)||[]})).flat();Ap({tournamentId:null==f?void 0:f.tournamentId,eventId:null==y?void 0:y.eventId,drawDefinition:m,matchUps:b});var N=h.map((function(e){return e.structureId}));if(Op({drawDefinition:m,structureIds:N}),null==v?void 0:v.length){var M={};v.forEach((function(e){var t,r=null===(t=e.matchUp)||void 0===t?void 0:t.matchUpId;r&&(M[r]=e)}));var R=function(e){e.matchUps.forEach((function(e){if(M[e.matchUpId]){var t=M[e.matchUpId].matchUp,n=t.tieMatchUps,i=r(t,["tieMatchUps"]);if(Object.assign(e,i),null==n?void 0:n.length){var a={};n.forEach((function(e){return M[e.matchUpId]=e})),e.tieMatchUps.forEach((function(e){return Object.assign(e,a[e.matchUpId])}))}M[e.matchUpId].matchUp=e,Cp(M[e.matchUpId])}}))};m.structures.forEach((function(e){var t,r;if(null==P?void 0:P.includes(e.structureId))if(e.structures)try{for(var n=a(e.structures),i=n.next();!i.done;i=n.next()){var o=i.value;R(o)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}else R(e)}))}var A=D.map(Ri("structureId"));f&&mf({element:f,timeItem:{itemValue:{structureIds:N,drawId:m.drawId},itemType:p}});return t(t({},L),{addedStructureIds:A})}function TI(e){var t,r,n=UI(e),i=n.structures,a=n.links,o=n.matchUpModifications,u=n.error;if(u)return{error:u};var s=e.drawDefinition;return SI({tournamentId:null===(t=e.tournamentRecord)||void 0===t?void 0:t.tournamentId,eventId:(null===(r=e.event)||void 0===r?void 0:r.eventId)||e.eventId,matchUpModifications:o,drawDefinition:s,structures:i,links:a})}function PI(e){var t=e.winnerFirst,r=void 0===t||t,n=e.addOutcomeString,i=e.reversed,a=void 0!==i&&i,o=e.matchUpStatus,u=e.matchUpFormat,s=e.autoComplete,l=e.winningSide,c=e.sets;if(!c)return{error:pt,info:"missing sets"};var d=u&&Zd(u),p=null!=d?d:{},v=p.bestOf,m=p.finalSetFormat,h=p.setFormat,g=a||!(!r||!l||1===l),I=n?function(e){var t,r=e.matchUpStatus,n=(t={},t[Ho]="RET",t[Ko]="WO",t[Bo]="DF/DF",t[Vo]="WO/WO",t[zo]="SUS",t[xo]="ABN",t[jo]="DEF",t[Lo]="DR",t);return r&&n[r]||""}({matchUpStatus:o}):"",y=(null==c?void 0:c.sort(DI).map((function(e){var t=v&&e.setNumber===v&&m?m:h,r=(null==t?void 0:t.tiebreakSet)||(c=e,!(f(null==c?void 0:c.side1Score)||f(null==c?void 0:c.side2Score))&&function(e){return f(null==e?void 0:e.side1TiebreakScore)||f(null==e?void 0:e.side2TiebreakScore)}(e)),n=e.side1Score,i=e.side2Score,a=e.side1TiebreakScore,o=e.side2TiebreakScore,u=a||(f(a)||s?0:""),l=o||(f(o)||s?0:"");var c;if(r){return"[".concat((g?[l,u]:[u,l]).join("-"),"]")}var d=Math.min(u,l),p=d?"(".concat(d,")"):"",I=n||(f(n)||s?0:""),y=i||(f(i)||s?0:""),U=g?"".concat([y,I].join("-")).concat(p):"".concat([I,y].join("-")).concat(p);["-"," "].includes(U)&&(U="");return U})).filter(Boolean).join(" "))||"";return I?2===l?"".concat(I," ").concat(y):"".concat(y," ").concat(I):y}function DI(e,t){return e.setNumber-t.setNumber}function bI(e){var t=e.matchUpFormat,r=e.matchUpStatus,n=e.winningSide,i=e.score;if(!i)return{sets:[]};var a=i.sets||[],o=PI({winnerFirst:!1,matchUpFormat:t,matchUpStatus:r,sets:a}),u=PI({winnerFirst:!1,reversed:!0,matchUpFormat:t,matchUpStatus:r,sets:a}),s=PI({matchUpFormat:t,matchUpStatus:r,winningSide:n,sets:a}),l=o===s?u:o;return n&&(o=1===n?s:l,u=2===n?s:l),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:u}}}function NI(e){var t,r,n=$c(e);if(!e.drawDefinition){var i=null!==(t=e.tournamentRecord)&&void 0!==t?t:e.tournamentId&&n[e.tournamentId];if(e.tournamentRecord||(e.tournamentRecord=i),(m=Ld({eventId:e.eventId,drawId:e.drawId,tournamentRecord:i})).error)return m;m.drawDefinition&&(e.drawDefinition=m.drawDefinition),e.event=m.event}var a=e.policyDefinitions,o=e.tournamentRecord,u=e.disableAutoCalc,s=e.enableAutoCalc,l=e.drawDefinition,c=e.matchUpFormat,d=e.matchUpId,p=e.schedule,v=e.event,f=e.notes;if(!l)return{error:pe};if(!d)return{error:Ze};var m,h=Jl({policyType:ja,tournamentRecord:o,event:v}).policy,g=void 0!==e.allowChangePropagation&&e.allowChangePropagation||void 0!==(null==h?void 0:h.allowChangePropagation)&&h.allowChangePropagation||void 0,I=e.outcome;if(c&&(m=dI({tournamentRecord:o,drawDefinition:l,matchUpFormat:c,matchUpId:d,event:v})).error)return m;if((null===(r=null==I?void 0:I.score)||void 0===r?void 0:r.sets)&&!I.score.scoreStringSide1){var y=bI(I).score;I.score=y,I.score.sets=I.score.sets.filter((function(e){return e.side1Score||e.side2Score||e.side1TiebreakScore||e.side2TiebreakScore}))}return Yg({matchUpStatusCodes:null==I?void 0:I.matchUpStatusCodes,matchUpStatus:null==I?void 0:I.matchUpStatus,winningSide:null==I?void 0:I.winningSide,allowChangePropagation:g,score:null==I?void 0:I.score,tournamentRecords:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:u,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:d,schedule:p,event:v,notes:f})}function MI(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S=e.updateInProgressMatchUps,w=void 0===S||S,T=e.collectionDefinition,P=e.referenceCategory,D=e.tournamentRecord,b=e.policyDefinitions,N=e.enforceCategory,M=e.referenceGender,R=e.drawDefinition,A=e.tieFormatName,E=e.enforceGender,C=e.structureId,x=e.matchUpId,O=e.matchUp,F=e.eventId,k=e.uuids,_=e.event,j="addCollectionDefinition",B=null!==(p=tl({tournamentRecord:D,drawDefinition:R,event:_}).appliedPolicies)&&void 0!==p?p:{},V=null!==(v=null==b?void 0:b[Ca])&&void 0!==v?v:null==B?void 0:B[Ca];N=null!=N?N:null===(f=null==V?void 0:V.participants)||void 0===f?void 0:f.enforceCategory;var G=!1!==(null!=E?E:null===(m=null==V?void 0:V.participants)||void 0===m?void 0:m.enforceGender),q=!(!(null!=P?P:null==_?void 0:_.category)||!1===N),W=!(!(null!=M?M:null==_?void 0:_.gender)||!G),H=Hm({referenceCategory:null!=P?P:null==_?void 0:_.category,collectionDefinition:T,referenceGender:M,checkCategory:q,checkGender:W,event:_});if(H.error)return On({result:H,stack:j});var z=(null==O?void 0:O.tieFormat)?void 0:Rm({drawDefinition:R,structureId:C,matchUpId:x,eventId:F,event:_});if(null==z?void 0:z.error)return On({result:{error:z.error},stack:j});var Y=null==z?void 0:z.structure,J=null!==(h=null==(O=null!=O?O:null==z?void 0:z.matchUp)?void 0:O.tieFormat)&&void 0!==h?h:null==z?void 0:z.tieFormat,Z=bm(J);if(null==(z=zm({tieFormat:Z}))?void 0:z.error)return On({result:{error:z.error},stack:j});if(T.collectionId){var X=Z.collectionDefinitions.map((function(e){return e.collectionId}));if(X.includes(T.collectionId))return On({context:{collectionId:T.collectionId},result:{error:Or}})}else T.collectionId=ed();Z.collectionDefinitions.push(T),Z.collectionDefinitions.sort((function(e,t){return(e.collectionOrder||0)-(t.collectionOrder||0)})).forEach((function(e,t){return e.collectionOrder=t+1}));var Q=Mm(Z),$=Q.aggregateValue,ee=Q.valueGoal;Z.winCriteria=xn({aggregateValue:$,valueGoal:ee});var te=null==J?void 0:J.winCriteria.valueGoal,re=null==J?void 0:J.winCriteria.aggregateValue;(te&&te!==ee||$&&!re)&&(A?Z.tieFormatName=A:delete Z.tieFormatName);var ne=[],ie=[],ae=[],oe=xn(Z);if(null==(z=zm({tieFormat:oe}))?void 0:z.error)return On({result:{error:z.error},stack:j});if(F&&_){_.tieFormat=oe;try{for(var ue=a(null!==(g=_.drawDefinitions)&&void 0!==g?g:[]),se=ue.next();!se.done;se=ue.next()){var le=se.value;if(!le.tieFormat)try{for(var ce=(i=void 0,a(null!==(I=le.structures)&&void 0!==I?I:[])),de=ce.next();!de.done;de=ce.next()){var pe=de.value;if(!pe.tieFormat){var ve=RI({updateInProgressMatchUps:w,collectionDefinition:T,structure:pe,uuids:k});ie.push.apply(ie,u([],o(ve.newMatchUps),!1)),ae.push.apply(ae,u([],o(ve.targetMatchUps),!1)),ne.push(pe.structureId)}}}catch(e){i={error:e}}finally{try{de&&!de.done&&(s=ce.return)&&s.call(ce)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{se&&!se.done&&(n=ue.return)&&n.call(ue)}finally{if(r)throw r.error}}AI({modifiedMatchUps:ae,eventId:null==_?void 0:_.eventId,modifiedStructureIds:ne,tournamentRecord:D,drawDefinition:R,addedMatchUps:ie,stack:j})}else if(C&&Y){Y.tieFormat=oe;var fe=RI({updateInProgressMatchUps:w,collectionDefinition:T,structure:Y,uuids:k});ie.push.apply(ie,u([],o(fe.newMatchUps),!1)),AI({modifiedMatchUps:ae=fe.targetMatchUps,eventId:null==_?void 0:_.eventId,modifiedStructureIds:ne,tournamentRecord:D,drawDefinition:R,addedMatchUps:ie,stack:j})}else if(x&&O){if(!Qm({matchUp:O,updateInProgressMatchUps:w}))return On({result:{error:Dt},stack:j});O.tieFormat=oe;var me=Km({collectionDefinition:T,matchUp:O,uuids:k});Array.isArray(O.tieMatchUps)||(O.tieMatchUps=[]),(l=O.tieMatchUps).push.apply(l,u([],o(me),!1)),ie.push.apply(ie,u([],o(me),!1)),AI({modifiedMatchUps:[O],eventId:null==_?void 0:_.eventId,modifiedStructureIds:ne,tournamentRecord:D,drawDefinition:R,addedMatchUps:ie,stack:j})}else{if(!R)return{error:K};R.tieFormat=oe;try{for(var he=a(null!==(y=R.structures)&&void 0!==y?y:[]),ge=he.next();!ge.done;ge=he.next()){var Ie=ge.value,ye=RI({updateInProgressMatchUps:w,collectionDefinition:T,structure:Ie,uuids:k});ne.push(Ie.structureId),ie.push.apply(ie,u([],o(ye.newMatchUps),!1)),ae.push.apply(ae,u([],o(ye.targetMatchUps),!1))}}catch(e){c={error:e}}finally{try{ge&&!ge.done&&(d=he.return)&&d.call(he)}finally{if(c)throw c.error}}AI({modifiedMatchUps:ae,eventId:null==_?void 0:_.eventId,tournamentRecord:D,drawDefinition:R,addedMatchUps:ie,stack:j})}(null===(U=null==B?void 0:B.audit)||void 0===U?void 0:U[Uo])&&th({drawDefinition:R,auditData:xn({drawId:null==R?void 0:R.drawId,collectionDefinition:T,action:j,structureId:C,matchUpId:x,eventId:F})});return t({tieFormat:oe,targetMatchUps:ae,addedMatchUps:ie},L)}function RI(e){var t,r,n,i,s=e.updateInProgressMatchUps,l=e.collectionDefinition,c=e.structure,d=e.uuids,p=[],v=(null===(i=mp({matchUpFilters:{matchUpTypes:[Fs]},structure:c}))||void 0===i?void 0:i.matchUps).filter((function(e){return Qm({matchUp:e,updateInProgressMatchUps:s})&&!e.tieFormat}));try{for(var f=a(v),m=f.next();!m.done;m=f.next()){var h=m.value,g=Km({collectionDefinition:l,matchUp:h,uuids:d});Array.isArray(h.tieMatchUps)||(h.tieMatchUps=[]),(n=h.tieMatchUps).push.apply(n,u([],o(g),!1)),p.push.apply(p,u([],o(g),!1))}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}return{newMatchUps:p,targetMatchUps:v}}function AI(e){var t=e.modifiedStructureIds,r=e.tournamentRecord,n=e.modifiedMatchUps,i=e.drawDefinition,a=e.addedMatchUps,o=e.eventId,u=e.stack;Ap({tournamentId:null==r?void 0:r.tournamentId,matchUps:a,drawDefinition:i,eventId:o}),null==n||n.forEach((function(e){Cp({tournamentId:null==r?void 0:r.tournamentId,drawDefinition:i,context:u,matchUp:e,eventId:o})})),Op({structureIds:t,drawDefinition:i,eventId:o})}function EI(e){var r,n,i,s,l,c,d,p,v=da(e,[(r={_anyOf:(n={},n[xi]=!1,n[Fi]=!1,n[ki]=!1,n[ta]=!1,n)},r[Oi]=!0,r)]);if(v.error)return v;var f=[],m=null!==(c=null!==(l=e.drawDefinition)&&void 0!==l?l:e.event)&&void 0!==c?c:(e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord;if(m){if((y=CI(e,m)).error)return y;f.push.apply(f,u([],o(null!==(d=null==y?void 0:y.applied)&&void 0!==d?d:[]),!1)),e.drawDefinition&&Op({drawDefinition:e.drawDefinition,tournamentId:e.tournamentId})}else{if(!e.tournamentRecords)return{error:W};var h=Object.keys(e.tournamentRecords);if(!h.length)return{error:W};try{for(var g=a(h),I=g.next();!I.done;I=g.next()){var y,U=I.value;if((y=CI(e,e.tournamentRecords[U])).error)return y;f.push.apply(f,u([],o(null!==(p=null==y?void 0:y.applied)&&void 0!==p?p:[]),!1))}}catch(e){i={error:e}}finally{try{I&&!I.done&&(s=g.return)&&s.call(g)}finally{if(i)throw i.error}}}return f.length?t(t({},L),{applied:f}):{error:ut}}function CI(e,n){var i,o,u,s=null!==(u=tl(e).appliedPolicies)&&void 0!==u?u:{};n.extensions||(n.extensions=[]);var l=[],c=Object.keys(e.policyDefinitions);if(!c.length)return{error:nt};try{for(var d=a(c),p=d.next();!p.done;p=d.next()){var v=p.value;if(!s[v]||e.allowReplacement){var f=e.policyDefinitions[v];if(!f)continue;if(!Di(f))return{error:xr};var m=f.policyName,h=r(f,["policyName"]);if(!h||!Object.keys(h).length||m&&!Pi(m))return{error:xr};s[v]=e.policyDefinitions[v],l.push(v)}}}catch(e){i={error:e}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}return(null==l?void 0:l.length)?t(t({},jn({element:n,extension:{name:Za,value:s}})),{applied:l}):{applied:l,error:ut}}function xI(e){var r,n=e.tournamentRecord,i=e.drawDefinition,a=e.flightProfile,o=e.drawName,u=e.drawId,s=e.event;if(!o||"string"!=typeof o)return On({result:{error:xr},context:{drawName:o}});a||(a=_d({event:s}).flightProfile);var l=null===(r=null==a?void 0:a.flights)||void 0===r?void 0:r.find((function(e){return e.drawId===u}));l&&(l.drawName=o,Ya({event:s,extension:{name:ao,value:t(t({},a),{flights:a.flights})}}));return i&&(i.drawName=o,Op({tournamentId:null==n?void 0:n.tournamentId,drawDefinition:i})),l||i?t(t({},L),{flight:l}):{error:K}}function OI(e){var r,n=e.tournamentRecord;if(!n)return{error:W};var i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},a={};return(null===(r=n.events)||void 0===r?void 0:r.map((function(e){var t=e.eventId;return a[t]=e,((null==e?void 0:e.drawDefinitions)||[]).map((function(e){return{drawDefinition:e,eventId:t}}))})).flat().filter(Boolean)).forEach((function(e){var t=e.drawDefinition,r=e.eventId,n=0,o=0,u=0,s=Sf({drawDefinition:t}).allStructuresLinked,c=a[r],d=((null==t?void 0:t.structures)||[]).map((function(e){var r,i,a,s,l=e.stage,d=e.stageSequence,p=e.structureId,v=cu[l],f=Qp({drawDefinition:t,structure:e,event:c}).inContextStructureMatchUps,m=null==f?void 0:f.filter((function(e){return e.winningSide})),h=m.filter(Boolean).length||0;o+=h,u+=f.length-o;var g=Math.max(m.filter((function(e){return 1===e.roundNumber})).map((function(e){return e.roundPosition}))),I=ss({structure:e}).positionAssignments,y=null==I?void 0:I.filter((function(e){return e.participantId}));n+=null!==(r=null==y?void 0:y.length)&&void 0!==r?r:0;var U=(null!==(i=null==I?void 0:I.length)&&void 0!==i?i:0)-(null!==(a=null==y?void 0:y.length)&&void 0!==a?a:0),S=Xs({matchUps:f}),w=S.roundMatchUps,T=S.roundProfile,P=S.roundNumbers,D=S.maxMatchUpsCount,b=T&&Object.keys(T).filter((function(e){return!T[e].inactiveRound})).map((function(e){return parseInt(e)})),N=T&&Object.keys(T).filter((function(e){return T[e].inactiveRound})).map((function(e){return parseInt(e)})),M=T&&Object.values(T).every((function(e){return e.inactiveRound}));return{positionsAssignedCount:null!==(s=null==y?void 0:y.length)&&void 0!==s?s:0,maxWinningSideFirstRoundPosition:g,unassignedPositionsCount:U,inactiveStructure:M,maxMatchUpsCount:D,inactiveRounds:N,roundMatchUps:w,activeRounds:b,roundNumbers:P,roundProfile:T,structureId:p,stageSequence:d,orderNumber:v,stage:l}})),p=d.find((function(e){return 2===e.orderNumber&&1===e.stageSequence})),v=d.filter((function(e){return!e.inactiveStructure})).length,f=Ys({structureId:p.structureId,drawDefinition:t}).links,m=1===l(p.activeRounds[0])&&1===p.activeRounds.length&&1===v,h=null==d?void 0:d.every((function(e){return e.inactiveStructure})),g=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),I=t.drawId;n&&!o&&i.positionsNoOutcomes.push(I),h&&i.inactive.push(I),m&&i.matchPlay.push(I),g&&i.canBePruned.push(I);var y={matchUpsWithWinningSideCount:o,matchUpsNoOutcomeCount:u,positionsAssignedCount:n,allStructuresLinked:s,structuresData:d,inactiveDraw:h,isMatchPlay:m,drawId:I};i.drawAnalysis[I]=y})),t(t({},L),{drawsAnalysis:i})}function FI(e){var r,n,i,a,s,c,d,p,v,f,m,h,g=e.flight,I=e.suppressNotifications,y=e.modifyEventEntries,U=e.existingDrawCount,S=e.allowReplacement,w=e.checkEntryStatus,T=e.tournamentRecord,P=e.drawDefinition,D=e.event;if(!P)return{error:K};if(!D)return{error:Ae};D.drawDefinitions||(D.drawDefinitions=[]);var b=P.drawId,N=P.drawName,M=P.entries,R=D.entries,A=0;if(void 0!==U&&U!==D.drawDefinitions.length)return{error:xr,info:"drawDefintions count mismatch"};var E=_d({event:D}).flightProfile,C=g&&(null===(r=null==E?void 0:E.flights)||void 0===r?void 0:r.find((function(e){return e.flightNumber===g.flightNumber}))),x=null===(a=null===(i=null===(n=null==E?void 0:E.links)||void 0===n?void 0:n.find((function(e){var t;return(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.drawId)===b})))||void 0===i?void 0:i.source)||void 0===a?void 0:a.drawId,O=x&&!D.drawDefinitions.find((function(e){return e.drawId===x}));if(O)return On({result:{error:K},info:{sourceDrawId:x}});if(C&&C.drawId!==P.drawId)return On({result:{error:Y},info:{relevantFlight:C}});var F=null==M?void 0:M.every((function(e){var t=e.participantId,r=e.entryStatus,n=null==C?void 0:C.drawEntries.find((function(e){return e.participantId===t}));return!r||(null==n?void 0:n.entryStatus)===r})),k=!w||R&&(null==M?void 0:M.every((function(e){var t=e.participantId,r=e.entryStatus,n=e.entryStage,i=R.find((function(e){return e.participantId===t&&(!e.entryStage||e.entryStage===n)}));return(null==i?void 0:i.entryStatus)===r})));if(C&&!F)return On({result:{error:Y},context:{drawEntriesPresentInFlight:F,matchingEventEntries:k,relevantFlight:C},info:"Draw entries are not present in flight or do not match entryStatuses"});if(y&&(null==M||M.filter(Boolean).forEach((function(e){if((null==e?void 0:e.entryStatus)&&_l.includes(null==e?void 0:e.entryStatus)){var t=null==R?void 0:R.filter(Boolean).find((function(t){return t.participantId===e.participantId}));t&&e.entryStatus&&(null==t?void 0:t.entryStatus)!==e.entryStatus&&(t.entryStatus=e.entryStatus,A+=1)}}))),R&&!k)return On({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:k,eventEntries:R},error:Y}});var _,j=(null===(c=null===(s=null==E?void 0:E.flights)||void 0===s?void 0:s.map((function(e){var t=e.flightNumber;return!isNaN(t)&&l(t)})))||void 0===c?void 0:c.filter(Boolean))||[],B=(null===(d=D.drawDefinitions.map((function(e){var t=e.drawOrder;return t&&l(t)})))||void 0===d?void 0:d.filter(Boolean))||[],V=Math.max.apply(Math,u(u([0],o(B),!1),o(j),!1))+1,G=null===(p=null==E?void 0:E.flights)||void 0===p?void 0:p.find((function(e){return e.drawId===b}));if(G){G.drawName=P.drawName,_={name:ao,value:t(t({},E),{flights:E.flights})};var q=G.flightNumber;q&&!B.includes(q)?V=q:G.flightNumber=V}else{var W=(null==E?void 0:E.flights)||[];W.push({manuallyAdded:!0,flightNumber:V,drawEntries:M,drawName:N,drawId:b}),_={name:ao,value:t(t({},E||{}),{flights:W})}}Ya({event:D,extension:_}),Object.assign(P,{drawOrder:V});var H=D.drawDefinitions.find((function(e){return e.drawId===b})),z=null==T?void 0:T.tournamentId,J=D.eventId;if(H){if(!S)return{error:ve};var Z=null===(v=Up({drawDefinition:H}))||void 0===v?void 0:v.matchUps,X=null!==(f=null==Z?void 0:Z.map(Ro))&&void 0!==f?f:[],Q=null===(m=Up({drawDefinition:P}))||void 0===m?void 0:m.matchUps;if(!I){(null==X?void 0:X.length)&&Ep({matchUpIds:X,action:"modifyDrawDefinition",tournamentId:z,eventId:J}),(null==Q?void 0:Q.length)&&Ap({matchUps:Q,tournamentId:z,eventId:J}),D.drawDefinitions=D.drawDefinitions.map((function(e){return e.drawId===b?P:e}));var $=null===(h=P.structures)||void 0===h?void 0:h.map((function(e){return e.structureId}));Op({drawDefinition:P,tournamentId:z,structureIds:$,eventId:J})}}else if(D.drawDefinitions.push(P),!I){var ee=Up({drawDefinition:P,event:D}).matchUps;ee&&Ap({tournamentId:null==T?void 0:T.tournamentId,matchUps:ee}),xp({drawDefinition:P,tournamentId:z,eventId:J})}return t(t({},L),{modifiedEventEntryStatusCount:A})}function kI(e){var r,n,i=e.allowDuplicateParticipantIdPairs,s=e.returnParticipants,l=e.tournamentRecord,c=e.participants,d=void 0===c?[]:c;if(!l)return{error:W};l.participants||(l.participants=[]);var p=l.participants.map((function(e){return e.participantId}))||[];d.forEach((function(e){e.participantId||(e.participantId=ed())}));var v=d.filter((function(e){return!p.includes(e.participantId)})),f=d.filter((function(e){return p.includes(e.participantId)})),m=v.filter((function(e){return e.participantType===fs})),h=v.filter((function(e){return e.participantType!==fs})),g=m.concat.apply(m,u([],o(h),!1)),I=[];if(g.length){try{for(var y=a(g),U=y.next();!U.done;U=y.next()){var S=gm({allowDuplicateParticipantIdPairs:i,returnParticipant:!0,disableNotice:!0,tournamentRecord:l,participant:U.value});if(S.error)return S;S.success&&!S.existingParticipant&&I.push(S.participant)}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}I.length&&mn({topic:nd,payload:{tournamentId:l.tournamentId,participants:I}});var w=t({participants:s&&Ui(I),addedCount:I.length},L);return f.length&&Object.assign(w,{notAdded:f,info:zt}),xn(w)}return t({info:"No new participants to add",addedCount:0},L)}function _I(e){var r,n,i,a,o,u,s,l,c,d,p,v,f,m,h=e.matchUpIds,g=void 0===h?[]:h,y=e.drawDefinition,U=e.roundNumber,S=e.newRound,w=e.isMock,T=e.event;if("object"!=typeof y)return{error:K};var P=e.participantIdPairings,D=e.matchUpsCount,b=null!==(r=e.structureId)&&void 0!==r?r:1===(null===(n=y.structures)||void 0===n?void 0:n.length)&&(null===(a=null===(i=y.structures)||void 0===i?void 0:i[0])||void 0===a?void 0:a.structureId);if("string"!=typeof b)return{error:Pe};var N,M=null===(o=y.structures)||void 0===o?void 0:o.find((function(e){return e.structureId===b}));if(!M)return{error:De};var A=null!==(u=M.matchUps)&&void 0!==u?u:[],E=null==A?void 0:A.reduce((function(e,t){return t.roundPosition&&(N=!0),((null==t?void 0:t.roundNumber)||0)>e?t.roundNumber:e}),0);if(!D){var C=null!==(l=null===(s=null==y?void 0:y.entries)||void 0===s?void 0:s.filter((function(e){var t=e.entryStatus;return _l.includes(t)})))&&void 0!==l?l:[],x=Math.floor((null==C?void 0:C.length)/2)||1;if(S)D=x;else{var O=null!==(c=null!=U?U:E)&&void 0!==c?c:1,F=x-(null!==(v=null===(p=null===(d=M.matchUps)||void 0===d?void 0:d.filter((function(e){return e.roundNumber===O})))||void 0===p?void 0:p.length)&&void 0!==v?v:0);F>0&&(D=F)}}if(P&&!Array.isArray(P)||D&&!I(D)||g&&!Array.isArray(g)||!P&&!D)return{error:xr,info:"matchUpsCount or pairings error"};if(M.structures||N||M.finishingPosition===es)return{error:X};if(U&&U-1>(E||0))return{error:xr,info:"roundNumber error"};var k=null!=U?U:S&&(null!=E?E:0)+1||E||1;P=null!=P?P:R(0,D).map((function(){return{participantIds:[void 0,void 0]}}));var _=null==P?void 0:P.map((function(t,r){var n,i,a,o=null!==(n=null==t?void 0:t.participantIds)&&void 0!==n?n:[void 0,void 0];o.push.apply(o,[void 0,void 0]);var u=o.slice(0,2).map((function(e,t){return xn({sideNumber:t+1,participantId:e})})),s=null!==(a=null!==(i=g[r])&&void 0!==i?i:function(t){var r;if(e.idPrefix||w){var n=y.drawId,i=null!==(r=e.idPrefix)&&void 0!==r?r:"ah";return"".concat(n,"-").concat(i,"-").concat(k,"-").concat(t)}}(r))&&void 0!==a?a:ed();return{roundNumber:k,matchUpStatus:Yo,matchUpId:s,sides:u}}));if(null==_?void 0:_.length){var j=null===(f=Gd({drawDefinition:y,event:T}))||void 0===f?void 0:f.tieFormat;j&&_.forEach((function(e){var t=Ym({tieFormat:j,matchUp:e,isMock:w}).tieMatchUps;Object.assign(e,{tieMatchUps:t,matchUpType:Fs})}))}return t({matchUpsCount:null!==(m=null==_?void 0:_.length)&&void 0!==m?m:0,matchUps:_},L)}function LI(e){return e.participantIdPairings.map((function(e){return e.participantIds.sort().join("|")})).sort().join("/")}function jI(e){var r=e.valueSortedPairings,n=e.stipulated,i=void 0===n?[]:n,a=e.pairingValueMap,s=e.deltaObjects,l=e.valueObjects,c=e.actorsCount,d=[].concat.apply([],u([],o(i),!1)),p=[],v=0;i.filter(Boolean).forEach((function(e){var t=o(e,2),r=BI(t[0],t[1]),n=a[r];p.push({participantIds:e,value:n}),v+=a[r]})),O(r,c).map((function(e){return S(e).map((function(e){return t(t({},e),{value:e.value+Math.random()*Math.round(Math.random())})}))})).flat().forEach((function(e){var t=e.pairing.split("|");if(!t.reduce((function(e,t){return d.includes(t)||e}),!1)){d.push.apply(d,u([],o(t),!1));var r=e.value;v+=r,p.push({participantIds:t,value:r})}})),p.sort((function(e,t){return e.value-t.value}));var f=p.reduce((function(e,t){var r=o(t.participantIds,2),n=BI(r[0],r[1]),i=s[n];return i>e?i:e}),0),m=p.reduce((function(e,t){var r=o(t.participantIds,2),n=BI(r[0],r[1]),i=l[n];return i>e?i:e}),0);return{value:v,participantIdPairings:p,maxDelta:f,maxDiff:m}}function BI(e,t){return[e,t].sort(Pv).join("|")}function VI(e){var t=e.participantIds,r={},n=[];t.forEach((function(e){r[e]=t.filter((function(t){return t!==e})),r[e].forEach((function(t){var r=BI(t,e);n.includes(r)||n.push(r)}))}));var i=Object.assign.apply(Object,u([{}],o(n.map((function(e){var t;return(t={})[e]=0,t}))),!1));return{uniquePairings:n,possiblePairings:r,deltaObjects:i}}function GI(e){var t,r,n=e.possiblePairings,i=e.valueObjects,o={},u=function(e){var t=n[e].map((function(t){return function(e,t){var r=BI(e,t);return{opponent:t,value:i[r]}}(e,t)}));o[e]=t.sort((function(e,t){return e.value-t.value}))};try{for(var s=a(Object.keys(n)),l=s.next();!l.done;l=s.next()){u(l.value)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return{pairingValues:o}}var qI,WI="ELO",HI="NTRP",zI="WTN",YI={ELO:WI,NTRP:HI,TRN:"TRN",UTR:"UTR",WTN:zI},KI=((qI={})[WI]={defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},qI[HI]={accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},qI.UTR={defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},qI[zI]={attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]},qI),JI=0;function ZI(e){var t=e.tournamentParticipants,r=e.adHocRatings,n=void 0===r?{}:r,i=e.possiblePairings,a=e.uniquePairings,s=e.maxIterations,l=e.deltaObjects,c=e.valueObjects,d=e.eventType,p=e.scaleName,v=e.salted;a.forEach((function(e){var r=function(e){var t,r,n=e.tournamentParticipants,i=e.adHocRatings,a=e.eventType,o=e.scaleName,u=e.pairing,s=null!==(r=null===(t=KI[o])||void 0===t?void 0:t.defaultInitialization)&&void 0!==r?r:JI;return u.split("|").map((function(e){var t;if(a===ma){var r=null===(t=null==n?void 0:n.find((function(t){return t.participantId===e})))||void 0===t?void 0:t.individualParticipantIds;return r?null==r?void 0:r.map((function(e){return i[e]||s})):2*s}return i[e]||s}))}({tournamentParticipants:t,adHocRatings:n,scaleName:p,eventType:d,pairing:e}),i="number"==typeof v&&v||.5,a=v&&(Math.round(Math.random())?i:-1*i)||0,o=Math.abs(r[0]-r[1])+a,u=Math.abs(r[0]-r[1]);l[e]=u,c[e]||(c[e]=0),c[e]+=o?Math.pow(o,2):0}));var f=function(e){var t=e.maxIterations,r=void 0===t?4e3:t,n=e.valueSortedPairings,i=e.pairingValues,a=e.valueObjects,s=e.deltaObjects,l=Object.assign.apply(Object,u([{}],o(n.map((function(e){var t;return(t={})[e.pairing]=e.value,t}))),!1)),c=Object.keys(i),d=[],p=jI({actorsCount:c.length,valueSortedPairings:n,pairingValueMap:l,deltaObjects:s,valueObjects:a}),v=[LI(p)];d.push(p);var f,m=p.value,h=p,g=0,I=0,y=c.length;do{y-=1,f=c.length*i[c[0]].length}while(f>r&&y>5);var U=[];c.forEach((function(e){i[e].slice(0,y).forEach((function(t){I+=1;var r=BI(e,t.opponent);if(!U.includes(r)){var i=jI({stipulated:[[e,t.opponent]],actorsCount:c.length,valueSortedPairings:n,pairingValueMap:l,deltaObjects:s,valueObjects:a});if(!v.includes(LI(i))){v.push(LI(i)),d.push(i);var o=i.maxDelta,u=i.value;o<h.maxDelta&&(h=i),(u<m||u===m&&Math.round(Math.random()))&&(m=u),U.push(r),g+=1}}})),d=d.filter((function(e){return Math.abs(e.value-m)<5}))})),d.sort((function(e,t){return e.maxDiff-t.maxDiff}));var S=N(d);return{candidatesCount:g,deltaCandidate:h,maxIterations:r,iterations:I,candidate:S}}({valueSortedPairings:a.map((function(e){return{pairing:e,value:c[e]}})).sort((function(e,t){return e.value-t.value})),maxIterations:s,pairingValues:GI({possiblePairings:i,valueObjects:c}).pairingValues,deltaObjects:l,valueObjects:c}),m=f.candidate,h=f.candidatesCount,g=f.deltaCandidate,I=f.iterations;return{participantIdPairings:m.participantIdPairings,candidatesCount:h,deltaCandidate:g,iterations:I,candidate:m}}var XI=100,QI=100,$I=4e3;function ey(e){var r,n,i,u,s,l,c,d,p=e.encounterValue,v=void 0===p?XI:p,f=e.sameTeamValue,m=void 0===f?QI:f,h=e.maxIterations,g=void 0===h?$I:h,I=e.generateMatchUps,y=void 0===I||I,U=e.tournamentParticipants,S=e.participantIds,w=e.drawDefinition,T=e.adHocRatings,P=e.structureId,D=e.salted,b=void 0===D?.5:D,N=e.matchUpIds,M=e.eventType,R=e.structure,A=e.scaleName,E=e.idPrefix,C=e.isMock,x=e.event;if(!w)return{error:K};if(!R&&!P)return{error:De};if(R||(R=as({drawDefinition:w,structureId:P}).structure),!Di(R))return{error:Ne};if(!(null==S?void 0:S.length))return{error:Vt};var O=function(e){var t,r,n=e.matchUps,i=[];try{for(var u=a(n),s=u.next();!s.done;s=u.next()){var l=s.value.sides.map(Ri("participantId"));if(2===l.length){var c=o(l,2),d=BI(c[0],c[1]);i.includes(d)||i.push(d)}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return{encounters:i}}({matchUps:null!==(c=null==R?void 0:R.matchUps)&&void 0!==c?c:[]}).encounters,F={};try{for(var k=a(O),_=k.next();!_.done;_=k.next()){F[H=_.value]||(F[H]=0),F[H]+=v}}catch(e){r={error:e}}finally{try{_&&!_.done&&(n=k.return)&&n.call(k)}finally{if(r)throw r.error}}var j=null==U?void 0:U.filter((function(e){return e.participantType===gs}));if(j)try{for(var B=a(j),V=B.next();!V.done;V=B.next()){var G=VI({participantIds:null!==(d=V.value.individualParticipantIds)&&void 0!==d?d:[]}).uniquePairings;try{for(var q=(s=void 0,a(G)),W=q.next();!W.done;W=q.next()){var H;F[H=W.value]||(F[H]=0),F[H]+=m}}catch(e){s={error:e}}finally{try{W&&!W.done&&(l=q.return)&&l.call(q)}finally{if(s)throw s.error}}}}catch(e){i={error:e}}finally{try{V&&!V.done&&(u=B.return)&&u.call(B)}finally{if(i)throw i.error}}var z,Y=VI({participantIds:S}),J=Y.uniquePairings,Z=ZI({tournamentParticipants:U,possiblePairings:Y.possiblePairings,drawDefinition:w,participantIds:S,uniquePairings:J,maxIterations:g,adHocRatings:T,deltaObjects:Y.deltaObjects,valueObjects:F,eventType:M,scaleName:A,structure:R,salted:b}),X=Z.candidatesCount,Q=Z.participantIdPairings,$=Z.iterations,ee=Z.candidate;if(!X)return{error:Nr};if(y){var te=_I({structureId:null==R?void 0:R.structureId,participantIdPairings:Q,newRound:!0,drawDefinition:w,matchUpIds:N,idPrefix:E,isMock:C,event:x});if(te.error)return te;z=te.matchUps}var re=ee.maxDelta,ne=ee.maxDiff;return t(t({},L),{participantIdPairings:Q,candidatesCount:X,iterations:$,matchUps:z,maxDelta:re,maxDiff:ne})}function ty(e){var t,r,n,i,o,u,s,l,c,d=e.restrictEntryStatus,p=e.adHocRatings,v=void 0===p?{}:p,f=e.generateMatchUps,m=e.tournamentRecord,h=e.encounterValue,g=e.sameTeamValue,I=e.drawDefinition,y=e.scaleAccessor,U=e.maxIterations,S=e.matchUpIds,w=e.scaleName,T=e.idPrefix,P=e.salted,D=e.event;if("object"!=typeof I||I.drawType&&I.drawType!==Nu)return{error:Y};var b=e.participantIds,N=e.structureId,M=null!==(n=null==m?void 0:m.isMock)&&void 0!==n?n:e.isMock;if(!Array.isArray(null==I?void 0:I.entries)&&b&&!Array.isArray(b))return{error:xr,info:"Missing Entries"};var R=null!==(i=e.eventType)&&void 0!==i?i:null==D?void 0:D.eventType,A=null===(o=null==I?void 0:I.entries)||void 0===o?void 0:o.filter((function(e){var t=e.entryStatus;return!d||_l.includes(t)})).map(Mo);if(b){var E=b.filter((function(e){return!(null==A?void 0:A.includes(e))}));if(null==E?void 0:E.length)return On({result:{error:At},info:{invalidParticipantIds:E}})}else b=A;if(!N){var C=null===(s=null===(u=null==I?void 0:I.structures)||void 0===u?void 0:u.filter((function(e){return 1===e.stageSequence})))||void 0===s?void 0:s.reduce((function(e,t){var r=t.stage&&cu[t.stage];return ip({drawDefinition:I,structure:t})&&r>(cu[null==e?void 0:e.stage]||1)?t:e}),void 0);N=null==C?void 0:C.structureId}var x=null===(l=null==I?void 0:I.structures)||void 0===l?void 0:l.find((function(e){return e.structureId===N}));if(!x)return{error:De};if(!ip({drawDefinition:I,structure:x}))return{error:Y};var O=null!==(c=m.participants)&&void 0!==c?c:[],F=function(e){var t=null==O?void 0:O.find((function(t){return t.participantId===e})),r=ry({scaleName:"".concat(w,".").concat(Ua),scaleAccessor:y,participant:t,eventType:R});!r&&w&&(r=ry({scaleAccessor:y,participant:t,scaleName:w,eventType:R})),r&&!v[e]&&(v[e]=r)};try{for(var k=a(null!=b?b:[]),_=k.next();!_.done;_=k.next()){F(_.value)}}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=k.return)&&r.call(k)}finally{if(t)throw t.error}}return ey({tournamentParticipants:O,generateMatchUps:f,participantIds:b,encounterValue:h,sameTeamValue:g,drawDefinition:I,maxIterations:U,adHocRatings:v,matchUpIds:S,structure:x,eventType:R,idPrefix:T,salted:P,isMock:M,event:D})}function ry(e){var t,r=e.scaleType,n=void 0===r?wa:r,i=e.scaleAccessor,a=e.participant,o=e.scaleName,u=e.eventType,s=a&&yv({scaleAttributes:{eventType:null!=u?u:fa,scaleType:n,scaleName:o},participant:a}),l=null===(t=null==s?void 0:s.scaleItem)||void 0===t?void 0:t.scaleValue;return i&&Di(l)?l[i]:l}function ny(e){var r,n,i,a,s,l,c,d,p=e.tournamentRecord,v=e.drawDefinition,f=e.structureId,m=e.matchUps;if("object"!=typeof v)return{error:K};if(f||1!==(null===(n=v.structures)||void 0===n?void 0:n.length)||(f=null===(a=null===(i=v.structures)||void 0===i?void 0:i[0])||void 0===a?void 0:a.structureId),"string"!=typeof f)return{error:Pe};if(!Zs(m))return{error:xr,info:rm("matchUps")};var h=null===(s=v.structures)||void 0===s?void 0:s.find((function(e){return e.structureId===f}));if(!h)return{error:De};var g=(null==h?void 0:h.matchUps).find((function(e){return!!e.roundPosition}));return h.structures||g||h.finishingPosition===es?{error:X}:x(null!==(d=null===(c=null===(l=Kp({tournamentRecord:p,inContext:!1}))||void 0===l?void 0:l.matchUps)||void 0===c?void 0:c.map(Ro))&&void 0!==d?d:[],m.map(Ro))?{error:Wr,info:"One or more matchUpIds already present in tournamentRecord"}:((r=h.matchUps).push.apply(r,u([],o(m),!1)),Ap({tournamentId:null==p?void 0:p.tournamentId,drawDefinition:v,matchUps:m}),Op({drawDefinition:v,structureIds:[f]}),t({},L))}function iy(e){var r,n=e.deleteExisting,i=e.event,a=e.flightProfile,o="attachFlightProfile";return a?i?_d({event:i}).flightProfile&&!n?On({result:{error:Gr},stack:o}):(null===(r=i.drawDefinitions)||void 0===r?void 0:r.length)?On({result:{error:J},stack:o}):(Ya({event:i,extension:{name:ao,value:a}}),t({flightProfile:Ui(a,!1,!0)},L)):On({result:{error:Ae},stack:o}):On({result:{error:pt},stack:o})}function ay(e){var r,n=e.tournamentRecord,i=e.scaleAttributes,a=e.drawDefinition,o=e.entryStatuses,u=e.drawId,s=e.event,l=e.stage;if(!s)return{error:Ae};if(o&&!Array.isArray(o))return On({result:{error:xr},info:rm("entryStatus"),stack:"removeScaleValues"});var c=s.entries;if(u){var d=_d({event:s}).flightProfile,p=null===(r=null==d?void 0:d.flights)||void 0===r?void 0:r.find((function(e){return e.drawId===u}));c=p?p.drawEntries:null==a?void 0:a.entries}return function(e){var r,n=e.tournamentRecord,i=e.scaleAttributes,a=e.participantIds;if(!n)return{error:W};if(!a)return{error:Vt};if(!i)return{error:pt,info:"scaleAttributes required"};var o=i.scaleType,u=i.eventType,s=i.scaleName,l=[Ic,o,u,s].join(".");return null===(r=n.participants)||void 0===r||r.forEach((function(e){a.includes(e.participantId)&&e.timeItems&&(e.timeItems=e.timeItems.filter((function(e){return e&&(null==e?void 0:e.itemType)!==l})))})),t({},L)}({tournamentRecord:n,scaleAttributes:i,participantIds:(c||[]).filter((function(e){return(!l||!e.entryStage||e.entryStage===l)&&(!o||o.includes(e.entryStatus))})).map(Mo)})}function oy(e){var r,n,i,s,l,c,d,p,v,f="resetTieFormat",m=e.drawDefinition,h=e.event,g=e.uuids,I=da(e,[(r={},r[Fi]=!0,r[Wi]=!0,r)],f);if(I.error)return I;var y=cm(e,[(n={},n[ra]=Qi,n)]);if(y[ea])return y;var U=null===(d=e.tournamentRecord)||void 0===d?void 0:d.tournamentId,S=null!==(p=null==y?void 0:y.matchUp)&&void 0!==p?p:{},w=S.matchUp,T=S.structure;if(!(null==w?void 0:w.tieMatchUps))return On({result:{error:tt},info:"Must be a TEAM matchUp",stack:f});if(!w.tieFormat)return t({},L);var P=null===(v=Gd({structure:T,drawDefinition:m,event:h}))||void 0===v?void 0:v.tieFormat;if(!P)return On({result:{error:jr},info:"No inherited tieFormat",stack:f});var D=[],b=[],N=[],M=[],R=function(e){var t=e.matchUpCount,r=e.collectionId;b.push(r);var n=(w.tieMatchUps||[]).filter((function(e){return e.collectionId===r}));if(n.length>t)n.sort((function(e,t){return(e.matchUpStatus===Yo?1:0)-(t.matchUpStatus===Yo?1:0)})),N.push.apply(N,u([],o(n.slice(0,t)),!1)),D.push.apply(D,u([],o(n.slice(3).map(Ro)),!1));else if(N.push.apply(N,u([],o(n),!1)),n.length<t){var i=Km({collectionDefinition:e,matchUpsLimit:t-n.length,matchUp:w,uuids:g});M.push.apply(M,u([],o(i),!1))}};try{for(var A=a(P.collectionDefinitions),E=A.next();!E.done;E=A.next()){R(E.value)}}catch(e){i={error:e}}finally{try{E&&!E.done&&(s=A.return)&&s.call(A)}finally{if(i)throw i.error}}try{for(var C=a((null==w?void 0:w.tieMatchUps)||[]),x=C.next();!x.done;x=C.next()){var O=x.value;O.collectionId&&!b.includes(O.collectionId)&&D.push(O.matchUpId)}}catch(e){l={error:e}}finally{try{x&&!x.done&&(c=C.return)&&c.call(C)}finally{if(l)throw l.error}}return M.length&&(N.push.apply(N,u([],o(M),!1)),Ap({eventId:null==h?void 0:h.eventId,matchUps:M,drawDefinition:m,tournamentId:U})),D.length&&Ep({matchUpIds:D,eventId:null==h?void 0:h.eventId,drawDefinition:m,tournamentId:U}),w&&(w.tieMatchUps=N,w.tieFormatId=void 0,w.tieFormat=void 0,Cp({structureId:null==T?void 0:T.structureId,eventId:null==h?void 0:h.eventId,context:f,drawDefinition:m,tournamentId:U,matchUp:w})),t(t({},L),{newMatchUps:M,deletedMatchUpIds:D})}function uy(e){var t=e.participantsCount,r=e.participantCount;if(!(t=null!=t?t:r))return{error:xr};var n=h(t);return n?{drawSize:n}:On({result:{error:xr},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function sy(e){var t,r=e||{},n=r.drawSizeProgression,i=void 0!==n&&n,a=r.policyDefinitions,o=r.drawSize,u=e||{},s=u.requireParticipantCount,l=void 0===s||s,c=u.tournamentRecord,d=u.drawDefinition,p=u.event,v="getSeedsCount",f=null!==(t=null==e?void 0:e.participantsCount)&&void 0!==t?t:null==e?void 0:e.participantCount;if(!a){var m=rl({tournamentRecord:c,drawDefinition:d,event:p});if(m.error)return On({result:m,stack:v});a=m.policyDefinitions}var h=I(f);if(f&&!h)return On({result:{error:xr},context:{participantsCount:f},stack:v});if(l&&!h)return On({result:{error:Gt},stack:v});if(isNaN(o)){if(!f)return On({result:{error:de},stack:v});o=uy({participantsCount:f}).drawSize}var g=l&&f||o;if(g&&g>o)return{error:Yt};var y=null==a?void 0:a[Ba];if(!y)return{error:ot};var U=y.seedsCountThresholds;return U?(void 0!==y.drawSizeProgression&&(i=y.drawSizeProgression),{seedsCount:U.filter((function(e){return i?e.drawSize<=o:o===e.drawSize})).reduce((function(e,t){return f&&f>=t.minimumParticipantCount?t.seedsCount:e}),0)}):{error:he}}function ly(e){var t=e.policyDefinitions,r=e.drawDefinition,n=e.drawSize,i=e.drawId,a=e.event,o=e.stage;if(!a)return{error:Ae};var u=Jv({drawDefinition:r,drawId:i,stage:o,event:a}),s=u.entries,l=u.stageEntries,c=l.length,d=uy({participantsCount:c}).drawSize,p=sy({drawSize:null!=n?n:d,participantsCount:c,policyDefinitions:t});return p.error?On({result:p,stack:"getEntriesAndSeedsCount"}):{entries:s,seedsCount:p.seedsCount,stageEntries:l}}function cy(e){var t=e.scaleAttributes,r=e.scaledEntries,n=e.stageEntries,i=e.seedsCount,a=e.scaleName;if(!t)return{error:pt,info:"missing scaleAttributes"};var s=Object.assign.apply(Object,u([{}],o((r||[]).slice(0,i).map((function(e,t){var r;return(r={})[e.participantId]=t+1,r}))),!1));a=a||t.scaleName;var l=(new Date).toISOString(),c=n.map((function(e){var r=e.participantId;return{scaleItems:[{scaleValue:s[r],eventType:t.eventType,scaleType:Pa,scaleName:a,scaleDate:l}],participantId:r}}));return{scaleItemsWithParticipantIds:c}}function dy(e){var r,n=e.tournamentRecord,i=e.scaleAttributes,a=e.participantId,o=e.tournamentRecords||n&&((r={})[n.tournamentId]=n,r)||{};if(!a)return{error:_t};var u=Ps({tournamentRecords:o,tournamentRecord:n,participantId:a}),s=u.participant,l=u.tournamentId;return s?t(t({},yv({participant:s,scaleAttributes:i})),{tournamentId:l}):{error:Lt}}function py(e){var r,n=e.sortDescending,i=void 0!==n&&n,a=e.tournamentRecord,o=e.scaleAttributes,u=e.scaleSortMethod,s=e.stageSequence,l=e.entries,c=e.event,d=e.stage;return a?{scaledEntries:(l=null!==(r=null!=l?l:null==c?void 0:c.entries)&&void 0!==r?r:[]).filter((function(e){return(!d||!e.entryStage||e.entryStage===d)&&(!s||!e.entryStageSequence||e.entryStageSequence===s)&&_l.includes(e.entryStatus)})).map((function(e){var r=e.participantId,n=dy({tournamentRecord:a,scaleAttributes:o,participantId:r}).scaleItem;return t(t({},e),n)})).filter((function(e){var t=e.scaleValue;return!!(u||!isNaN(t)&&parseFloat(t))&&t})).sort(u||function(e,t){return i?p(t)-p(e):p(e)-p(t)})}:{error:W};function p(e){return parseFloat(e.scaleValue||(i?-1:1e5))}}function vy(e){var r,n,i,a,s=e.qualifyingPositions,c=e.drawEntries,d=void 0===c?[]:c,p=e.drawName,v=e.drawId,f=e.event,m=e.stage,h="addFlight";if(!f)return On({result:{error:Ae},stack:h});if(!p)return On({result:{error:pt},stack:h});if(null==d?void 0:d.length){var g=(null!==(r=f.entries)&&void 0!==r?r:[]).map(Ri("participantId")),I=d.map(Ri("participantId"));if(E(I,g).length!==I.length)return On({result:{error:xr},stack:h})}var y=null===(n=_d({event:f}))||void 0===n?void 0:n.flightProfile,U=(null===(a=null===(i=null==y?void 0:y.flights)||void 0===i?void 0:i.map((function(e){var t=e.flightNumber;return!isNaN(t)&&l(t)})))||void 0===a?void 0:a.filter(Boolean))||[],S=Math.max.apply(Math,u([0],o(U),!1))+1,w={drawId:v||ed(),flightNumber:S,drawEntries:d,drawName:p};m&&(w.stage=m),s&&(w.qualifyingPositions=s);var T=((null==y?void 0:y.flights)||[]).find((function(e){return e.drawId===w.drawId}));if(T)return On({result:{error:Vr},stack:h});var P=((null==y?void 0:y.flights)||[]).concat(w);return Ya({event:f,extension:{name:ao,value:t(t({},y||{}),{flights:P})}})}var fy,my={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},hy={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},gy={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Iy={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},yy={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},Uy={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Sy={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},wy={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},Ty={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Py={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Dy={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},by={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Ny={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},My={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Ry={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Ay={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Ey={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},Cy="COLLEGE_DEFAULT",xy="COLLEGE_JUCO",Oy="COLLEGE_D3",Fy="DOMINANT_DUO",ky="DOMINANT_DUO_MIXED",_y="LAVER_CUP",Ly="TEAM_DOUBLES_3_AGGREGATION",jy="TIME_TENNIS_DUAL",By="TIME_TENNIS_PRO_CIRCUIT",Vy="USTA_BREWER_CUP",Gy="USTA_OZAKI_CUP",qy="USTA_COLLEGE",Wy="USTA_GOLD_TEAM_CHALLENGE",Hy="USTA_LEVEL_1",zy="USTA_INTERSECTIONAL",Yy="USTA_SECTION_BATTLE",Ky="USTA_SOUTHERN_LEVEL_5",Jy="USTA_TOC",Zy="USTA_WTT_ITT",Xy="USTA_ZONAL",Qy={COLLEGE_D3:Oy,COLLEGE_DEFAULT:Cy,COLLEGE_JUCO:xy,DOMINANT_DUO:Fy,DOMINANT_DUO_MIXED:ky,LAVER_CUP:_y,TEAM_DOUBLES_3_AGGREGATION:Ly,TIME_TENNIS_DUAL:jy,TIME_TENNIS_PRO_CIRCUIT:By,USTA_BREWER_CUP:Vy,USTA_OZAKI_CUP:Gy,USTA_COLLEGE:qy,USTA_GOLD_TEAM_CHALLENGE:Wy,USTA_INTERSECTIONAL:zy,USTA_LEVEL_1:Hy,USTA_SECTION_BATTLE:Yy,USTA_SOUTHERN_LEVEL_5:Ky,USTA_TOC:Jy,USTA_WTT_ITT:Zy,USTA_ZONAL:Xy},$y="STANDARD",eU=((fy={})[$y]={hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},fy[Oy]={hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Fh,matchUpCount:6,matchUpValue:1},tieFormatName:Oy,valueGoal:5},fy[Cy]={hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Fh},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Fh},tieFormatName:Cy,valueGoal:4},fy[xy]={hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Fh},tieFormatName:xy,valueGoal:5},fy[_y]=Ay,fy[Fy]=Dy,fy[ky]=Sy,fy[Ly]=hy,fy[jy]=wy,fy[By]=Uy,fy[Vy]=Ty,fy[Gy]=Py,fy[qy]=by,fy[Wy]=my,fy[zy]=yy,fy[Hy]=Ny,fy[Yy]=Iy,fy[Ky]=gy,fy[Zy]=My,fy[Jy]=Ey,fy[Xy]=Ry,fy),tU=function(e){var r,n,i=(null==e?void 0:e.namedFormat)&&Object.keys(eU).includes(e.namedFormat)?e.namedFormat:$y,a=Array.isArray(null==e?void 0:e.uuids)?null==e?void 0:e.uuids:[],o=null!==(r=null==e?void 0:e.event)&&void 0!==r?r:{},u=o.category,s=o.gender,l=Ui(eU[i],!1,!0),c=function(t){var r,n,i,o;if(!(null==e?void 0:e.isMock)&&!(null===(r=null==e?void 0:e.event)||void 0===r?void 0:r.isMock)||!e.event)return null!==(n=null==a?void 0:a.pop())&&void 0!==n?n:ed();var u=null===(i=null==e?void 0:e.event)||void 0===i?void 0:i.eventId;return null!==(o=a.pop())&&void 0!==o?o:"".concat(u,"-COL-").concat(t+1)};return l.hydrate?(n={winCriteria:{valueGoal:l.valueGoal},collectionDefinitions:[t({collectionId:c(0),matchUpFormat:kh,collectionName:"Doubles",matchUpType:xs},l.doubles),t({collectionId:c(1),matchUpFormat:Fh,collectionName:"Singles",matchUpType:Es},l.singles)]},l.tieFormatName&&(n.tieFormatName=l.tieFormatName)):(l.collectionDefinitions.forEach((function(e,t){return e.collectionId=c(t)})),n=l),(null==e?void 0:e.hydrateCollections)&&n.collectionDefinitions.forEach((function(e){u&&!e.category&&(e.category=u),s&&!e.gender&&(e.gender=s)})),n},rU={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:Dy,DOMINANT_DUO_MIXED:Sy,LAVER_CUP:Ay,TEAM_DOUBLES_3_AGGREGATION:hy,TIME_TENNIS_DUAL:wy,TIME_TENNIS_PRO_CIRCUIT:Uy,USTA_BREWER_CUP:Ty,USTA_OZAKI_CUP:Py,USTA_COLLEGE:by,USTA_GOLD_TEAM_CHALLENGE:my,USTA_INTERSECTIONAL:yy,USTA_LEVEL_1:Ny,USTA_SECTION_BATTLE:Iy,USTA_SOUTHERN_LEVEL_5:gy,USTA_TOC:Ey,USTA_WTT_ITT:My,USTA_ZONAL:Ry};function nU(e){var r,n,i,o,u,s,l,c=e.suppressNotifications,d=e.tournamentRecord,p=e.internalUse,v=e.event;if(!d)return{error:W};if(d.events||(d.events=[]),!v)return{error:Ae};var f=d.startDate,m=d.endDate;if(!p&&((null===(i=v.entries)||void 0===i?void 0:i.length)||(null===(o=v.drawDefinitions)||void 0===o?void 0:o.length))){var h=xn({drawDefinitions:!!(null===(u=v.drawDefinitions)||void 0===u?void 0:u.length),entries:!!(null===(s=v.entries)||void 0===s?void 0:s.length)});return{info:"entries/drawDefinitions cannot exist",error:xr,context:h}}var g=t({eventType:fa,drawDefinitions:[],entries:[],startDate:f,endDate:m},v);if(v.eventType===Ia)if(v.tieFormat){var I=zm({tieFormat:v.tieFormat});if(I.error)return I}else if(v.tieFormatName){if(!rU[v.tieFormatName])return{context:{tieFormatName:v.tieFormatName},error:xr};var y=tU({isMock:null==d?void 0:d.isMock,namedFormat:v.tieFormatName,event:v});g.tieFormat=y}g.eventId||(g.eventId=ed());var U=d.events.reduce((function(e,t){return e||t.eventId===g.eventId}),void 0);if(U)return{error:Ce};var S=g;if(d.events.push(S),!c){if(Un().topics.includes(rd)){var w=null!==(l=Yp({event:v}).matchUps)&&void 0!==l?l:[];Ap({tournamentId:null==d?void 0:d.tournamentId,eventId:v.eventId,matchUps:w})}try{for(var T=a(v.drawDefinitions||[]),P=T.next();!P.done;P=T.next()){xp({drawDefinition:P.value})}}catch(e){r={error:e}}finally{try{P&&!P.done&&(n=T.return)&&n.call(T)}finally{if(r)throw r.error}}}return t(t({},L),{event:g})}function iU(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.participantIds,a=e.stageSequence,o=e.stage,u=void 0===o?iu:o,s=e.eventId,l=e.event;if(!r)return{error:W};if(!Array.isArray(i))return{error:xr,participantIds:i};if(!l)return{error:Ae};var c;if(l&&(c=aU({element:l,participantIds:i,stageSequence:a,stage:u})).error)return c;if(n&&(c=aU({element:n,participantIds:i,stageSequence:a,stage:u})).error)return s?On({context:{drawPromotionError:c.error,drawId:n.drawId},result:t({},L),stack:"promoteAlternates"}):c;return t({},L)}function aU(e){var r,n,i=e.participantIds,s=e.stageSequence,c=e.element,d=e.stage,p=(c.entries||[]).filter((function(e){return e.entryStatus===Sl})),v=(c.entries||[]).filter((function(e){return i.includes(e.participantId)})),f=p.reduce((function(e,t){var r=t.entryPosition;return isNaN(r)&&e||(!e||r<e.entryPosition)&&t||e}),void 0),m=v.length?v:[f].filter(Boolean);if(!(null==m?void 0:m.length))return{error:Jt};var h=m.filter((function(e){return e.entryStatus!==Sl}));if(h.length)return{error:Kt,invalidEntryStatus:h};var g=m.filter((function(e){var t=e.entryStage;return t&&t!==d}));if(g.length)return{error:Zt,invalidStage:g};var I=s&&m.filter((function(e){return e.stageSequence!==s}));if(null==I?void 0:I.length)return{error:Xt,invalidStageSequence:I};var y=function(e){e.entryStatus=Tl;var t=null==e?void 0:e.entryPosition;isNaN(t)||c.entries.forEach((function(e){e.entryStatus===Sl&&e.entryPosition>t&&(e.entryPosition=e.entryPosition-1)}));var r=Math.max.apply(Math,u(u([],o(c.entries.filter((function(e){return e.entryStatus===Tl&&!isNaN(e.entryPosition)})).map((function(e){return l(e.entryPosition||0)}))),!1),[0],!1));e.entryPosition=r||0};try{for(var U=a(m),S=U.next();!S.done;S=U.next()){y(S.value)}}catch(e){r={error:e}}finally{try{S&&!S.done&&(n=U.return)&&n.call(U)}finally{if(r)throw r.error}}return t({},L)}function oU(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.participantId,a=e.entryPosition,o=e.skipRefresh,u=e.event;if(!r)return{error:W};if(!i)return On({result:{error:_t},stack:"setEntryPositions"});if(void 0!==a&&!Number.isSafeInteger(a))return{error:xr,entryPosition:a};((null==u?void 0:u.entries)||[]).forEach((function(e){e.participantId===i&&(e.entryPosition=a)})),((null==n?void 0:n.entries)||[]).forEach((function(e){e.participantId===i&&(e.entryPosition=a)}));var s=function(e){e.entries.forEach((function(e){e.entryPosition===a&&e.participantId!==i&&(e.entryPosition+=.1)}))};return o||((null==u?void 0:u.entries)&&(s(u),u.entries=mv({entries:u.entries})),(null==n?void 0:n.entries)&&(s(n),n.entries=mv({entries:n.entries}))),t({},L)}function uU(e){var r=e.tournamentRecord,n=e.event,i=e.startDate;if(!r)return{error:W};if(!n)return{error:Ae};if(!Wn.test(i))return{error:It};var a=lU(r);if(a.error)return a;var o=a.tournamentStartDate,u=a.tournamentEndDate,s=new Date(ui(i)).getTime();if(!o||!u||s<o||s>u)return{error:It};var l=n.endDate&&new Date(ui(n.endDate)).getTime();return l&&s>l&&(n.endDate=i),n.startDate=i,t({},L)}function sU(e){var r=e.tournamentRecord,n=e.event,i=e.endDate;if(!r)return{error:W};if(!n)return{error:Ae};if(!Wn.test(i))return{error:It};var a=lU(r);if(a.error)return a;var o=a.tournamentStartDate,u=a.tournamentEndDate,s=new Date(ui(i)).getTime();if(!o||!u||s<o||s>u)return{error:It};var l=n.startDate&&new Date(ui(n.startDate)).getTime();return l&&s<l&&(n.startDate=i),n.endDate=i,t({},L)}function lU(e){var t=e.startDate,r=e.endDate;return Wn.test(t)&&Wn.test(r)?{tournamentStartDate:new Date(ui(t)).getTime(),tournamentEndDate:new Date(ui(r)).getTime()}:On({result:{error:Ut},context:{startDate:t,endDate:r}})}var cU={addAdHocMatchUps:ny,addCollectionDefinition:MI,addCollectionGroup:function(e){var r,n,i=e.updateInProgressMatchUps,s=void 0===i||i,l=e.tournamentRecord,c=e.groupDefinition,d=e.drawDefinition,p=e.collectionIds,v=e.tieFormatName,f=e.structureId,m=e.matchUpId,h=e.matchUp,g=e.eventId,I=e.event,y="addCollectionGroup";if(!Array.isArray(p))return On({result:{error:pt},stack:y});var U=h?void 0:Rm({drawDefinition:d,structureId:f,matchUpId:m,eventId:g,event:I});if(null==U?void 0:U.error)return On({result:U,stack:y});var S=null==U?void 0:U.structure;h=h||(null==U?void 0:U.matchUp);var w=null==U?void 0:U.tieFormat,T=null==w?void 0:w.winCriteria.valueGoal,P=bm(w);if((U=zm({tieFormat:P})).error)return On({result:U,stack:y});try{for(var D=a(P.collectionDefinitions),b=D.next();!b.done;b=D.next()){var N=b.value,M=N.collectionId;if(N.collectionGroupNumber&&p.includes(M))return On({info:"collectionIds cannot be part of other collectionGroups",result:{error:xr},stack:y})}}catch(e){r={error:e}}finally{try{b&&!b.done&&(n=D.return)&&n.call(D)}finally{if(r)throw r.error}}var R=(P.collectionGroups||[]).reduce((function(e,t){return t.groupNumber>e?t.groupNumber:e}),0)+1;return c.groupNumber=R,P.collectionDefinitions=P.collectionDefinitions.map((function(e){return p.includes(e.collectionId)?t(t({},e),{collectionGroupNumber:R}):e})),P.collectionGroups=u(u([],o(P.collecitonGroups||[]),!1),[c],!1),eI({updateInProgressMatchUps:s,originalValueGoal:T,tournamentRecord:l,drawDefinition:d,tieFormatName:v,structureId:f,structure:S,tieFormat:P,matchUpId:m,matchUp:h,eventId:g,event:I})},addDrawDefinition:FI,addDrawDefinitionTimeItem:Xg,addDrawEntries:kv,addEvent:nU,addEventEntries:Bv,addEventEntryPairs:function(e){var r,n,i,o=e.allowDuplicateParticipantIdPairs,u=e.entryStage,s=void 0===u?iu:u,l=e.entryStatus,c=void 0===l?Sl:l,d=e.participantIdPairs,p=void 0===d?[]:d,v=e.tournamentRecord,f=e.drawDefinition,m=e.event,h=e.uuids;if(!v)return{error:W};if(!m)return{error:Ae};if(m.eventType!==xs)return{error:Re};var g=[],I=new Map;try{for(var y=a(null!==(i=v.participants)&&void 0!==i?i:[]),U=y.next();!U.done;U=y.next()){var S=U.value,w=S.participantType,T=S.participantId,P=S.person,D=S.individualParticipantIds;w===fs&&(null==P?void 0:P.sex)?I.set(T,P.sex):w===hs&&D&&g.push(D)}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var b=p.filter((function(e){if(2!==e.length)return!0;if(!I.has(e[0])||!I.has(e[1]))return!0;if(!m.gender||m.gender===lp)return!1;var t=e.map((function(e){return I.get(e)})),r=m.gender===cp&&(t[0]!==cp||t[1]!==cp)||m.gender===vp&&(t[0]!==vp||t[1]!==vp);return m.gender===dp&&(t.sort(Pv),t[0]===vp&&t[1]===cp||(r=!0)),r}));if(b.length)return{error:Et,invalidParticipantIdPairs:b};var N,M=p.map((function(e){var t;return{participantId:null!==(t=null==h?void 0:h.pop())&&void 0!==t?t:ed(),participantRole:Vv,individualParticipantIds:e,participantType:hs}})),R=o?M:M.filter((function(e){return!g.find((function(t){return 2===E(t,e.individualParticipantIds).length}))})),A=[];if(R){var C=kI({allowDuplicateParticipantIdPairs:o,participants:R,returnParticipants:!0,tournamentRecord:v});if(C.error)return C;A=C.participants||[],N=C.info}var x=Bv({participantIds:p.map((function(e){var t=A.find((function(t){return 2===E(t.individualParticipantIds,e).length}));return t||gl({tournamentRecord:v,participantIds:e}).participant})).map((function(e){return e.participantId})),tournamentRecord:v,drawDefinition:f,entryStatus:c,entryStage:s,event:m});R.length&&mn({payload:{participants:R},topic:nd});var O=R.map(Mo);return t(t({},x),{info:N,newParticipantIds:O})},addFlight:vy,addPlayoffStructures:TI,addQualifyingStructure:function(e){var t=e.tournamentRecord;if(!t)return{error:W};var r=function(e){if(!e.drawDefinition)return{error:K};if(!e.targetStructureId)return{error:Pe};var t=cI(e);if(t.error)return t;var r=t.structure,n=t.link;return r&&n?Oh({tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,structure:r,link:n}):{error:xr}}(e);if(r.error)return r;var n=e.qualifyingRoundNumber,i=e.qualifyingPositions,a=e.targetStructureId,o=e.drawDefinition,u=e.structureName,s=e.matchUpType,l=e.drawSize,c=e.drawType;return gf({tournamentRecord:t,timeItem:{itemType:"addQualifyingStructures",itemValue:xn({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:i,targetStructureId:a,structureName:u,matchUpType:s,drawSize:l,drawType:c})}}),r},addVoluntaryConsolationStage:function(e){return function(e){var r=e.drawDefinition,n=e.drawSize;if(!r)return{error:K};var i=Qg({stage:uu,stageSequence:1,drawDefinition:r,drawSize:n});return i.error?i:(Op({drawDefinition:r}),t({},L))}(e)},addVoluntaryConsolationStructure:rf,aggregateTieFormats:function(e){var r,n,i,o,u,s,l,c=e.tournamentRecord;if(!c)return{error:W};var d=0,p=function(e){var t,r,n,i,p,v,f,m,h=null!==(o=e.tieFormats)&&void 0!==o?o:[],g=function(e){var t,r;if(e.tieFormat){var n;try{for(var i=(t=void 0,a(h)),o=i.next();!o.done;o=i.next()){var u=o.value;Zm({descendant:e.tieFormat,ancestor:u}).different||(n=u.tieFormatId)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}if(n)e.tieFormatId=n,delete e.tieFormat;else{var s=Ui(e.tieFormat,void 0,!0);s.tieFormatId||(s.tieFormatId=ed()),e.tieFormatId=s.tieFormatId,delete e.tieFormat,h.push(s),d+=1}}},I=e.eventType;g({tieFormat:e.tieFormat,eventType:I});try{for(var y=(t=void 0,a(null!==(u=e.drawDefinitions)&&void 0!==u?u:[])),U=y.next();!U.done;U=y.next()){var S=U.value;g({tieFormat:S.tieFormat,eventType:I});try{for(var w=(n=void 0,a(null!==(s=S.structures)&&void 0!==s?s:[])),T=w.next();!T.done;T=w.next()){g({tieFormat:T.value.tieFormat,eventType:I})}}catch(e){n={error:e}}finally{try{T&&!T.done&&(i=w.return)&&i.call(w)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{U&&!U.done&&(r=y.return)&&r.call(y)}finally{if(t)throw t.error}}var P=function(t,r){var n,i=null===(n=b.matchUps)||void 0===n?void 0:n.find((function(e){return e.matchUpId===t}));i&&(i.tieFormatId=r,delete i.tieFormat,Cp({tournamentId:null==c?void 0:c.tournamentId,eventId:e.eventId,matchUp:i}))},D=function(e){var t=Ui(e.tieFormat,void 0,!0);t.tieFormatId||(t.tieFormatId=ed()),h.push(t),d+=1,P(e.matchUpId,t.tieFormatId)},b=Yp({matchUpFilters:{matchUpTypes:[Os]},event:e}),N=null!==(l=b.matchUps)&&void 0!==l?l:[];try{for(var M=(p=void 0,a(N)),R=M.next();!R.done;R=M.next()){var A=R.value,E=void 0;try{for(var C=(f=void 0,a(h)),x=C.next();!x.done;x=C.next()){var O=x.value;A.tieFormat&&Zm({descendant:A.tieFormat,ancestor:O}).different||(E=O.tieFormatId)}}catch(e){f={error:e}}finally{try{x&&!x.done&&(m=C.return)&&m.call(C)}finally{if(f)throw f.error}}E?P(A.matchUpId,E):D(A)}}catch(e){p={error:e}}finally{try{R&&!R.done&&(v=M.return)&&v.call(M)}finally{if(p)throw p.error}}h.length&&(e.tieFormats=h)};try{for(var v=a(null!==(i=c.events)&&void 0!==i?i:[]),f=v.next();!f.done;f=v.next()){p(f.value)}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}return t(t({},L),{addedCount:d})},alternateDrawPositionAssignment:function(e){return function(e){return um({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e.alternateParticipantId,tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,drawPosition:e.drawPosition,structureId:e.structureId})}(e)},applyLineUps:function(e){var r,n,i,o,u,s,l,c,d,p,v,f,m=e.tournamentRecord,h=e.drawDefinition,g=e.matchUpId,I=e.lineUps,y=e.event;if(!m)return{error:W};if(!h)return{error:Z};if("string"!=typeof g)return{error:tt};if(!Array.isArray(I))return{error:xr,lineUps:I};var U=m.participants||[],S=Ef({tournamentParticipants:U,inContext:!0,drawDefinition:h,matchUpId:g});if(S.error)return S;if(!S.matchUp)return{error:Qe};var w=S.matchUp,P=S.structure,D=w.drawPositions;if(w.matchUpType!==Fs)return{error:tt};if(!(null==D?void 0:D.length))return{error:ie};var b=null===(d=Gd({matchUp:w,drawDefinition:h,structure:P,event:y}))||void 0===d?void 0:d.tieFormat,N={};try{for(var M=a(I),R=M.next();!R.done;R=M.next()){var A=R.value;if(!Array.isArray(A))return{error:xr,lineUp:A};var E={},C=[],x=function(e){var t,r;if("object"!=typeof e)return{value:{error:xr,lineUpAssignment:e}};var n=e.participantId,i=e.collectionAssignments,o=void 0===i?[]:i;if(!Array.isArray(o))return{value:{error:xr,collectionAssignments:o}};var u=U.find((function(e){return e.participantId===n}));if(!u)return{value:{error:Lt}};if(u.participantType!==fs)return{value:{error:xt}};var s=null===(v=null===(p=w.sides)||void 0===p?void 0:p.find((function(e){var t,r;return null===(r=null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds)||void 0===r?void 0:r.includes(n)})))||void 0===v?void 0:v.sideNumber;s&&C.push(s);var l=function(e){if("object"!=typeof e)return{value:{error:xr,collectionAssignment:e}};var t=e.collectionId,r=e.collectionPosition,i=null===(f=null==b?void 0:b.collectionDefinitions)||void 0===f?void 0:f.find((function(e){return e.collectionId===t}));if(!i)return{value:{error:xr,collectionId:t}};var a="".concat(t,"-").concat(r);E[a]||(E[a]=[]);var o=E[a].length;if(i.matchUpType===Es&&o||i.matchUpType===xs&&o>1)return{value:{info:"Excessive collectionPosition assignments",error:xr}};E[a].push(n)};try{for(var c=(t=void 0,a(o)),d=c.next();!d.done;d=c.next()){var m=l(d.value);if("object"==typeof m)return m}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}};try{for(var O=(i=void 0,a(A)),F=O.next();!F.done;F=O.next()){var k=x(F.value);if("object"==typeof k)return k.value}}catch(e){i={error:e}}finally{try{F&&!F.done&&(o=O.return)&&o.call(O)}finally{if(i)throw i.error}}var _=Object.values(E);try{for(var j=(u=void 0,a(_)),B=j.next();!B.done;B=j.next()){var V=B.value;if(2===V.length)if(!gl({tournamentParticipants:U,participantIds:V}).participant){var G=gm({participant:{participantType:hs,participantRole:Vv,individualParticipantIds:V},pairOverride:!0,tournamentRecord:m});if(G.error)return G}}}catch(e){u={error:e}}finally{try{B&&!B.done&&(s=j.return)&&s.call(j)}finally{if(u)throw u.error}}var q=T(C),H=((q[1]||0)>(q[2]||0)?1:(q[2]||0)>(q[1]||0)&&2)||void 0,z=Object.keys(N).map((function(e){return parseInt(e)}));H&&!z.includes(H)&&(N[H]=A)}}catch(e){r={error:e}}finally{try{R&&!R.done&&(n=M.return)&&n.call(M)}finally{if(r)throw r.error}}if(!Object.keys(N).length)return{error:Lr};if((S=Ef({drawDefinition:h,matchUpId:g})).error)return S;if(!S.matchUp)return{error:Qe};var Y=S.matchUp;Y.sides||(Y.sides=[]);var K=function(e){var t=Y.sides.find((function(t){return t.sideNumber===e})),r=N[e];if(!r)return"continue";t?t.lineUp=r:Y.sides.push({lineUp:r,sideNumber:e})};try{for(var J=a([1,2]),X=J.next();!X.done;X=J.next()){K(H=X.value)}}catch(e){l={error:e}}finally{try{X&&!X.done&&(c=J.return)&&c.call(J)}finally{if(l)throw l.error}}return Cp({tournamentId:null==m?void 0:m.tournamentId,context:"applyLineUps",drawDefinition:h,matchUp:Y}),t({},L)},assignDrawPosition:function(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.participantId,a=e.drawPosition,o=e.structureId,u=e.qualifier,s=e.event,l=e.bye;if(!n)return{error:K};if(!a)return{error:ue};if(!o)return{error:Pe};if(l){if((c=av({tournamentRecord:r,drawDefinition:n,drawPosition:a,structureId:o,event:s})).error)return c}else{if(u)return{error:Br};var c;if((c=om({tournamentRecord:r,drawDefinition:n,participantId:i,drawPosition:a,structureId:o,event:s})).error)return c}return t({},L)},assignDrawPositionBye:av,assignMatchUpSideParticipant:function(e){var r,n,i,o,u=e.tournamentRecord,s=e.drawDefinition,l=e.participantId,c=e.sideNumber,d=e.matchUpId,p=e.event;if(l&&"string"!=typeof l)return{error:At};if(!s)return{error:K};if(!d)return{error:Ze};var v=void 0===c;if(v&&(c=1),![1,2].includes(c))return On({result:{error:xr,context:{sideNumber:c}}});var f=Ef({drawDefinition:s,matchUpId:d,event:p}),m=f.matchUp,h=f.structure;if(!m)return{error:Qe};var g=!((null==h?void 0:h.structures)||s.drawType&&s.drawType!==Nu||(null===(i=null==h?void 0:h.matchUps)||void 0===i?void 0:i.find((function(e){return!!e.roundPosition}))));if(!g)return{error:se};if(!l&&((null===(o=null==m?void 0:m.score)||void 0===o?void 0:o.scoreStringSide1)||eu.includes(null==m?void 0:m.matchUpstatus)||(null==m?void 0:m.matchUpStatus)&&[Vo,Bo].includes(m.matchUpStatus)))return{error:Nt,info:"matchUp has completed status or score"};if(m){if(m.sides=[1,2].map((function(e){var r,n,i=null!==(n=null===(r=m.sides)||void 0===r?void 0:r.find((function(t){return t.sideNumber===e})))&&void 0!==n?n:{sideNumber:e};return c===e?t(t({},i),{participantId:l}):i})),v)try{for(var I=a(m.sides),y=I.next();!y.done;y=I.next()){var U=y.value;U.sideNumber&&(U.sideNumber=3-U.sideNumber)}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}Cp({tournamentId:null==u?void 0:u.tournamentId,context:"assignSideParticipant",drawDefinition:s,matchUp:m})}return t(t({},L),{sidesSwapped:v})},assignSeedPositions:function(e){var r,n,i=e.provisionalPositioning,s=e.useExistingSeedLimit,l=e.tournamentRecord,c=e.drawDefinition,d=e.seedingProfile,p=e.structureId,v=e.assignments,f=e.drawId,m=e.event,h=0;if(!(null==v?void 0:v.length))return{error:Fe};if(!l)return{error:W};if(!f)return{error:pe};var g=ql({provisionalPositioning:i,drawDefinition:c,structureId:p});if(g.error)return g;var I=g.seedAssignments,y=g.seedLimit,U=Object.assign.apply(Object,u([{}],o((null!=I?I:[]).filter((function(e){return e.seedNumber})).map((function(e){var t;return(t={})[e.seedNumber]=e,t}))),!1));v.forEach((function(e){var t=e.seedNumber;y&&t<=y&&(!s||U[t])&&(U[t]=e)}));var S=Object.values(U),w=S.map((function(e){return null==e?void 0:e.participantId})).filter(Boolean);if(w.length!==b(w).length)return{error:fe};try{for(var T=a(S),P=T.next();!P.done;P=T.next()){var D=P.value,N=$f(t(t({},D),{provisionalPositioning:i,tournamentRecord:l,drawDefinition:c,seedingProfile:d,structureId:p,event:m}));if(null==N?void 0:N.error)return N;(null==N?void 0:N.success)&&h++}}catch(e){r={error:e}}finally{try{P&&!P.done&&(n=T.return)&&n.call(T)}finally{if(r)throw r.error}}return h?t(t({},L),{modifications:h}):{error:Dr}},assignTieMatchUpParticipantId:Tm,attachConsolationStructures:function(e){return wI(t(t({},e),{itemType:"attachConsolationStructures"}))},attachFlightProfile:iy,attachPlayoffStructures:SI,attachQualifyingStructure:Oh,attachStructures:wI,automatedPlayoffPositioning:Ch,automatedPositioning:Eh,autoSeeding:function(e){var t,r=e.tournamentRecord,n=e.drawDefinition,i=e.policyDefinitions,a=e.scaleAttributes,o=e.scaleName,u=e.drawSize,s=e.drawId,l=e.event,c=e.stage,d=e.sortDescending,p=e.scaleSortMethod,v=ly({policyDefinitions:i,drawDefinition:n,drawSize:u,drawId:s,event:l,stage:c});if(v.error)return v;var f=v.entries,m=v.seedsCount,h=v.stageEntries;return h&&m?{scaleItemsWithParticipantIds:cy({scaleAttributes:a,scaledEntries:null!==(t=py({tournamentRecord:r,scaleAttributes:a,scaleSortMethod:p,sortDescending:d,entries:f,stage:c}).scaledEntries)&&void 0!==t?t:[],stageEntries:h,seedsCount:m,scaleName:o}).scaleItemsWithParticipantIds}:{error:xr}},bulkMatchUpStatusUpdate:function(e){var r,n,i,o;if(!(null==e?void 0:e.outcomes))return{error:pt};if(!Array.isArray(e.outcomes))return{error:pt,info:{outcomes:e.outcomes}};var u=e.tournamentRecords||e.tournamentRecord&&((r={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,r)||{},s=null!==(o=e.outcomes)&&void 0!==o?o:[],l=s.reduce((function(e,t){return e.includes(t.tournamentId)?e:e.concat(t.tournamentId)}),[]),c=function(e){var r=u[e];if(!r)return{value:{error:W}};var n=s.filter((function(t){return t.tournamentId===e}));if(n.length){var i=function(e){var r,n,i,o,u,s=e.tournamentRecords,l=e.tournamentRecord,c=e.outcomes,d=e.policyDefinitions,p={};c.forEach((function(e){var t=e.eventId;p[t]||(p[t]=[]),p[t].push(e)}));try{for(var v=a(Object.keys(p)),f=v.next();!f.done;f=v.next()){var m=f.value,h=Ld({tournamentRecord:l,eventId:m}).event,g=function(e){var t=e.drawId,r=null===(u=null==h?void 0:h.drawDefinitions)||void 0===u?void 0:u.find((function(e){return e.drawId===t}));if(r&&t){var n=e.matchUpFormat,i=e.matchUpId,a=NI({schedule:null==e?void 0:e.schedule,tournamentRecords:s,policyDefinitions:d,tournamentRecord:l,drawDefinition:r,matchUpFormat:n,matchUpId:i,outcome:e,drawId:t,event:h});if(a.error)return{value:a}}};try{for(var I=(i=void 0,a(p[m])),y=I.next();!y.done;y=I.next()){var U=g(y.value);if("object"==typeof U)return U.value}}catch(e){i={error:e}}finally{try{y&&!y.done&&(o=I.return)&&o.call(I)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}return t({},L)}({outcomes:n,tournamentRecord:r});if(i.error)return{value:i}}};try{for(var d=a(l),p=d.next();!p.done;p=d.next()){var v=c(p.value);if("object"==typeof v)return v.value}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return t({},L)},checkInParticipant:fm,checkOutParticipant:vm,deleteAdHocMatchUps:function(e){var r,n,i,s,l,c,d,p=e.tournamentRecord,v=e.matchUpIds,f=void 0===v?[]:v,m=e.drawDefinition,h=e.structureId,g=e.event;if("object"!=typeof m)return{error:K};if("string"!=typeof h)return{error:Pe};if(!Array.isArray(f))return{error:xr};var y=null===(i=m.structures)||void 0===i?void 0:i.find((function(e){return e.structureId===h}));if(!y)return{error:De};var S=null==y?void 0:y.matchUps,w=null==S?void 0:S.find((function(e){return!!e.roundPosition}));if(y.structures||w||y.finishingPosition===es)return{error:X};var T,P,D=[],b=null!==(s=null==S?void 0:S.filter((function(e){var t=e.matchUpId;return Bp({score:e.score})&&D.push(t),f.includes(t)})))&&void 0!==s?s:[],N=b.map(Ri("matchUpId"));if(N.length){y.matchUps=(null!==(l=y.matchUps)&&void 0!==l?l:[]).filter((function(e){var t=e.matchUpId;return!N.includes(t)})),Ep({tournamentId:null==p?void 0:p.tournamentId,matchUpIds:N,action:"deleteAdHocMatchUps",eventId:null==g?void 0:g.eventId,drawDefinition:m});var M=U(y.matchUps.map(Ri("roundNumber"))),A=(T=M,void 0===P&&(P=1),Array.isArray(T)&&T.every(I)?R(Math.min.apply(Math,u(u([],o(T),!1),[P],!1)),Math.max.apply(Math,u([],o(T),!1))+1).filter((function(e){return!T.includes(e)})):[]);if(A.length){A.reverse();var E=function(e){y.matchUps.forEach((function(t){t.roundNumber&&t.roundNumber>e&&(t.roundNumber-=1,Cp({tournamentId:null==p?void 0:p.tournamentId,context:["adHoc round deletion"],eventId:null==g?void 0:g.eventId,drawDefinition:m,matchUp:t}))}))};try{for(var C=a(A),x=C.next();!x.done;x=C.next()){E(x.value)}}catch(e){r={error:e}}finally{try{x&&!x.done&&(n=C.return)&&n.call(C)}finally{if(r)throw r.error}}}if(D.length){y.positionAssignments=U(y.matchUps.flatMap((function(e){var t;return(null!==(t=e.sides)&&void 0!==t?t:[]).map((function(e){return e.participantId}))})).filter(Boolean)).map((function(e){return{participantId:e}}));var O=null!==(d=null!==(c=null==y?void 0:y.matchUpFormat)&&void 0!==c?c:null==m?void 0:m.matchUpFormat)&&void 0!==d?d:null==g?void 0:g.matchUpFormat,F=cg({positionAssignments:y.positionAssignments,matchUps:y.matchUps,tournamentRecord:p,drawDefinition:m,matchUpFormat:O,event:g});F.error&&console.log(F)}Op({structureIds:[h],eventId:null==g?void 0:g.eventId,drawDefinition:m})}return t({},L)},deleteDrawDefinitions:Rf,deleteEvents:function(e){var r=e.removePairParticipants,n=e.tournamentRecord,i=e.eventIds;if(!n)return{error:W};if(!n.events)return{error:Ee};if(!Array.isArray(i))return{error:pt,info:rm("drawIds")};var a=[],s=[],l=[],c=[];if(n.events=(n.events||[]).filter((function(e){if(i.includes(e.eventId)){var t={action:Nf,payload:{events:[e]}};a.push(t),s.push({tournamentId:n.tournamentId,eventName:e.eventName,eventType:e.eventType,category:e.category,eventId:e.eventId,gender:e.gender})}var r=e.eventType===ma?(e.entries||[]).map((function(e){var t=e.entryStatus,r=e.participantId;return t!==Al&&r})).filter(Boolean):[],d=i.includes(e.eventId);return d?c.push.apply(c,u([],o(r),!1)):l.push.apply(l,u([],o(r),!1)),!d})),r){var d=c.filter((function(e){return!l.includes(e)}));n.participants=n.participants.filter((function(e){var t=e.participantId;return!d.includes(t)}))}return ff({tournamentRecord:n}),a.length&&(mn({topic:od,payload:a}),gf({tournamentRecord:n,timeItem:{itemType:Nf,itemValue:s}})),t({},L)},deleteFlightAndFlightDraw:function(e){var r,n,i=e.autoPublish,a=void 0===i||i,o=e.tournamentRecord,u=e.auditData,s=e.drawId,l=e.event,c=e.force;if(!o)return{error:W};if(!s)return{error:pe};if(!l)return{error:Ae};var d=_d({event:l}).flightProfile;if(d&&(null===(r=d.flights)||void 0===r?void 0:r.find((function(e){return e.drawId===s})))){var p=d.flights.filter((function(e){return e.drawId!==s}));Ya({event:l,extension:{name:ao,value:t(t({},d),{flights:p})}})}if(null===(n=l.drawDefinitions)||void 0===n?void 0:n.find((function(e){return e.drawId===s}))){var v=Rf({drawIds:[s],eventId:l.eventId,tournamentRecord:o,autoPublish:a,auditData:u,event:l,force:c});if(v.error)return v}return Zg({tournamentRecord:o,event:l})},deleteFlightProfileAndFlightDraws:function(e){var r,n=e.autoPublish,i=void 0===n||n,a=e.tournamentRecord,o=e.auditData,u=e.event,s=e.force;if(!a)return{error:W};if(!u)return{error:Ae};var l=_d({event:u}).flightProfile;if(l){var c=null===(r=l.flights)||void 0===r?void 0:r.map((function(e){return e.drawId})).filter(Boolean),d=Rf({eventId:u.eventId,tournamentRecord:a,autoPublish:i,auditData:o,drawIds:c,event:u,force:s});return d.error?d:Ja({event:u,name:ao})}return t({},L)},destroyPairEntries:function(e){var n,i;if(!e.tournamentRecord)return{error:W};var o=e.participantIds,u=r(e,["participantIds"]),s=0,l=[];try{for(var c=a(o),d=c.next();!d.done;d=c.next()){var p=d.value,v=Zv(t({participantId:p},u));v.success&&(s+=1),v.error&&l.push(v.error)}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return s?t({destroyedCount:s},L):{error:l}},destroyPairEntry:Xv,disableTieAutoCalc:function(e){var t=e.drawDefinition,r=e.matchUpId,n=e.event;if(!t)return{error:K};var i=Ef({drawDefinition:t,matchUpId:r,event:n}).matchUp;return jn({extension:{name:ro,value:!0},element:i})},drawMatic:ty,enableTieAutoCalc:function(e){var t=e.tournamentRecord,r=e.drawDefinition,n=e.matchUpId,i=e.event;if(!r)return{error:K};var a=Ef({drawDefinition:r,matchUpId:n,event:i}).matchUp;return(null==a?void 0:a.matchUpType)!==Os?{error:tt}:Yg({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:r,matchUpId:n,event:i})},getAvailablePlayoffProfiles:Np,getAvailablePlayoffRounds:Np,luckyLoserDrawPositionAssignment:function(e){return function(e){return um({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e.luckyLoserParticipantId,tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,drawPosition:e.drawPosition,structureId:e.structureId})}(e)},modifyCollectionDefinition:rh,modifyDrawDefinition:function(e){var r,n=e.tournamentRecord,i=e.drawDefinition,a=e.drawUpdates,o=e.drawId,u=e.event;if(!Di(a))return{error:xr};var s=_d({event:u}).flightProfile,l=a.drawName&&xI({drawName:a.drawName,tournamentRecord:n,drawDefinition:i,flightProfile:s,drawId:o,event:u});if(null==l?void 0:l.error)return null==l?void 0:l.error;var c=(null==l?void 0:l.flight)||(null===(r=null==s?void 0:s.flights)||void 0===r?void 0:r.find((function(e){return e.drawId===o})));return c||i?(c&&Ya({event:u,extension:{name:ao,value:t(t({},s),{flights:s.flights})}}),i&&(a.policyDefinitions&&EI({policyDefinitions:a.policyDefinitions,drawDefinition:i}),Op({tournamentId:null==n?void 0:n.tournamentId,drawDefinition:i})),t({},L)):{error:K}},modifyDrawName:xI,modifyEntriesStatus:gv,modifyEvent:function(e){var r,n,i,a,s,l=e.tournamentRecord,c=e.eventUpdates,d=e.eventId,p=e.event,v="modifyEvent";if(!l)return On({result:{error:W},stack:v});if(!Pi(d))return On({result:{error:Ae},context:{eventId:d},stack:v});if(!Di(c))return On({result:{error:xr},context:{eventUpdates:c},stack:v});var f=null!==(n=null===(r=null==p?void 0:p.entries)||void 0===r?void 0:r.filter((function(e){var t=e.entryStatus;return u(u([],o(_l),!1),[Sl],!1).includes(t)})).map((function(e){return e.participantId})))&&void 0!==n?n:[],m=f&&null!==(i=Rv({participantFilters:{participantIds:f},withIndividualParticipants:!0,tournamentRecord:l}).participants)&&void 0!==i?i:[],h=[],g=m.reduce((function(e,t){var r,n,i=(null===(r=t.person)||void 0===r?void 0:r.sex)?[t.person.sex]:(null===(n=t.individualParticpants)||void 0===n?void 0:n.map((function(e){var t;return null===(t=e.person)||void 0===t?void 0:t.sex})))||[];return h.push.apply(h,u([],o(i),!1)),e.includes(t.participantType)?e:e.concat(t.participantType)}),[]),I=U(h),y=!I.length||[dp,lp].includes(null!==(a=c.gender)&&void 0!==a?a:"")||1===I.length&&I[0]===c.gender;if(c.gender&&!y)return On({context:{gender:c.gender,validGender:y},result:{error:xr},stack:v});var S=(g.includes(ga)&&[ga]||g.includes(fs)&&[va]||g.includes(hs)&&[ma]||[ma,va,ga]).includes(null!==(s=c.eventType)&&void 0!==s?s:"");return c.eventType&&!S?On({context:{participantType:c.eventType,validEventType:S},result:{error:xr},stack:v}):(c.eventType&&(p.eventType=c.eventType),c.eventName&&(p.eventName=c.eventName),c.gender&&(p.gender=c.gender),t({},L))},modifyEventEntries:function(e){var r,n,i,a=e.entryStatus,s=void 0===a?Tl:a,l=e.unpairedParticipantIds,c=void 0===l?[]:l,d=e.participantIdPairs,p=void 0===d?[]:d,v=e.entryStage,f=void 0===v?iu:v,m=e.tournamentRecord,h=e.event;if(!m)return{error:W};if(!h)return{error:Ae};var g=null!==(n=m.participants)&&void 0!==n?n:[],I=g.filter((function(e){return e.participantType===fs})).map((function(e){return e.participantId})),y=c.concat.apply(c,u([],o(p),!1)).flat(1/0).filter((function(e){return!I.includes(e)}));if(y.length)return{error:Et,invalidParticipantIds:y};var U=p.filter((function(e){return 2!==e.length}));if(U.length)return{error:Et,invalidParticipantIdPairs:U};var S=g.filter((function(e){return e.participantType===hs})).map((function(e){return e.individualParticipantIds})),w=kI({participants:p.filter((function(e){return!S.find((function(t){return 2===E(t,e).length}))})).map((function(e){return{participantType:hs,participantRole:Vv,individualParticipantIds:e}})),tournamentRecord:m});if(w.error)return w;var T=p.map((function(e){return gl({tournamentRecord:m,participantIds:e}).participant})).map((function(e){return{participantId:e,entryStatus:s,entryStage:f}})),P=c.map((function(e){return{entryStatus:Al,participantId:e,entryStage:f}}));return h.entries=(null!==(i=h.entries)&&void 0!==i?i:[]).filter((function(e){return e.entryStage===f})),h.entries=(r=h.entries).concat.apply(r,u(u([],o(T),!1),o(P),!1)),t({},L)},modifyPairAssignment:function(e){var r,n,i,s,l,c,d=e.replacementIndividualParticipantId,p=e.existingIndividualParticipantId,v=e.tournamentRecord,f=e.drawDefinition,m=e.participantId,h=e.event,g=e.uuids;if(!h)return{error:Ae};if((null==h?void 0:h.eventType)!==ma)return{error:Re};if(g&&!Array.isArray(g))return{error:xr};if(!v)return{error:W};if(![d,p,m].every((function(e){return"string"==typeof e})))return{error:_t};var I=(null===(l=null==h?void 0:h.entries)||void 0===l?void 0:l.filter((function(e){var t=e.entryStatus;return[Al,El].includes(t)})).map((function(e){return e.participantId})))||[];if(!I.includes(d))return{error:At};var y=(v.participants||[]).find((function(e){return e.participantId===m}));if((null==y?void 0:y.participantType)!==hs)return{error:Rt,participant:y};var U,S=y.individualParticipantIds,w=u([d],o(S.filter((function(e){return e!==p}))),!1),T=gl({participantIds:w,tournamentRecord:v}).participant;if(T)U=T.participantId;else{if((C=gm({participant:{participantId:null==g?void 0:g.pop(),participantRole:Vv,individualParticipantIds:w,participantType:hs},returnParticipant:!0,tournamentRecord:v})).error)return C;U=C.participant.participantId}var P=_d({event:h}).flightProfile;if(f){var D=null===(c=null==P?void 0:P.flights)||void 0===c?void 0:c.find((function(e){return e.drawId===f.drawId}));D&&(D.drawEntries=D.drawEntries.map((function(e){return e.participantId===m?t(t({},e),{participantId:U}):e}))),f.entries=f.entries.map((function(e){return e.participantId===m?t(t({},e),{participantId:U}):e}));try{for(var b=a(f.structures||[]),N=b.next();!N.done;N=b.next()){var M=N.value;if(M.positionAssignments)M.positionAssignments=M.positionAssignments.map((function(e){return e.participantId===m?t(t({},e),{participantId:U}):e}));else if(M.structures)try{for(var R=(i=void 0,a(M.structures)),A=R.next();!A.done;A=R.next()){var E=A.value;E.positionAssignments=E.positionAssignments.map((function(e){return e.participantId===m?t(t({},e),{participantId:U}):e}))}}catch(e){i={error:e}}finally{try{A&&!A.done&&(s=R.return)&&s.call(R)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{N&&!N.done&&(n=b.return)&&n.call(b)}finally{if(r)throw r.error}}}h.entries=h.entries.map((function(e){return e.participantId===m&&t(t({},e),{participantId:U})||e.participantId===d&&t(t({},e),{participantId:p})||e}));var C,x=v.events.some((function(e){var t=e.entries,r=e.eventId,n=e.drawDefinitions;return h.eventId===r?n.some((function(e){var t=e.drawId,r=e.entries;return t!==(null==f?void 0:f.drawId)&&(null==r?void 0:r.find((function(e){return e.participantId===m})))})):null==t?void 0:t.find((function(e){return e.participantId===m}))}));return!x&&(C=Kv({addIndividualParticipantsToEvents:!1,participantIds:[m],tournamentRecord:v})).error?C:t(t({},L),{participantOtherEntries:x,newPairParticipantId:U})},modifySeedAssignment:function(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.participantId,a=e.structureId,s=e.seedValue,c=e.event;return r?(r.participants||[]).find((function(e){return e.participantId===i}))?function(e){var r=e.validation,n=void 0===r||r,i=e.tournamentRecord,a=e.drawDefinition,s=e.participantId,c=e.structureId,d=e.seedValue,p=e.event;if(!a)return{error:K};if(!c)return{error:Pe};var v=as({drawDefinition:a,structureId:c}).structure;if(!v)return{error:De};if(!(!n||f(d)||void 0===d||""===d||"string"==typeof d&&d.split("-").every((function(e){return f(e)&&l(e)>0}))))return{error:xr};var m=ql({drawDefinition:a,structure:v}).seedAssignments,h=null==m?void 0:m.map((function(e){return e.seedNumber})),g=null==m?void 0:m.find((function(e){return e.participantId===s}));if(g){var I="string"==typeof d?d.includes("-")&&d.split("-").map((function(e){return parseInt(e)})).join("-")||parseInt(d)>0&&parseInt(d)||"":d&&d>0&&d||"";g.seedValue=I}else{var y={seedNumber:Math.max.apply(Math,u([0],o(h||[]),!1))+1,participantId:s};d&&(y.seedValue=d),v.seedAssignments||(v.seedAssignments=[]),v.seedAssignments.push(y)}return Fp({tournamentId:null==i?void 0:i.tournamentId,eventId:null==p?void 0:p.eventId,drawDefinition:a,structure:v}),t({},L)}({tournamentRecord:r,drawDefinition:n,participantId:i,structureId:a,seedValue:s,event:c}):{error:At}:{error:W}},modifyTieFormat:function(e){var r,n,i,s,l,c,d=e.updateInProgressMatchUps,p=void 0!==d&&d,v=e.tieFormatComparison,f=e.modifiedTieFormat,m=e.tournamentRecord,h=e.drawDefinition,g=e.structureId,I=e.matchUpId,y=e.eventId,U=e.uuids,S=e.event,T="modifyTieFormat";if(!zm({tieFormat:f}).valid)return On({result:{error:He},info:"falied validation",stack:T});var P=Rm({drawDefinition:h,structureId:g,matchUpId:I,eventId:y,event:S});if(P.error)return On({result:P,stack:T});var D=P.matchUp,b=P.tieFormat,N=bm(b),M=Zm({descendant:f,ancestor:N});if(M.invalid)return On({context:{invalid:M.invalid},result:{error:He},stack:T});if(!(null==M?void 0:M.different))return On({result:t({},L),info:"Nothing to do",stack:T});var R,A=N.collectionDefinitions.map((function(e){return e.collectionId})),E=f.collectionDefinitions.map((function(e){return e.collectionId})),C=A.filter((function(e){return!E.includes(e)})),x=f.collectionDefinitions.filter((function(e){var t=e.collectionId;return!A.includes(t)})),O=x.map(Ri("collectionId")),F=[],k=f.tieFormatName;try{for(var _=a(f.collectionDefinitions),j=_.next();!j.done;j=_.next()){var B=j.value;if(!O.includes(B.collectionId)){var V=rh(t(t({updateInProgressMatchUps:p},B),{tournamentRecord:m,tieFormatName:k,drawDefinition:h,structureId:g,matchUpId:I,eventId:y,event:S}));if(V.modifications&&F.push.apply(F,u([],o(V.modifications),!1)),V.error)return On({result:V,stack:T});V.tieFormat&&(R=V.tieFormat)}}}catch(e){r={error:e}}finally{try{j&&!j.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}try{for(var G=a(x),q=G.next();!q.done;q=G.next()){var W=MI({updateInProgressMatchUps:p,collectionDefinition:B=q.value,tournamentRecord:m,drawDefinition:h,tieFormatName:k,structureId:g,matchUpId:I,matchUp:D,eventId:y,uuids:U,event:S});if(W.error)return On({result:W,stack:T});W.tieFormat&&(R=W.tieFormat)}}catch(e){i={error:e}}finally{try{q&&!q.done&&(s=G.return)&&s.call(G)}finally{if(i)throw i.error}}try{for(var H=a(C),z=H.next();!z.done;z=H.next()){var Y=aI({updateInProgressMatchUps:p,tieFormatComparison:v,tournamentRecord:m,drawDefinition:h,tieFormatName:k,collectionId:z.value,structureId:g,matchUpId:I,eventId:y,matchUp:D,event:S});if(Y.error)return On({result:Y,stack:T});Y.tieFormat&&(R=Y.tieFormat)}}catch(e){l={error:e}}finally{try{z&&!z.done&&(c=H.return)&&c.call(H)}finally{if(l)throw l.error}}return(null==b?void 0:b.tieFormatName)!==k?(R.tieFormatName=k,F.push({tieFormatName:k})):(F.length||O.length||C.length)&&(delete R.tieFormatName,F.push("tieFormatName removed: modifications without new tieFormatName")),R.collectionDefinitions=R.collectionDefinitions.sort((function(e,t){return w(e.collectionOrder)-w(t.collectionOrder)})).map((function(e,r){return t(t({},e),{collectionOrder:r+1})})),t({processedTieFormat:bm(R),modifications:F},L)},orderCollectionDefinitions:function(e){var r=e.tournamentRecord,n=e.drawDefinition,i=e.structureId,a=e.matchUpId,o=e.orderMap,u=e.eventId,s=e.matchUp,l=e.event;if("object"!=typeof o||!Object.values(o).every((function(e){return I(e)})))return On({result:{error:xr},context:{orderMap:o}});if(u&&(null==l?void 0:l.tieFormat))rI({tournamentRecord:r,event:l,orderMap:o});else if(a){if(null==(c=n&&Ef({drawDefinition:n,matchUpId:a}))?void 0:c.error)return c;if(!(s=c.matchUp))return{error:et};(null==s?void 0:s.tieFormat)&&(s.tieFormat=tI({tieFormat:s.tieFormat,orderMap:o}),Cp({tournamentId:null==r?void 0:r.tournamentId,eventId:null==l?void 0:l.eventId,drawDefinition:n,matchUp:s}))}else if(i){var c;if((c=as({drawDefinition:n,structureId:i})).error)return c;var d=c.structure;if(null==d?void 0:d.tieFormat)d.tieFormat=tI({tieFormat:d.tieFormat,orderMap:o}),iI({eventId:null==l?void 0:l.eventId,tournamentRecord:r,drawDefinition:n,structure:d,orderMap:o}),Op({drawDefinition:n,structureIds:[d.structureId]});else if(n.tieFormat)nI({structureIds:[i],tournamentRecord:r,drawDefinition:n,orderMap:o,event:l});else{if(!(null==l?void 0:l.tieFormat))return{error:jr};rI({structureIds:[i],tournamentRecord:r,orderMap:o,event:l})}}else{if(!(null==n?void 0:n.tieFormat))return{error:jr};nI({tournamentRecord:r,drawDefinition:n,orderMap:o,event:l})}return t({},L)},promoteAlternate:function(e){var r=e.participantId;return r&&"string"!=typeof r?{error:xr,participantId:r}:iU(t(t({},e),{participantIds:[r].filter(Boolean)}))},promoteAlternates:iU,pruneDrawDefinition:function(e){var r,n,i=e.matchPlayDrawPositions,a=void 0===i||i,s=e.tournamentRecord,l=e.drawDefinition,c=e.drawId;if(!s)return{error:W};if(!l)return{error:K};var d=[],p=OI({tournamentRecord:s}).drawsAnalysis;if(p.canBePruned.includes(c)){var v=p.matchPlay.includes(c),f=p.drawAnalysis[c],m=o(os({stageSequence:1,drawDefinition:l,stage:iu}).structures,1)[0],h=f.structuresData.find((function(e){var t=e.structureId;return m.structureId===t})),g=null!==(r=m.matchUps)&&void 0!==r?r:[];d=g.sort((function(e,t){return e.roundPosition-t.roundPosition})).filter((function(e){var t=e.roundNumber;return!h.inactiveRounds.includes(t)}));var I=d.map(Ro),y=g.map(Ro).filter((function(e){return!I.includes(e)}));if(v){var U=d.sort((function(e,t){return e.roundPosition-t.roundPosition})).filter((function(e){var t=e.roundNumber;return!h.inactiveRounds.includes(t)})).filter((function(e){return e.winningSide})),S=U.map(Ro),w=I.filter((function(e){return!S.includes(e)}));y.push.apply(y,u([],o(w),!1));var T=U.flatMap((function(e){var t;return null!==(t=e.drawPositions)&&void 0!==t?t:[]})).filter(Boolean),P=T.flat(),D=Object.assign.apply(Object,u([{}],o(P.map((function(e,t){var r;return(r={})[e]=t+1,r}))),!1));if(U.forEach((function(e){a?e.drawPositions=e.drawPositions.map((function(e){return D[e]})):delete e.drawPositions})),a){var b=null===(n=null==m?void 0:m.positionAssignments)||void 0===n?void 0:n.filter((function(e){return P.includes(e.drawPosition)})).map((function(e){return e.drawPosition=D[e.drawPosition],e}));m.positionAssignments=b}else m.positionAssignments=[];m.matchUps=U,d=U}Ep({tournamentId:null==s?void 0:s.tournamentId,matchUpIds:y,drawDefinition:l}),Op({drawDefinition:l})}return t(t({},L),{matchUps:d})},qualifierDrawPositionAssignment:function(e){return function(e){return um({positionActionName:"qualifierDrawPositionAssignment",participantId:e.qualifyingParticipantId,isQualifierPosition:!0,tournamentRecord:e.tournamentRecord,drawDefinition:e.drawDefinition,drawPosition:e.drawPosition,structureId:e.structureId})}(e)},refreshEventDrawOrder:Zg,removeCollectionDefinition:aI,removeCollectionGroup:function(e){var n,i=e.updateInProgressMatchUps,a=void 0===i||i,o=e.collectionGroupNumber,u=e.tournamentRecord,s=e.drawDefinition,l=e.tieFormatName,c=e.structureId,d=e.matchUpId,p=e.matchUp,v=e.eventId,f=e.event;if(!o)return{error:pt};if(isNaN(o))return{error:xr};var m="removeCollectionGroup",h=p?void 0:Rm({drawDefinition:s,structureId:c,matchUpId:d,eventId:v,event:f});if(null==h?void 0:h.error)return On({result:h,stack:m});var g=null==h?void 0:h.structure;p=null!=p?p:null==h?void 0:h.matchUp;var I=null==h?void 0:h.tieFormat,y=null==I?void 0:I.winCriteria.valueGoal,U=null==I?void 0:I.winCriteria.aggregateValue,S=bm(I);if((h=zm({tieFormat:S})).error)return On({result:h,stack:m});var w=[];if(S.collectionDefinitions=S.collectionDefinitions.map((function(e){var t=e.collectionGroupNumber,n=r(e,["collectionGroupNumber"]);return t!==o?e:(w.push(e.collectionId),n)})),S.collectionGroups=S.collectionGroups.filter((function(e){return e.groupNumber!==o})),!(h=eI({updateInProgressMatchUps:a,originalValueGoal:y,wasAggregateValue:U,tournamentRecord:u,drawDefinition:s,tieFormatName:l,structureId:c,structure:g,tieFormat:S,matchUpId:d,matchUp:p,eventId:v,event:f})).error){var T=tl({tournamentRecord:u}).appliedPolicies;if(null===(n=null==T?void 0:T.audit)||void 0===n?void 0:n[Uo])th({drawDefinition:s,auditData:xn({drawId:null==s?void 0:s.drawId,collectionGroupNumber:o,action:m,structureId:c,matchUpId:d,eventId:v})})}return On({result:t(t({},h),{modifiedCollectionIds:w}),stack:m})},removeDelegatedOutcome:function(e){var t=e.drawDefinition,r=e.event,n=e.matchUpId;if(!t)return{error:K};if(!n)return{error:Ze};var i=Ef({drawDefinition:t,event:r,matchUpId:n}).matchUp;return i?_n({name:$a,element:i}):{error:Qe}},removeDrawEntries:function(e){var r,n,i=e.autoEntryPositions,a=void 0===i||i,o=e.participantIds,u=e.drawDefinition,s=e.drawId,l=e.stages,c=e.event;if(!c)return{error:Ae};if(!s)return{error:pe};if(!(null==o?void 0:o.length))return{error:Vt};if(x(null!==(r=fv({drawDefinition:u,stages:l}).assignedParticipantIds)&&void 0!==r?r:[],o))return{error:Ht};var d=function(e){var t=e.participantId;return!o.includes(t)},p=_d({event:c}).flightProfile,v=null===(n=null==p?void 0:p.flights)||void 0===n?void 0:n.find((function(e){return e.drawId===s}));return(null==v?void 0:v.drawEntries)&&(v.drawEntries=v.drawEntries.filter(d),a&&(v.drawEntries=mv({entries:v.drawEntries}))),(null==u?void 0:u.entries)&&(u.entries=u.entries.filter(d),a&&(u.entries=mv({entries:u.entries}))),t({},L)},removeDrawPositionAssignment:Qv,removeEventEntries:Lv,removeMatchUpSideParticipant:function(e){var r,n,i=e.tournamentRecord,a=e.drawDefinition,o=e.sideNumber,u=e.matchUpId,s=e.event;if(!i)return{error:W};if(!a)return{error:K};if(!u)return{error:Ze};if(!o)return{error:pt};if(![1,2].includes(o))return{error:xr,sideNumber:o};var l=Ef({drawDefinition:a,matchUpId:u,event:s}),c=l.matchUp,d=l.structure;if(!c)return{error:Qe};var p=!((null==d?void 0:d.structures)||a.drawType&&a.drawType!==Nu||(null===(r=null==d?void 0:d.matchUps)||void 0===r?void 0:r.find((function(e){return!!e.roundPosition}))));return p?(null===(n=c.sides)||void 0===n||n.forEach((function(e){e.sideNumber===o&&delete e.participantId})),Cp({tournamentId:null==i?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:a,matchUp:c}),t({},L)):{error:se}},removeRoundMatchUps:function(e){var r=e.removeCompletedMatchUps,n=e.tournamentRecord,i=e.drawDefinition,a=e.structureId,o=e.roundNumber,u=e.event;if(!n)return{error:W};if(!i)return{error:K};if(!o)return On({result:{error:pt},info:"roundNumber required"});var l=as({drawDefinition:i,structureId:a});if(l.error)return l;var c=l.structure;return(null==c?void 0:c.structures)?{error:X}:ip({drawDefinition:i,structure:c})?function(e){var r,n=e.removeCompletedMatchUps,i=e.drawDefinition,a=e.tournamentId,o=e.roundNumber,u=e.structure,l=e.eventId,c=null!==(r=null==u?void 0:u.matchUps)&&void 0!==r?r:[],d=[],p=!1,v=c.reduce((function(e,t){var r=null==t?void 0:t.roundNumber;return r?e.includes(r)?e:e.concat(r):e}),[]).sort(s);if(v.includes(o)){var f=c.filter((function(e){var t=e.roundNumber===o&&(!eu.includes(e.matchUpStatus)||n);return t&&d.push(e.matchUpId),!t}));if(d.length)Ep({matchUpIds:d,drawDefinition:i,tournamentId:a,eventId:l}),f.some((function(e){return e.roundNumber===o}))||(f.forEach((function(e){e.roundNumber>o&&(e.roundNumber-=1,Cp({drawDefinition:i,tournamentId:a,eventId:l,matchUp:e}))})),p=!0),u.matchUps=f}return t({deletedMatchUpsCount:d.length,roundRemoved:p},L)}({tournamentId:n.tournamentId,removeCompletedMatchUps:r,eventId:u.eventId,drawDefinition:i,roundNumber:o,structure:c}):(console.log("not implemented"),t({},L))},removeScaleValues:ay,removeSeededParticipant:function(e){var r,n,i=e.tournamentRecord,a=e.drawDefinition,o=e.participantId,u=e.structureId,s="removeSeededParticipant";if(!i)return{error:W};if(!a)return{error:K};var l=(null!==(r=a.structures)&&void 0!==r?r:[]).find((function(e){return e.structureId===u}));return l?!l.stage||![iu,au].includes(l.stage)||l.stage===iu&&1!==l.stageSequence?On({result:{error:X},stack:s}):(null===(n=l.seedAssignments)||void 0===n?void 0:n.find((function(e){return e.participantId===o})))?t({},L):On({info:"participant not seeded",result:{error:jr},context:{participantId:o}}):On({result:{error:De},stack:s})},removeSeeding:function(e){var t,r,n=e.tournamentRecord,i=e.drawDefinition,a=e.entryStatuses,o=e.scaleName,u=e.drawId,s=e.event,l=e.stage;return n?s?(o=o||(null===(t=s.category)||void 0===t?void 0:t.categoryName)||(null===(r=s.category)||void 0===r?void 0:r.ageCategoryCode),ay({tournamentRecord:n,scaleAttributes:{eventType:s.eventType,scaleType:Pa,scaleName:o},drawDefinition:i,entryStatuses:a,drawId:u,event:s,stage:l})):{error:Ae}:{error:W}},removeStructure:function(e){var r,n,i,a,s,l,c,d,p,v,f=e.tournamentRecord,m=e.drawDefinition,h=e.structureId,g=e.event,I=e.force;if("string"!=typeof h)return{error:xr};if(!m)return{error:K};if(!h)return{error:Pe};var y=null!==(r=m.structures)&&void 0!==r?r:[],U=[],S=y.find((function(e){return e.structureId===h}));if(!S)return{error:De};var w=mp({structure:S}).matchUps.some((function(e){return Bp({score:e.score})}));if(w){var T=null===(n=tl({tournamentRecord:f,drawDefinition:m,structure:S,event:g}))||void 0===n?void 0:n.appliedPolicies;if(!(null!=I?I:null===(a=null===(i=null==T?void 0:T[ja])||void 0===i?void 0:i.allowDeletionWithScoresPresent)||void 0===a?void 0:a.structures))return{error:Jr}}var P=y.find((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r})),D=h===(null==P?void 0:P.structureId),b=y.filter((function(e){return e.stage===au})).map(Ri("structureId"));if(D&&!b.length)return{error:V};var N=y.map(Ri("structureId")),M=[],R=b.includes(h),A=new Map;N.forEach((function(e){return A.set(e,R?function(e){var t,r;return null!==(r=null===(t=m.links)||void 0===t?void 0:t.map((function(t){return b.includes(t.source.structureId)&&t.target.structureId===e&&t.source.structureId})).filter(Boolean))&&void 0!==r?r:[]}(e):function(e){var t,r;return null!==(r=null===(t=m.links)||void 0===t?void 0:t.map((function(t){return t.source.structureId===e&&t.target.structureId!==(null==P?void 0:P.structureId)&&t.target.structureId})).filter(Boolean))&&void 0!==r?r:[]}(e))}));for(var E=D?A.get(h):[h],C=function(){var e=E.pop(),t=mp({structure:as({structureId:e,drawDefinition:m}).structure}).matchUps,r=bo(t);M.push.apply(M,u([],o(r),!1)),m.links=null!==(l=null===(s=m.links)||void 0===s?void 0:s.filter((function(t){return t.source.structureId!==e&&t.target.structureId!==e})))&&void 0!==l?l:[],(!D||D&&b.length||e!==h)&&(m.structures=(null!==(c=m.structures)&&void 0!==c?c:[]).filter((function(t){return e&&e===t.structureId&&U.push(e),t.structureId!==e})));var n=e&&(null===(d=A.get(e))||void 0===d?void 0:d.filter((function(e){return e!==(null==P?void 0:P.structureId)||h===P.structureId})));(null==n?void 0:n.length)&&E.push.apply(E,u([],o(n),!1))};null==E?void 0:E.length;)C();var x=Ip({drawDefinition:m}).matchUps;if(null==x||x.forEach((function(e){e.winnerMatchUpId&&M.includes(e.winnerMatchUpId)&&delete e.winnerMatchUpId,e.loserMatchUpId&&M.includes(e.loserMatchUpId)&&delete e.loserMatchUpId})),D){var O=null===(v=null!==(p=P.matchUps)&&void 0!==p?p:[])||void 0===v?void 0:v.map(Ri("matchUpId"));M.push.apply(M,u([],o(O),!1)),P.positionAssignments=[],P.seedAssignments=[],P.matchUps=[],P.extensions&&(P.extensions=[])}return R&&xh({drawDefinition:m}),Ep({tournamentId:null==f?void 0:f.tournamentId,matchUpIds:M,action:"removeStructure",eventId:null==g?void 0:g.eventId,drawDefinition:m}),Op({drawDefinition:m,eventId:null==g?void 0:g.eventId}),t(t({},L),{removedMatchUpIds:M,removedStructureIds:U})},removeTieMatchUpParticipantId:function(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D,b,N,M,R,A=e.tournamentRecord,E=e.drawDefinition,C=e.participantId,x=e.event,O="removeTieMatchUpParticiapantId";if(!C)return On({result:{error:_t},stack:O});var F=hm(e);if(F.error)return F;var k=tl({tournamentRecord:A,drawDefinition:E,event:x}).appliedPolicies,_=null!==(l=null!==(s=null===(i=e.policyDefinitions)||void 0===i?void 0:i[Ca])&&void 0!==s?s:null==k?void 0:k[Ca])&&void 0!==l?l:jv[Ca],j=null===(c=null==_?void 0:_.processCodes)||void 0===c?void 0:c.substitution,B=F.inContextDualMatchUp,V=F.inContextTieMatchUp,G=F.relevantAssignments,q=F.collectionPosition,W=F.teamParticipants,H=F.collectionId,z=F.matchUpType,Y=F.dualMatchUp,K=F.tieMatchUp,J=F.tieFormat;if(!Y)return On({result:{error:et},stack:O});var Z=null===(d=null==V?void 0:V.sides)||void 0===d?void 0:d.find((function(e){var t,r,n;return(null===(t=e.participant)||void 0===t?void 0:t.participantId)===C||(null===(n=null===(r=e.participant)||void 0===r?void 0:r.individualParticipantIds)||void 0===n?void 0:n.includes(C))}));if(!Z)return On({result:{error:Lt},stack:O});if(!(null===(p=Z.substitutions)||void 0===p?void 0:p.length)&&(Bp({score:null==V?void 0:V.score})||(null==V?void 0:V.winningSide)))return On({result:{error:qr},stack:O});var X=null===(f=null===(v=null==B?void 0:B.sides)||void 0===v?void 0:v.find((function(e){return e.sideNumber===Z.sideNumber})))||void 0===f?void 0:f.participantId;if(!X)return On({result:{error:Lt},stack:O});var Q=null===(h=null===(m=Rv({participantFilters:{participantIds:[C]},tournamentRecord:A}))||void 0===m?void 0:m.participants)||void 0===h?void 0:h[0];if(!Q)return On({result:{error:Lt},stack:O});if(z===Es&&Q.participantType===hs)return On({result:{error:Rt},stack:O});var $=Q.participantType===fs?[C]:Q.individualParticipantIds;Im({tournamentId:A.tournamentId,eventId:x.eventId,inContextDualMatchUp:B,drawDefinition:E,dualMatchUp:Y});var ee=null===(g=Y.sides)||void 0===g?void 0:g.find((function(e){return e.sideNumber===Z.sideNumber}));if(!ee&&((null===(I=Y.sides)||void 0===I?void 0:I.filter((function(e){return!e.lineUp})).length)||0)<2){var te=null==W?void 0:W.map((function(e){var t,r=e.participantId;return{drawPosition:null===(t=null==G?void 0:G.find((function(e){return e.participantId===r})))||void 0===t?void 0:t.drawPosition,teamParticipantId:r}}));ee=null===(y=Y.sides)||void 0===y?void 0:y.find((function(e){var t;return(null===(t=null==te?void 0:te.find((function(t){return t.drawPosition===e.drawPosition})))||void 0===t?void 0:t.teamParticipantId)===X}))}if(!ee)return On({result:{error:Lt,context:{participantId:C}}});var re=Um({collectionPosition:q,teamParticipantId:X,dualMatchUpSide:ee,participantIds:$,drawDefinition:E,collectionId:H}),ne=re.modifiedLineUp,ie=re.previousParticipantIds;if(ee.lineUp=ne,X&&J&&im({participantId:X,lineUp:ne,drawDefinition:E,tieFormat:J}),z===xs&&Q.participantType===fs){var ae=null===(U=null==V?void 0:V.sides)||void 0===U?void 0:U.find((function(e){return e.sideNumber===(null==ee?void 0:ee.sideNumber)})),oe=(null!=ae?ae:{}).participantId,ue=oe&&(null===(w=null===(S=Rv({participantFilters:{participantIds:[oe]},tournamentRecord:A,withDraws:!0}))||void 0===S?void 0:S.participants)||void 0===w?void 0:w[0]);if(!ue)return On({result:{error:Lt},stack:O});var se=null!==(P=null===(T=null==ue?void 0:ue.individualParticipantIds)||void 0===T?void 0:T.filter((function(e){return e!==C})))&&void 0!==P?P:[];if(ie&&se.push.apply(se,u([],o(ie),!1)),se.length>2)return On({result:{error:Et},stack:O});if(null===(D=ue.draws)||void 0===D?void 0:D.length){if(1===se.length){var le;if(!gl({participantIds:se,tournamentRecord:A}).participant)if((le=gm({participant:{participantRole:Vv,individualParticipantIds:se,participantType:hs},pairOverride:!0,tournamentRecord:A})).error)return On({result:le,stack:O})}}else if(se.length){if(ue.individualParticipantIds=se,(le=wm({participant:ue,pairOverride:!0,tournamentRecord:A})).error)return On({result:le,stack:O})}else(le=Kv({participantIds:[oe],tournamentRecord:A})).error&&console.log("cleanup",{result:le})}if(1===(null===(b=Z.substitutions)||void 0===b?void 0:b.length)){var ce=null===(N=null==V?void 0:V.sides)||void 0===N?void 0:N.find((function(e){return e.sideNumber!==Z.sideNumber}));if(!(null===(M=null==ce?void 0:ce.substitutions)||void 0===M?void 0:M.length)&&(null===(R=null==K?void 0:K.processCodes)||void 0===R?void 0:R.length)){try{for(var de=a(j||[]),pe=de.next();!pe.done;pe=de.next()){var ve=pe.value,fe=K.processCodes.lastIndexOf(ve);K.processCodes.splice(fe,1)}}catch(e){r={error:e}}finally{try{pe&&!pe.done&&(n=de.return)&&n.call(de)}finally{if(r)throw r.error}}Cp({tournamentId:null==A?void 0:A.tournamentId,matchUp:K,context:O,drawDefinition:E})}}return Cp({tournamentId:null==A?void 0:A.tournamentId,matchUp:Y,context:O,drawDefinition:E}),t(t({},L),{modifiedLineUp:ne})},renameStructures:function(e){var r,n,i=e.drawDefinition,s=e.structureDetails;if(!Array.isArray(s))return{error:xr};if(!i)return{error:K};var l=Object.assign.apply(Object,u([{}],o(s.map((function(e){var t;if(Di(e)){var r=e||{},n=r.structureId,i=r.structureName;if(n&&i)return(t={})[n]=i,t}})).filter(Boolean)),!1));if(!Object.values(l).length)return{error:pt};try{for(var c=a(i.structures||[]),d=c.next();!d.done;d=c.next()){var p=d.value,v=l[p.structureId];v&&(p.structureName=v)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return t({},L)},replaceTieMatchUpParticipantId:ym,resetDrawDefinition:function(e){var r,n,i,o,u,s=e.tournamentRecord,l=e.removeScheduling,c=e.drawDefinition;if(!c)return{error:K};var d=fl({drawDefinition:c}),p=function(e){var t;return null===(t=null==d?void 0:d.drawMatchUps)||void 0===t?void 0:t.find((function(t){return t.matchUpId===e}))};try{for(var v=a(c.structures||[]),f=v.next();!f.done;f=v.next()){var m=f.value,h=m.positionAssignments,g=m.stage,I=m.stageSequence;!h||1===I&&[au,iu].includes(g)||(m.positionAssignments=h.map((function(e){return delete e.participantId,e})),m.seedAssignments=[]);var y=mp({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:d,structure:m}).matchUps,U=function(e){var t=e.matchUpId,r=e.roundNumber,n=e.sides,i=p(t);if(i){if(delete i.extensions,delete i.notes,i.matchUpStatus!==Fo&&Object.assign(i,ug),r&&r>1&&i.drawPositions){var a=null==n?void 0:n.map((function(e){var t=e.drawPosition;return!e.participantFed&&t})).filter(Boolean),o=i.drawPositions.map((function(e){return a.includes(e)?void 0:e}));i.drawPositions=o}l?delete i.timeItems:(null===(u=i.timeItems)||void 0===u?void 0:u.length)&&(i.timeItems=i.timeItems.filter((function(e){return e.itemType&&![tc,rc,ec,ac,ic,oc].includes(e.itemType)}))),Cp({tournamentId:null==s?void 0:s.tournamentId,context:"resetDrawDefiniton",drawDefinition:c,matchUp:i})}};try{for(var S=(i=void 0,a(y)),w=S.next();!w.done;w=S.next()){U(w.value)}}catch(e){i={error:e}}finally{try{w&&!w.done&&(o=S.return)&&o.call(S)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}var T=(c.structures||[]).map((function(e){return e.structureId}));return Op({drawDefinition:c,structureIds:T}),t({},L)},resetMatchUpLineUps:function(e){var r,n,i=e.inheritance,a=void 0===i||i,o=e.tournamentRecord,u=e.drawDefinition,s=e.matchUpId,l=e.event;if(!u)return{error:K};var c=null===(r=Ef({drawDefinition:u,matchUpId:s}))||void 0===r?void 0:r.matchUp;if(!(null==c?void 0:c.tieMatchUps))return{error:tt};var d=null===(n=Ef({inContext:!0,drawDefinition:u,matchUpId:s,event:l}))||void 0===n?void 0:n.matchUp,p=0;return((null==c?void 0:c.sides)||[]).forEach((function(e){e.lineUp&&delete e.lineUp})),((null==d?void 0:d.sides)||[]).forEach((function(e){if(p+=1,!1===a){var t=null==d?void 0:d.tieFormat,r=e.participantId;t&&r&&im({drawDefinition:u,participantId:r,lineUp:[],tieFormat:t})}Cp({tournamentId:null==o?void 0:o.tournamentId,context:"resetMatchUpLineUps",eventId:null==l?void 0:l.eventId,drawDefinition:u,matchUp:c})})),t(t({},L),{modificationsCount:p})},resetScorecard:function(e){var r,n,i,o,u=e.tournamentRecord,s=e.drawDefinition,l=e.matchUpId,c=e.event,d="resetScorecard";if(!s)return On({result:{error:K},stack:d});if(!l)return On({result:{error:Ze},stack:d});if(!Pi(l))return On({result:{error:xr,matchUpId:l},stack:d});var p=fl({drawDefinition:s}),v=Ip({nextMatchUps:!0,inContext:!0,drawDefinition:s,matchUpsMap:p}).matchUps,f=p.drawMatchUps.find((function(e){return e.matchUpId===l})),m=null==v?void 0:v.find((function(e){return e.matchUpId===l}));if(!f||!v)return{error:Qe};if(f.matchUpType!==Ia)return{error:tt};var h=Ks({inContextDrawMatchUps:v,drawDefinition:s,matchUpId:l}),g=as({drawDefinition:s,structureId:null==m?void 0:m.structureId}).structure;if(Object.assign(e,{inContextDrawMatchUps:v,inContextMatchUp:m,matchUpsMap:p,targetData:h,structure:g,matchUp:f}),bg(e))return{error:Mt};if(null===(i=f.tieMatchUps)||void 0===i?void 0:i.length)try{for(var I=a(f.tieMatchUps),y=I.next();!y.done;y=I.next()){var U=Yg({matchUpId:y.value.matchUpId,matchUpTieId:l,winningSide:void 0,removeScore:!0,tournamentRecord:u,drawDefinition:s,event:c});if(U.error)return On({result:U,stack:d})}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}var S=vg({event:e.event,removeScore:!0,tournamentRecord:u,drawDefinition:s,matchUpsMap:p,matchUpId:l});if(S.error)return On({result:S,stack:d});if(e.tiebreakReset&&!S.tieFormatRemoved){var w=null===(o=Gd({drawDefinition:s,structure:g,event:c}))||void 0===o?void 0:o.tieFormat;if(f.tieFormat&&w){var T=Zm({descendant:f.tieFormat,ancestor:w}),P=T.matchUpCountDifference,D=T.descendantDifferences,b=T.ancestorDifferences,N=T.valueDifference;if(1===D.collectionIds.length&&!b.collectionIds.length&&!b.groupsCount&&1===P&&1===N){var M=oy({tournamentRecord:u,drawDefinition:s,matchUpId:l,event:c});if(M.error)return M}}}return t({},L)},resetTieFormat:oy,resetVoluntaryConsolationStructure:function(e){var r,n,i=e.tournamentRecord,a=e.drawDefinition,o=e.resetEntries,u=e.event;if(!a)return{error:K};var s=null===(r=a.structures)||void 0===r?void 0:r.find((function(e){return e.stage===uu}));if(!s)return{error:De};var l=(null===(n=s.matchUps)||void 0===n?void 0:n.map((function(e){return e.matchUpId})))||[];return s.positionAssignments=[],s.seedAssignments=[],s.matchUps=[],Ep({tournamentId:null==i?void 0:i.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:l,drawDefinition:a}),o&&(a.entries=a.entries.filter((function(e){return e.entryStage!==uu}))),Op({tournamentId:null==i?void 0:i.tournamentId,eventId:null==u?void 0:u.eventId,drawDefinition:a,structureIds:[s.structureId]}),t({},L)},setDelegatedOutcome:function(e){return function(e){var t,r,n=e.drawDefinition,i=e.matchUpId,a=e.outcome,o=e.matchUp;if(!o&&!n)return{error:K};if(!a)return{error:pt,info:"missing outcome"};if(!o&&!i)return{error:et};if(!o){var u=Ef({drawDefinition:n,matchUpId:i});if(u.error)return u;o=u.matchUp}return"object"==typeof a&&(null===(t=a.score)||void 0===t?void 0:t.scoreStringSide1)&&(null===(r=a.score)||void 0===r?void 0:r.scoreStringSide2)?jn({element:o,extension:{name:$a,value:a}}):{error:xr}}(e)},setDrawParticipantRepresentativeIds:function(e){var t=e.representativeParticipantIds,r=e.drawDefinition;if(!r)return{error:Z};if(!Array.isArray(t))return{error:xr};var n=No((null==r?void 0:r.entries)||[]);return t.length&&E(t,n).length<t.length?{error:xr}:za({drawDefinition:r,extension:{name:co,value:t}})},setEntryPosition:oU,setEntryPositions:function(e){var r,n,i=e.tournamentRecord,o=e.entryPositions,u=e.drawDefinition,s=e.event;if(!i)return{error:W};if(!Array.isArray(o))return{error:xr};try{for(var l=a(o),c=l.next();!c.done;c=l.next()){var d=c.value,p=oU({skipRefresh:!0,tournamentRecord:i,drawDefinition:u,participantId:d.participantId,entryPosition:d.entryPosition,event:s});if(p.error)return p}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=l.return)&&n.call(l)}finally{if(r)throw r.error}}return(null==s?void 0:s.entries)&&(s.entries=mv({entries:s.entries})),(null==u?void 0:u.entries)&&(u.entries=mv({entries:u.entries})),t({},L)},setEventDates:function(e){var r,n=e.tournamentRecord,i=e.event,a=e.startDate,o=e.endDate;return n?i?a||o?a&&!Wn.test(a)||o&&!Wn.test(o)?{error:It}:a&&o&&new Date(ui(a)).getTime()>new Date(ui(o)).getTime()?{error:xr}:a&&(r=uU({tournamentRecord:n,event:i,startDate:a})).error||o&&(r=sU({tournamentRecord:n,event:i,endDate:o})).error?r:t({},L):{error:pt,info:"missing date"}:{error:Ae}:{error:W}},setEventEndDate:sU,setEventStartDate:uU,setMatchUpFormat:function(e){var r,n,i,o,u="setMatchUpFormat",s=e.tournamentRecord,l=e.drawDefinition,c=e.scheduledDates,d=e.stageSequences,p=e.matchUpFormat,v=e.structureId,f=e.eventType,m=e.matchUpId,h=e.eventId,g=e.stages,I=e.drawId,y=e.event,U=e.force;if(!s)return{error:W};if(!p)return{error:Ye};if(p&&!Fm({matchUpFormat:p}))return On({result:{error:Ge,matchUpFormat:p},stack:u});if(c&&!Array.isArray(c))return On({result:{error:xr,scheduledDates:c},stack:u});if(f&&![va,ma].includes(f))return On({result:{error:Re},stack:u});var S=0,w=e.structureIds||v&&[v].filter(Boolean)||[],T=e.eventIds||h&&[h].filter(Boolean)||[],P=e.drawIds||I&&[I].filter(Boolean)||[];if((v||(null==w?void 0:w.length))&&!l)return On({result:{error:K},stack:u});if(I&&m&&l){var D=dI({tournamentRecord:s,drawDefinition:l,matchUpFormat:p,structureIds:w,structureId:v,matchUpId:m});if(D.error)return D;S+=1}var b=function(e){var t,r,n,i,o=[];try{for(var l=a(e.structures||[]),v=l.next();!v.done;v=l.next()){var f=v.value;if(!(Array.isArray(g)&&!g.includes(f.stage)||Array.isArray(d)&&!d.includes(f.stageSequence)||(null==w?void 0:w.length)&&!w.includes(f.structureId))){(null==w?void 0:w.length)&&f.matchUpFormat!==p&&(f.matchUpFormat=p,o.push(f.structureId),S+=1);var m=(U||c)&&mp({matchUpFilters:{matchUpStatuses:[Yo]},structure:f}).matchUps,h=c&&mp({matchUpFilters:{matchUpStatuses:[Yo]},contextFilters:{scheduledDates:c},afterRecoveryTimes:!1,inContext:!0,structure:f}).matchUps;if(null==m?void 0:m.length){var I=h?h.map(Ro):m.map(Ro);try{for(var T=(n=void 0,a(m)),P=T.next();!P.done;P=T.next()){var D=P.value;I.includes(D.matchUpId)&&(D.matchUpFormat=(null==c?void 0:c.length)?p:void 0,Cp({tournamentId:null==s?void 0:s.tournamentId,eventId:null==y?void 0:y.eventId,context:u,drawDefinition:e,matchUp:D}))}}catch(e){n={error:e}}finally{try{P&&!P.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}}}}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=l.return)&&r.call(l)}finally{if(t)throw t.error}}return o.length||e.matchUpFormat===p||(e.matchUpFormat=p,S+=1),o};try{for(var N=a(s.events||[]),M=N.next();!M.done;M=N.next()){var R=M.value;if(!((null==T?void 0:T.length)&&!T.includes(R.eventId)||f&&f!==R.eventType||f===ga))if(Array.isArray(d)||Array.isArray(g)||(null==w?void 0:w.length)||(null==P?void 0:P.length))try{for(var A=(i=void 0,a(R.drawDefinitions||[])),E=A.next();!E.done;E=A.next()){var C=E.value;if(!Array.isArray(P)||P.includes(C.drawId))Op({structureIds:b(C),drawDefinition:C})}}catch(e){i={error:e}}finally{try{E&&!E.done&&(o=A.return)&&o.call(A)}finally{if(i)throw i.error}}else R.matchUpFormat!==p&&(R.matchUpFormat=p,S+=1)}}catch(e){r={error:e}}finally{try{M&&!M.done&&(n=N.return)&&n.call(N)}finally{if(r)throw r.error}}return t(t({},L),S?{modificationsCount:S}:{info:Dr})},setMatchUpStatus:NI,setOrderOfFinish:function(e){return function(e){var r,n,i,s,l=e.drawDefinition,c=e.finishingOrder;if(!l)return{error:K};var d="setOrderOfFinish";if(!Array.isArray(c))return On({info:rm("finishingOrder"),result:{error:xr},stack:d});var p,v,f=yp({inContext:!0,drawDefinition:l}),m=f.completedMatchUps,h=f.matchUpsMap,g=null!==(i=null==m?void 0:m.map(Ro))&&void 0!==i?i:[],y=c.map(Ro),U=(null!=m?m:[]).filter((function(e){var t=e.matchUpId;return y.includes(t)})).reduce((function(e,t){var r=t.matchUpTieId,n=t.matchUpType,i=t.roundNumber,a=t.structureId;return e.matchUpTypes.includes(n)||e.matchUpTypes.push(n),e.roundNumbers.includes(i)||e.roundNumbers.push(i),e.structureIds.includes(a)||e.structureIds.push(a),e.matchUpTieIds.includes(r)||e.matchUpTieIds.push(r),e}),{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]}),S=U.matchUpTypes,w=U.roundNumbers,T=U.structureIds,P=U.matchUpTieIds;if(S.length>1||P.length>1||w.length>1||T.length>1)return On({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:xr},stack:d});var D={},N=[],M=[],R=c.every((function(e){var t=e.orderOfFinish,r=e.matchUpId;return N.push(r),t&&M.push(t),D[r]=t,p=g.includes(r),v=void 0===t||I(t)&&Math.floor(t)>0,p&&v}));if(!R)return On({result:{error:p?xr:We},info:(p?!v&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:d});var A=null==m?void 0:m.filter((function(e){return e.structureId===T[0]&&e.roundNumber===w[0]&&e.matchUpType===S[0]&&e.matchUpTieId===P[0]&&!N.includes(e.matchUpId)}));try{for(var E=a(null!=A?A:[]),C=E.next();!C.done;C=E.next()){var x=C.value,O=(x||{}).orderOfFinish;if(O){if(!I(O))return On({context:{orderOfFinish:O,matchUp:x},result:{error:xr},stack:d});M.push(O)}}}catch(e){r={error:e}}finally{try{C&&!C.done&&(n=E.return)&&n.call(E)}finally{if(r)throw r.error}}if(b(M).length!==M.length||Math.max.apply(Math,u([],o(M),!1))>M.length)return On({info:"Values not unique or greater than expected number of values",result:{error:xr},stack:d});if(T.length){var F=gp({matchUpFilters:{matchUpIds:y},structureId:T[0],drawDefinition:l,matchUpsMap:h});if(F.error)return On({result:F,stack:d});null===(s=F.completedMatchUps)||void 0===s||s.forEach((function(e){return e.orderOfFinish=D[e.matchUpId]}))}return t({},L)}(e)},setPositionAssignments:function(e){return function(e){var r,n,i,o,u,s=e.structurePositionAssignments,l=e.provisionalPositioning,c=e.tournamentRecord,d=e.drawDefinition,p=e.event;if(!d)return{error:K};if(!Array.isArray(s))return{error:xr};try{for(var v=a(s),f=v.next();!f.done;f=v.next()){var m=f.value,h=m.structureId,g=m.positionAssignments;if(g){var I=as({drawDefinition:d,structureId:h});if(I.error)return I;var y=I.structure;if(!y)return{error:De};var U=null===(u=ss({structure:y}).positionAssignments)||void 0===u?void 0:u.map((function(e){return e.drawPosition})),S=null==g?void 0:g.map((function(e){return e.drawPosition}));if(E(U,S).length!==(null==U?void 0:U.length))return On({result:{error:xr},info:"drawPositions do not match",stack:"setPositionAssignments"});var w=fl({drawDefinition:d}),T=Ip({inContext:!0,drawDefinition:d,matchUpsMap:w}).matchUps,P=function(e){var t=e.drawPosition,r=e.participantId,n=e.bye,i=e.qualifier;if(n){var a=av({tournamentRecord:c,drawDefinition:d,drawPosition:t,matchUpsMap:w,structureId:h,structure:y,event:p});if(null==a?void 0:a.error)return{value:a}}else if(i)g.forEach((function(e){e.drawPosition===t&&(e.qualifier=!0,delete e.participantId,delete e.bye)}));else if(r){var o=om({provisionalPositioning:l,inContextDrawMatchUps:T,tournamentRecord:c,drawDefinition:d,participantId:r,drawPosition:t,matchUpsMap:w,structureId:h,event:p});if(null==o?void 0:o.error)return{value:o}}};try{for(var D=(i=void 0,a(g||[])),b=D.next();!b.done;b=D.next()){var N=P(b.value);if("object"==typeof N)return N.value}}catch(e){i={error:e}}finally{try{b&&!b.done&&(o=D.return)&&o.call(D)}finally{if(i)throw i.error}}kp({tournamentId:null==c?void 0:c.tournamentId,drawDefinition:d,structure:y,event:p})}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}var M=s.map((function(e){return e.structureId}));return Op({tournamentId:null==c?void 0:c.tournamentId,eventId:null==p?void 0:p.eventId,drawDefinition:d,structureIds:M}),t({},L)}(e)},setStructureOrder:function(e){var r=e.drawDefinition,n=e.orderMap;return r?("object"==typeof n&&Object.values(n).every((function(e){return I(e)}))||On({result:{error:xr},context:{orderMap:n}}),r.structures||(r.structures=[]),r.structures.forEach((function(e){var t=n[e.structureId];t&&(e.structureOrder=t)})),r.structures.sort((function(e,t){return w(e.structureOrder)-w(t.structureOrder)})),t({},L)):{error:K}},setSubOrder:function(e){var r,n,i,a,o=e.tournamentRecord,u=e.drawDefinition,s=e.drawPosition,l=e.structureId,c=e.subOrder,d=e.event;if(!u)return{error:K};if(!l)return{error:Pe};if(!s)return{error:ue};var p=as({drawDefinition:u,structureId:l}).structure;if(!p)return{error:De};var v=p;p.structures&&p.structureType===Iu&&(v=null===(r=p.structures)||void 0===r?void 0:r.find((function(e){var t;return null===(t=e.positionAssignments)||void 0===t?void 0:t.find((function(e){return e.drawPosition===s}))})));var f=null==v?void 0:v.positionAssignments,m=null==f?void 0:f.find((function(e){return e.drawPosition===s}));m&&jn({element:m,extension:{name:Io,value:c}});var h=mp({structure:v,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:((null==d?void 0:d.eventType)===Fs||u.matchUpType===Fs||(null!==(i=null!==(n=null==d?void 0:d.tieFormat)&&void 0!==n?n:null==u?void 0:u.tieFormat)&&void 0!==i?i:null==p?void 0:p.tieFormat))&&{matchUpTypes:[Fs]},event:d}).matchUps;return cg({positionAssignments:f,tournamentRecord:o,drawDefinition:u,matchUpFormat:null!==(a=null==p?void 0:p.matchUpFormat)&&void 0!==a?a:u.matchUpFormat,matchUps:h,event:d}),Op({drawDefinition:u,structureIds:[l]}),t({},L)},substituteParticipant:function(e){return function(e){var t,r,n,i=e.substituteParticipantId,a=e.existingParticipantId,o=e.tournamentRecord,u=e.drawDefinition,s=e.sideNumber,l=e.matchUpId,c=e.event,d="substituteParticipant";if(!u)return{error:K};if(!l)return{error:Ze};if(!a||!i)return On({result:{error:_t},stack:d});var p=Ef({drawDefinition:u,matchUpId:l,event:c}).matchUp;if(!p)return{error:Qe};if(!p.collectionId)return On({result:{error:tt},stack:d});var v=fl({drawDefinition:u}),f=Ip({tournamentParticipants:null==o?void 0:o.participants,inContext:!0,drawDefinition:u,matchUpsMap:v}).matchUps,m=null==f?void 0:f.find((function(e){return e.matchUpId===l})),h=null==f?void 0:f.find((function(e){return e.matchUpId===(null==m?void 0:m.matchUpTieId)})),g=null===(t=null==h?void 0:h.sides)||void 0===t?void 0:t.find((function(e){return e.participant.individualParticipants.some((function(e){return e.participantId===a}))}));if(!g||s&&g.sideNumber!==s)return{error:At};var I=null===(n=null===(r=g.participant)||void 0===r?void 0:r.individualParticipants)||void 0===n?void 0:n.map(Mo).filter((function(e){return e!==a}));return(null==I?void 0:I.includes(i))?ym({newParticipantId:i,tieMatchUpId:l,existingParticipantId:a,substitution:!0,tournamentRecord:o,drawDefinition:u,event:c}):On({result:{error:At},stack:d})}(e)},swapDrawPositionAssignments:function(e){return nh(e)},toggleParticipantCheckInState:mm,updateDrawIdsOrder:Jg,updateTeamLineUp:im,updateTieMatchUpScore:vg,withdrawParticipantAtDrawPosition:function(e){return Object.assign(e,{entryStatus:xl}),Qv(e)}};function dU(e){var r,n,i,o,u,s,l=e.qualifyingProfiles,c=e.appliedPolicies,d=e.idPrefix,v=e.isMock,f=e.uuids,m=[],h=[],g=[],y=function(e,t){return e.stageSequence-t.stageSequence},U=0,S=0,w=1;try{for(var T=a(l.sort((function(e,t){return e.roundTarget-t.roundTarget}))),P=T.next();!P.done;P=T.next()){var D=P.value,b=D.structureProfiles||[];w=D.roundTarget||w;var N=1,M=0,R=void 0,A=void 0,E=void 0,C=function(e){var t,r,n=p(e.drawSize||e.participantsCount),i=e.qualifyingRoundNumber,a=e.structureOptions,o=e.matchUpFormat,m=e.structureName,y=e.structureId,S=e.drawType,T=e.matchUpType,P=e.qualifyingPositions||pU({drawSize:n,qualifyingRoundNumber:i}),D=void 0,C=void 0;if(!I(n))return{value:On({result:{error:de},stack:"generateQualifyingSTructures"})};var x=l.length>1?"".concat(w,"-"):"",O=b.length>1||x?N:"",F=m||(x||O?"".concat(ef(au)," ").concat(x).concat(O):ef(au));if(S===Yu){var k=Gf({structureName:e.structureName||F,structureId:y||(null==f?void 0:f.pop()),stage:au,structureOptions:a,appliedPolicies:c,stageSequence:N,matchUpType:T,roundTarget:w,drawSize:n,idPrefix:d,isMock:v,uuids:f}),_=k.structures,L=k.groupCount,j=k.maxRoundNumber;M=L,r=j,D=_[0],s=[1]}else n=(t=lI({qualifyingRoundNumber:i,qualifyingPositions:P,matchUpType:T,drawSize:n,idPrefix:d,isMock:v,uuids:f})).drawSize,C=t.matchUps,r=t.roundLimit,D=tf({structureName:e.structureName||F,structureId:y||(null==f?void 0:f.pop()),qualifyingRoundNumber:r,stage:au,matchUpFormat:o,stageSequence:N,matchUpType:T,roundLimit:r,matchUps:C}),w&&jn({extension:{name:fo,value:w},element:D}),M=(null===(u=null==C?void 0:C.filter((function(e){return e.roundNumber===r})))||void 0===u?void 0:u.length)||0;if(N>1){var B=oI({sourceStructureId:A,sourceRoundNumber:R,targetStructureId:D.structureId,finishingPositions:E===Tu?[1]:void 0,linkType:E}).link;g.push(B),U+=(n||0)-M}else U+=n||0;E=S===Yu?Tu:Pu,A=D.structureId,R=r,h.push(D),N+=1};try{for(var x=(i=void 0,a((b||[]).sort(y))),O=x.next();!O.done;O=x.next()){var F=C(O.value);if("object"==typeof F)return F.value}}catch(e){i={error:e}}finally{try{O&&!O.done&&(o=x.return)&&o.call(x)}finally{if(i)throw i.error}}S+=M,m.push({qualifiersCount:M,finalQualifyingRoundNumber:R,finalQualifyingStructureId:A,finishingPositions:s,roundTarget:w,linkType:E}),w+=1}}catch(e){r={error:e}}finally{try{P&&!P.done&&(n=T.return)&&n.call(T)}finally{if(r)throw r.error}}return t(t({qualifiersCount:S,qualifyingDrawPositionsCount:U,qualifyingDetails:m,structures:h},L),{links:g})}function pU(e){for(var t=e.drawSize,r=e.qualifyingRoundNumber,n=t,i=0;i<r;)n=Math.floor(n/2),i+=1;return n}function vU(e){var t,r,n,i,a,o,u=e.policyDefinitions,s=e.appliedPolicies,l=e.drawType,c=null===(t=null==u?void 0:u[Ga])||void 0===t?void 0:t.drawTypeCoercion,d=null===(r=null==s?void 0:s[Ga])||void 0===r?void 0:r.drawTypeCoercion;return null===(o=null!==(a=null!==(i=null!==(n="boolean"==typeof c?c:void 0)&&void 0!==n?n:l&&(null==c?void 0:c[l]))&&void 0!==i?i:"boolean"==typeof d?d:void 0)&&void 0!==a?a:l&&(null==d?void 0:d[l]))||void 0===o||o}function fU(e){var r=e.structureName,n=e.matchUpType,i=e.idPrefix,a=e.drawSize,s=e.isMock,l=e.uuids,c=[],d=pI({linkFedFinishingRoundNumbers:[1],drawSize:a+1,matchUpType:n,idPrefix:i,isMock:s}).matchUps,p=tf({structureName:r||ef(iu),structureId:null==l?void 0:l.pop(),stageSequence:1,stage:iu,matchUpType:n,matchUps:d});c.push(p);var v=pI({finishingPositionOffset:a/2,idPrefix:i&&"".concat(i,"-c"),drawSize:a-1,isConsolation:!0,matchUpType:n,isMock:s,uuids:l}).matchUps,f=tf({structureName:ef(Zu),matchUps:v,structureId:null==l?void 0:l.pop(),stage:ou,stageSequence:2,matchUpType:n});c.push(f);var m=lI({idPrefix:i&&"".concat(i,"-p1t2"),drawSize:2,matchUpType:n,isMock:s}).matchUps,h=tf({structureName:ef(Ju),matchUps:m,structureId:null==l?void 0:l.pop(),stageSequence:3,stage:su,matchUpType:n});c.push(h);var g=function(e){var t=e.mainStructure,r=e.consolationStructure,n=e.deciderStructure,i=r.matchUps.reduce((function(e,t){return(t.drawPositions||[]).filter(Boolean).length&&!e.includes(t.roundNumber)?e.concat(t.roundNumber):e}),[]),a=t.matchUps.reduce((function(e,t){return!e||t.roundNumber>e?t.roundNumber:e}),void 0),s=r.matchUps.reduce((function(e,t){return!e||t.roundNumber>e?t.roundNumber:e}),void 0),l=i.map((function(e,n){var a=i.indexOf(e)%2?Su:wu;return{linkType:Du,source:{roundNumber:1+n,structureId:t.structureId},target:{feedProfile:a,roundNumber:e,structureId:r.structureId}}})),c={linkType:Pu,source:{roundNumber:s,structureId:r.structureId},target:{feedProfile:Su,roundNumber:a,structureId:t.structureId}},d=[{linkType:Pu,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Su,roundNumber:1,structureId:n.structureId}},{linkType:Du,source:{roundNumber:a,structureId:t.structureId},target:{feedProfile:Su,roundNumber:1,structureId:n.structureId}}];return u(u(u([],o(l),!1),[c],!1),o(d),!1)}({mainStructure:p,consolationStructure:f,deciderStructure:h});return t({structures:c,links:g},L)}function mU(e){var t,r,n=e.qualifyingRoundNumber,i=e.finishingPositionOffset,s=e.qualifyingPositions,d=e.matchUpType,p=e.idPrefix,v=e.drawSize,f=e.isMock,m=e.uuids;if(!I(v)||v<2)return{matchUps:[],roundsCount:0};if(c(v))return lI(e);var h=function(e){var t=l(e),r=t%2?t+1:t,n=!!(Math.ceil(r/2)%2),i=[{participantsCount:r,preFeedRound:n}];for(;r>2;){var a=Math.ceil(r/2),o=1===a,u=!(o||!(a%2)),s=!!(2!==(r=!o&&u?a+1:a)&&Math.ceil(r/2)%2);i.push({participantsCount:r,preFeedRound:s,feedRound:u})}return i}(v),g=h.shift(),y=R(1,((null==g?void 0:g.participantsCount)||0)+1).map((function(e){return{drawPosition:e}})),U=[],S=1;U=sI({roundNumber:S,matchUpType:d,idPrefix:p,matchUps:U,isMock:f,nodes:y,uuids:m}).matchUps,S++;var w=e.roundLimit||n;try{for(var T=a(h),P=T.next();!P.done;P=T.next()){var D=P.value.participantsCount/2,b=R(1,D+1);s&&D===s&&(w=S-1);var N=b.map((function(e){var t=uI({roundPosition:e,roundNumber:S,idPrefix:p,uuids:m});return{roundPosition:e,roundNumber:S,matchUpId:t}}));U.push.apply(U,u([],o(N),!1)),S++}}catch(e){t={error:e}}finally{try{P&&!P.done&&(r=T.return)&&r.call(T)}finally{if(t)throw t.error}}var M=S-1;return U=Hp({finishingPositionOffset:i,lucky:!0,roundsCount:M,roundLimit:w,matchUps:U}),w&&(U=U.filter((function(e){return e.roundNumber<=w}))),{matchUps:U,roundsCount:M,roundLimit:w}}function hU(e){var r,n,i,a,s,l=e.playoffAttributes,c=e.stageSequence,d=void 0===c?1:c,p=e.stage,v=void 0===p?iu:p,f=e.matchUpType,m=e.drawSize,h=e.uuids,g=e.structureId||function(){if(e.isMock||e.idPrefix){var t=e.drawDefinition.drawId;return"".concat(t,"-s-0")}}()||(null==h?void 0:h.pop()),I=tl(e).appliedPolicies,y=(null===(n=e.policyDefinitions)||void 0===n?void 0:n[Va])||(null==I?void 0:I[Va]);e.skipRounds=e.skipRounds||m<=4&&((null==y?void 0:y.feedMainFinal)?0:1)||0;var U=null!==(s=null!==(i=e.structureName)&&void 0!==i?i:null===(a=null==l?void 0:l[0])||void 0===a?void 0:a.name)&&void 0!==s?s:ef(iu),S=((r={})[Nu]=function(){var e=tf({finishingPosition:$u,stageSequence:d,structureName:U,matchUps:[],matchUpType:f,structureId:g,stage:v});return t({structures:[e],links:[]},L)},r[Fu]=function(){var r=mU(e).matchUps,n=tf({stageSequence:d,structureName:U,matchUpType:f,structureId:g,matchUps:r,stage:v});return t({structures:[n],links:[]},L)},r[Eu]=function(){return r=lI(e).matchUps,n=tf({stageSequence:d,structureName:U,matchUpType:f,structureId:g,matchUps:r,stage:v}),t({structures:[n],links:[]},L);var r,n},r[Cu]=function(){return fU(e)},r[Ru]=function(){return vI(t(t({},e),{roundOffsetLimit:3,playoffAttributes:null!=l?l:Xu}))},r[Au]=function(){return vI(t(t({},e),{roundOffsetLimit:2,playoffAttributes:null!=l?l:Qu}))},r[su]=function(){return vI(e)},r[Mu]=function(){var e=pI({drawSize:m,uuids:h,matchUpType:f}).matchUps,r=tf({stageSequence:d,structureName:U,matchUpType:f,structureId:g,stage:iu,matchUps:e});return t({structures:[r],links:[]},L)},r[Ou]=function(){return fI(e)},r[xu]=function(){return gI(t(t({},e),{feedRounds:1,fmlc:!0}))},r[Wu]=function(){return gI(t(t({},e),{feedRounds:1}))},r[Lu]=function(){return gI(t(t({},e),{feedsFromFinal:1}))},r[Bu]=function(){return gI(t(t({},e),{feedsFromFinal:2}))},r[Gu]=function(){return gI(t(t({},e),{feedsFromFinal:3}))},r[zu]=function(){return gI(e)},r[ku]=function(){return hI(e)},r[Yu]=function(){return Gf(e)},r[Ku]=function(){return function(e){var r=e.drawDefinition,n=e.structureOptions,i=e.requireSequential,a=Gf(t(t({structureName:ef(iu)},e),{stage:iu})),s=a.structures,l=a.groupCount,c=a.groupSize;if(l<1)return{error:Mr};var d=(null==n?void 0:n.playoffGroups)||[{finishingPositions:[1],structureName:ef(su)}],p=o(s,1)[0],v=II(t({sourceStructureId:p.structureId,requireSequential:i,drawDefinition:r,playoffGroups:d,groupCount:l,groupSize:c},e)),f=v.structures,m=v.links;return f&&s.push.apply(s,u([],o(f),!1)),t(t({},L),{structures:s,links:m})}(e)},r);return{generators:S}}function gU(e){var r,n,i,s,d,p,v,f,m,h,g,I=e||{},y=I.enforceMinimumDrawSize,U=void 0===y||y,S=I.overwriteExisting,w=I.appliedPolicies,T=I.staggeredEntry,P=I.drawDefinition,D=I.tieFormat,b=I.drawSize,N=I.isMock,M=I.uuids,R=null!==(d=e.drawTypeCoercion)&&void 0!==d?d:vU({appliedPolicies:w,drawType:e.drawType}),A="generateDrawStructuresAndLinks",E=R&&2===e.drawSize&&Eu||e.drawType||Eu,C=[],x=[],O=null!==(p=null==e?void 0:e.matchUpType)&&void 0!==p?p:Es,F=null===(v=null==P?void 0:P.structures)||void 0===v?void 0:v.filter((function(e){return e.stage===au}));F&&C.push.apply(C,u([],o(F),!1));var k=null==F?void 0:F.map((function(e){return e.structureId})),_=null===(f=null==P?void 0:P.structures)||void 0===f?void 0:f.find((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r})),j=null===(m=null==P?void 0:P.links)||void 0===m?void 0:m.filter((function(e){return e.target.structureId===(null==_?void 0:_.structureId)&&(null==k?void 0:k.includes(e.source.structureId))})),B=function(e,t){var r;if(e.linkType===Tu&&(null==t?void 0:t.structures)){var n=e.source.finishingPositions||[];return t.structures.length*n.length}if(e.linkType===Pu&&(null===(r=null==t?void 0:t.matchUps)||void 0===r?void 0:r.length)){var i=e.source.roundNumber,a=t.matchUps.filter((function(e){return e.roundNumber===i}));return a.length}},V=null==F?void 0:F.map((function(e){var t,r,n,i,a=null==j?void 0:j.find((function(t){return t.target.structureId===e.structureId})),o=null!==(n=null===(r=null===(t=ss({structure:e}))||void 0===t?void 0:t.positionAssignments)||void 0===r?void 0:r.length)&&void 0!==n?n:0;if(!a)return o;var u=null==a?void 0:a.source.structureId,s=null===(i=P.structures)||void 0===i?void 0:i.find((function(e){return e.structureId===u}));return o-(B(a,s)||0)})).filter(Boolean).reduce((function(e,t){return e+t}),0),G=null==j?void 0:j.map((function(e){var t=e.source.structureId,r=null==F?void 0:F.find((function(e){return e.structureId===t}));return B(e,r)})).filter(Boolean).reduce((function(e,t){return e+t}),0),q=!(!_||(null===(h=null==_?void 0:_.matchUps)||void 0===h?void 0:h.length));if((null==F?void 0:F.length)&&!q)return{error:Hr};var W=!(null==F?void 0:F.length)&&e.qualifyingProfiles,H=(null==W?void 0:W.length)&&dU({idPrefix:e.idPrefix,qualifyingProfiles:W,appliedPolicies:w,isMock:N,uuids:M});if(null==H?void 0:H.error)return H;var z=H||{qualifyingDrawPositionsCount:V,qualifiersCount:G},Y=z.qualifyingDrawPositionsCount,K=z.qualifyingDetails,J=z.qualifiersCount;Y&&((null==H?void 0:H.structures)&&C.push.apply(C,u([],o(H.structures),!1)),(null==H?void 0:H.links)&&x.push.apply(x,u([],o(H.links),!1))),Object.assign(e,xn({drawSize:b,matchUpType:O,tieFormat:D}));var Z=E!==Nu&&(!b||isNaN(b)||b<2||!T&&![Mu,Fu].includes(E)&&([Ku,Yu].includes(E)&&b<3||![Yu,Ku].includes(E)&&!c(b)));if(Z&&!Y)return On({context:{drawSize:b,invalidDrawSize:Z},result:{error:le},stack:A});var X=ts.includes(E);if(b&&l(b)<4&&X)if(R)E=Eu;else if(U)return On({context:{enforceMinimumDrawSize:U,invalidDrawSize:Z,drawSize:b,drawType:E},result:{error:le},stack:A});var Q=hU(e),$=Q.generators,ee=Q.error;if(ee)return{error:ee};var te=$[E];if(!te)return{error:ne};var re=null==te?void 0:te();if(re.error)return re;var ie=re.structures,ae=re.links;if(null==ie?void 0:ie.length){var oe=ie.find((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r}));if(_&&oe)if(q){var ue=oe.structureId;if(oe.structureId=_.structureId,null==ae?void 0:ae.length)try{for(var se=a(ae),ce=se.next();!ce.done;ce=se.next()){(fe=ce.value).source.structureId===ue&&(fe.source.structureId=_.structureId),fe.target.structureId===ue&&(fe.target.structureId=_.structureId)}}catch(e){r={error:e}}finally{try{ce&&!ce.done&&(n=se.return)&&n.call(se)}finally{if(r)throw r.error}}}else if(!S)return{error:Hr};C.push.apply(C,u([],o(ie),!1))}C.sort(ns),(null==ae?void 0:ae.length)&&x.push.apply(x,u([],o(ae),!1));var de=re.structures.find((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r}));try{for(var pe=a(K||[]),ve=pe.next();!ve.done;ve=pe.next()){var fe,me=ve.value,he=me.finalQualifyingRoundNumber,ge=me.finalQualifyingStructureId,Ie=me.roundTarget,ye=me.finishingPositions,Ue=me.linkType;if(null==(fe=de&&(null===(g=oI({targetStructureId:de.structureId,sourceStructureId:ge,sourceRoundNumber:he,finishingPositions:ye,targetEntryRound:Ie,linkType:Ue}))||void 0===g?void 0:g.link))?void 0:fe.error)return fe;fe&&x.push(fe)}}catch(e){i={error:e}}finally{try{ve&&!ve.done&&(s=pe.return)&&s.call(pe)}finally{if(i)throw i.error}}return j&&x.push.apply(x,u([],o(j),!1)),t(t({},L),{qualifyingResult:{qualifyingDrawPositionsCount:Y,qualifiersCount:J},structures:C,links:x})}function IU(e){var r,n,i,a,o,u=e||{},s=u.modifyOriginal,l=void 0===s||s,c=u.stageSequence,d=void 0===c?1:c,p=u.isMock,v="generateDrawTypeAndModifyDrawDefinition";if(!e.drawDefinition)return On({result:{error:K},stack:v});var f=l?e.drawDefinition:Ui(e.drawDefinition,!1,!0),m=e.tieFormat,h=e.matchUpType;if(m){var g=zm({tieFormat:m});if(g.error)return g}m=bm(null!=m?m:null===(r=Gd({drawDefinition:f}))||void 0===r?void 0:r.tieFormat),h=null!=h?h:f.matchUpType||Es,e.tieFormat=m,e.matchUpType=h;var I=Cv({drawDefinition:f,stage:iu});e.drawSize=null!==(n=e.drawSize)&&void 0!==n?n:I,!I&&e.drawSize&&Qg({drawSize:e.drawSize,drawDefinition:f,stageSequence:d,stage:iu});var y=fl({drawDefinition:f}).drawMatchUps.map(Ro),U=gU(e);if(U.error)return On({result:U,stack:v});var S=U.structures,w=U.links,T=U.qualifyingResult;f.structures=S,f.links=w;var P=Math.max(null!==(i=e.qualifiersCount)&&void 0!==i?i:0,(null==T?void 0:T.qualifiersCount)||0);if((null==T?void 0:T.qualifyingDrawPositionsCount)&&!Cv({stage:au,drawDefinition:f})){var D=Qg({drawSize:T.qualifyingDrawPositionsCount,stage:au,drawDefinition:f});if(D.error)return D}if(P){var b=$g({qualifiersCount:P,drawDefinition:f,stage:iu});if(b.error)return b}var N=null!==(a=e.drawSize)&&void 0!==a?a:I;Object.assign(e,xn({drawSize:N,matchUpType:h,tieFormat:m}));var M=Ip({drawDefinition:f}),R=M.matchUps,A=M.matchUpsMap;m&&(null==R||R.forEach((function(e){if(!y.includes(e.matchUpId)){var t=Ym({tieFormat:m,matchUp:e,isMock:p}).tieMatchUps;Object.assign(e,{tieMatchUps:t,matchUpType:h})}})));var E=zp({drawDefinition:f,matchUpsMap:A}).inContextDrawMatchUps;return Op({tournamentId:null===(o=e.tournamentRecord)||void 0===o?void 0:o.tournamentId,drawDefinition:f}),t(t({inContextDrawMatchUps:E,drawDefinition:f,matchUpsMap:A},L),{structures:S,matchUps:R,links:w})}function yU(e){var t=e.tournamentRecord,r=e.categoryName,n=e.categoryType;if(!t)return{error:W};var i=tl({tournamentRecord:t}).appliedPolicies,a=null==i?void 0:i[Ga];return((null==a?void 0:a.allowedDrawTypes)||[]).filter((function(e){var t=e.categoryNames,i=e.categoryTypes;return!r&&!i||r&&(null==t?void 0:t.includes(r))||n&&(null==i?void 0:i.includes(n))}))}function UU(e){var r,n,i,a,s,l=e.consideredEntries,c=e.policyDefinitions,d=e.tournamentRecord,p=e.appliedPolicies,v=e.participantMap,f=e.enforceGender,m=e.participants,h=e.event;if(m&&v||!d||(m=(r=Rv({tournamentRecord:d})).participants,v=r.participantMap),!m)return{error:kt};if(!Array.isArray(m))return{error:xr};if(!h)return{error:Ae};var g=null!==(i=null!==(n=null==c?void 0:c[Ca])&&void 0!==n?n:null==p?void 0:p[Ca])&&void 0!==i?i:jv[Ca],I=!1!==(null!=f?f:null===(a=null==g?void 0:g.participants)||void 0===a?void 0:a.enforceGender),y=h.eventType,S=h.gender,w=y===ha,T=y===Ia&&gs||w&&hs||fs,P=Object.assign.apply(Object,u([{}],o((null!==(s=null!=l?l:h.entries)&&void 0!==s?s:[]).map((function(e){var t;return(t={})[e.participantId]=e.entryStatus,t}))),!1)),D=Object.keys(P),b=m.filter((function(e){return D.includes(e.participantId)})).filter((function(e){var t,r,n,i,a=P[e.participantId],o=y&&[ha,Ia].includes(y)&&e.participantType===fs&&(hv(a)||a===xl),u=e.participantType!==T&&!o,s=!u&&w&&U(null!==(r=null===(t=null==e?void 0:e.individualParticipantIds)||void 0===t?void 0:t.map((function(e){var t,r,n;return null===(n=null===(r=null===(t=null==v?void 0:v[e])||void 0===t?void 0:t.participant)||void 0===r?void 0:r.person)||void 0===n?void 0:n.sex})).filter(Boolean))&&void 0!==r?r:[]),l=!S||!(null==s?void 0:s.length)||lp===S||[cp,vp].includes(S)&&s[0]===S||dp===S&&(1==s.length&&1===(null===(n=e.individualParticipantIds)||void 0===n?void 0:n.length)||2===s.length),c=null===(i=null==e?void 0:e.person)||void 0===i?void 0:i.sex,d=!(null==e?void 0:e.person)||!S||[lp,dp].includes(S)||[cp,vp].includes(S)&&c===S;return u||!(!I||l&&d)}));if(b.length){var N=b.map((function(e){return e.participantId}));return{error:Oe,invalidParticipantIds:N}}return t(t({},L),{valid:!0})}var SU,wU,TU=function(){return{matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}};function PU(e){var r,n="prepareStage",i=e.seedsCount,a=e.preparedStructureIds||[],s=e.provisionalPositioning,l=e.inContextDrawMatchUps,c=e.tournamentRecord,d=e.appliedPolicies,p=e.qualifyingOnly,v=e.drawDefinition,f=e.seedingProfile,m=e.matchUpsMap,h=e.automated,g=e.placeByes,y=e.drawType,U=e.drawSize,S=e.entries,w=e.event,T=e.enforcePolicyLimits,P=void 0===T||T,D=e.seedAssignmentProfile,b=e.seedByRanking,N=void 0===b||b,M=e.seededParticipants,A=e.assignSeedsCount,E=e.seedingScaleName,C=e.stageSequence,x=void 0===C?1:C,O=e.roundTarget,F=e.stage,k=null==w?void 0:w.eventType,_=S.filter((function(e){var t,r,n=null===(r=null===(t=Vn({name:fo,element:e}))||void 0===t?void 0:t.extension)||void 0===r?void 0:r.value;return(!e.entryStage||e.entryStage===F)&&(!x||!e.entryStageSequence||e.entryStageSequence===x)&&(!O||!n||n===O)&&kl.includes(e.entryStatus)}));M&&(i=M.length),i>U&&(i=U),i>_.length&&(i=_.length);var j=os({drawDefinition:v,stageSequence:x,roundTarget:O,stage:F}).structures,B=((null==j?void 0:j.length)||0)>1,V=null==j?void 0:j.find((function(e){var t=e.structureId;return!a.includes(t)}));if(!V)return On({result:{error:De},stack:n});var G=null==V?void 0:V.structureId,q=V?Kf({provisionalPositioning:s,appliedPolicies:d,drawDefinition:v,seedingProfile:f,structure:V}):void 0,W=function(e){var r,n,i=e.requireParticipantCount,a=void 0===i||i,s=e.enforcePolicyLimits,l=void 0===s||s,c=e.drawSizeProgression,d=e.participantsCount,p=e.participantCount,v=e.appliedPolicies,f=e.drawDefinition,m=e.seedingProfile,h=e.structureId,g=e.seedsCount;d=null!=d?d:p;var y=as({drawDefinition:f,structureId:h});if(y.error)return y;var U=y.structure;if(!U)return{error:De};var S=ls({structure:U}).positionAssignments,w=(null==S?void 0:S.length)||0;if(g>w)return{error:me};var T=null===(r=U.structures)||void 0===r?void 0:r.length,P=I(null==m?void 0:m.groupSeedingThreshold)&&(null==m?void 0:m.groupSeedingThreshold),D=null===(n=Hf({roundRobinGroupsCount:T,drawSize:w}))||void 0===n?void 0:n.seedGroups,b=sy({policyDefinitions:v,requireParticipantCount:a,drawSizeProgression:c,participantsCount:d,drawSize:w}).seedsCount;return b&&(null==v?void 0:v[Ba])&&g>b&&l&&(g=b),U.seedLimit=g,U.seedAssignments=R(1,g+1).map((function(e){var t=null==D?void 0:D.find((function(t){return t.includes(e)})),r=t&&Math.min.apply(Math,u([],o(t),!1));return{participantId:void 0,seedNumber:e,seedValue:P&&e>=P?r:e}})),Op({drawDefinition:f,structureIds:[h]}),t(t({},L),{seedLimit:g})}({participantsCount:_.length,enforcePolicyLimits:P,appliedPolicies:d,drawDefinition:v,seedingProfile:f,structureId:G,seedsCount:i}).seedLimit;W&&W<i&&(i=W);var H=S.map(Mo);if(M)M.filter((function(e){var t=e.participantId;return H.includes(t)})).filter((function(e){return!e.seedNumber||e.seedNumber<=M.length})).sort((function(e,t){return e.seedNumber<t.seedNumber?-1:e.seedNumber<t.seedNumber?1:0})).forEach((function(e){var t=e.participantId,r=e.seedNumber,n=e.seedValue;$f({provisionalPositioning:s,tournamentRecord:c,drawDefinition:v,seedingProfile:f,participantId:t,seedBlockInfo:q,structureId:G,seedNumber:r,seedValue:n,event:w})}));else if(w||E){var z=(null==w?void 0:w.category)||{},Y=z.categoryName,K=z.ageCategoryCode,J=py({scaleAttributes:{scaleType:Pa,scaleName:E||Y||K||w.eventId,eventType:k},tournamentRecord:c,stageSequence:x,entries:S,stage:F}).scaledEntries;if(!(null==J?void 0:J.length)&&N)J=py({scaleAttributes:{scaleName:Y||K,scaleType:Sa,eventType:k},tournamentRecord:c,stageSequence:x,entries:S,stage:F}).scaledEntries;var Z=null!==(r=null==J?void 0:J.length)&&void 0!==r?r:0;Z<i&&(i=Z),null==J||J.filter((function(e){var t=e.participantId;return H.includes(t)})).slice(0,A||i).forEach((function(e,t){var r=t+1,n=e.participantId,i=e.scaleValue,a=(null==D?void 0:D[r])||i||r;$f({provisionalPositioning:s,tournamentRecord:c,drawDefinition:v,seedingProfile:f,participantId:n,structureId:G,seedNumber:r,seedValue:a,event:w})}))}var X,Q,$=[];if(!1!==h&&y!==Nu&&(!p||F===au)){var ee="object"==typeof h&&h.seedsOnly,te=Eh({inContextDrawMatchUps:l,multipleStructures:B,tournamentRecord:c,appliedPolicies:d,drawDefinition:v,seedingProfile:f,structureId:G,matchUpsMap:m,placeByes:g,seedLimit:W,seedsOnly:ee,drawSize:U,drawType:y,event:w});if(te.conflicts&&($=null==te?void 0:te.conflicts),X=null==te?void 0:te.positionAssignments,Q=null==te?void 0:te.positioningReport,te.error)return On({result:te,stack:n})}return{positionAssignments:X,positioningReport:Q,stageEntries:_,structureId:G,seedsCount:i,conflicts:$}}var DU=((SU={})[Ba]={validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:(wU={},wU[Ku]={positioning:hu},wU[Yu]={positioning:hu},wU),positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]},SU);function bU(e){var r,n,i,s,c,d,p,v,f,m,g,y,U,S,w,T,P,D,b,N,M,A,E,C,x,O,F,k,_,j,B,V,G,q,W,H,z,Y,K,J,Z,X,Q,$,ee,te,re,ne,ie,ae,oe,ue,le,ce,pe,ve,fe,me,he,ge,Ie,ye,Ue="generateDrawDefinition",Se=e.considerEventEntries,we=void 0===Se||Se,Te=e.ignoreAllowedDrawTypes,Pe=e.voluntaryConsolation,De=e.hydrateCollections,be=e.ignoreStageSpace,Ne=e.tournamentRecord,Me=e.qualifyingOnly,Re=e.tieFormatName,Ae=e.drawEntries,Ee=e.placeByes,Ce=e.event,xe=null===(T=e.isMock)||void 0===T||T,Oe=e.idPrefix,Fe=null!==(P=tl({tournamentRecord:Ne,event:Ce}).appliedPolicies)&&void 0!==P?P:{},ke=Ui(null!==(D=e.policyDefinitions)&&void 0!==D?D:{},!1,!0),_e=(null!==(b=e.drawTypeCoercion)&&void 0!==b?b:vU({drawType:e.drawType,policyDefinitions:ke,appliedPolicies:Fe}))&&2===e.drawSize&&Eu||e.drawType||Eu,Le=null!==(N=null==ke?void 0:ke[Ba])&&void 0!==N?N:null==Fe?void 0:Fe[Ba],je=null!==(C=null!==(M=e.seedingProfile)&&void 0!==M?M:null===(E=null===(A=null==Le?void 0:Le.seedingProfile)||void 0===A?void 0:A.drawTypes)||void 0===E?void 0:E[_e])&&void 0!==C?C:null==Le?void 0:Le.seedingProfile;e.seedingProfile&&(ke[Ba]||(ke[Ba]=t({},DU[Ba])),ke[Ba].seedingProfile=je);var Be=Rv({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:Ne}),Ve=Be.participants,Ge=Be.participantMap,qe=null!==(k=null!==(x=e.enforceGender)&&void 0!==x?x:null===(F=null===(O=null==ke?void 0:ke[Ca])||void 0===O?void 0:O.participants)||void 0===F?void 0:F.enforceGender)&&void 0!==k?k:null===(j=null===(_=null==Fe?void 0:Fe[Ca])||void 0===_?void 0:_.participants)||void 0===j?void 0:j.enforceGender,We=!Te&&Ne&&yU({tournamentRecord:Ne,categoryType:null===(B=null==Ce?void 0:Ce.category)||void 0===B?void 0:B.categoryType,categoryName:null===(V=null==Ce?void 0:Ce.category)||void 0===V?void 0:V.categoryName});if((null==We?void 0:We.length)&&!We.includes(_e))return On({result:{error:se},stack:Ue});var He=null!==(q=null===(G=null==Ce?void 0:Ce.entries)||void 0===G?void 0:G.filter((function(e){return e.entryStatus&&u(u([],o(_l),!1),[Ml],!1).includes(e.entryStatus)})))&&void 0!==q?q:[],ze=(Me&&[]||Ae||(we?He:[])).filter((function(e){var t=e.entryStage;return!t||t===iu})),Ye=Ce&&Ve&&UU({consideredEntries:ze,appliedPolicies:Fe,participantMap:Ge,enforceGender:qe,participants:Ve,event:Ce});if(null==Ye?void 0:Ye.error)return On({result:Ye,stack:Ue});var Ke=!e.drawSize&&ze.length&&![Nu,Cu,Mu,Yu,Ku].includes(_e)&&h(ze.length)||e.drawSize&&I(e.drawSize)&&l(e.drawSize)||!1;if(isNaN(Ke)&&_e!==Nu)return On({result:{error:de},stack:Ue});var Je="number"!=typeof e.seedsCount?l(null!==(W=e.seedsCount)&&void 0!==W?W:0):null!==(H=e.seedsCount)&&void 0!==H?H:0,Ze=null==Ce?void 0:Ce.eventType,Xe=null!==(z=e.matchUpType)&&void 0!==z?z:Ze,Qe=e.drawId?null===(Y=null==Ce?void 0:Ce.drawDefinitions)||void 0===Y?void 0:Y.find((function(t){return t.drawId===e.drawId})):void 0,$e=e.tieFormat,et=e.matchUpFormat;if(Xe===Fs&&Ze===Fs){var tt=null===(J=null===(K=null==Qe?void 0:Qe.structures)||void 0===K?void 0:K.find((function(e){return e.stage===iu})))||void 0===J?void 0:J.tieFormat;$e=$e||tt||Re&&(null===(Z=null==Ce?void 0:Ce.tieFormat)||void 0===Z?void 0:Z.tieFormatName)===Re&&Ce.tieFormat||Re&&tU({namedFormat:Re,hydrateCollections:De,isMock:xe,event:Ce})||(null==Ce?void 0:Ce.tieFormat)||tU({event:Ce,isMock:xe,hydrateCollections:De}),et=void 0}else et||($e=void 0,(null==Ce?void 0:Ce.matchUpFormat)||(et=Fh));if($e&&(nt=zm({gender:null==Ce?void 0:Ce.gender,enforceGender:qe,tieFormat:$e})).error)return On({result:nt,stack:Ue});if(e.drawId&&"string"!=typeof e.drawId)return On({result:{error:xr},stack:Ue});Qe&&_e!==Qe.drawType&&(Qe.drawType=_e);var rt=null!=Qe?Qe:function(e){var t=null!=e?e:{},r=t.drawId,n=void 0===r?ed():r,i=t.processCodes,a=t.matchUpType,o=t.drawType,u=TU();return Object.assign(u,{processCodes:i,matchUpType:a,drawType:o,drawId:n})}({drawType:_e,drawId:e.drawId,processCodes:e.processCodes});if((et||$e)&&!(et&&(null==Ce?void 0:Ce.matchUpFormat)===et||(null==Ce?void 0:Ce.tieFormat)&&$e&&JSON.stringify(Ce.tieFormat)===JSON.stringify($e))){if($e){var nt=function(e){var t,r,n=e.tieFormat,i=zm({checkCollectionIds:!1,tieFormat:n});if(i.error)return i;try{for(var o=a(n.collectionDefinitions),u=o.next();!u.done;u=o.next()){var s=u.value;s.collectionId||(s.collectionId=ed())}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return{tieFormat:n}}({tieFormat:$e});if(nt.error)return On({result:nt,stack:Ue});rt.tieFormat=null!==(X=nt.tieFormat)&&void 0!==X?X:$e}else if(et){if((nt=dI({tournamentRecord:Ne,drawDefinition:rt,matchUpFormat:et,event:Ce})).error)return{error:nt.error,info:"matchUpFormat or tieFormat error"}}Xe&&(rt.matchUpType=Xe)}var it=((r={})[La]=Fe[La],r);if(ke){if("object"!=typeof ke)return On({info:"policyDefinitions must be an object",result:{error:xr},stack:Ue});try{for(var at=a(Object.keys(ke)),ot=at.next();!ot.done;ot=at.next()){var ut=ot.value;JSON.stringify(null==Fe?void 0:Fe[ut])!==JSON.stringify(ke[ut])&&(it[ut]=ke[ut])}}catch(e){n={error:e}}finally{try{ot&&!ot.done&&(i=at.return)&&i.call(at)}finally{if(n)throw n.error}}Object.keys(it).length&&(EI({policyDefinitions:it,drawDefinition:rt}),Object.assign(Fe,it))}else it.avoidance&&EI({drawDefinition:rt,policyDefinitions:it});Fe[Ba]||ke[Ba]||(EI({policyDefinitions:DU,drawDefinition:rt}),Object.assign(Fe,DU));var st,lt=null===($=null===(Q=null==Qe?void 0:Qe.structures)||void 0===Q?void 0:Q.find((function(e){return e.stage===iu&&1===e.stageSequence})))||void 0===$?void 0:$.structureId,ct=null!=Ae?Ae:He,dt=[],vt=[],ft=e.qualifyingPlaceholder&&!(null===(ee=e.qualifyingProfiles)||void 0===ee?void 0:ee.length)&&!Qe,mt=Qe?null===(te=Qe.structures)||void 0===te?void 0:te.filter((function(e){return e.stage===au})):[],ht=1===(null==mt?void 0:mt.length)&&!(null===(re=mt[0].matchUps)||void 0===re?void 0:re.length)&&mt[0].structureId;if(ht){var gt=e.qualifyingProfiles,It=(null==gt?void 0:gt.length)?dU({uuids:e.uuids,qualifyingProfiles:gt,appliedPolicies:Fe,idPrefix:Oe,isMock:xe}):void 0;if(null==It?void 0:It.error)return It;rt.structures=null===(ne=rt.structures)||void 0===ne?void 0:ne.filter((function(e){return e.structureId!==ht})),rt.links=null===(ie=rt.links)||void 0===ie?void 0:ie.filter((function(e){return e.source.structureId!==ht}));var yt=null!=It?It:{},Ut=yt.qualifiersCount,St=yt.qualifyingDrawPositionsCount,wt=yt.qualifyingDetails;St&&((null==It?void 0:It.structures)&&(null===(ae=rt.structures)||void 0===ae||ae.push.apply(ae,u([],o(It.structures),!1))),(null==It?void 0:It.links)&&(null===(oe=rt.links)||void 0===oe||oe.push.apply(oe,u([],o(It.links),!1))));var Tt=null===(ue=rt.structures)||void 0===ue?void 0:ue.find((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r})),Pt=Ev({stageSequence:1,drawDefinition:rt,structureId:lt,stage:iu}).qualifiersCount;if((nt=$g({qualifiersCount:Math.max(null!=Ut?Ut:0,null!=Pt?Pt:0),drawDefinition:rt,stage:iu})).error)return nt;if((nt=Qg({drawSize:St,stage:au,drawDefinition:rt})).error)return nt;try{for(var Dt=a((null!=Ae?Ae:[]).filter((function(e){return e.entryStage===au}))),bt=Dt.next();!bt.done;bt=Dt.next()){var Nt=bt.value;Fv(t(t({},Nt),{entryStage:null!==(le=Nt.entryStage)&&void 0!==le?le:iu,drawDefinition:rt}))}}catch(e){s={error:e}}finally{try{bt&&!bt.done&&(c=Dt.return)&&c.call(Dt)}finally{if(s)throw s.error}}try{for(var Mt=a(wt||[]),Rt=Mt.next();!Rt.done;Rt=Mt.next()){var At=Rt.value,Et=At.finalQualifyingRoundNumber,Ct=At.finalQualifyingStructureId,xt=At.roundTarget,Ot=At.finishingPositions,Ft=At.linkType;if(null==(cr=Tt&&(null===(ce=oI({targetStructureId:Tt.structureId,sourceStructureId:Ct,sourceRoundNumber:Et,finishingPositions:Ot,targetEntryRound:xt,linkType:Ft}))||void 0===ce?void 0:ce.link))?void 0:cr.error)return cr;cr&&(rt.links||(rt.links=[]),rt.links.push(cr))}}catch(e){d={error:e}}finally{try{Rt&&!Rt.done&&(p=Mt.return)&&p.call(Mt)}finally{if(d)throw d.error}}st={drawDefinition:rt}}else{if((st=IU(t(t({},e),{modifyOriginal:!1,tournamentRecord:Ne,appliedPolicies:Fe,drawDefinition:rt,matchUpFormat:et,matchUpType:Xe,tieFormat:$e,drawSize:Ke,isMock:xe}))).error)return On({result:st,stack:Ue});rt=st.drawDefinition;try{for(var kt=a(ct),_t=kt.next();!_t.done;_t=kt.next()){Nt=_t.value;if(!Ae||!Nt.entryStage||Nt.entryStage===iu){nt=Fv(t(t({},Nt),{ignoreStageSpace:null!=be?be:_e===Nu,entryStage:null!==(pe=Nt.entryStage)&&void 0!==pe?pe:iu,drawDefinition:rt,drawType:_e}));if(Ae&&nt.error)return On({result:nt,stack:Ue})}}}catch(e){v={error:e}}finally{try{_t&&!_t.done&&(f=kt.return)&&f.call(kt)}finally{if(v)throw v.error}}_e===Fu&&(Je=0);var Lt=PU(t(t(t({},st),e),{qualifyingOnly:!Ke||Me,appliedPolicies:Fe,drawDefinition:rt,seedingProfile:je,participants:Ve,stage:iu,seedsCount:Je,placeByes:Ee,drawSize:Ke,entries:ct}));if(Lt.error&&!Lt.conflicts)return Lt;if((null===(ve=Lt.positioningReport)||void 0===ve?void 0:ve.length)&&dt.push(((m={})[iu]=Lt.positioningReport,m)),lt=Lt.structureId,Lt.conflicts&&(vt=Lt.conflicts),_e===Nu&&e.roundsCount){var jt=null===(fe=null==Ce?void 0:Ce.entries)||void 0===fe?void 0:fe.filter((function(e){var t=e.entryStage,r=e.entryStatus;return(!t||t===iu)&&r&&_l.includes(r)})),Bt=null==jt?void 0:jt.map(Ri("participantId")),Vt=jt?Math.floor(jt.length/2):0;R(1,e.roundsCount+1).forEach((function(){var t,r,n;if(e.automated){var i=null!==(t=e.drawMatic)&&void 0!==t?t:{},a=i.restrictEntryStatus,o=i.generateMatchUps,u=i.structureId,s=i.matchUpIds,l=i.scaleName,c=ty({eventType:null!==(n=null===(r=e.drawMatic)||void 0===r?void 0:r.eventType)&&void 0!==n?n:Xe,generateMatchUps:null==o||o,restrictEntryStatus:a,tournamentRecord:Ne,participantIds:Bt,drawDefinition:rt,structureId:u,matchUpIds:s,scaleName:l,idPrefix:Oe,isMock:xe,event:Ce}).matchUps;ny({tournamentRecord:Ne,drawDefinition:rt,structureId:u,matchUps:c})}else{c=_I({newRound:!0,drawDefinition:rt,matchUpsCount:Vt,idPrefix:Oe,isMock:xe,event:Ce}).matchUps;ny({tournamentRecord:Ne,drawDefinition:rt,structureId:lt,matchUps:c})}}))}}var Gt=[];if(e.qualifyingProfiles){var qt=function(e,t){return e.stageSequence-t.stageSequence},Wt=[],Ht=1;e.qualifyingProfiles.sort((function(e,t){return e.roundTarget-t.roundTarget}));try{for(var zt=a(e.qualifyingProfiles),Yt=zt.next();!Yt.done;Yt=zt.next()){var Kt=Yt.value;if(!Array.isArray(Kt.structureProfiles))return On({info:rm("structureProfiles"),result:{error:pt},stack:Ue});Ht=Kt.roundTarget||Ht;var Jt=(null===(me=Kt.structureProfiles)||void 0===me?void 0:me.sort(qt))||[],Zt=1;try{for(var Xt=(U=void 0,a(Jt)),Qt=Xt.next();!Qt.done;Qt=Xt.next()){var $t=Qt.value,er=(Et=$t.qualifyingRoundNumber,$t.qualifyingPositions),tr=$t.seededParticipants,rr=$t.seedingScaleName,nr=$t.seedsCount,ir=void 0===nr?0:nr,ar=$t.seedByRanking,or=$t.placeByes,ur=$t.drawSize,sr=PU(t(t(t({},st),e),{seedingProfile:null!==(he=$t.seedingProfile)&&void 0!==he?he:je,stageSequence:Zt,qualifyingRoundNumber:Et,preparedStructureIds:Wt,qualifyingPositions:er,seededParticipants:tr,stage:au,seedingScaleName:rr,appliedPolicies:Fe,drawDefinition:rt,qualifyingOnly:Me,seedByRanking:ar,participants:Ve,roundTarget:Ht,seedsCount:ir,placeByes:or,drawSize:ur,entries:ct}));if(sr.error)return sr;sr.structureId&&Wt.push(sr.structureId),Zt+=1,(null===(ge=sr.conflicts)||void 0===ge?void 0:ge.length)&&Gt.push.apply(Gt,u([],o(sr.conflicts),!1)),(null===(Ie=sr.positioningReport)||void 0===Ie?void 0:Ie.length)&&dt.push(((w={})[au]=sr.positioningReport,w))}}catch(e){U={error:e}}finally{try{Qt&&!Qt.done&&(S=Xt.return)&&S.call(Xt)}finally{if(U)throw U.error}}Ht+=1}}catch(e){g={error:e}}finally{try{Yt&&!Yt.done&&(y=zt.return)&&y.call(zt)}finally{if(g)throw g.error}}}else if(lt&&ft){var lr=tf({structureName:ef(au),stage:au}),cr=oI({sourceStructureId:lr.structureId,targetStructureId:lt,sourceRoundNumber:0,linkType:Tu}).link;rt.structures||(rt.structures=[]),rt.structures.push(lr),rt.links||(rt.links=[]),rt.links.push(cr)}return rt.drawName=null!==(ye=e.drawName)&&void 0!==ye?ye:_e&&ef(_e),"object"==typeof Pe&&Ke>=4&&rf(t(t({},Pe),{drawDefinition:rt,matchUpType:Xe})),t(t({existingDrawDefinition:!!Qe,qualifyingConflicts:Gt,positioningReports:dt,drawDefinition:rt,structureId:lt},L),{conflicts:vt})}var NU="splitWaterfall",MU="splitShuttle",RU={SPLIT_LEVEL_BASED:"splitLevelBased",SPLIT_WATERFALL:NU,SPLIT_SHUTTLE:MU};var AU="ASC",EU="DESC",CU={ASC:"ASC",ASCENDING:AU,DESC:"DESC",DESCENDING:EU};function xU(e){var r,n,i,o,u,s,l,c,d,p,v,m,h,g,I,y=e.tieFormat,U=e.useDefaultEventRanking,S=e.tournamentRecord,w=e.drawDefinition,T=e.scaleAccessor,P=e.singlesOnly,D=e.attach,b=e.event;if((null==b?void 0:b.eventType)!==Ia)return{error:Re};if(!S)return{error:W};if(!y&&!w)return{error:Z};if(zm({tieFormat:y=null!=y?y:null===(u=Gd({drawDefinition:w,event:b}))||void 0===u?void 0:u.tieFormat}).error)return{error:He};if("object"!=typeof T&&!U)return{error:xr,context:{scaleAccessor:T}};var N={},M=(null!==(l=null!==(s=null==w?void 0:w.entries)&&void 0!==s?s:null==b?void 0:b.entries)&&void 0!==l?l:[]).filter((function(e){return(null==e?void 0:e.entryStatus)===Tl})).map(Mo),A=Rv({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:S}).participants,E=void 0===A?[]:A,C=E.filter((function(e){var t=e.participantId;return M.includes(t)})),x=null!==(d=null===(c=null==b?void 0:b.category)||void 0===c?void 0:c.categoryName)&&void 0!==d?d:null===(p=null==b?void 0:b.category)||void 0===p?void 0:p.ageCategoryCode,O=T||{},F=O.scaleName,k=void 0===F?x:F,_=O.scaleType,j=void 0===_?Sa:_,B=O.sortOrder,V=O.accessor,G=j===Sa?"rankings":"ratings",q=function(e,t){var r,n,i,a=null===(r=e[G])||void 0===r?void 0:r[t];if(!a&&U&&(a=null===(n=e[G])||void 0===n?void 0:n[As]),Array.isArray(a)){var o=null===(i=a.find((function(e){return e.scaleName===k})))||void 0===i?void 0:i.scaleValue;if(f(o))return o;if(V&&"object"==typeof o)return o[V]}return 0},H=function(e,t,r){var n=B===EU?e:t;return q(B===EU?t:e,r)-q(n,r)},z=function(e,t){return H(e,t,As)},Y=function(e,t){return H(e,t,Cs)},K=[],J=null!==(v=null==y?void 0:y.collectionDefinitions)&&void 0!==v?v:[],X=function(e){var t,r,n=null!==(h=null===(m=e.individualParticipants)||void 0===m?void 0:m.sort(z))&&void 0!==h?h:[],i=P?n:null!==(I=null===(g=e.individualParticipants)||void 0===g?void 0:g.sort(Y))&&void 0!==I?I:[],o={},u=function(e){var t=[],r=e.collectionId,a=e.matchUpCount,u=e.matchUpType,s=e.gender,l=u===As;R(0,a).forEach((function(e){var a=l?n:null!=i?i:[],u=e+1,c=[];R(0,l?1:2).forEach((function(e){var n,i=null===(n=null==a?void 0:a.find((function(r){var n,i=s&&([cp,vp].includes(s)&&s||s===dp&&[cp,vp][e]);return!(i&&i!==(null===(n=r.person)||void 0===n?void 0:n.sex)||t.includes(r.participantId))})))||void 0===n?void 0:n.participantId;i&&(c.push(i),t.push(i),o[i]||(o[i]=[]),o[i].push({collectionPosition:u,collectionId:r}))})),l||K.push(c)}))};try{for(var s=(t=void 0,a(J)),l=s.next();!l.done;l=s.next()){u(l.value)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}var c=Object.keys(o).map((function(e){return{collectionAssignments:o[e],participantId:e}}));N[e.participantId]=c};try{for(var Q=a(C),$=Q.next();!$.done;$=Q.next()){X($.value)}}catch(e){r={error:e}}finally{try{$&&!$.done&&(n=Q.return)&&n.call(Q)}finally{if(r)throw r.error}}var ee=[];try{for(var te=a(K),re=te.next();!re.done;re=te.next()){var ne=re.value;if(!gl({tournamentParticipants:E,participantIds:ne}).participant){var ie={individualParticipantIds:ne,participantRole:Vv,participantType:hs};ee.push(ie)}}}catch(e){i={error:e}}finally{try{re&&!re.done&&(o=te.return)&&o.call(te)}finally{if(i)throw i.error}}if(D){for(;ee.length;)gm({participant:ee.pop(),tournamentRecord:S});jn({element:w,extension:{name:uo,value:N}})}return t(t({},L),{lineUps:N,participantsToAdd:ee})}function OU(e){var t=e.court,r=e.date,n=r&&t.dateAvailability.find((function(e){return Ii(e.date,r)})),i=t.dateAvailability.find((function(e){return!e.date}));return n||i}function FU(e){var t=e.includeBookingTypes,r=void 0===t?[]:t,n=e.courtDate,i=[],a=vi(n.startTime);(n.bookings||[]).filter((function(e){return!e.bookingType||!r.includes(e.bookingType)})).sort((function(e,t){return ai(e.startTime).localeCompare(ai(t.startTime))})).forEach((function(e){var t={startTime:oi(a.toISOString()),endTime:e.startTime};vi(e.startTime)>a&&i.push(t),vi(e.endTime)>a&&(a=vi(e.endTime))}));var o={startTime:oi(a.toISOString()),endTime:n.endTime};return vi(n.endTime)>a&&i.push(o),i}function kU(e){var t=e.averageMatchUpMinutes,r=e.includeBookingTypes,n=e.periodStart,i=e.date,a=e.courts,o=vi(n),u=function(e){var t=e.averageMatchUpMinutes,r=e.includeBookingTypes,n=e.periodStartTime,i=e.periodEndTime;function a(e){var r=vi(e.startTime),a=vi(e.endTime);return!(r>n)&&!(a<i)&&fi(n,a)>=t}return{enoughTime:function(e){return!!FU({includeBookingTypes:r,courtDate:e}).filter(a).length}}}({averageMatchUpMinutes:t,includeBookingTypes:r,periodStartTime:o,periodEndTime:hi(o,t)}).enoughTime;return{availableToScheduleCount:((null==a?void 0:a.filter((function(e){if(!Array.isArray(e.dateAvailability))return!1;var t=OU({date:i,court:e});return!(!t||!u(t))})))||[]).length}}function _U(e){var t=null!=e?e:{},r=t.startTime,n=void 0===r?"8:00":r,i=t.endTime,a=void 0===i?"20:30":i,o=t.count,u=void 0===o?10:o,s=t.date;return R(0,u).map((function(){return{dateAvailability:[{date:s,startTime:n,endTime:a}]}}))}function LU(e){var t,r,n=e.remainingScheduleTimes,i=void 0===n?[]:n,s=e.clearScheduleDates,l=e.periodLength,c=void 0===l?30:l,d=e.scheduleDate,p=e.courts,v=void 0===p?[]:p,f=e.bookings,m=void 0===f?[]:f;if(!Array.isArray(v)||!v.length)return{error:xr,courts:v};if(!Array.isArray(m))return{error:mt};if(!Jn(d))return{error:It};s&&(Array.isArray(s)?s.includes(d)&&(m=[]):m=[]);var h=m.reduce((function(e,t){var r=t.courtId;return r?e.courtBookings[r]?e.courtBookings[r].push(t):e.courtBookings[r]=[t]:e.unassignedBookings.push(t),e}),{courtBookings:{},unassignedBookings:[]}),g=h.courtBookings,I=h.unassignedBookings,y=v.map((function(e,t){var r=e.courtId,n=e.courtName,a=g[r]||[],s=OU({date:d,court:e})||{},l=s.bookings,c=void 0===l?[]:l,p=s.startTime,v=s.endTime,f=s.date;return{courtId:r,courtName:n,dateAvailability:{bookings:u(u([i[t]&&{startTime:p,endTime:i[t]}],o(Ui(c,!1,!0)),!1),o(a),!1).filter(Boolean),startTime:p,endTime:v,date:f}}}));I.sort((function(e,t){return ii(e.startTime)-ii(t.startTime)}));var U=[],S=function(e){var t=e.startTime,r=e.endTime,n=e.averageMinutes,i=e.recoveryMinutes,a=e.matchUpId,o=ii(t),u=ii(r),s=y.map((function(e){var t=FU({courtDate:e.dateAvailability});return{courtName:e.courtName,courtId:e.courtId,timeSlots:t}})).flat().reduce((function(e,t){var r,n=t.courtId,i=t.courtName,a=t.timeSlots.find((function(t){var n=t.startTime,i=t.endTime;r=ii(n)-o;var a=o>=ii(n);return u<=ii(i)&&0!==e.startDifference&&((0===r||r+c>=0)&&(void 0===e.startDifference||r<e.startDifference)||a)}));return a?{courtName:i,courtId:n,startDifference:r}:e}),{});if(s.courtId){var l={averageMinutes:n,recoveryMinutes:i,matchUpId:a,startTime:t,endTime:r};U.push(l);var d=y.find((function(e){return e.courtId===s.courtId}));null==d||d.dateAvailability.bookings.push(l)}else console.log({unassignedBooking:e})};try{for(var w=a(I),T=w.next();!T.done;T=w.next()){S(T.value)}}catch(e){t={error:e}}finally{try{T&&!T.done&&(r=w.return)&&r.call(w)}finally{if(t)throw t.error}}var P=y.map((function(e){var t=e.courtId,r=e.courtName;return{dateAvailability:[e.dateAvailability],courtName:r,courtId:t}}));return{virtualCourts:P,assignedBookings:U}}function jU(e){var t=e.averageMatchUpMinutes,r=e.periodLength,n=void 0===r?30:r,i=(t||90)+(e.recoveryMinutes||0);return n>i?i:n||30}function BU(e){var t=e.scheduleDate,r=e.startTime,n=e.endTime,i=e.courts,a=(r?"startTime":n&&"endTime")||void 0;return i.reduce((function(e,i){var o=OU({date:t,court:i}),u=a&&((null==o?void 0:o[a])||i[a]);return u&&(!e||r&&ii(u)<ii(e)||n&&ii(u)>ii(e))?u:e}),void 0)}function VU(e){var t=e.date,r=void 0===t?Zn():t,n=e.startTime,i=void 0===n?"08:00":n,s=e.endTime,c=void 0===s?"19:00":s,d=e.periodLength,p=e.courts,v=e.calculateStartTimeFromCourts,f=void 0===v||v,m=e.remainingScheduleTimes,h=e.averageMatchUpMinutes,g=e.clearScheduleDates,I=e.courtsCount,y=e.bookings;d=d||jU({averageMatchUpMinutes:h}),r=ui(r),i=oi(i),c=oi(c);var U=0,S=0,w=0,T=0,P=0;!p&&I&&(p=_U({startTime:i,endTime:c,count:I,date:r}));var D=LU({remainingScheduleTimes:m,clearScheduleDates:g,scheduleDate:r,periodLength:d,bookings:y,courts:p}).virtualCourts,b=function(e){var t,r,n,i=e.averageMinutes,o=e.startTime,u=e.endTime,s=e.courts,l=e.date;if(o=o||BU({courts:s,scheduleDate:l,startTime:!0}),u=u||BU({courts:s,scheduleDate:l,endTime:!0}),o&&u){var c=vi(o),d=vi(u);try{for(var p=a(s||[]),v=p.next();!v.done;v=p.next()){var f=v.value;Array.isArray(f.dateAvailability)&&FU({courtDate:OU({court:f,date:l})}).forEach((function(e){var t=vi(e.startTime),r=vi(e.endTime);if(t>d||t<c)return!1;if(r<c)return!1;if(fi(t,r)>=i){var a=oi(t.toISOString());(!n||a<n)&&(n=a)}}))}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}}return{firstTimeSlotStartTime:n}}({averageMinutes:h,courts:D,startTime:i,endTime:c,date:r}).firstTimeSlotStartTime;f&&b&&(i=b||i);var N=ii(i),M=ii(c)-N,A=R(0,Math.floor(M/d)+1).map((function(e){var t,n,i,a=(t=N+e*d,n=Math.floor(t/60),i=t-60*n,n>23&&(n%=24),[gi(n),gi(i)].join(":")),o=kU({courts:D||[],averageMatchUpMinutes:h,periodStart:a,date:r}).availableToScheduleCount,u=o>S?o-S:0;P+=e?o:0;var s=e?P/e:o,c=e?d*s/h*(e-1)+s:s,p=o?S&&c-U||u:0;U=c,S=o;var v=l(w+=p)-T;return{periodStart:a,add:v,availableToScheduleCount:o,newCourts:u,totalMatchUps:T+=v}}));return{scheduleTimes:A.reduce((function(e,t){var r=R(0,t.add).map((function(){return{scheduleTime:t.periodStart}}));return e.concat.apply(e,u([],o(r),!1))}),[]).flat(),timingProfile:A,totalMatchUps:T}}var GU={garman:{getCourtsAvailableAtPeriodStart:kU,generateTimeSlots:FU,getScheduleTimes:VU,courtGenerator:_U},generateAdHocMatchUps:_I,generateAndPopulatePlayoffStructures:UI,generateCourts:function(e){var r,n,i,a,o,u;if(!e)return{error:pt};var s=da(e,[(r={dates:!1},r[aa]=function(e){return Array.isArray(e)&&e.every(Jn)},r),(n={uuids:!1},n[aa]=function(e){return Array.isArray(e)&&e.every(Pi)},n),(i={startTime:!1,endTime:!1},i[aa]=ni,i),(a={idPrefix:!1,namePrefix:!1},a[aa]=Pi,a),(o={count:!0},o[aa]=f,o)]);if(s.error)return s;var l=null!==(u=e.tournamentRecord)&&void 0!==u?u:{},c=l.startDate,d=l.endDate,p=e.dates||c&&d&&ei(c,d)||[],v=R(1,e.count+1).map((function(t){var r,n,i,a,o;return xn({courtId:null!==(i=null!==(n=null===(r=e.uuids)||void 0===r?void 0:r.pop())&&void 0!==n?n:e.idPrefix&&"".concat(e.idPrefix,"-").concat(t))&&void 0!==i?i:ed(),courtName:null!==(o=null===(a=e.courtNames)||void 0===a?void 0:a.pop())&&void 0!==o?o:e.namePrefix&&"".concat(e.namePrefix," ").concat(t),dateAvailability:p.map((function(t){var r,n;return{startTime:null!==(r=e.startTime)&&void 0!==r?r:"08:00",endTime:null!==(n=e.endTime)&&void 0!==n?n:"20:00",date:t}}))})}));return t(t({},L),{courts:v})},generateDrawDefinition:bU,generateDrawMaticRound:ey,generateDrawStructuresAndLinks:gU,generateDrawTypeAndModifyDrawDefinition:IU,generateFlightProfile:function(e){var r,n,i=e.drawNameRoot,a=void 0===i?"Flight":i,s=e.attachFlightProfile,l=e.tournamentRecord,c=e.scaleAttributes,d=e.scaleSortMethod,p=e.deleteExisting,v=e.sortDescending,f=e.drawNames,m=void 0===f?[]:f,h=e.flightsCount,g=e.splitMethod,I=e.uuids,y=void 0===I?[]:I,U=e.event,w=e.stage;if(!U)return{error:Ae};var T=null!==(r=U.entries)&&void 0!==r?r:[];if(_d({event:U}).flightProfile&&s&&!p)return{error:Gr};var P=null!==(n=e.scaledEntries)&&void 0!==n?n:py({tournamentRecord:l,scaleAttributes:c,scaleSortMethod:d,sortDescending:v,event:U,stage:w}).scaledEntries,D=P.map(Mo),b=S(T.filter((function(e){var t=e.participantId;return!D.includes(t)})).filter((function(e){return(!w||!e.entryStage||e.entryStage===w)&&(!e.entryStatus||kl.includes(e.entryStatus))}))),N=P.concat.apply(P,u([],o(b),!1)),M=N.length,A=O(N,Math.ceil(M/h));g===NU?A=_(N,h):g===MU&&(A=_(N,h,!0));var E=R(0,h).map((function(e){var t,r,n=e+1;return{flightNumber:n,drawId:null!==(t=null==y?void 0:y.pop())&&void 0!==t?t:ed(),drawEntries:(r=A[e],(r||[]).map((function(e){var t=e.participantId,r=e.scaleValue,n=T.find((function(e){return e.participantId===t}));return(null==n?void 0:n.scaleValue)&&r&&(n.scaleValue=r),n})).sort((function(e,t){return e.scaleValue-t.scaleValue})).map((function(e,t){return e.scaleValue&&(e.seedNumber=t+1),e}))),drawName:(null==m?void 0:m.length)&&m[e]||"".concat(a," ").concat(n)}})),C={scaleAttributes:c,splitMethod:g,flights:E};if(s){var x=iy({flightProfile:C,deleteExisting:p,event:U});return t({splitEntries:on()&&A||void 0},x)}return t({flightProfile:C},L)},generateLineUps:xU,generateQualifyingStructure:cI,generateSeedingScaleItems:cy,generateVoluntaryConsolation:function(e){var r,n,i,a,s,l,c,d,p=e.drawType,v=void 0===p?Eu:p,f=e.attachConsolation,m=void 0===f||f,g=e.applyPositioning,I=void 0===g||g,y=e.tournamentRecord,U=e.staggeredEntry,S=e.automated,w=e.placeByes,T=e.isMock,P=e.event,D=null==e?void 0:e.drawDefinition;if(!D)return{error:K};var b=uu,N=Gl({stageSequence:1,drawDefinition:D,stage:b}),M=[Yu,Cu,Ku].includes(v)?N.length:h(N.length);if(!U&&v===Mu&&N.length<2||v===Yu&&N.length<3)return{error:le};var R=e.tieFormat,A=e.matchUpType;if(R){var E=zm({tieFormat:R});if(E.error)return E}R=bm(null!=R?R:null===(i=Gd({drawDefinition:D}))||void 0===i?void 0:i.tieFormat),A=null!==(a=null!=A?A:D.matchUpType)&&void 0!==a?a:Es;var C=os({stageSequence:1,drawDefinition:D,stage:b}).structures;if(C.length>1)return{error:Le};if(null===(l=null===(s=null==C?void 0:C[0])||void 0===s?void 0:s.matchUps)||void 0===l?void 0:l.length)return{error:zr};var x=null===(c=null==C?void 0:C[0])||void 0===c?void 0:c.structureId;Object.assign(e,xn({structureName:null!==(d=e.structureName)&&void 0!==d?d:ef(uu),structureId:x,matchUpType:A,tieFormat:R,drawSize:M,stage:b}));var O=hU(e);if(O.error)return O;var F=O.generators[v];if(!F)return{error:ne};var k=null==F?void 0:F();if(k.error)return k;var _=k.structures,j=k.links,B=_.map((function(e){return mp({structure:e}).matchUps})).flat();R&&B.forEach((function(e){var t=Ym({matchUp:e,tieFormat:R,isMock:T}).tieMatchUps;Object.assign(e,{tieMatchUps:t,matchUpType:A})})),I&&m||(D=Ui(D,!1,!0)),D.links||(D.links=[]),j.length&&(r=D.links).push.apply(r,u([],o(j),!1));var V=_.map((function(e){return e.structureId}));D.structures||(D.structures=[]);var G=D.structures.map((function(e){return e.structureId}));D.structures=D.structures.map((function(e){return V.includes(e.structureId)?_.find((function(t){return t.structureId===e.structureId})):e}));var q=_.filter((function(e){var t=e.structureId;return!G.includes(t)}));return q.length&&(n=D.structures).push.apply(n,u([],o(q),!1)),S&&Eh({seedingProfile:e.seedingProfile,applyPositioning:I,tournamentRecord:y,drawDefinition:D,structureId:x,placeByes:w,drawSize:M,event:P}),m&&Op({drawDefinition:D}),t({links:j,structures:_},L)}},qU=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],WU=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function HU(e){var t=void 0===e?{}:e,r=t.count,n=void 0===r?1:r,i=t.participantsCount,a=void 0===i?32:i,o=S(WU),u=o.slice(0,n);return{cities:R(0,a).map((function(e){return e<Math.min(n,o.length)?u[e]:M(u)}))}}function zU(e){var t=void 0===e?{}:e,r=t.count,n=void 0===r?1:r,i=t.participantsCount,a=void 0===i?32:i,o=S(qU),u=o.slice(0,n).map((function(e){return Object.keys(e)})).flat();return{states:R(0,a).map((function(e){return e<Math.min(n,o.length)?u[e]:M(u)}))}}function YU(e){var t=void 0===e?{}:e,r=t.count,n=void 0===r?1:r,i=t.participantsCount,a=void 0===i?32:i,o=R(0,n).map((function(){return R(0,5).map((function(){return g(0,9)})).join("")}));return{postalCodes:R(0,a).map((function(e){return e<n?o[e]:M(o)}))}}var KU={lastNames:["Abbey","Assange","Ahern","Ampleforth","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Bill","Bruce","Charles","Chris","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function JU(e){var t=e||{},r=t.count,n=void 0===r?100:r,i=t.sex;if(!n||i&&![cp,vp].includes(i))return{personData:[],error:xr};for(var a=Math.ceil(1.3*n),o=KU.lastNames,u=KU.firstFemale,s=KU.firstMale,l=ws.map((function(e){return e.iso})).filter(Boolean),c=Math.ceil(a/o.length),d=Math.ceil(a/u.length),p=Math.ceil(a/s.length),v=R(0,c).flatMap((function(){var e=Ui(o,!1,!0);return R(0,o.length).map((function(){return N(e)}))})),f=R(0,d).flatMap((function(){var e=Ui(u,!1,!0);return R(0,u.length).map((function(){return N(e)}))})),m=R(0,p).flatMap((function(){var e=Ui(s,!1,!0);return R(0,s.length).map((function(){return N(e)}))})),h={},g=0;g<a;g++){var I=v.pop(),y=i||M([cp,vp]),U=y===cp?m.pop():f.pop(),S=M(l);h["".concat(U).concat(I)]={nationalityCode:S,sex:y,firstName:U,lastName:I}}return{personData:Object.values(h).slice(0,n)}}function ZU(e){var t=(null==e?void 0:e.count)||1,r=e||{},n=r.personExtensions,i=r.consideredDate,a=r.isMock,s=void 0===a||a,c=r.gendersCount,d=r.personData,p=r.category,v=r.sex;if(isNaN(t))return{error:xr};var f=(null==c?void 0:c[cp])||v===cp&&t||0,m=(null==c?void 0:c[vp])||v===vp&&t||0,h=(t=Math.max(t,f+m))-(f+m),g=f&&JU({count:f,sex:cp}).personData||[],I=m&&JU({count:m,sex:vp}).personData||[],y=u(u(u([],o(g),!1),o(I),!1),o(h&&JU({count:h}).personData||[]),!1),U=y.filter((function(e){return!v||f&&m||e.sex===v})),w=[];if(Array.isArray(d)){var T=d.filter((function(e){return"string"==typeof e.firstName&&("string"==typeof e.lastName&&(!(e.sex&&![cp,vp].includes(e.sex))&&(!(e.nationalityCode&&("string"!=typeof e.nationalityCode||e.nationalityCode.length>3||!ws.find((function(t){return[t.iso,t.ioc].includes(e.nationalityCode)}))))&&(e.nationalityCode&&w.push(e.nationalityCode),!0))))}));if(!T.length)return{error:xr};U=T}var P=d?U:S(U);if(P.length<t){var D=y.reduce((function(e,t){var r=t.firstName,n=t.lastName,i=t.nationalityCode;return t.sex===cp?(e.maleFirstNames.includes(r)||e.maleFirstNames.push(r),e.maleLastNames.includes(n)||e.maleLastNames.push(n)):(e.femaleFirstNames.includes(r)||e.femaleFirstNames.push(r),e.femaleLastNames.includes(n)||e.femaleLastNames.push(n)),e.nationalityCodes.includes(i)||e.nationalityCodes.push(i),e}),{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]}),b=D.maleFirstNames,A=D.maleLastNames,E=D.femaleFirstNames,C=D.femaleLastNames,x=D.nationalityCodes;R(0,t-P.length).forEach((function(){var e=v||M([cp,vp]),t=M(x),r={firstName:M(e===cp?b:E),lastName:M(e===cp?A:C),sex:e,nationalityCode:t};P.push(r)}))}var O=Vm({consideredDate:i,category:p}),F=O.ageMinDate,k=O.ageMaxDate,_=l((null==F?void 0:F.slice(0,4))||0)||l((null==k?void 0:k.slice(0,4))||0)-3,L=l((null==k?void 0:k.slice(0,4))||0)||l((null==F?void 0:F.slice(0,4))||0)+3,j=(F||k)&&[_,L],B=P.slice(0,t).map((function(e,t){var r,i,a,u=o(j||[],2),l=u[0],c=u[1],d=j&&N(R(l,c)),p=N(R(0,365)),v=d&&(r=p,a=new Date(d,0),Xn(new Date(a.setDate(r)),i));return Object.assign(xn({extensions:n||[{name:"regionCode",value:t+1}],birthDate:v,isMock:s}),e)}));return{persons:B.length&&B||P[0],nationalityCodes:w}}function XU(e){var t=e.cities,r=e.states,n=e.postalCodes,i=e.nationalityCode,a=e.participantIndex;return{postalCode:null==n?void 0:n[a],state:null==r?void 0:r[a],city:null==t?void 0:t[a],countryCode:i}}var QU=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function $U(e){var t=void 0===e?{}:e,r=t.nameRoot,n=void 0===r?"TEAM":r,i=t.count,a=void 0===i?1:i,o=S(QU).slice(0,a);return o.length<a&&R(0,a-o.length).forEach((function(e){return o.push("".concat(n," ").concat(e+1))})),{names:o}}var eS=function(e){var t=e.isSide1,r=e.lowValue,n=e.setTo,i=e.tiebreakAt,a=e.NoAD;if(void 0===r)return!1;var o,u=l(r);return(null==u?void 0:u.toString().length)>2&&(u=parseInt(u.toString().slice(0,2))),i&&i<n&&u>i&&(u=i),o=a&&!i?u<n?n:n-1:u+1<n&&n||i&&i<n&&u===i&&n||!i&&u+2||n+1,[t?u:o,t?o:u]},tS=function(e){var t=e.isSide1,r=e.lowValue,n=e.tiebreakTo,i=e.tiebreakNoAd;if(void 0===r)return!1;var a="string"==typeof r?parseInt(r):r;(null==a?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),i&&a>n-1&&(a=n-1);var o=function(e){var t=e.lowValue,r=e.NoAD,n=e.tiebreakTo,i=r?1:2;if(t+1>=n)return t+i;return n}({lowValue:a,NoAD:i,tiebreakTo:n});return[t?a:o,t?o:a]};function rS(e){var t=e.tiebreakTo,r=void 0===t?7:t;return e.scoreString.split(" ").filter(Boolean).map((function(e,t){return function(e){var t=e.set,n=e.setNumber,i=(null==t?void 0:t.startsWith("["))&&t.split("[")[1].split("]")[0].split("-").map((function(e){return parseInt(e)})),a=t.includes("(")&&t.split("(")[0]||t.includes("[")&&t.split("[")[0]||t,u=!i&&a.split("-").map((function(e){return parseInt(e)})),s=i?(i[0]>i[1]?1:i[0]<i[1]&&2)||void 0:(u[0]>u[1]?1:u[0]<u[1]&&2)||void 0,l=t.includes("(")?t.split("(")[1].split(")")[0]:void 0,c=l&&tS({lowValue:l,isSide1:2===s,tiebreakTo:r}),d=null!=c?c:[],p=o(u||[],2),v=p[0],f=p[1],m=o(i||d||[],2),h=m[0],g=m[1];return{side1Score:v,side2Score:f,side1TiebreakScore:h,side2TiebreakScore:g,winningSide:s,setNumber:n}}({set:e,setNumber:t+1})}))}function nS(e){var r=e.matchUpFormat,n=e.matchUpStatus,i=e.winningSide,a=e.scoreString;if(!a)return{outcome:t(t({},ug),{winningSide:i,matchUpStatus:n})};if(i&&![1,2,void 0].includes(i))return{error:xr,winningSide:i};var o=a&&rS({scoreString:a}),u={},s=PI({sets:o,matchUpFormat:r}),l=PI({sets:o,reversed:!0,matchUpFormat:r});return 2===i?(u.scoreStringSide1=l,u.scoreStringSide2=s):(u.scoreStringSide1=s,u.scoreStringSide2=l),u.sets=rS({scoreString:u.scoreStringSide1}),xn({outcome:{matchUpStatus:n,winningSide:i,score:u}})}function iS(e){var t,r=e.tournamentRecords,n=e.tournamentId;return"object"==typeof r&&Object.keys(r).length?(Object.keys(r).filter((function(e){return!n||e===n})).forEach((function(e){var n=function(e){var t,r,n=da(e,[(t={},t[Fi]=!0,t)]);if(n.error)return n;var i=e.tournamentRecord,a=Jl({policyType:_a,tournamentRecord:i}).policy,o=Vn({element:i,name:mo}).extension,u=null===(r=null==o?void 0:o.value)||void 0===r?void 0:r.dailyLimits,s=null==a?void 0:a.defaultDailyLimits;return{matchUpDailyLimits:u||s}}({tournamentRecord:r[e]}).matchUpDailyLimits;t=n})),{matchUpDailyLimits:t}):{error:q}}function aS(e){var t,r=e.matchUpScheduleTimes,n=e.matchUpDependencies,i=e.allDateMatchUpIds,a=e.matchUp,o=((null===(t=null==n?void 0:n[a.matchUpId])||void 0===t?void 0:t.matchUpIds)||[]).filter((function(e){return i.includes(e)})),u=o.filter((function(e){return!r[e]}));return{dependenciesScheduled:!(null==u?void 0:u.length),remainingDependencies:u}}function oS(e){var r=e.tournamentRecords,n=e.tournamentRecord,i=e.tournamentId,a=e.drawId;if(!n&&!r)return{error:W};if(!a)return{error:pe};if(!n&&r){if("string"!=typeof i&&!(i=lg({tournamentRecords:r,drawId:a})))return{error:z};if(!(n=r[i]))return{error:W}}var o=n&&Ld({tournamentRecord:n,drawId:a});return(null==o?void 0:o.drawDefinition)?t({drawDefinition:o.drawDefinition,event:o.event,tournamentRecord:n},L):On({result:{error:Z},stack:"findDrawDefinition"})}function uS(e){var t,r,n,i,a=e.matchUpPotentialParticipantIds,s=e.matchUpNotBeforeTimes,l=e.timeAfterRecovery,c=e.matchUp,d=Wp(c).individualParticipantIds;l=null!=l?l:null===(t=c.schedule)||void 0===t?void 0:t.timeAfterRecovery;var p=function(e){var t;a[e]||(a[e]=[]),a[e]=U((t=a[e]).concat.apply(t,u([],o(d),!1)))},v=function(e){l&&(!s[e]||l>s[e])&&(s[e]=l)},f=(null===(r=c.winnerTo)||void 0===r?void 0:r.matchUpId)||c.winnerMatchUpId;f&&(l&&v(f),p(f));var m=(null===(n=c.loserTo)||void 0===n?void 0:n.matchUpId)||c.loserMatchUpId;m&&(l&&v(m),p(m)),(null===(i=c.sidesTo)||void 0===i?void 0:i.length)&&c.sidesTo.forEach((function(e){var t=e.matchUpId;t&&(l&&v(t),p(t))}))}function sS(e){var t=e.individualParticipantProfiles,r=e.participantId;t[r]||(t[r]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function lS(e){var t,r,n=e.matchUpPotentialParticipantIds,i=e.individualParticipantProfiles,a=e.typeChangeRecoveryMinutes,o=e.averageMatchUpMinutes,u=void 0===o?0:o,s=e.matchUpNotBeforeTimes,c=e.matchUpDependencies,d=e.recoveryMinutes,p=void 0===d?0:d,v=e.scheduleTime,f=e.matchUp,m=oi(null===(t=null==f?void 0:f.schedule)||void 0===t?void 0:t.endTime),h=m?mi(m,l(p)):mi(v,l(u)+l(p)),g=a&&(m?mi(oi(m),a):mi(v,l(u)+l(a))),I=(null===(r=null==c?void 0:c[f.matchUpId])||void 0===r?void 0:r.participantIds)||[],y=(f.roundPosition&&n[f.matchUpId]||[]).flat();I.forEach((function(e){sS({individualParticipantProfiles:i,participantId:e});var t=i[e].priorMatchUpType!==f.matchUpType&&g||h;y.includes(e)?function(e){var t=e.individualParticipantProfiles,r=e.recoveryValue,n=e.participantId,i=e.scheduleTime,a=e.drawId;t[n].potentialRecovery[a]||(t[n].potentialRecovery[a]=[]),t[n].potentialRecovery[a].push(r),t[n].potentialBookings[a]||(t[n].potentialBookings[a]=[]),t[n].potentialBookings[a].push({timeAfterRecovery:r,scheduleTime:i})}({individualParticipantProfiles:i,drawId:f.drawId,recoveryValue:t,participantId:e,scheduleTime:v}):(i[e].timeAfterRecovery=t,i[e].bookings.push({scheduleTime:v,timeAfterRecovery:t}))})),uS({matchUpPotentialParticipantIds:n,matchUpNotBeforeTimes:s,timeAfterRecovery:h,matchUp:f})}function cS(e){var t,r,n,i,a,o,u=e.matchUpScheduleTimes,s=e.matchUpDependencies,l=e.scheduleTime,c=e.matchUpId,d=e.details,p=null===(r=null===(t=d.minutesMap)||void 0===t?void 0:t[c])||void 0===r?void 0:r.recoveryMinutes,v=mi(l,((null===(i=null===(n=d.minutesMap)||void 0===n?void 0:n[c])||void 0===i?void 0:i.averageMinutes)||0)+(p||0)),f=(null===(a=null==s?void 0:s[c])||void 0===a?void 0:a.dependentMatchUpIds)||[];if(f.length){var m=f.reduce((function(e,t){var r=u[t];if(!r)return e;var n={scheduleTime:r,matchUpId:t};return r&&!e.matchUpId||ii(r)<ii(e.scheduleTime)?n:e}),{});m.scheduleTime&&ii(v)>ii(m.scheduleTime)&&(o=m)}return{scheduledDependent:o}}var dS="DO_NOT_SCHEDULE",pS={DO_NOT_SCHEDULE:dS};function vS(e){var r,n,i=e.averageMatchUpMinutes,s=void 0===i?90:i,l=e.requestConflicts,c=void 0===l?{}:l,d=e.potentials,p=void 0===d||d,v=e.personRequests,f=e.scheduleTime,m=e.scheduleDate,h=e.matchUp,g=function(e){var t=e||{},r=t.sides,n=t.matchUpType;return(r||[]).map((function(e){var t;return n===xs&&((null===(t=null==e?void 0:e.participant)||void 0===t?void 0:t.individualParticipants)||[])||(null==e?void 0:e.participant)&&[e.participant]||[]})).flat()}(h).map((function(e){var t=e.person;return null==t?void 0:t.personId}));if(p){var I=((null==h?void 0:h.potentialParticipants)||[]).flat().map((function(e){var t=e.person;return null==t?void 0:t.personId}));g.push.apply(g,u([],o(I),!1))}var y=g.map((function(e){var r;return null===(r=v[e])||void 0===r?void 0:r.map((function(r){return t(t({},r),{personId:e})}))})).filter(Boolean).flat().filter((function(e){return e.requestType===dS&&Ii(m,e.date)})),U=[],S=null==h?void 0:h.matchUpId,w=vi(oi(f),ui(m)),T=oi(hi(w,s).toISOString());try{for(var P=a(y),D=P.next();!D.done;D=P.next()){var b=D.value,N=b.requestId,M=b.startTime,R=b.endTime;(f>M&&f<R||T>M&&T<R)&&(U.push({matchUpId:S,request:b,scheduleTime:f}),c[N]?(c[N].scheduleTimes.includes(f)||c[N].scheduleTimes.push(f),c[N].matchUpIds.includes(S)||c[N].matchUpIds.push(S)):c[N]={request:b,scheduleTimes:[f],matchUpIds:[S]})}}catch(e){r={error:e}}finally{try{D&&!D.done&&(n=P.return)&&n.call(P)}finally{if(r)throw r.error}}return{conflicts:U}}function fS(e){var t,r=e.defaultRecoveryMinutes,n=void 0===r?0:r,i=e.defaultAverageMinutes,a=e.tournamentRecords,o=e.matchUpFormat,u=e.categoryName,s=e.categoryType,l=e.tournamentId,c=e.eventType,d=e.eventId;return Fm({matchUpFormat:o})?(Object.keys(a).filter((function(e){return!l||e===l})).forEach((function(e){var r;if(!t){var n=a[e],i=d?null===(r=Ld({tournamentRecord:n,eventId:d}))||void 0===r?void 0:r.event:void 0;return(null==(t=qc({tournamentRecord:n,matchUpFormat:o,categoryName:u,categoryType:s,eventType:c,event:i}))?void 0:t.averageMinutes)||(null==t?void 0:t.recoveryMinutes)}})),{recoveryMinutes:(null==t?void 0:t.recoveryMinutes)||n,averageMinutes:(null==t?void 0:t.averageMinutes)||i,typeChangeRecoveryMinutes:(null==t?void 0:t.typeChangeRecoveryMinutes)||(null==t?void 0:t.recoveryMinutes)||n}):{error:Ge}}function mS(e){var r=e.scheduleCompletedMatchUps,n=e.containedStructureIds,i=e.tournamentRecords,s=e.periodLength,l=void 0===s?30:s,d=e.matchUps,p=e.rounds;if("object"!=typeof i)return{error:q};if(!Array.isArray(p))return{error:pt,info:rm("rounds")};var v={},f=[];p.sort((function(e,t){var r,n;return(null!==(r=e.sortOrder)&&void 0!==r?r:0)-(null!==(n=t.sortOrder)&&void 0!==n?n:0)})),n=null!=n?n:Object.assign.apply(Object,u([{}],o(Object.values(i).map((function(e){return jp({tournamentRecord:e}).containedStructures}))),!1)),d||(d=Jp({nextMatchUps:!0,tournamentRecords:i}).matchUps);var m=0,h={},g={},y={},U=p.flatMap((function(e){var t,s,p,U,S,w=e.periodLength||l,T=[];(null==n?void 0:n[e.structureId])?T.push.apply(T,u([],o(n[e.structureId]),!1)):T.push(e.structureId);var P=d?up({tournamentIds:[e.tournamentId],roundNumbers:[e.roundNumber],matchUpIds:e.matchUpIds,eventIds:[e.eventId],drawIds:[e.drawId],processContext:!0,structureIds:T,matchUps:d}).sort(Zp):[],D=e.roundSegment||{},b=D.segmentNumber,N=D.segmentsCount;if(I(b)&&c(null==P?void 0:P.length)&&c(N)&&b>0&&b<=N&&N<(null==P?void 0:P.length)&&!(null===(S=e.matchUpIds)||void 0===S?void 0:S.length)){var M=P.length/N,R=M*(b-1);P=P.slice(R,R+M)}var A=i[e.tournamentId],E=Ld({drawId:e.drawId,tournamentRecord:A}).event,C=[];try{for(var x=a(P),O=x.next();!O.done;O=x.next()){var F=O.value;(j=F.matchUpFormat)&&(v[j]||(v[j]=[],v[j].push(F)),C.push(j))}}catch(e){t={error:e}}finally{try{O&&!O.done&&(s=x.return)&&s.call(x)}finally{if(t)throw t.error}}var k=function(t){var n=null!=E?E:{},a=n.eventType,s=n.category,l=null!=s?s:{},c=l.categoryName,d=l.ageCategoryCode,p=fS({categoryName:null!=c?c:d,categoryType:null==s?void 0:s.categoryType,tournamentId:e.tournamentId,eventId:e.eventId,tournamentRecords:i,matchUpFormat:t,eventType:a}),v=p.typeChangeRecoveryMinutes,I=p.recoveryMinutes,U=p.averageMinutes,S=p.error;if(S)return{value:{error:S,round:e}};var T=P.filter((function(e){return(r||!eu.includes(e.matchUpStatus))&&e.matchUpStatus!==Fo})).map(Ro);T.forEach((function(e){y[e]={typeChangeRecoveryMinutes:v,recoveryMinutes:I,averageMinutes:U},h[e]=I,g[e]=U})),f.push.apply(f,u([],o(T),!1)),m=Math.max(U||0,m);var D="".concat(U,"|").concat(w);return{value:{roundPeriodLength:w,recoveryMinutes:I,averageMinutes:U,matchUpIds:T,hash:D}}};try{for(var _=a(C),L=_.next();!L.done;L=_.next()){var j,B=k(j=L.value);if("object"==typeof B)return B.value}}catch(e){p={error:e}}finally{try{L&&!L.done&&(U=_.return)&&U.call(_)}finally{if(p)throw p.error}}}));return t({scheduledRoundsDetails:U,greatestAverageMinutes:m,matchUpFormatCohorts:v,recoveryMinutesMap:h,averageMinutesMap:g,orderedMatchUpIds:f,minutesMap:y},L)}function hS(e){var t=e.matchUpPotentialParticipantIds,r=e.individualParticipantProfiles,n=e.matchUp,i=e.value,a=n.matchUpType,s=Wp(n).individualParticipantIds,l=(t[n.matchUpId]||[]).filter((function(e){return!x(e,s)})).flat();u(u([],o(s),!1),o(l),!1).forEach((function(e){if(sS({individualParticipantProfiles:r,participantId:e}),!r[e].potentialCounted[n.drawId]){var t=r[e].counters;t[a]?t[a]+=i:i>0&&(t[a]=i),t[xc]?t[xc]+=i:i>0&&(t[xc]=i),l.includes(e)&&(r[e].potentialCounted[n.drawId]=!0)}}))}var gS=function(e){var t=e.scheduleAttributes,r=void 0===t?["scheduledDate","scheduledTime"]:t,n=e.schedule,i=void 0===n?{}:n;return!!Object.keys(i).filter((function(e){return r.includes(e)})).filter((function(e){return i[e]})).length};function IS(e){var r=e.defaultRecoveryMinutes,n=void 0===r?0:r,i=e.averageMatchUpMinutes,a=void 0===i?90:i,s=e.dateScheduledMatchUps,l=e.tournamentRecords,c=e.venueIds,d=void 0===c?[]:c,p=e.periodLength,v=e.scheduleDate,f=e.matchUps;if("object"!=typeof l)return{error:q};if(!Zs(f)&&!Array.isArray(s))return{error:$e};p=null!=p?p:jU({recoveryMinutes:n,averageMatchUpMinutes:a});var m=Object.assign.apply(Object,u([{}],o(Object.values(l).map((function(e){var t;return(null!==(t=e.events)&&void 0!==t?t:[]).map((function(t){var r,n=Ac({tournamentRecord:e,event:t}).scheduleTiming;return(r={})[t.eventId]={event:t,scheduleTiming:n},r}))})).flat()),!1)),h={averageTimes:[{minutes:{default:a}}],recoveryTimes:[{minutes:{default:n}}]};s||(s=null==f?void 0:f.filter((function(e){var t=e.schedule;return gS({schedule:t})&&(!v||e.schedule.scheduledDate===v)})));var g=null==s?void 0:s.filter((function(e){return(!d.length||d.includes(e.schedule.venueId))&&e.matchUpStatus!==Fo})),I=null==g?void 0:g.map((function(e){var r=e.eventId,n=e.schedule,i=e.matchUpFormat,a=m[r],o=a.event,u=a.scheduleTiming,s=null==o?void 0:o.eventType,l=Wc({timingDetails:t(t({},u),{defaultTiming:h,matchUpFormat:i}),eventType:s}),c=l.averageMinutes,d=l.recoveryMinutes,v=n.courtId,f=n.venueId,g=oi(n.scheduledTime),I=mi(g,c);return{recoveryMinutes:d,averageMinutes:c,periodLength:p,startTime:g,courtId:v,endTime:I,venueId:f}})).filter(Boolean);return{bookings:I,relevantMatchUps:g,dateScheduledMatchUps:s}}function yS(e){var t,r,n,i=e.matchUpPotentialParticipantIds,s=e.individualParticipantProfiles,l=e.scheduleCompletedMatchUps,c=e.containedStructureIds,d=e.matchUpNotBeforeTimes,p=e.matchUpScheduleTimes,v=e.matchUpDependencies,f=e.clearScheduleDates,m=e.tournamentRecords,h=e.periodLength,g=e.scheduleDate,I=e.useGarman,y=e.matchUps,U=e.courts,S=e.venues,w={},T=[],P=[],D=[],b=function(e){var t,r=e.rounds,S=void 0===r?[]:r,b=e.venueId,N=mS({scheduleCompletedMatchUps:l,containedStructureIds:c,tournamentRecords:m,periodLength:h,matchUps:y,rounds:S}),M=N.scheduledRoundsDetails,R=N.greatestAverageMinutes,A=N.orderedMatchUpIds,E=N.minutesMap;D.push.apply(D,u([],o(null!=A?A:[]),!1));var C=function(e){var t,r,n,i,o,u,s=e.scheduledRoundsDetails,l=e.greatestAverageMinutes,c=e.garmanSinglePass,d=[],p=[];try{for(var v=a(s.filter(Boolean)),f=v.next();!f.done;f=v.next()){var m=f.value;u||(u=m.hash),(m.hash===u||c)&&(p=p.concat(m.matchUpIds)),m.hash===u||c||(u=m.hash,d.push({averageMinutes:o,recoveryMinutes:i,roundPeriodLength:n,matchUpIds:p}),p=m.matchUpIds),o=c?l:m.averageMinutes,i=m.recoveryMinutes,n=m.roundPeriodLength}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}return p.length&&d.push({matchUpIds:p,roundPeriodLength:n,recoveryMinutes:i,averageMinutes:o}),{groupedRounds:d}}({scheduledRoundsDetails:M,greatestAverageMinutes:R,garmanSinglePass:!0}).groupedRounds,x=void 0,O=void 0,F=[];I&&(t=function(e){var t,r,n=e.calculateStartTimeFromCourts,i=void 0===n||n,a=e.remainingScheduleTimes,o=e.defaultRecoveryMinutes,u=e.averageMatchUpMinutes,s=e.clearScheduleDates,l=e.tournamentRecords,c=e.tournamentRecord,d=e.periodLength,p=e.scheduleDate,v=e.startTime,f=e.venueIds,m=e.matchUps,h=e.endTime;if(c&&!l&&((t={})[c.tournamentId]=c,l=t),"object"!=typeof l||!Object.keys(l).length)return{error:q};d=null!=d?d:jU({recoveryMinutes:o,averageMatchUpMinutes:u});var g=lf({dates:[p],ignoreDisabled:!0,tournamentRecords:l}),I=g.courts,y=g.venues,U=null!==(r=null==I?void 0:I.filter((function(e){return!f||f.includes(e.venueId)})))&&void 0!==r?r:[];v=null!=v?v:BU({courts:U,scheduleDate:p,startTime:!0}),h=null!=h?h:BU({courts:U,scheduleDate:p,endTime:!0});var S=IS({defaultRecoveryMinutes:o,averageMatchUpMinutes:u,tournamentRecords:l,scheduleDate:p,periodLength:d,venueIds:f,matchUps:m}),w=S.bookings,T=S.dateScheduledMatchUps,P=VU({calculateStartTimeFromCourts:i,remainingScheduleTimes:a,averageMatchUpMinutes:u,clearScheduleDates:s,date:p,periodLength:d,startTime:v,bookings:w,endTime:h,courts:U}).scheduleTimes,D=1===(null==f?void 0:f.length)&&f[0]||1===(null==y?void 0:y.length)&&y[0].venueId||void 0;return{dateScheduledMatchUpIds:null==T?void 0:T.map(Ri("matchUpId")),dateScheduledMatchUps:T,scheduleTimes:P,venueId:D}}({averageMatchUpMinutes:null===(n=C[0])||void 0===n?void 0:n.averageMinutes,scheduleDate:ui(g),venueIds:[e.venueId],clearScheduleDates:f,tournamentRecords:m,periodLength:h,matchUps:y}),F=t.scheduleTimes,x=t.dateScheduledMatchUpIds,O=t.dateScheduledMatchUps);var k=function(e){var t,r,n,i,o=e.matchUpPotentialParticipantIds,u=e.individualParticipantProfiles,s=e.dateScheduledMatchUpIds,l=e.greatestAverageMinutes,c=e.dateScheduledMatchUps,d=e.matchUpNotBeforeTimes,p=e.matchUpScheduleTimes,v=e.matchUpDependencies,f=e.clearScheduleDates,m=e.scheduleDate,h=e.minutesMap,g=e.matchUps,I=[];s||(c=null==g?void 0:g.filter((function(e){var t=e.schedule||{},r=e.matchUpStatus===Fo;return r&&I.push({tournamentId:e.tournamentId,matchUpId:e.matchUpId}),!r&&gS({schedule:t})&&(!m||e.schedule.scheduledDate===m)})),s=c.map(Ro));var y=Array.isArray(f)?f.includes(m):f,U=y?[]:g.filter((function(e){var t=e.matchUpId;return s.includes(t)}));try{for(var S=a(U),w=S.next();!w.done;w=S.next()){var T=w.value;hS({matchUpPotentialParticipantIds:o,individualParticipantProfiles:u,value:1,matchUp:T});var P=null===(n=T.schedule)||void 0===n?void 0:n.scheduledTime;P&&(p[T.matchUpId]=P,lS({individualParticipantProfiles:u,matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:d,matchUpDependencies:v,averageMatchUpMinutes:l,recoveryMinutes:null===(i=null==h?void 0:h[T.matchUpId])||void 0===i?void 0:i.recoveryMinutes,scheduleTime:P,matchUp:T}))}}catch(e){t={error:e}}finally{try{w&&!w.done&&(r=S.return)&&r.call(S)}finally{if(t)throw t.error}}return{dateScheduledMatchUpIds:s,byeScheduledMatchUpDetails:I,dateScheduledMatchUps:c,clearDate:y}}({matchUpPotentialParticipantIds:i,individualParticipantProfiles:s,dateScheduledMatchUpIds:x,greatestAverageMinutes:R,matchUpNotBeforeTimes:d,matchUpScheduleTimes:p,matchUpDependencies:v,clearScheduleDates:f,scheduleDate:g,minutesMap:E,matchUps:y});x=k.dateScheduledMatchUpIds,O=k.dateScheduledMatchUps;var _=k.byeScheduledMatchUpDetails,L=k.clearDate;(null==_?void 0:_.length)&&P.push.apply(P,u([],o(_),!1));var j=function(e){var t=e.matchUpPotentialParticipantIds,r=e.scheduleCompletedMatchUps,n=e.dateScheduledMatchUpIds,i=e.matchUpNotBeforeTimes,a=e.matchUpScheduleTimes,o=e.orderedMatchUpIds,u=e.clearDate,s=e.matchUps,l=Object.keys(a),c=o.map((function(e){return s.find((function(t){return t.matchUpId===e}))})).filter(Boolean).filter((function(e){var t=!u&&(n.includes(e.matchUpId)||l.includes(e.matchUpId)),i=[Fo,jo,_o,xo,Ho,Ko,Vo,Bo].includes(null==e?void 0:e.matchUpStatus);return r||!t&&!e.winningSide&&!i})),d=c.reduce((function(e,r){var n=r.drawId,a=r.tournamentId;return e.matchUpMap[a]||(e.matchUpMap[a]={}),e.matchUpMap[a][n]?e.matchUpMap[a][n].push(r):e.matchUpMap[a][n]=[r],uS({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:i,matchUp:r}),e}),{matchUpMap:{}}).matchUpMap;return{matchUpsToSchedule:c,matchUpMap:d}}({matchUpPotentialParticipantIds:i,scheduleCompletedMatchUps:l,dateScheduledMatchUpIds:x,matchUpNotBeforeTimes:d,matchUpScheduleTimes:p,orderedMatchUpIds:A,clearDate:L,matchUps:y}),B=j.matchUpsToSchedule,V=j.matchUpMap,G=U.filter((function(e){return e.venueId===b}));w[b]={previousRemainingScheduleTimes:[],courtsCount:G.length,greatestAverageMinutes:R,scheduledRoundsDetails:M,dateScheduledMatchUps:O,matchUpsToSchedule:B,scheduleTimes:F,groupedRounds:C,venueCourts:G,minutesMap:E,matchUpMap:V},f||T.push.apply(T,u([],o(x),!1))};try{for(var N=a(S),M=N.next();!M.done;M=N.next()){b(M.value)}}catch(e){t={error:e}}finally{try{M&&!M.done&&(r=N.return)&&r.call(N)}finally{if(t)throw t.error}}return{allDateScheduledByeMatchUpDetails:P,allDateScheduledMatchUpIds:T,venueScheduledRoundDetails:w,allDateMatchUpIds:D}}function US(e){var t,r,n,i,a,s=e.individualParticipantProfiles,c=e.matchUpNotBeforeTimes,d=e.matchUpDependencies,p=e.scheduleTime,v=e.matchUp,f=e.details,m=((null===(t=null==d?void 0:d[v.matchUpId])||void 0===t?void 0:t.participantIds)||[]).flat(),h=(null===(n=null===(r=null==f?void 0:f.minutesMap)||void 0===r?void 0:r[v.matchUpId])||void 0===n?void 0:n.averageMinutes)||0,g=(null===(a=null===(i=null==f?void 0:f.minutesMap)||void 0===i?void 0:i[v.matchUpId])||void 0===a?void 0:a.recoveryMinutes)||0,I=m.every((function(e){var t;sS({individualParticipantProfiles:s,participantId:e});var r=s[e];if(!r.timeAfterRecovery)return!0;var n=oi(null===(t=null==v?void 0:v.schedule)||void 0===t?void 0:t.endTime),i=n?mi(n,l(g)):mi(p,l(h)+l(g));return!!!u(u([],o(Object.keys(r.potentialBookings).filter((function(e){return e!==v.drawId})).map((function(e){return r.potentialBookings[e]})).flat()),!1),o(r.bookings),!1).find((function(e){return(t={scheduleTime:p,timeAfterRecovery:i},r=e,n=ii(t.scheduleTime),a=ii(t.timeAfterRecovery),o=ii(r.scheduleTime),u=ii(r.timeAfterRecovery),s=n>o&&n<u,l=o>n&&o<a,c=a>o&&a<u,d=u>n&&u<a,xn({hasOverlap:n===o||a===u||s||c||l||d,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:d},!0)).hasOverlap;var t,r,n,a,o,u,s,l,c,d}))})),y=c[v.matchUpId],U=y?fi(vi(y),vi(p),!1):0;return{enoughTime:I&&U>=0}}function SS(e){var t=e.individualParticipantProfiles,r=e.matchUpPotentialParticipantIds,n=e.matchUpDailyLimits,i=void 0===n?{}:n,a=e.matchUp,s=a.matchUpId,l=a.matchUpType,c=Wp(a).enteredIndividualParticipantIds,d=(a.roundPosition&&r[s]||[]).flat(),p=U(c.concat.apply(c,u([],o(d),!1)));p.forEach((function(e){sS({individualParticipantProfiles:t,participantId:e})}));var v=p.filter((function(e){var r=t[e];if(r)return[l,xc].find((function(e){var t,n=(null===(t=r.counters)||void 0===t?void 0:t[e])||0,a=i[e]||0;return n&&a&&n>=a}))}));return{participantIdsAtLimit:v,relevantParticipantIds:p}}function wS(e){var r,n,i,s,l,c,d,p,v,f=e.scheduleCompletedMatchUps,m=void 0!==f&&f,h=e.scheduleByeMatchUps,g=void 0!==h&&h,I=e.errorOnAnachronism,y=void 0!==I&&I,U=e.checkChronology,S=void 0===U||U,w=e.matchUpDependencies,T=e.removePriorValues,P=e.tournamentRecords,D=e.tournamentRecord,b=e.matchUpDetails,N=e.matchUpIds,M=e.schedule;if(!D)return{error:W};if(!(b||N&&Array.isArray(N)))return{error:Xe};if(!(b||M&&"object"==typeof M))return{error:wr};var R=[],A=0;if(S&&!w){var E=Xp({tournamentRecords:P,tournamentRecord:D});w=E.matchUpDependencies,v=E.matchUps}v||(v=null!==(c=null===(l=Kp({tournamentRecord:D}))||void 0===l?void 0:l.matchUps)&&void 0!==c?c:[]);var C=v.reduce((function(e,t){var r=t.matchUpId,n=t.drawId,i=t.matchUpStatus;return!g&&i===Fo||!m&&eu.includes(i)||(e[n]?e[n].push(r):e[n]=[r]),e}),{}),x=null==b?void 0:b.map((function(e){return e.matchUpId}));try{for(var O=a(Object.keys(C)),F=O.next();!F.done;F=O.next()){var k=F.value,_=oS({tournamentRecord:D,drawId:k}).drawDefinition;if(_){var j=C[k].filter((function(e){var t;return null!==(t=null==N?void 0:N.includes(e))&&void 0!==t?t:null==x?void 0:x.includes(e)})),B=Up({inContext:!1,drawDefinition:_}).matchUps,V=function(e){var t=jg({schedule:(null===(d=null==b?void 0:b.find((function(t){return t.matchUpId===e})))||void 0===d?void 0:d.schedule)||M,matchUpDependencies:w,errorOnAnachronism:y,removePriorValues:T,inContextMatchUps:v,tournamentRecords:P,tournamentRecord:D,checkChronology:S,drawDefinition:_,drawMatchUps:B,matchUpId:e});if((null===(p=null==t?void 0:t.warnings)||void 0===p?void 0:p.length)&&R.push.apply(R,u([],o(t.warnings),!1)),(null==t?void 0:t.success)&&(A+=1),t.error)return{value:t}};try{for(var G=(i=void 0,a(j)),q=G.next();!q.done;q=G.next()){var H=V(q.value);if("object"==typeof H)return H.value}}catch(e){i={error:e}}finally{try{q&&!q.done&&(s=G.return)&&s.call(G)}finally{if(i)throw i.error}}}}}catch(e){r={error:e}}finally{try{F&&!F.done&&(n=O.return)&&n.call(O)}finally{if(r)throw r.error}}return R.length?t(t({},L),{scheduled:A,warnings:R}):t(t({},L),{scheduled:A})}function TS(e){var r,n,i,s,l,c=e.scheduleCompletedMatchUps,d=void 0!==c&&c,p=e.scheduleByeMatchUps,v=void 0!==p&&p,f=e.errorOnAnachronism,m=e.matchUpContextIds,h=e.removePriorValues,g=e.tournamentRecords,I=e.checkChronology,y=e.matchUpDetails,U=e.schedule;if(e.matchUpIds&&!m)return wS(e);var S=da(e,[(r={},r[xi]=!0,r),(n={},n[sa]={matchUpContextIds:!1,matchUpDetails:!1},n[oa]=xr,n[ua]=ia,n)]);if(S.error)return S;if((!y||m)&&!U)return{error:pt,info:"schedule is required"};var w=[],T=0,P=Xp({tournamentRecords:g}).matchUpDependencies,D=function(e){var t=e.tournamentId,r=null==m?void 0:m.filter((function(e){return e.tournamentId===t})).map(Ro),n=null==y?void 0:y.filter((function(e){return(null==e?void 0:e.tournamentId)===t}));if((null==r?void 0:r.length)||(null==n?void 0:n.length)){var i=wS({matchUpDetails:n,scheduleCompletedMatchUps:d,scheduleByeMatchUps:v,matchUpDependencies:P,errorOnAnachronism:f,removePriorValues:h,tournamentRecords:g,tournamentRecord:e,checkChronology:I,matchUpIds:r,schedule:U});if((null===(l=i.warnings)||void 0===l?void 0:l.length)&&w.push.apply(w,u([],o(i.warnings),!1)),i.scheduled&&(T+=i.scheduled),i.error)return{value:i}}};try{for(var b=a(Object.values(g)),N=b.next();!N.done;N=b.next()){var M=D(N.value);if("object"==typeof M)return M.value}}catch(e){i={error:e}}finally{try{N&&!N.done&&(s=b.return)&&s.call(b)}finally{if(i)throw i.error}}return w.length?t(t({},L),{scheduled:T,warnings:w}):t(t({},L),{scheduled:T})}function PS(e){var t,r,n,i=e.autoSchedulingAudit,o=e.tournamentRecords;mn({topic:od,payload:i});var u=function(e){return e?Object.values(e).reduce((function(e,t){return e+t.length||0}),0):0},s=((null==i?void 0:i.schedulingProfile)||[]).reduce((function(e,t){return e+t.venues.reduce((function(e,t){return e+t.rounds.length}),0)}),0),l={scheduledDatesCount:null===(n=i.scheduledDates)||void 0===n?void 0:n.length,noTimeMatchUpIdsCount:u(null==i?void 0:i.noTimeMatchUpIds),scheduledMatchUpIdsCount:u(null==i?void 0:i.scheduledMatchUpIds),overLimitMatchUpIdsCount:u(null==i?void 0:i.overLimitMatchUpIds),requestConflictsCount:u(null==i?void 0:i.requestConflicts),profileRoundsCount:s},c={itemType:bf,itemValue:l};try{for(var d=a(Object.values(o)),p=d.next();!p.done;p=d.next()){gf({tournamentRecord:p.value,timeItem:c})}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}}function DS(e){var r,n,i,o,u,s,l,c=e.tournamentRecords,d=e.requestType,p=da(e,[(r={},r[xi]=!0,r)]);if(p.error)return p;var v={};try{for(var f=a(Object.values(c)),m=f.next();!m.done;m=f.next()){var h=Vn({element:m.value,name:po}).extension,g=(null==h?void 0:h.value)||[];try{for(var I=(o=void 0,a(g)),y=I.next();!y.done;y=I.next()){var U=y.value||{},S=U.personId,w=U.requests;v[S]||(v[S]=[]);try{for(var T=(s=void 0,a(w)),P=T.next();!P.done;P=T.next()){var D=P.value;d&&D.requestType!==d||v[S].push(D)}}catch(e){s={error:e}}finally{try{P&&!P.done&&(l=T.return)&&l.call(T)}finally{if(s)throw s.error}}}}catch(e){o={error:e}}finally{try{y&&!y.done&&(u=I.return)&&u.call(I)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}return t({personRequests:v},L)}function bS(e){var t=e.averageMinutes,r=e.startTime,n=e.endTime,i=e.court,a=e.date;if(!Array.isArray(i.dateAvailability))return{error:pt,stack:"getEarliestCourtTime"};var o=BU({scheduleDate:a,courts:[i],startTime:!0}),u=BU({scheduleDate:a,courts:[i],endTime:!0});r=r||o,n=n||u;var s=FU({courtDate:OU({court:i,date:a})}),l=vi(r),c=vi(n);return{earliestCourtTime:s.reduce((function(e,r){var n=vi(r.startTime),i=vi(r.endTime);if(n>c||i<l)return e;var a=l>n?l:n;if(fi(a,i)>=t){var o=oi(a.toISOString());(!e||o<e)&&(e=o)}return e}),void 0),courtStartTime:o,courtEndTime:u}}function NS(e){var r,n,i=e.scheduleAttributes,o=void 0===i?["scheduledDate","scheduledTime"]:i,u=e.ignoreMatchUpStatuses,s=void 0===u?eu:u,l=e.scheduledDates,c=e.venueIds,d=$c(e),p=Di(d)?Object.values(d).map((function(e){return e.tournamentId})).filter(Boolean):[];if(!(null==p?void 0:p.length))return{error:q};var v=0;try{for(var f=a(p),m=f.next();!m.done;m=f.next()){var h=MS({ignoreMatchUpStatuses:s,scheduleAttributes:o,tournamentRecord:d[m.value],scheduledDates:l,venueIds:c});if(h.error)return h;v+=h.clearedScheduleCount||0}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return t(t({},L),{clearedScheduleCount:v})}function MS(e){var r,n,i,o,u,s=e.scheduleAttributes,l=void 0===s?["scheduledDate","scheduledTime"]:s,c=e.ignoreMatchUpStatuses,d=void 0===c?eu:c,p=e.tournamentRecord,v=e.scheduledDates,f=e.venueIds,m=void 0===f?[]:f;if("object"!=typeof p)return{error:W};if(!Array.isArray(d)||!Array.isArray(m))return{error:xr};m.length&&l.push("venueId");var h=(null!==(i=Kp({matchUpFilters:{scheduledDates:v},tournamentRecord:p}).matchUps)&&void 0!==i?i:[]).filter((function(e){return e.matchUpStatus&&!d.includes(e.matchUpStatus)&&gS({schedule:e.schedule,scheduleAttributes:l})&&(!(null==m?void 0:m.length)||m.includes(e.schedule.venueId))})).map(Ro),g=null!==(o=Kp({tournamentRecord:p,inContext:!1}).matchUps)&&void 0!==o?o:[],I=0;try{for(var y=a(g),U=y.next();!U.done;U=y.next()){var S=U.value;h.includes(S.matchUpId)&&(S.timeItems=(null!==(u=S.timeItems)&&void 0!==u?u:[]).filter((function(e){return(null==e?void 0:e.itemType)&&![tc,rc,ec,ic,oc].includes(null==e?void 0:e.itemType)})),I+=1)}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}return t(t({},L),{clearedScheduleCount:I})}function RS(e){var r,n,i=e.checkPotentialRequestConflicts,s=void 0===i||i,l=e.scheduleCompletedMatchUps,c=e.clearScheduleDates,d=e.scheduleDates,p=void 0===d?[]:d,v=e.tournamentRecords,f=e.periodLength,m=e.useGarman,h=e.dryRun,g=e.pro,I=da(e,[(r={},r[xi]=!0,r),(n={},n[aa]=function(e){return!e||Array.isArray(e)&&e.every(Jn)},n[ji]=!1,n[ua]=ia,n)]);if(I.error)return I;var y=pf({tournamentRecords:v});if(y.error)return y;if(!y.schedulingProfile.length)return t({},L);var U=y.modifications,S=y.issues,w=void 0===S?[]:S,T=y.schedulingProfile,P=void 0===T?[]:T,D=Object.assign.apply(Object,u([{}],o(Object.values(v).map((function(e){return jp({tournamentRecord:e}).containedStructures}))),!1)),b=p.map((function(e){if(Jn(e))return ui(e)})).filter(Boolean),N=P.map((function(e){return e.scheduleDate})).map((function(e){return Jn(e)&&ui(e)})).filter((function(e){return e&&(!p.length||b.includes(e))}));if(!N.length)return{error:ft};c&&!h&&NS({tournamentRecords:v,scheduledDates:Array.isArray(c)?c:[]});var M=lf({ignoreDisabled:!1,tournamentRecords:v}).courts,R=Jp({matchUpFilters:{matchUpTypes:[Es,xs]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:v}).matchUps,A=Xp({includeParticipantDependencies:!0,tournamentRecords:v,matchUps:R}).matchUpDependencies,E=iS({tournamentRecords:v}).matchUpDailyLimits,C=DS({requestType:dS,tournamentRecords:v}).personRequests,x={schedulingProfileModifications:U,checkPotentialRequestConflicts:s,scheduleCompletedMatchUps:l,schedulingProfileIssues:w,dateSchedulingProfiles:P.filter((function(e){var t=ui(null==e?void 0:e.scheduleDate);return N.includes(t)})).sort((function(e,t){return new Date(e.scheduleDate).getTime()-new Date(t.scheduleDate).getTime()})),containedStructureIds:D,matchUpDependencies:A,matchUpDailyLimits:E,clearScheduleDates:c,tournamentRecords:v,schedulingProfile:P,personRequests:C,periodLength:f,useGarman:m,matchUps:R,dryRun:h,courts:M};return g?function(e){var r,n,i,s,l=e.schedulingProfileModifications,c=e.checkPotentialRequestConflicts,d=e.scheduleCompletedMatchUps,p=e.schedulingProfileIssues,v=e.dateSchedulingProfiles,f=e.containedStructureIds,m=e.matchUpDependencies,h=e.matchUpDailyLimits,g=e.clearScheduleDates,I=e.tournamentRecords,y=e.periodLength,U=void 0===y?30:y,S=e.schedulingProfile,w=e.personRequests,T=e.matchUps,P=void 0===T?[]:T,D=e.courts,b=e.dryRun,N={},M={},R={},A={},E={},C={},x={},O={},F={},k=function(e){var t,r,n,l,p,v,y,S,T=ui(null==e?void 0:e.scheduleDate),k=(null==e?void 0:e.venues)||[],_={},L={},j=function(e,t){e.forEach((function(e){var r=L[e].counters;r[t]?r[t]+=1:r[t]=1,r[xc]?r[xc]+=1:r[xc]=1}))};N[T]={},M[T]={},C[T]=[],x[T]=[],O[T]=[],F[T]=[];var B={};null==P||P.forEach((function(e){var t;(null===(t=e.schedule)||void 0===t?void 0:t.scheduledDate)&&Ii(T,ui(e.schedule.scheduledDate))&&uS({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:B,matchUp:e})}));for(var V=yS({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:d,containedStructureIds:f,matchUpNotBeforeTimes:B,matchUpScheduleTimes:E,matchUpDependencies:m,clearScheduleDates:g,tournamentRecords:I,periodLength:U,scheduleDate:T,matchUps:P,courts:D,venues:k}),G=V.allDateScheduledByeMatchUpDetails,q=V.allDateScheduledMatchUpIds,W=V.venueScheduledRoundDetails,H=V.allDateMatchUpIds,z=null==P?void 0:P.filter((function(e){var t=e.matchUpId;return q.includes(t)})),Y=IS({dateScheduledMatchUps:z,tournamentRecords:I,scheduleDate:T,periodLength:U}).bookings,K=LU({scheduleDate:T,periodLength:U,bookings:Y,courts:D}).virtualCourts,J=null==K?void 0:K.reduce((function(e,t){var r=bS({date:T,averageMinutes:0,court:t}),n=r.earliestCourtTime,i=r.courtEndTime;return(!e.startTime||vi(n)<vi(e.startTime))&&(e.startTime=n),(!e.endTime||vi(i)>vi(e.endTime))&&(e.endTime=i),e}),{}),Z=J.startTime,X=function(e){var t,r=e.courtId,n=e.booking;return null===(t=null==K?void 0:K.find((function(e){return e.courtId===r})))||void 0===t?void 0:t.dateAvailability[0].bookings.push(n)},Q=0,$=void 0;!$;){var ee=function(e){for(var t,r,n=W[e],s=n.matchUpsToSchedule.length,l=[],d=[],p=void 0,v=0;!p;){var f=function(t){var r;if(d.length===n.courtsCount||l.length===n.courtsCount)return p=!0,"break";var i=t.matchUpId,a=t.matchUpType,s=SS({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:h,matchUp:t}),v=s.participantIdsAtLimit,f=s.relevantParticipantIds;if(v.length)return x[T].includes(i)||x[T].push(i),"continue";var g=aS({matchUpScheduleTimes:E,matchUpDependencies:m,allDateMatchUpIds:H,matchUp:t}),I=g.dependenciesScheduled,y=g.remainingDependencies;if(!I)return M[T][i]||(M[T][i]=[]),M[T][i].push({remainingDependencies:y}),"continue";var S=[],P=null==K?void 0:K.reduce((function(e,r){var s,l,p,v;if(d.includes(r.courtId))return e;var h=bS({averageMinutes:n.greatestAverageMinutes,startTime:Z,date:T,court:r}).earliestCourtTime;if(e.scheduleTime&&ii(h)>=ii(e.scheduleTime))return e;if(cS({matchUpScheduleTimes:E,matchUpDependencies:m,scheduleTime:h,matchUpId:i,details:n}).scheduledDependent)return e;if(!US({individualParticipantProfiles:L,matchUpNotBeforeTimes:B,matchUpDependencies:m,scheduleTime:h,details:n,matchUp:t}).enoughTime)return N[T][i]||(N[T][i]=[]),N[T][i].includes(h)||N[T][i].push(h),e;var g=(null===(l=null===(s=n.minutesMap)||void 0===s?void 0:s[i])||void 0===l?void 0:l.averageMinutes)||n.greatestAverageMinutes,I=vS({potentials:c,averageMatchUpMinutes:g,requestConflicts:F,personRequests:w,scheduleTime:h,scheduleDate:T,matchUp:t}).conflicts;if(null==I?void 0:I.length)return S.push.apply(S,u([],o(I),!1)),!1;j(f,a);var y=null===(v=null===(p=n.minutesMap)||void 0===p?void 0:p[i])||void 0===v?void 0:v.recoveryMinutes;return lS({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:B,averageMatchUpMinutes:g,matchUpDependencies:m,recoveryMinutes:y,scheduleTime:h,matchUp:t}),(!e.scheduleTime||ii(h)<ii(e.scheduleTime))&&(e.averageMatchUpMinutes=g,e.recoveryMinutes=y,e.scheduleTime=h,e.courtName=r.courtName,e.courtId=r.courtId),e}),{});if(P.scheduleTime){var D=P.averageMatchUpMinutes,b=P.recoveryMinutes,C=P.scheduleTime,O=P.courtId;E[i]=C,A[i]=O,l.push(i),d.push(O);var k=C,V=mi(k,D);X({courtId:O,booking:{averageMatchUpMinutes:D,recoveryMinutes:b,periodLength:U,matchUpId:i,startTime:k,courtId:O,endTime:V,venueId:e}}),n.matchUpsToSchedule=n.matchUpsToSchedule.filter((function(e){return e.matchUpId!==i}))}else(null==S?void 0:S.length)&&(R[T]||(R[T]=[]),(r=R[T]).push.apply(r,u([],o(S),!1)))};try{for(var g=(t=void 0,a(n.matchUpsToSchedule)),I=g.next();!I.done&&"break"!==f(I.value);I=g.next());}catch(e){t={error:e}}finally{try{I&&!I.done&&(r=g.return)&&r.call(g)}finally{if(t)throw t.error}}d.length!==n.courtsCount&&l.length!==n.courtsCount&&n.matchUpsToSchedule.length||(p=!0),n.matchUpsToSchedule.length&&l<n.courtsCount&&(vi(Z)<vi(J.endTime)?Z=mi(Z,U):(p=!0,n.complete=!0)),v+=1,!p&&v>=s&&(p=!0)}(null===(i=n.matchUpsToSchedule)||void 0===i?void 0:i.length)||(n.complete=!0)};try{for(var te=(t=void 0,a(k)),re=te.next();!re.done;re=te.next())ee(re.value.venueId)}catch(e){t={error:e}}finally{try{re&&!re.done&&(r=te.return)&&r.call(te)}finally{if(t)throw t.error}}Q+=1,$=k.every((function(e){var t=e.venueId;return W[t].complete}))||10===Q}var ne=function(e){var t=W[e].matchUpMap;Object.keys(t).forEach((function(e){var r=I[e];r&&Object.keys(t[e]).forEach((function(n){var i=oS({tournamentRecord:r,drawId:n}).drawDefinition;i&&t[e][n].forEach((function(e){var t=e.matchUpId,n=E[t],a=A[t];if(n){var o=n.split(":").map(gi).join(":"),u="".concat(ui(T),"T").concat(o);b||(kg({drawDefinition:i,scheduledTime:u,matchUpId:t}),Fg({courtDayDate:T,tournamentRecords:I,tournamentRecord:r,drawDefinition:i,matchUpId:t,courtId:a})),C[T].push(t)}}))}))})),O[T]=W[e].matchUpsToSchedule.map(Ro)};try{for(var ie=(n=void 0,a(k)),ae=ie.next();!ae.done;ae=ie.next())ne(ae.value.venueId)}catch(e){n={error:e}}finally{try{ae&&!ae.done&&(l=ie.return)&&l.call(ie)}finally{if(n)throw n.error}}!b&&(null==G?void 0:G.length)&&TS({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:I,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});try{for(var oe=(p=void 0,a(e.venues)),ue=oe.next();!ue.done;ue=oe.next()){var se=ue.value;try{for(var le=(y=void 0,a(se.rounds)),ce=le.next();!ce.done;ce=le.next()){var de=ce.value,pe=(null!==(s=de.matchUps)&&void 0!==s?s:[]).map((function(e){return e.matchUpId})),ve=null==pe?void 0:pe.filter((function(e){return C[T].includes(e)}));de.canScheduledMatchUpIds=ve;var fe=Math.round(((null==ve?void 0:ve.length)||0)/de.matchUpsCount*1e4)/100;(fe===1/0||isNaN(fe))&&(fe=void 0),de.possibleToSchedulePct=fe,de.matchUpsCount===(null==ve?void 0:ve.length)&&(de.possibleToSchedule=!0)}}catch(e){y={error:e}}finally{try{ce&&!ce.done&&(S=le.return)&&S.call(le)}finally{if(y)throw y.error}}}}catch(e){p={error:e}}finally{try{ue&&!ue.done&&(v=oe.return)&&v.call(oe)}finally{if(p)throw p.error}}};try{for(var _=a(null!=v?v:[]),j=_.next();!j.done;j=_.next())k(j.value)}catch(e){r={error:e}}finally{try{j&&!j.done&&(n=_.return)&&n.call(_)}finally{if(r)throw r.error}}var B=(null!=v?v:[]).map((function(e){return e.scheduleDate})),V={timeStamp:Date.now(),overLimitMatchUpIds:x,scheduledMatchUpIds:C,schedulingProfile:S,noTimeMatchUpIds:O,requestConflicts:F,scheduledDates:B};return PS({tournamentRecords:I,autoSchedulingAudit:V}),t(t({},L),{schedulingProfileModifications:l,schedulingProfileIssues:p,dateSchedulingProfiles:v,recoveryTimeDeferredMatchUpIds:N,dependencyDeferredMatchUpIds:M,matchUpScheduleTimes:E,overLimitMatchUpIds:x,scheduledMatchUpIds:C,noTimeMatchUpIds:O,requestConflicts:F,scheduledDates:B})}(x):function(e){var r,n,i,s,l,c,d,p,v,f=e.schedulingProfileModifications,m=e.checkPotentialRequestConflicts,h=e.scheduleCompletedMatchUps,g=e.schedulingProfileIssues,I=e.dateSchedulingProfiles,y=e.containedStructureIds,U=e.matchUpDependencies,S=e.matchUpDailyLimits,w=e.clearScheduleDates,T=e.tournamentRecords,P=e.schedulingProfile,D=e.personRequests,b=e.periodLength,N=e.matchUps,M=e.courts,R=e.dryRun,A={},E={},C={},x={},O={},F={},k={},_={},j={},B={},V=function(e){var t,r,n,f,g,I,P,L,V=ui(null==e?void 0:e.scheduleDate),G=(null==e?void 0:e.venues)||[],q={},W={},H=function(e,t){e.forEach((function(e){var r=W[e].counters;r[t]?r[t]+=1:r[t]=1,r[xc]?r[xc]+=1:r[xc]=1}))};C[V]={},x[V]={},A[V]={},E[V]={},k[V]=[],_[V]=[],j[V]=[],B[V]=[];var z={};N.forEach((function(e){var t;(null===(t=e.schedule)||void 0===t?void 0:t.scheduledDate)&&Ii(V,ui(e.schedule.scheduledDate))&&uS({matchUpPotentialParticipantIds:q,matchUpNotBeforeTimes:z,matchUp:e})}));for(var Y=yS({matchUpPotentialParticipantIds:q,individualParticipantProfiles:W,scheduleCompletedMatchUps:h,containedStructureIds:y,matchUpNotBeforeTimes:z,matchUpScheduleTimes:F,matchUpDependencies:U,clearScheduleDates:w,tournamentRecords:T,useGarman:!0,periodLength:b,scheduleDate:V,matchUps:N,courts:M,venues:G}),K=Y.allDateScheduledByeMatchUpDetails,J=Y.venueScheduledRoundDetails,Z=Y.allDateMatchUpIds,X=0,Q=void 0;!Q;){var $=function(e){for(var t=0,r=J[e],n=function(){var n=r.scheduleTimes.shift(),i=n.scheduleTime,a=n.attempts,s=void 0===a?0:a,l=r.matchUpsToSchedule.find((function(e){var t,n,a,s=e.matchUpId,l=e.matchUpType,c=SS({matchUpPotentialParticipantIds:q,individualParticipantProfiles:W,matchUpDailyLimits:S,matchUp:e}),d=c.participantIdsAtLimit,p=c.relevantParticipantIds;if(d.length)return _[V].includes(s)||_[V].push(s),!1;if(cS({matchUpScheduleTimes:F,matchUpDependencies:U,scheduleTime:i,matchUpId:s,details:r}).scheduledDependent)return!1;var v=aS({matchUpScheduleTimes:F,matchUpDependencies:U,allDateMatchUpIds:Z,matchUp:e}),f=v.dependenciesScheduled,h=v.remainingDependencies;if(!f)return x[V][s]||(x[V][s]=[]),x[V][s].push({scheduleTime:i,remainingDependencies:h}),!1;if(!US({individualParticipantProfiles:W,matchUpNotBeforeTimes:z,matchUpDependencies:U,scheduleTime:i,details:r,matchUp:e}).enoughTime)return C[V][s]||(C[V][s]=[]),C[V][s].push({scheduleTime:i}),!1;var g=r.greatestAverageMinutes,I=vS({potentials:m,averageMatchUpMinutes:g,requestConflicts:B,personRequests:D,scheduleTime:i,scheduleDate:V,matchUp:e}).conflicts;if(null==I?void 0:I.length)return O[V]||(O[V]=[]),(t=O[V]).push.apply(t,u([],o(I),!1)),!1;H(p,l);var y=null===(a=null===(n=r.minutesMap)||void 0===n?void 0:n[s])||void 0===a?void 0:a.recoveryMinutes;return lS({matchUpPotentialParticipantIds:q,individualParticipantProfiles:W,matchUpNotBeforeTimes:z,averageMatchUpMinutes:g,matchUpDependencies:U,recoveryMinutes:y,scheduleTime:i,matchUp:e}),F[s]=i,!0}));r.matchUpsToSchedule=r.matchUpsToSchedule.filter((function(e){return e.matchUpId!==(null==l?void 0:l.matchUpId)})),l?t+=1:(E[V][e]||(E[V][e]=[]),E[V][e].push({scheduleTime:i,attempts:s+1}))};r.courtsCount&&(null===(i=r.scheduleTimes)||void 0===i?void 0:i.length)&&(null===(s=r.matchUpsToSchedule)||void 0===s?void 0:s.length)&&t<=r.courtsCount;)n();(null===(l=r.matchUpsToSchedule)||void 0===l?void 0:l.length)&&(E[V][e]=null===(c=E[V][e])||void 0===c?void 0:c.filter((function(e){var t=e.attempts<10;return t&&r.scheduleTimes.push(e),!t}))),(null===(d=r.scheduleTimes)||void 0===d?void 0:d.length)&&(null===(p=r.matchUpsToSchedule)||void 0===p?void 0:p.length)||(r.complete=!0)};try{for(var ee=(t=void 0,a(G)),te=ee.next();!te.done;te=ee.next())$(te.value.venueId)}catch(e){t={error:e}}finally{try{te&&!te.done&&(r=ee.return)&&r.call(ee)}finally{if(t)throw t.error}}X+=1,Q=G.every((function(e){var t=e.venueId;return J[t].complete}))||10===X}var re=function(e){var t=J[e].matchUpMap;Object.keys(t).forEach((function(r){var n=T[r];n&&Object.keys(t[r]).forEach((function(i){var a=oS({tournamentRecord:n,drawId:i}).drawDefinition;a&&t[r][i].forEach((function(t){var r=t.matchUpId,i=F[r];if(i){var o=i.split(":").map(gi).join(":"),u="".concat(ui(V),"T").concat(o);R?k[V].push(r):(kg({drawDefinition:a,scheduledTime:u,matchUpId:r}).success&&k[V].push(r),e&&Og({tournamentRecord:n,drawDefinition:a,matchUpId:r,venueId:e}))}}))}))})),j[V]=J[e].matchUpsToSchedule.map(Ro),A[V][e]=J[e].scheduleTimes.sort((function(e,t){return ii(e.scheduleTime)-ii(t.scheduleTime)}))};try{for(var ne=(n=void 0,a(G)),ie=ne.next();!ie.done;ie=ne.next())re(ie.value.venueId)}catch(e){n={error:e}}finally{try{ie&&!ie.done&&(f=ne.return)&&f.call(ne)}finally{if(n)throw n.error}}!R&&(null==K?void 0:K.length)&&TS({matchUpDetails:K,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:T,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});try{for(var ae=(g=void 0,a(e.venues)),oe=ae.next();!oe.done;oe=ae.next()){var ue=oe.value;try{for(var se=(P=void 0,a(ue.rounds)),le=se.next();!le.done;le=se.next()){var ce=le.value,de=(null===(v=ce.matchUps)||void 0===v?void 0:v.map((function(e){return e.matchUpId})))||[],pe=de.filter((function(e){return k[V].includes(e)}));ce.canScheduledMatchUpIds=pe;var ve=Math.round(pe.length/ce.matchUpsCount*1e4)/100;(ve===1/0||isNaN(ve))&&(ve=0),ce.possibleToSchedulePct=ve,ce.matchUpsCount===pe.length&&(ce.possibleToSchedule=!0)}}catch(e){P={error:e}}finally{try{le&&!le.done&&(L=se.return)&&L.call(se)}finally{if(P)throw P.error}}}}catch(e){g={error:e}}finally{try{oe&&!oe.done&&(I=ae.return)&&I.call(ae)}finally{if(g)throw g.error}}};try{for(var G=a(I),q=G.next();!q.done;q=G.next())V(q.value)}catch(e){r={error:e}}finally{try{q&&!q.done&&(n=G.return)&&n.call(G)}finally{if(r)throw r.error}}var W=I.map((function(e){return e.scheduleDate})),H={timeStamp:Date.now(),overLimitMatchUpIds:_,scheduledMatchUpIds:k,schedulingProfile:P,noTimeMatchUpIds:j,requestConflicts:B,scheduledDates:W};return PS({tournamentRecords:T,autoSchedulingAudit:H}),t(t({},L),{schedulingProfileModifications:f,schedulingProfileIssues:g,scheduleTimesRemaining:A,dateSchedulingProfiles:I,skippedScheduleTimes:E,recoveryTimeDeferredMatchUpIds:C,dependencyDeferredMatchUpIds:x,matchUpScheduleTimes:F,overLimitMatchUpIds:_,scheduledMatchUpIds:k,noTimeMatchUpIds:j,requestConflicts:B,scheduledDates:W})}(x)}function AS(e){var r=e||{};return r.tournamentId||(r.tournamentId=ed()),(!r.startDate||ri(r.startDate)||Gn.test(r.startDate))&&(!r.endDate||ri(r.endDate)||Gn.test(r.endDate))?(r.extensions&&(r.extensions=r.extensions.filter(Ln)),t({},r)):{error:It}}function ES(e){var r,n,i,o,u,s,l,c,d=e.addParticipants,p=void 0===d||d,v=e.participantAttribute,f=e.tournamentRecord,m=e.personAttribute,h=e.teamNames,g=e.accessor,I=e.uuids;if(!f)return{error:W};var y={},U=(null!==(i=f.participants)&&void 0!==i?i:[]).filter((function(e){var t=e.participantType,r=e.participantRole;return t===fs&&r===Vv})),S=0;try{for(var w=a(U),T=w.next();!T.done;T=w.next()){var P=T.value,D=g&&(null===(o=wi({element:P,accessor:g}))||void 0===o?void 0:o.value)||m&&(null===(u=P.person)||void 0===u?void 0:u[m])||v&&P[v];if(D){if(!Object.keys(y).includes(D)){y[D]={participantName:null!==(s=null==h?void 0:h[S])&&void 0!==s?s:D,participantId:null!==(l=null==I?void 0:I.pop())&&void 0!==l?l:ed(),individualParticipantIds:[],participantRole:Vv,participantType:gs};var b={value:null!=m?m:v,name:oo};jn({element:y[D],extension:b}),S+=1}y[D].individualParticipantIds.push(P.participantId)}}}catch(e){r={error:e}}finally{try{T&&!T.done&&(n=w.return)&&n.call(w)}finally{if(r)throw r.error}}var N=Object.keys(y),M=(null!==(c=f.participants)&&void 0!==c?c:[]).map((function(e){if(e.participantType===gs&&e.participantRole===Vv){var t=Vn({name:oo,element:e}).extension,r=null==t?void 0:t.value;return N.includes(r)?e.participantId:void 0}})).filter(Boolean),R=0,A=[];return Object.keys(y).forEach((function(e){var t=y[e],r=t.participantId;M.includes(r)||(f.participants||(f.participants=[]),p&&f.participants.push(t),A.push(t),R++)})),p&&R?(mn({payload:{tournamentId:f.tournamentId,participants:A},topic:nd}),t(t({},L),{participantsAdded:R})):A.length?t(t({},L),{newParticipants:A}):{error:Pt}}function CS(e){var t=e.idPrefix,r=e.participantType,n=e.index,i=e.uuids,a=r===fs?"I":"P";return t?"".concat(t,"-").concat(a,"-").concat(n):(null==i?void 0:i.pop())||ed()}function xS(e){var r=e.rankingRange,n=e.scaledParticipantsCount,i=e.ratingsParameters,s=void 0===i?KI:i,l=e.valuesInstanceLimit,c=e.consideredDate,d=e.category,p=e.nationalityCodesCount,v=e.nationalityCodeType,m=e.nationalityCodes,h=e.participantsCount,I=void 0===h?32:h,U=e.participantType,w=e.personIds,T=e.idPrefix,P=e.uuids,D=e.personExtensions,b=e.addressProps,N=e.gendersCount,M=e.matchUpType,A=e.personData,E=e.sex,C=e.inContext,x=e.withISO2,O=e.withIOC,F=e.scaleAllParticipants,k=U===hs||M===Cs,_=U===gs||M===gs;!r||Array.isArray(r)&&r.every((function(e){return f(e)}))&&2===r.length||(r=void 0),n=F?I:n;(r=r||[1,n&&n>1e3?n:1e3])[1]+=1;var L=I*(k?2:_?8:1),j=ZU({count:L,personExtensions:D,consideredDate:c,gendersCount:N,personData:A,category:d,sex:E});if(j.error)return j;var B=j.nationalityCodes,V=j.persons,G=[],q=[],W=[],H=[];if("object"==typeof d){var z=d.categoryName,Y=d.ageCategoryCode,K=d.ratingType;if((z||Y)&&!K){var J=o(r||[],2),Z=J[0],X=J[1];if(q=S(R(Z,X)).slice(0,n||g(20,30)),[hs,gs].includes(U)){var Q=o(r||[],2),$=Q[0],ee=Q[1];G=S(R($,ee)).slice(0,n||g(20,30))}}if(K&&s[K]){var te=d.ratingMax,re=d.ratingMin,ne=d.ratingAttributes,ie=t(t({},s[K]),ne||{}),ae=ie.attributes,oe=void 0===ae?{}:ae,ue=ie.decimalsCount,se=ie.accessors,le=ie.range,ce=ie.step,de=function(e){var t,r,n={},i=Object.keys(e||{});try{for(var u=a(i),s=u.next();!s.done;s=u.next()){var l=s.value,c=e[l];if("object"==typeof c&&c.generator){var d=o(c.range.slice().sort(),2),p=d[0],v=d[1];n[l]=g(p,v)}else n[l]=c}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return n},pe=le[0]>le[1]?2:.5,ve=o(le.slice().sort(),2),fe=ve[0],me=ve[1],he=function(){return R(0,2e3).map((function(){return y(fe,me,pe,ce,ue)})).filter((function(e){return(!te||e<=te)&&(!re||e>=re)})).slice(0,n||g(20,30)).map((function(e){return se?Object.assign.apply(Object,u(u([{}],o(se.map((function(t){var r;return(r={})[t]=e,r}))),!1),[de(oe)],!1)):e}))};W=he(),[hs,gs].includes(U)&&(H=he())}}var ge=ws.filter((function(e){return"IOC"===v&&e.ioc||e.iso}));var Ie,ye,Ue=b||{},Se=Ue.postalCodesProfile,we=Ue.postalCodesCount,Te=Ue.statesProfile,Pe=Ue.citiesProfile,De=Ue.citiesCount,be=Ue.statesCount,Ne=function(e){return Object.keys(e).map((function(e){return R(0,Te[e]).map((function(){return e}))})).flat()},Me={cities:Pe&&Ne(Pe)||(null==b?void 0:b.cities)||HU({count:De||L,participantsCount:L}).cities,states:Te&&Ne(Te)||(null==b?void 0:b.states)||zU({count:be||L,participantsCount:L}).states,postalCodes:Se&&Ne(Se)||(null==b?void 0:b.postalCodes)||YU({count:we||L,participantsCount:L}).postalCodes},Re=(Ie=p,ye=Math.ceil(L/Ie),l&&ye>l?Math.ceil(L/l):Ie),Ae=Re?S(ge).slice(0,p):m?ge.filter((function(e){return m.includes(e.iso)})):ge,Ee=S(R(0,Math.ceil(L/(Re||1))).map((function(){return Ae})).flat(1/0)),Ce=$U({count:I}).names,xe=R(0,I).map((function(e){var r=k?2:_?8:1,n=R(0,r).map((function(n){return function(e){var r=V[e],n=r||{},i=n.nationalityCode,a=n.participantExtensions,o=n.participantTimeItems,u=n.extensions,s=n.firstName,l=n.birthDate,c=n.lastName,p=n.personId,f=n.sex,m=s||"GivenName",h=c||"FamilyName",g="".concat(m," ").concat(h),I=Ee[e],y=(null==B?void 0:B.length)&&i||I&&("IOC"===v?I.ioc||I.iso:I.iso||I.ioc)||i;!(null==Ee?void 0:Ee.length)||y||i||console.log("%c Invalid Nationality Code",{participantIndex:e,country:I});var U=XU(t(t({},Me),{participantIndex:e,nationalityCode:y})),S=xn({participantId:CS({participantType:fs,index:e,idPrefix:T,uuids:P}),extensions:a,timeItems:o,participantRole:Vv,participantType:fs,participantName:g,person:{addresses:[U],personId:p||(null==w?void 0:w.length)&&w[e]||ed(),standardFamilyName:h,standardGivenName:m,nationalityCode:y,extensions:u,birthDate:Jn(l)?l:void 0,sex:f}});if(O&&y){var D=ws.find((function(e){return e.iso===y}));(null==D?void 0:D.ioc)&&(S.person.iocNationalityCode=D.ioc),(null==D?void 0:D.label)&&(S.person.countryName=D.label)}if(x&&y){var b=ws.find((function(e){return e.iso===y}));(null==b?void 0:b.iso2)&&(S.person.iso2NationalityCode=b.iso2),(null==b?void 0:b.label)&&(S.person.countryName=b.label)}if(d){var N=q[e],M=G[e];OS({scaleValue:N,eventType:fa,scaleType:Sa,participant:S,category:d}),OS({scaleValue:M,eventType:ha,scaleType:Sa,participant:S,category:d});var R=W[e],A=H[e];OS({scaleValue:R,eventType:fa,scaleType:wa,participant:S,category:d}),OS({scaleValue:A,eventType:ha,scaleType:wa,participant:S,category:d})}return S}(e*r+n)})),i=n.map((function(e){return e.participantId})),a=n.map((function(e){return e.person.standardFamilyName})).join("/"),s=k?hs:gs,l={participantId:CS({participantType:s,idPrefix:T,index:e,uuids:P}),participantRole:Vv,participantName:k?a:Ce[e],individualParticipantIds:i,participantType:s};return C&&(l.individualParticipants=n),k||_?u([l],o(n),!1):n})).flat();return{participants:xe}}function OS(e){var t=e.scaleValue,r=e.participant,n=e.eventType,i=e.scaleType,a=e.category,o=a.categoryName||a.ratingType||a.ageCategoryCode,u={itemValue:t,itemType:[Ta,i,n,o].join(".")};o&&t&&(r.timeItems||(r.timeItems=[]),r.timeItems.push(u))}function FS(e){var t,r,n=e.alternatesCount,i=void 0===n?0:n,a=e.tieFormatName,o=e.tieFormat,u=e.drawSize,s=0,l=0,c=0,d=0,p={},v=((t={})[cp]=0,t[vp]=0,t[dp]=0,t[pp]=0,t[lp]=0,t);null===(r=null==(o="object"==typeof o?o:tU({namedFormat:a}))?void 0:o.collectionDefinitions)||void 0===r||r.filter(Boolean).forEach((function(e){var t=e.category,r=e.collectionId,n=e.matchUpType,i=e.matchUpCount,a=e.gender;if([cp,vp].includes(a)){var o=i*(n===xs?2:1);v[a]<o&&(v[a]=o)}else a===dp&&(v[cp]<i&&(v[cp]=i),v[vp]<i&&(v[vp]=i));if(t){var u=JSON.stringify(t);p[u]=t}if(r||(e.collectionId=ed()),n===xs){var f=i;d+=i,s=Math.max(s,f)}if(n===Es){var m=i;c+=i,l=Math.max(l,m)}}));var f=Object.keys(p).length?Math.max(c,2*d):Math.max(l,2*s);return{maxDoublesDraw:s*(u+i),maxSinglesDraw:l*(u+i),teamSize:f,genders:v}}function kS(e){var r=e.participantsProfile,n=e.tournamentRecord,i=e.eventProfiles,o=e.drawProfiles,u=e.startDate,s=e.uuids,l=function(e){var r,n,i,o=e.participantsProfile,u=e.eventProfiles,s=e.drawProfiles,l=o||{},c=l.participantsCount,d=l.participantType,p=void 0===d?fs:d,v=c||0,f=((r={})[vp]=0,r[dp]=0,r[pp]=0,r[cp]=0,r[lp]=0,r),m=0,h=0,g=0,I=0,y=0,U=function(e){var t=e.alternatesCount,r=void 0===t?0:t,n=e.uniqueParticipants,i=e.tieFormatName,a=e.drawSize,o=void 0===a?0:a,u=e.eventType,s=e.tieFormat,l=e.category,c=e.gender,d=e.stage,p=u===ma,v=u===ga,U=Boolean(n||d===au||l||c);if(v){I=Math.max(I,o+r);var S=FS({alternatesCount:r,tieFormatName:i,tieFormat:s="object"==typeof s?s:tU({namedFormat:i}),drawSize:o}),w=S.teamSize,T=S.maxDoublesDraw,P=S.maxSinglesDraw,D=S.genders;g=Math.max(g,w),h=Math.max(h,P),U||(m=Math.max(m,T)),Object.keys(D).forEach((function(e){return f[e]+=D[e]}))}else if(p)U?(y+=b=2*(o+r),c&&(f[c]+=b)):o+r&&o+r>m&&(m=o+r);else if(U){var b=o+r;c&&(f[c]+=b),y+=b}else o&&o>h&&(h=o+r)};if(null==u||u.forEach((function(e){var r,n,i=e.tieFormatName,o=e.tieFormat,u=e.drawProfiles,s=e.eventType,l=e.category,c=e.gender;if(u)try{for(var d=a(u),p=d.next();!p.done;p=d.next()){var v=p.value,f=v.tieFormatName,m=v.tieFormat;U(t(t({},v),{tieFormatName:f||i,tieFormat:m||o,eventType:s,category:l,gender:c}))}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}})),Array.isArray(s))try{for(var S=a(s),w=S.next();!w.done;w=S.next()){var T=w.value;U(T)}}catch(e){n={error:e}}finally{try{w&&!w.done&&(i=S.return)&&i.call(S)}finally{if(n)throw n.error}}var P=Math.max(I*g,2*m,h);return m&&(p=hs),(c||v)<P&&(c=P),c&&m&&[hs,ga].includes(p)&&(h&&Math.floor(h/2)>m?c=Math.floor(h/2):(!h||2*m>=h)&&(c=Math.ceil(c/2))),void 0===c&&(c=(null==u?void 0:u.length)||(null==s?void 0:s.length)?0:32),c<v&&(c=v),{uniqueParticipantsCount:y,participantsCount:c,largestTeamDraw:I,largestTeamSize:g,participantType:p,gendersCount:f}}({participantsProfile:r,eventProfiles:i,drawProfiles:o}),c=l.participantsCount,d=l.participantType,p=l.largestTeamDraw,v=l.largestTeamSize,f=l.gendersCount,m=null==r?void 0:r.teamKey,h=xS(t(t({uuids:s},r),{consideredDate:u,participantsCount:c,participantType:d,gendersCount:f})).participants,g=0,I=kI({tournamentRecord:n,participants:h});if(I.error)return I;if(g+=I.addedCount,m){var y=ES(t({tournamentRecord:n},m));if(y.error)return y}var U=h.filter((function(e){return e.participantType===fs})).map(Mo),S=(null==r?void 0:r.idPrefix)?"".concat(gs,"-").concat(r.idPrefix):void 0;return(I=kI({participants:R(0,p).map((function(e){var t=U.slice(e*v,(e+1)*v),r=CS({index:e,participantType:d,idPrefix:S,uuids:s});return{participantName:"Team ".concat(e+1),participantRole:Vv,individualParticipantIds:t,participantType:gs,participantId:r}})),tournamentRecord:n})).error?I:(g+=I.addedCount,t({addedCount:g},L))}var _S,LS=function(){return{altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}};function jS(e){return parseInt(e)}function BS(e){var t=void 0===e?{}:e,r=t.startTime,n=void 0===r?"":r,i=t.endTime,a=void 0===i?"":i;if(!(n&&a&&Hn.test(n)&&Hn.test(a)))return!1;var u=o(n.split(":").map(jS),2),s=u[0],l=u[1],c=o(a.split(":").map(jS),2),d=c[0],p=c[1];return!(d<s)&&!(s===d&&p<l)}function VS(e,t){var r=o(e.startTime.split(":").map(jS),2),n=r[0],i=r[1],a=o(t.startTime.split(":").map(jS),2),u=a[0],s=a[1];return n<u?-1:n>u?1:i<s?-1:i>s?1:0}function GS(e){var t,r,n,i,o=e.dateAvailability;if(!o)return{error:gt};if(!Array.isArray(o))return{error:ht};var u="Times must be 24 hour => 00:00";try{for(var s=a(o),l=s.next();!l.done;l=s.next()){var c=l.value;if("object"!=typeof c)return{error:ht};var d=c.date,p=c.startTime,v=c.endTime,f=c.bookings,m=void 0===f?[]:f;if(!p||!v)return{error:ht};if(d&&!Wn.test(d))return{error:It,dateAvailability:{date:d},info:"Dates must be formated => YYYY-MM-DD"};if(!Hn.test(p))return{error:yt,dateAvailability:{startTime:p},info:u};if(!Hn.test(v))return{error:yt,dateAvailability:{endTime:v},info:u};if(p===v)return{error:yt,dateAvailability:{startTime:p,endTime:v},info:"startTime and endTime are equivalent"};if(!BS({startTime:p,endTime:v}))return{error:yt,dateAvailability:{startTime:p,endTime:v},info:"endTime must be after startTime"};if(m){if(!Array.isArray(m))return{error:mt};try{for(var h=(n=void 0,a(m)),g=h.next();!g.done;g=h.next()){var I=g.value;if("object"!=typeof I)return{error:mt};var y=I.startTime,U=I.endTime;if(!Hn.test(y))return{error:yt,booking:{startTime:y},info:u};if(!Hn.test(U))return{error:yt,booking:{endTime:U},info:u};if(y===U)return{error:yt,dateAvailability:{startTime:y,endTime:U},info:"startTime and endTime are equivalent"};if(!BS({startTime:y,endTime:U}))return{error:yt,dateAvailability:{startTime:y,endTime:U},info:"endTime must be after startTime"}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return{valid:!0}}function qS(e){var r,n,i=e.tournamentRecord,o=e.disableNotice,u=e.venueId,s=e.courtId,l=e.court,c=Ed({tournamentRecord:i,venueId:u}).venue;if(!c)return{error:cr};c.courts||(c.courts=[]);var d=t(t({},LS()),{venueId:u,courtId:s});if(d.courtId||(d.courtId=ed()),c.courts.some((function(e){return e.courtId===d.courtId})))return{error:sr};var p=((null==l?void 0:l.dateAvailability)||[]).map((function(e){var r;return t(t({},e),{date:ui(e.date),startTime:oi(e.startTime),endTime:oi(e.endTime),bookings:null===(r=e.bookings)||void 0===r?void 0:r.map((function(e){var t=e.startTime,r=e.endTime,n=e.bookingType;return{startTime:oi(t),endTime:oi(r),bookingType:n}}))})})),v=Object.keys(d);try{for(var f=a(v),m=f.next();!m.done;m=f.next()){var h=m.value;if(null==l?void 0:l[h])if("dateAvailability"===h){var g=GS({dateAvailability:p});if(!g.valid&&g.error)return g;d.dateAvailability=p}else d[h]=l[h]}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}var I=d;return c.courts.push(I),o||mn({payload:{venue:c,tournamentId:i.tournamentId},topic:yd,key:c.venueId}),t(t({},L),{court:Ui(d),venueId:u})}function WS(e){var r,n,i,o,u,s,l,c,d=e.tournamentRecord,p=e.venueId;if("string"!=typeof p||!p)return{error:dr};var v,f=null!==(l=null!==(s=e.tournamentRecords)&&void 0!==s?s:d&&((r={})[d.tournamentId]=d,r))&&void 0!==l?l:{},m=[];try{for(var h=a(Object.values(f)),g=h.next();!g.done;g=h.next()){var I=g.value;if(Ed({tournamentRecord:I,venueId:p}).venue){var y=HS(t(t({},e),{tournamentRecord:I}));try{for(var U=(o=void 0,a(null!==(c=null==y?void 0:y.courts)&&void 0!==c?c:[])),S=U.next();!S.done;S=U.next()){var w=S.value;m.push(null==w?void 0:w.courtId)}}catch(e){o={error:e}}finally{try{S&&!S.done&&(u=U.return)&&u.call(U)}finally{if(o)throw o.error}}if(y.error)return y;v=!0}}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return v?t(t({},L),{courtIds:m}):{error:cr}}function HS(e){var r=e.courtNameRoot,n=void 0===r?"Court":r,i=e.dateAvailability,a=void 0===i?[]:i,o=e.venueAbbreviationRoot,u=e.tournamentRecord,s=e.courtNames,l=void 0===s?[]:s,c=e.courtTimings,d=e.courtsCount,p=e.startTime,v=e.courtIds,m=e.endTime,h=e.idPrefix,g=e.venueId,I=e.dates;if(!g)return{error:dr};var y=Ed({tournamentRecord:u,venueId:g});if(y.error)return y;var U=y.venue;if(!f(d)||!l)return{error:or};var S=R(0,d=null!=d?d:l.length).map((function(e){var r=null==c?void 0:c[e],i=r?I.map((function(e){return t({date:Xn(e),startTime:p,endTime:m},r)})):a;return r&&p&&m&&i.push({startTime:p,endTime:m}),{courtName:l[e]||o&&(null==U?void 0:U.venueAbbreviation)&&"".concat(null==U?void 0:U.venueAbbreviation," ").concat(e+1)||"".concat(n," ").concat(e+1),dateAvailability:i}})).map((function(e,t){var r=(null==v?void 0:v.pop())||h&&"".concat(h,"-").concat(t+1);return qS({disableNotice:!0,tournamentRecord:u,courtId:r,venueId:g,court:e})})).map((function(e){return e.court})).filter(Boolean);return S.length!==d?On({info:"not all courts could be generated",result:{error:xr}}):(U&&mn({payload:{venue:U,tournamentId:u.tournamentId},topic:yd,key:U.venueId}),t(t({},L),{courts:Ui(S)}))}function zS(e){var t,r,n,i=e.tournamentRecord,u=e.venueProfiles,s=e.uuids,l=i.startDate,c=i.endDate,d=[],p=function(e,t){var r=t.venueAbbreviation,a=t.venueId,o=void 0===a?null!==(n=null==s?void 0:s.pop())&&void 0!==n?n:ed():a,u=t.dateAvailability,p=t.startTime,v=void 0===p?"07:00":p,f=t.endTime,m=void 0===f?"19:00":f,h=t.courtTimings,g=t.courtsCount,I=t.courtNames,y=t.venueName,U=t.idPrefix,S=t.courtIds,w={venueName:y||"Venue ".concat(e+1),venueAbbreviation:r,venueId:o},T=Rd({tournamentRecord:i,venue:w});if(T.error)return{value:T};d.push(o);var P=ei(l,c),D=!Array.isArray(u)&&[{startTime:v,endTime:m}].concat(P.map((function(e){return{date:Xn(e),startTime:v,endTime:m}}))),b=WS({dateAvailability:u||D,tournamentRecord:i,courtTimings:h,courtsCount:g,courtNames:I,startTime:v,idPrefix:U,courtIds:S,endTime:m,venueId:o,dates:P});return b.error?{value:b}:void 0};try{for(var v=a(u.entries()),f=v.next();!f.done;f=v.next()){var m=o(f.value,2),h=p(m[0],m[1]);if("object"==typeof h)return h.value}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}return d}function YS(e){var t=e.drawProfiles,r=e.category,n=e.gender,i={},a=null==t?void 0:t.reduce((function(e,t){var a=t||{},o=a.qualifyingPositions,u=void 0===o?0:o,s=a.participantsCount,l=void 0===s?0:s,c=a.uniqueParticipants,d=a.stage,p=void 0===d?iu:d,v=a.drawSize,f=void 0===v?0:v;Object.keys(e).includes(p)||(e[p]=0);var m=(l||f)-u;return c||n||r||p===au?(Object.keys(i).includes(p)||(i[p]=0),i[p]+=m):e[p]=Math.max(e[p],m),e}),{}),o=Object.keys(i);return o.forEach((function(e){return a[e]+=i[e]})),{stageParticipantsCount:a,uniqueParticipantsCount:i,uniqueParticipantStages:o}}function KS(e){var t=e.allUniqueParticipantIds,r=e.stageParticipantsCount,n=e.eventParticipantType,i=e.targetParticipants,a=r[iu]||0,o=r[au]||0,u={QUALIFYING:i.filter((function(e){return e.participantType===n})).filter((function(e){var r=e.participantId;return!t.includes(r)})).slice(0,o),MAIN:i.filter((function(e){return e.participantType===n})).filter((function(e){var r=e.participantId;return!t.includes(r)})).slice(o,o+a)};return{stageParticipants:u}}function JS(e){var r,n,i=e.removePriorValues,a=e.tournamentRecord,o=e.participantId,u=e.scaleItem;if(!ZS({scaleItem:u}))return{error:Tr};if(o&&Array.isArray(a.participants)&&(n=a.participants.find((function(e){return e.participantId===o})))){var s=XS({removePriorValues:i,participant:n,scaleItem:u});if(s.error)return s;r=!s.valueChanged,Un().topics.includes(md)&&mn({topic:md,payload:{tournamentId:a.tournamentId,participants:[n]}})}return r&&t(t({},L),{info:Lr,existingValue:null==u?void 0:u.scaleValue})||n&&t(t({},L),{newValue:null==u?void 0:u.scaleValue})||{error:Lt}}function ZS(e){var t=e.scaleItem,r=t&&Object.keys(t),n=["scaleType","eventType","scaleName"];return!!(n.filter((function(e){return null==r?void 0:r.includes(e)})).length===n.length)}function XS(e){var r=e.removePriorValues,n=e.participant,i=e.scaleItem;if(!n)return{error:Ft};var a=i&&Object.keys(i),o=["scaleType","eventType","scaleName"];if(!(o.filter((function(e){return a.includes(e)&&i[e]})).length===o.length))return{error:Tr};var u=(new Date).toISOString();n.timeItems||(n.timeItems=[]);var s=yv({scaleAttributes:i,participant:n}).scaleItem,l=function(e){return[void 0,null,""].includes(e)},c=!(l(null==s?void 0:s.scaleValue)&&l(i.scaleValue))&&JSON.stringify(null==s?void 0:s.scaleValue)!==JSON.stringify(i.scaleValue);if(c){var d=i.scaleType,p=i.eventType,v=i.scaleName,f=[Ta,d,p,v].join("."),m=xn({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:u,itemType:f});i.scaleId&&(m.itemSubTypes=[i.scaleId]),r&&(n.timeItems=n.timeItems.filter((function(e){return e.itemType!==f}))),n.timeItems.push(m)}return t(t({},L),{valueChanged:c,newValue:i.scaleValue})}function QS(e){var t=e.matchUpScoringFormat,r=e.isDecidingSet,n=e.isTiebreakSet,i=e.setObject;if(i){var a=$S({set:i}),o=function(e){var t=e.ignoreTiebreak,r=void 0!==t&&t,n=e.matchUpScoringFormat,i=e.matchUpFormat,a=e.isTiebreakSet,o=e.isDecidingSet,u=e.set;if(!u)return{error:pt,info:"missing set"};n=n||i&&Zd(i);var s=o&&n.finalSetFormat||(null==n?void 0:n.setFormat)||{},l=u.side1Score,c=u.side2Score,d=s.setTo,p=s.tiebreakAt,v=s.tiebreakFormat,f=null==v?void 0:v.NoAd,m=$S({set:u}),h=Math.abs(l-c),g=l>=d||c>=d,I=a||l>=d&&c>=d||p&&p<d&&(l===p||c===p),y=r||I&&(1===m&&u.side1TiebreakScore>u.side2TiebreakScore||2===m&&u.side2TiebreakScore>u.side1TiebreakScore),U=I&&(p&&!a||a&&f)?1:2,S=h>=U;return(g&&(S||I)||a)&&(!I||y)}({matchUpScoringFormat:t,isDecidingSet:r,isTiebreakSet:n,set:i});return o&&a||void 0}}function $S(e){var t=e.set;if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function ew(e){var t=e.setObject,r=e.matchUpScoringFormat;if(!t)return{error:ct};var n=(t||{}).setNumber,i=(r||{}).bestOf,a=!(!n||!i||n!==i),o=a&&(null==r?void 0:r.finalSetFormat)||(null==r?void 0:r.setFormat),u=!!(null==o?void 0:o.tiebreakSet),s=!!(null==o?void 0:o.timed),l=!u&&!s,c=!!(n&&i&&n<=i),d=[null==t?void 0:t.side1Score,null==t?void 0:t.side2Score],p=[null==t?void 0:t.side1PointScore,null==t?void 0:t.side2PointScore],v=[null==t?void 0:t.side1TiebreakScore,null==t?void 0:t.side2TiebreakScore],f=d.filter((function(e){return void 0!==e})).length,m=p.filter((function(e){return void 0!==e})).length,h=v.filter((function(e){return void 0!==e})).length,g=null==d?void 0:d.filter((function(e){return!isNaN(e)})).length,I=null==v?void 0:v.filter((function(e){return!isNaN(e)})).length,y=(o||{}).tiebreakAt,U=y&&2===d.filter((function(e){return e>=y})).length,S=U&&((d[0]>d[1]?1:d[1]>d[0]&&2)||void 0),w=!(!I||g),T=!!(null==t?void 0:t.winningSide),P=function(e){var t=e.setObject,r=e.setFormat,n=e.sideGameScores,i=e.sideTiebreakScores;if(!t)return{result:!1,error:ct};var a=!!(null==r?void 0:r.tiebreakSet),o=!!(null==r?void 0:r.timed);if(!r||a||o)return{result:!1,error:xr};var u=2===(null==n?void 0:n.filter((function(e){return!isNaN(e)})).length);if(!u)return{result:!1,error:St};var s=r||{},l=s.setTo,c=s.tiebreakAt,d=s.tiebreakFormat,p=s.NoAD,v=!(!l||!(null==n?void 0:n.find((function(e){return e>=l}))));if(!v)return{result:!1,error:St};var f=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!f)return{result:!1,error:Tt};var m=(null==t?void 0:t.winningSide)-1,h=1-m,g=n[m],I=n[h],y=g-I;if(!(g>I))return{result:!1,error:{message:"winningSide game scoreString is not high"}};var U=c&&d,S=2===(null==i?void 0:i.filter((function(e){return!isNaN(e)})).length),w=null==i?void 0:i[m],T=null==i?void 0:i[h],P=c&&2===n.filter((function(e){return e>=c})).length;if(U){var D=d.NoAD,b=d.tiebreakTo;if(P){if(y>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!S)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(b))return{result:!1,error:{message:"tiebreakTo error"}};if(!!(!b||!(null==i?void 0:i.find((function(e){return e>=b})))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(g>(c<l?l:l+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!w||!T||w<T)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};var N=w-T;if(N&&T>=b-1&&N<(D?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(g>l&&!P)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}var M=p?1:2,R=I>=l-1,A=y&&R&&!P&&y<M;if(A)return{result:!1,error:{message:"invalid winning game scoreString (3)"}};if(y>M&&g>l)return{result:!1,error:{message:"invalid winning game scoreString (4)"}};return{result:!0}}({setObject:t,setFormat:o,sideGameScores:d,sideTiebreakScores:v}),D=P.error,b=P.result,N=function(e){var t=e.setObject,r=e.setFormat,n=e.sideTiebreakScores;if(!t)return{result:!1,error:ct};var i=!!(null==r?void 0:r.tiebreakSet),a=!!(null==r?void 0:r.timed);if(!r||!i||a)return{result:!1,error:{message:"not tiebreak set"}};var o=[1,2].includes(null==t?void 0:t.winningSide);if(!t||!o)return{result:!1,error:Tt};var u=(r||{}).tiebreakSet,s=u||{},l=s.NoAD,c=s.tiebreakTo,d=2===(null==n?void 0:n.filter((function(e){return!isNaN(e)})).length);if(!d)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(c))return{result:!1,error:{message:"tiebreakTo error"}};var p=!!(null==n?void 0:n.find((function(e){return e>=c})));if(!p)return{result:!1,error:{message:"invalid tiebreak scores (2)"}};var v=(null==t?void 0:t.winningSide)-1,f=1-v,m=n[v],h=n[f];if(!m||!h||m<h)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};var g=l?1:2,I=m-h,y=h>=c-1;if(I&&y&&I<g)return{result:!1,error:{message:"invalid tiebreak scores (3)"}};return{result:!0}}({setObject:t,setFormat:o,sideTiebreakScores:v}),M=N.error,R=N.result,A=l&&!w&&b||u&&w&&R,E={expectTiebreakSet:u,expectTimedSet:s,hasTiebreakCondition:U,isCompletedSet:T,isDecidingSet:a,isTiebreakSet:w,isValidSet:c&&!(u&&!w)&&!(l&&w)&&(!T||A),isValidSetNumber:c,isValidSetOutcome:A,leadingSide:S,setFormat:o,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:v,sideTiebreakScoresCount:h,winningSide:QS({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:r,setObject:t})};return void 0!==(null==t?void 0:t.winningSide)&&(w?(E.isValidTiebreakSetOutcome=R,R||(E.tiebreakSetError=M)):(E.isValidStandardSetOutcome=b,b||(E.standardSetError=D))),E}function tw(e){var r,n=e||{},i=n.matchUp,a=n.sideNumber,s=n.setNumber,l=n.isTiebreakValue,c=n.isPointValue,d=(e||{}).matchUpFormat;if(!i)return{error:et};var p=Zd(d=d||(null==i?void 0:i.matchUpFormat)),v=!!(null==i?void 0:i.winningSide),f=null===(r=i.score)||void 0===r?void 0:r.sets,m=null==f?void 0:f.length,h=s&&s-1,g=!!(null==f?void 0:f.find((function(e,t){return e.setNumber===s&&t===h}))),I=(null==f?void 0:f.filter((function(e){return null==e?void 0:e.winningSide})))||[],y=(null==I?void 0:I.length)||0,U=s&&(null==f?void 0:f.slice(s))||[],S=!!(m&&s&&(null==U?void 0:U.reduce((function(e,t){return(!t||!t.side1Score&&!t.side2Score&&!t.side1TiebreakScore&&!t.side2TiebreakScore&&!t.side1PointScore&&!t.side2PointScore)&&e}),!0))),w=s<=m&&f.find((function(e){return e.setNumber===s})),P=w&&ew({setObject:w,matchUpScoringFormat:p}),D=P||{},b=D.isCompletedSet,N=D.sideGameScores,M=D.sideTiebreakScores,R=!!(w&&!b&&S||s&&s===m+1&&!v),A=[1,2].includes(a),E=A?a-1:0,C=w&&A&&(!l&&!c&&void 0!==N[E]&&N[E]||l&&void 0!==M[E]&&M[E]),x=!!C,O=null==I?void 0:I.map((function(e){return ew({setObject:e,matchUpScoringFormat:p}).isValidSetOutcome})).reduce((function(e,t){return e&&t}),!0),F=I.reduce((function(e,t){return e[t.winningSide-1]++,e}),[0,0]),k=null==i?void 0:i.winningSide,_=k&&k-1,L=1-_,j=F[_],B=F[L],V=Math.max.apply(Math,u([],o(F),!1)),G=T(F)[V],q=(null!=p?p:{}).bestOf,W=V===(q&&Math.ceil(q/2)||1)&&1===G&&F.indexOf(V)+1||void 0,H=j>B&&k===W;return t({completedSetsHaveValidOutcomes:O,validMatchUpWinningSide:H,calculatedWinningSide:W,matchUpScoringFormat:p,validMatchUpOutcome:W&&O&&H,isLastSetWithValues:S,completedSetsCount:y,isCompletedMatchUp:v,isValidSideNumber:A,hasExistingValue:x,existingValue:C,isExistingSet:g,isActiveSet:R},P)}var rw=((_S={})[Ko]=2,_S[Vo]=1,_S[Bo]=1,_S[Ho]=1,_S[jo]=4,_S);function nw(e){var t,r,n,i=e.defaultWithScorePercent,s=void 0===i?2:i,l=e.winningSide,c=e.matchUpStatusProfile,d=void 0===c?rw:c,p=e.matchUpFormat,v=void 0===p?Fh:p,f=e.pointsPerMinute,m=void 0===f?1:f,h=e.sideWeight,I=void 0===h?4:h;if(!Fm({matchUpFormat:v}))return{error:ze};if("object"!=typeof d)return{error:xr};if(s>100&&(s=100),isNaN(s)||isNaN(m)||isNaN(I))return{error:xr};var y=Object.keys(d).filter((function(e){return Object.keys(nu).includes(e)&&e!==_o}));if(Object.keys(y).reduce((function(e,t){return e+d[t]}),0)>100)return{error:xr,matchUpStatusProfile:d};var U=y.reduce((function(e,t){return e.pointer=e.pointer+d[t],e.valueMap.push([e.pointer,t]),e}),{pointer:0,valueMap:[]}),S=g(1,100),w=(null!==(n=U.valueMap.find((function(e){return S<=e[0]})))&&void 0!==n?n:[100,_o])[1],T={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ko,jo].includes(w)){var P={score:T,winningSide:l=l||g(1,2),matchUpStatus:w};if(!(w===jo&&g(1,100)>100-s))return{outcome:P}}else if([Vo,Bo].includes(w))return{outcome:{score:T,matchUpStatus:w}};var D,b=Zd(v),M=null!=b?b:{},A=M.bestOf,E=M.setFormat,C=M.finalSetFormat,x=[],O=g(0,1),F=l?[l-1]:u(u([],o(R(0,I).map((function(){return O}))),!1),[1-O],!1),k=[Ho,jo,qo,zo].includes(w)&&(N(R(1,A))||1);try{for(var _=a(R(1,(null!=A?A:0)+1)),L=_.next();!L.done;L=_.next()){var j=L.value,B=iw({incomplete:k===j,matchUpStatus:w,pointsPerMinute:m,setFormat:j===A&&C||E,setNumber:j,weightedRange:F}),V=B.set,G=B.incomplete,q=B.winningSideNumber;if(x.push(V),G){D=q;break}if(tw({matchUp:{score:{sets:x},matchUpFormat:v}}).calculatedWinningSide)break}}catch(e){t={error:e}}finally{try{L&&!L.done&&(r=_.return)&&r.call(_)}finally{if(t)throw t.error}}var W=tw({matchUp:{score:{sets:x},matchUpFormat:v}}),H=D?l||D:W.calculatedWinningSide;return{outcome:{score:bI({score:{sets:x},winningSide:H,matchUpStatus:w}).score,winningSide:H,matchUpStatus:w}}}function iw(e){var t,r,n,i,a=e.weightedRange,u=void 0===a?[0,1]:a,s=e.pointsPerMinute,l=e.matchUpStatus,c=e.incomplete,d=e.setFormat,p={setNumber:e.setNumber},v=d.setTo,f=d.tiebreakFormat,m=d.tiebreakAt,h=d.tiebreakSet,I=d.timed,y=d.minutes,U=g(0,u.length-1),S=u[U];if(I){var w=y*s,T=Math.round(.2*w),P=w+N([1,-1])*T,D=function(e,t,r){void 0===e&&(e=1),void 0===t&&(t=3),void 0===r&&(r=!0);for(var n=0,i=0;i<t;i++)n+=Math.random()*(e/t);return r&&e>1?Math.round(n):n}(P,2),b=[D,P-D];S&&b.reverse(),i=u[U]+1;var M=(b[0]>b[1]?1:b[1]>b[0]&&2)||0;if(c){var A=o(b,2),E=A[0],C=A[1];return Object.assign(p,{side1Score:E,side2Score:C}),eu.includes(l)?{set:p,incomplete:c,winningSideNumber:i}:{set:p,incomplete:c}}M||(b[g(0,1)]+=1),(M=b[0]>b[1]?1:2)!==i&&b.reverse();var x=o(b,2),O=x[0],F=x[1];return Object.assign(p,{side1Score:O,side2Score:F,winningSide:i}),{set:p}}if(c)return p.side1Score=g(0,m),p.side2Score=g(0,m),eu.includes(l)&&(i=u[U]+1),{set:p,incomplete:c,winningSideNumber:i};var k=R(1,v+1).map((function(e){return R(0,v+2-e).map((function(){return e}))})).flat(),_=k[g(0,k.length-1)],L=!(b=v&&eS({isSide1:!0,tiebreakAt:m,lowValue:_,setTo:v})),j=1===u.length&&u[U]+1;if(!L){if(j)(M=b[0]>b[1]?1:2)!==j&&b.reverse();else S&&b.reverse();var B=o(b,2);O=B[0],F=B[1];Object.assign(p,{side1Score:O,side2Score:F})}var V=ew({matchUpScoringFormat:{setFormat:d},setObject:p}),G=void 0;if(V.hasTiebreakCondition||L){var q=f||h||{},W=q.NoAD,H=q.tiebreakTo,z=R(1,H+1).map((function(e){return R(0,H+2-e).map((function(){return e}))})).flat(),Y=z[g(0,z.length-1)],K=tS({isSide1:!0,tiebreakNoAd:W,tiebreakTo:H,lowValue:Y});if(K)if(L){M=K[0]>K[1]?1:2;j?M!==j&&K.reverse():S&&K.reverse(),t=o(K,2),p.side1TiebreakScore=t[0],p.side2TiebreakScore=t[1],G=(K[0]>K[1]?1:K[1]>K[0]&&2)||void 0}else 2===V.leadingSide?(r=o(K,2),p.side1TiebreakScore=r[0],p.side2TiebreakScore=r[1]):(n=o(K,2),p.side2TiebreakScore=n[0],p.side1TiebreakScore=n[1])}return p.winningSide=V.winningSide||V.leadingSide||j||G,{set:p}}function aw(e){var r,n,i,o,u,s,l,c=e.matchUpStatusProfile,d=e.completeAllMatchUps,p=e.randomWinningSide,v=e.tournamentRecord,f=e.completionGoal,m=e.drawDefinition,h=e.event;if(!m)return{error:K};var g=e.matchUpFormat||m.matchUpFormat||(null==h?void 0:h.matchUpFormat),I=m.structures.slice().sort(ns),y=0,U=Ip({contextFilters:{stages:[iu,au]},matchUpFilters:{matchUpTypes:[Fs],roundNumbers:[1]},inContext:!0,drawDefinition:m}),S=U.matchUps,w=U.matchUpsMap;if(null==S?void 0:S.length){var T=(null===(u=null==h?void 0:h.category)||void 0===u?void 0:u.ageCategoryCode)||(null===(s=null==h?void 0:h.category)||void 0===s?void 0:s.categoryName);if(T){var P=xU({singlesOnly:!0,tournamentRecord:v,drawDefinition:m,scaleAccessor:{scaleName:T,sortOrder:AU,scaleType:Sa},event:h});if(P.error)return P;var D=P.lineUps,b=P.participantsToAdd;kI({tournamentRecord:v,participants:b}),jn({element:m,extension:{name:uo,value:D}})}else{var N=null===(l=S[0])||void 0===l?void 0:l.structureId,M=ss({drawDefinition:m,structureId:N}).positionAssignments;if(null==M?void 0:M.length){var R=Rv({participantFilters:{participantTypes:[Fs]},tournamentRecord:v}).participants;S.forEach((function(e){var t=e.tieMatchUps.filter((function(e){return e.matchUpType===Es})),r=e.tieMatchUps.filter((function(e){return e.matchUpType===xs}));t.forEach((function(e,t){var r=e.matchUpId;e.sides.forEach((function(e){var n,i=e.drawPosition,a=null==R?void 0:R.find((function(e){var t=e.participantId,r=M.find((function(e){return e.participantId===t}));return(null==r?void 0:r.drawPosition)===i}));if(a){var o=null===(n=a.individualParticipantIds)||void 0===n?void 0:n[t];o&&Tm({teamParticipantId:a.participantId,participantId:o,tournamentRecord:v,drawDefinition:m,tieMatchUpId:r,event:h})}}))})),r.forEach((function(e,t){var r=e.matchUpId;e.sides.forEach((function(e){var n,i=e.drawPosition,a=null==R?void 0:R.find((function(e){var t=e.participantId,r=M.find((function(e){return e.participantId===t}));return(null==r?void 0:r.drawPosition)===i}));if(a){var o=null===(n=a.individualParticipantIds)||void 0===n?void 0:n.slice(2*t,2*t+2);null==o||o.forEach((function(e){Tm({teamParticipantId:a.participantId,participantId:e,tournamentRecord:v,drawDefinition:m,tieMatchUpId:r,event:h})}))}}))}))}))}}}var A="string"==typeof d&&d,E=A&&_o;try{for(var C=a(I),x=C.next();!x.done;x=C.next()){var O=x.value;if(y>=f)break;var F=mp({matchUpFilters:{matchUpTypes:[xs,Es]},afterRecoveryTimes:!1,tournamentRecord:v,inContext:!0,drawDefinition:m,matchUpsMap:w,structure:O,event:h}).matchUps.filter((function(e){return!e.winningSide})).sort(Zp).map(Ro),k=function(e){if(!isNaN(f)&&y>=f)return"break";var t=mp({matchUpFilters:{matchUpTypes:[xs,Es]},afterRecoveryTimes:!1,tournamentRecord:v,inContext:!0,drawDefinition:m,matchUpsMap:w,structure:O,event:h}).matchUps.find((function(t){return t.matchUpId===e})),r=[Vo,Bo].includes(t.matchUpStatus);if((null==t?void 0:t.readyToScore)&&!r){var n=uw({winningSide:!p&&1,matchUpStatusProfile:c,tournamentRecord:v,drawDefinition:m,targetMatchUp:t,matchUpFormat:g,matchUpStatus:E,scoreString:A,event:h});if(null==n?void 0:n.error)return{value:n};y+=1}};try{for(var _=(i=void 0,a(F)),j=_.next();!j.done;j=_.next()){var B=k(j.value);if("object"==typeof B)return B.value;if("break"===B)break}}catch(e){i={error:e}}finally{try{j&&!j.done&&(o=_.return)&&o.call(_)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{x&&!x.done&&(n=C.return)&&n.call(C)}finally{if(r)throw r.error}}return t(t({},L),{completedCount:y})}function ow(e){var t=e.matchUpStatusCodes,r=e.policyDefinitions,n=e.tournamentRecord,i=e.drawDefinition,a=e.targetMatchUp,o=e.matchUpStatus,u=e.matchUpFormat,s=e.scoreString,l=e.winningSide,c=e.event;if(a&&a.matchUpStatus!==Fo){var d=(a||{}).matchUpId,p=nS({matchUpFormat:u,matchUpStatus:o,scoreString:s,winningSide:l}).outcome;return t&&(p.matchUpStatusCodes=t),NI({tournamentRecord:n,policyDefinitions:r,drawDefinition:i,matchUpFormat:u,matchUpId:d,outcome:p,event:c})}}function uw(e){var t=e.matchUpStatusProfile,r=void 0===t?{}:t,n=e.tournamentRecord,i=e.policyDefinitions,a=e.drawDefinition,o=e.matchUpStatus,u=e.matchUpFormat,s=e.targetMatchUp,l=e.scoreString,c=e.winningSide,d=e.event;return l||o?ow(e):NI({policyDefinitions:i,tournamentRecord:n,drawDefinition:a,matchUpFormat:u,matchUpId:(s||{}).matchUpId,outcome:nw({matchUpStatusProfile:r,matchUpFormat:u,winningSide:c}).outcome,event:d})}function sw(e){var r,n,i,u,s,l,c=e.matchUpStatusProfile,d=e.completeAllMatchUps,p=e.randomWinningSide,v=e.tournamentRecord,f=e.drawProfiles,m=e.event,h=_d({event:m}).flightProfile,g=m.eventName,I=m.eventType,y=m.category,U=v.startDate,S=[],w=(null==y?void 0:y.categoryName)||(null==y?void 0:y.ageCategoryCode)||(null==y?void 0:y.ratingType),T=null===(i=m.drawDefinitions)||void 0===i?void 0:i.map((function(e){return e.drawId}));if(Array.isArray(null==h?void 0:h.flights)){var P=function(e,r){var n=r.drawId,i=r.stage,a=r.drawName,o=r.drawEntries;S.push(r.drawId);var h=f[e],y=h||{},P=y.seedsCount,D=y.generate;if(void 0===D||D){var b=o.filter(Ri(Li)).map(Ri(Li)),N=w||g;if(v&&P&&P<=b.length)R(1,P+1).forEach((function(e,t){var r={scaleValue:e,scaleName:N,scaleType:Pa,eventType:I,scaleDate:U},n=b[t];JS({tournamentRecord:v,participantId:n,scaleItem:r})}));if(null==T?void 0:T.includes(n))return"break";var M=bU(t(t({},h),{matchUpType:I,seedingScaleName:N,tournamentRecord:v,isMock:!0,drawEntries:o,drawName:a,drawId:n,event:m,stage:i}));if(M.error)return{value:{error:M.error,drawIds:[]}};var A=M.drawDefinition;if(!A)return{value:{error:Z}};var E=null===(u=f[e])||void 0===u?void 0:u.drawExtensions;if(Array.isArray(E)&&E.filter(Ln).forEach((function(e){return jn({element:A,extension:e})})),(M=FI({suppressNotifications:!0,tournamentRecord:v,drawDefinition:A,event:m})).error)return{value:{error:M.error,drawIds:[]}};if(null==h?void 0:h.withPlayoffs){var C=null===(s=A.structures)||void 0===s?void 0:s[0].structureId,x=TI(t(t({idPrefix:h.idPrefix},h.withPlayoffs),{tournamentRecord:v,drawDefinition:A,isMock:!0,structureId:C,event:m}));if(null==x?void 0:x.error)return{value:x}}var O=null==h?void 0:h.completionGoal;if(!(!1===(null==h?void 0:h.automated))&&(d||O)){var F=null==h?void 0:h.matchUpFormat,k=aw({completeAllMatchUps:!O&&d,matchUpStatusProfile:c,randomWinningSide:p,tournamentRecord:v,completionGoal:O,drawDefinition:A,matchUpFormat:F,event:m});if(k.error)return{value:{error:k.error,drawIds:[]}};var _=k.completedCount;if((null==h?void 0:h.drawType)===Ku){var L=null===(l=A.structures)||void 0===l?void 0:l.find((function(e){return e.stage===iu}));if(!L)return{value:{error:De}};var j=Ch({structureId:L.structureId,tournamentRecord:v,drawDefinition:A,event:m});if(j.error)return{value:{error:j.error,drawIds:[]}};if((j=aw({completeAllMatchUps:!O&&d,completionGoal:O?O?O-(null!=_?_:0):void 0:void 0,matchUpStatusProfile:c,randomWinningSide:p,tournamentRecord:v,drawDefinition:A,matchUpFormat:F,event:m})).error)return{value:{error:j.error,drawIds:[]}}}}}};try{for(var D=a(h.flights.entries()),b=D.next();!b.done;b=D.next()){var N=o(b.value,2),M=P(N[0],N[1]);if("object"==typeof M)return M.value;if("break"===M)break}}catch(e){r={error:e}}finally{try{b&&!b.done&&(n=D.return)&&n.call(D)}finally{if(r)throw r.error}}}return t(t({},L),{drawIds:S})}function lw(e){var r,n,i,a=e.participantsProfile,o=void 0===a?{}:a,u=e.uniqueParticipantsCount,s=e.ratingsParameters,l=e.tournamentRecord,c=e.eventProfile,d=e.eventIndex,p=e.event,v=e.uuids,f=p.category,m=p.gender,h=p.eventType,g=h===va&&fs||h===ma&&hs||h,I=u[iu]||0,y=u[au]||0,U=(null===(r=c.drawProfiles)||void 0===r?void 0:r.length)?I+y:null!==(i=null===(n=c.participantsProfile)||void 0===n?void 0:n.participantsCount)&&void 0!==i?i:0,S=[cp,vp].includes(m)?m:void 0,w=(null==o?void 0:o.idPrefix)?"E-".concat(d,"-").concat(null==o?void 0:o.idPrefix):void 0,T=xS(t(t({uuids:c.uuids||v},o),{scaledParticipantsCount:c.scaledParticipantsCount,consideredDate:null==l?void 0:l.startDate,rankingRange:c.rankingRange,participantType:g,participantsCount:U,ratingsParameters:s,category:f,idPrefix:w,sex:S})).participants,P=kI({tournamentRecord:l,participants:T});if(P.error)return P;var D=null==T?void 0:T.filter((function(e){return e.participantType===g}));return{uniqueDrawParticipants:D,uniqueParticipantIds:null==T?void 0:T.map(Mo)}}function cw(e){var r=e.autoEntryPositions,n=e.tournamentRecord,i=e.drawParticipants,a=e.drawProfile,o=e.event,u=a.drawType,s=void 0===u?Eu:u,l=a.qualifyingPositions,c=void 0===l?0:l,d=a.stage,p=void 0===d?iu:d,v=a.drawSize,f=void 0===v?0:v,m=a.drawName,h=a.drawId,g=f-c,I=i.slice(0,g).map(Mo);if(I.length){var y=Bv({participantIds:I,autoEntryPositions:r,entryStage:p,tournamentRecord:n,event:o});if(y.error)return y}var U=vy({drawName:m||s,qualifyingPositions:c,drawEntries:I.map((function(e){return{entryStatus:Tl,entryStage:p,participantId:e}})),drawId:h,event:o,stage:p});return U.error?U:t({},L)}function dw(e){var r,n,i=e.uniqueDrawParticipants,o=e.autoEntryPositions,u=e.stageParticipants,s=e.tournamentRecord,l=e.drawProfiles,c=e.category,d=e.gender,p=e.event,v=0;try{for(var f=a(l),m=f.next();!m.done;m=f.next()){var h=m.value,g=h.qualifyingPositions,I=void 0===g?0:g,y=h.uniqueParticipants,U=h.stage,S=void 0===U?iu:U,w=h.drawSize,T=(void 0===w?0:w)-I,P=y||d||c||S===au,D=P?i.slice(v,v+T):u[S||iu]||[];P&&(v+=T);var b=cw({autoEntryPositions:o,drawParticipants:D,tournamentRecord:s,drawProfile:h,event:p});if(b.error)return b}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return t({},L)}function pw(e){var r,n,i,o,u,s,l=e.allUniqueParticipantIds,c=e.matchUpStatusProfile,d=e.participantsProfile,p=e.completeAllMatchUps,v=e.autoEntryPositions,f=e.hydrateCollections,m=e.randomWinningSide,h=e.ratingsParameters,g=e.tournamentRecord,I=e.eventProfile,y=e.eventIndex,U=e.publish,S=e.isMock,w=e.uuids,T=I.gender,P=I.eventName,D=I.eventType,b=void 0===D?va:D,N=I.policyDefinitions,M=I.drawProfiles,R=void 0===M?[]:M,A=I.eventExtensions,E=I.surfaceCategory,C=I.tieFormatName,x=I.processCodes,O=I.discipline,F=I.eventLevel,k=I.timeItems,_=I.ballType,L=I.category,j=I.eventId||ed(),B=I.tieFormat||(b===ga?tU({namedFormat:C,event:{eventId:j,category:L,gender:T},hydrateCollections:f,isMock:S}):void 0),V=g.participants;try{for(var G=a(R),q=G.next();!q.done;q=G.next()){var W=q.value;!T&&W.gender&&(T=null==W?void 0:W.gender)}}catch(e){r={error:e}}finally{try{q&&!q.done&&(n=G.return)&&n.call(G)}finally{if(r)throw r.error}}var H=YS({drawProfiles:R,category:L,gender:T}),z=H.stageParticipantsCount,Y=H.uniqueParticipantsCount,K=H.uniqueParticipantStages,J=b===va&&fs||b===ma&&hs||b,Z=K?lw({event:{eventType:b,category:L,gender:T},uniqueParticipantsCount:Y,participantsProfile:d,ratingsParameters:h,tournamentRecord:g,eventProfile:I,eventIndex:y,uuids:w}):{},X=Z.uniqueDrawParticipants,Q=void 0===X?[]:X,$=Z.uniqueParticipantIds,ee=void 0===$?[]:$,te=I.eventAttributes;"object"!=typeof te&&(te={});var re=(null==L?void 0:L.categoryName)||(null==L?void 0:L.ageCategoryCode)||(null==L?void 0:L.ratingType);P=P||re||"Generated Event";var ne,ie=t(t({},te),{surfaceCategory:E,processCodes:x,discipline:O,eventLevel:F,eventName:P,eventType:b,tieFormat:B,ballType:_,category:L,eventId:j,gender:T});if((null==A?void 0:A.length)&&Array.isArray(A)){var ae=A.filter(Ln);(null==ae?void 0:ae.length)&&Object.assign(ie,{extensions:ae})}if(Array.isArray(k)&&k.forEach((function(e){return If({event:ce,timeItem:e})})),"object"==typeof N)try{for(var oe=a(Object.keys(N)),ue=oe.next();!ue.done;ue=oe.next()){var se=ue.value;EI({policyDefinitions:(u={},u[se]=N[se],u),event:ie})}}catch(e){i={error:e}}finally{try{ue&&!ue.done&&(o=oe.return)&&o.call(oe)}finally{if(i)throw i.error}}ie.category&&(ie.category.categoryName=re);var le=nU({suppressNotifications:!1,internalUse:!0,tournamentRecord:g,event:ie});if(le.error)return le;var ce=null==le?void 0:le.event,de=KS({allUniqueParticipantIds:l,stageParticipantsCount:z,eventParticipantType:J,targetParticipants:V}).stageParticipants;if(null==R?void 0:R.length){var pe=dw({uniqueDrawParticipants:Q,autoEntryPositions:v,stageParticipants:de,tournamentRecord:g,drawProfiles:R,category:L,gender:T,event:ce});if(pe.error)return pe;var ve=sw({matchUpStatusProfile:c,completeAllMatchUps:p,randomWinningSide:m,tournamentRecord:g,drawProfiles:R,event:ce});if(ve.error)return ve;ne=ve.drawIds}else if(null===(s=null==I?void 0:I.participantsProfile)||void 0===s?void 0:s.participantsCount){var fe=Q.map(Ri("participantId"));if(fe.length){var me=Bv({participantIds:fe,autoEntryPositions:v,tournamentRecord:g,entryStage:iu,event:ce});if(me.error)return me}}return U&&Pf({tournamentRecord:g,event:ce}),{drawIds:ne,eventId:j,uniqueParticipantIds:ee}}function vw(e){var t=e.tournamentRecords;if(!Di(t))return{error:q};var r=Object.keys(null!=t?t:{}).reduce((function(e,r){var n=Uf({tournamentRecord:t[r]}).tournamentInfo,i=n.startDate,a=n.endDate,o=i&&new Date(ui(i));(!e.startDate||o&&o<e.startDate)&&(e.startDate=o);var u=a&&new Date(ui(a));return(!e.endDate||u&&u>e.endDate)&&(e.endDate=u),e}),{startDate:void 0,endDate:void 0}),n=r.startDate&&ui(r.startDate.toISOString()),i=r.endDate&&ui(r.endDate.toISOString());return n&&i?{startDate:n,endDate:i}:{error:vt}}function fw(e){var r=e.tournamentRecords,n=e.scheduleDate,i=e.venueId,a=e.round;if(!Jn(n))return{error:It};var o=Vn({name:go,tournamentRecords:r,discover:!0}).extension,u=(null==o?void 0:o.value)||[],s=u.find((function(e){return Ii(n,e.scheduleDate)}));if(!s){var l=vw({tournamentRecords:r}),c=l.startDate,d=l.endDate,p=new Date(n);if(c&&p<new Date(c)||d&&p>new Date(d))return{error:It};s={scheduleDate:n,venues:[]},u.push(s)}var v=s.venues.find((function(e){return e.venueId===i}));v||(v={venueId:i,rounds:[]},s.venues.push(v));var f=["notBeforeTime"],m=function(e){return Object.keys(e).filter((function(e){return!f.includes(e)})).sort().map((function(t){return Di(e[t])?m(e[t]):e[t]})).flat().join("|")};if(v.rounds.find((function(e){return m(e)===m(a)})))return On({result:{error:Te},stack:"addSchedulingProfileRound"});v.rounds.push(a);var h=vf({tournamentRecords:r,schedulingProfile:u});return h.error?h:t({},L)}function mw(e){var r,n,i,s,l,c,d,v,f,m,h,g=e.allUniqueParticipantIds,I=void 0===g?[]:g,y=e.participantsProfile,U=void 0===y?{}:y,S=e.matchUpStatusProfile,w=e.completeAllMatchUps,T=e.autoEntryPositions,P=e.hydrateCollections,D=e.randomWinningSide,b=e.ratingsParameters,N=e.tournamentRecord,M=e.isMock,A=void 0===M||M,C=e.drawProfile,x=e.startDate,O=e.drawIndex,F=e.uuids,k=Ui(C,!1,!0),_=k.excessParticipantAlternates,j=void 0===_||_,B=k.matchUpFormat,V=void 0===B?Fh:B,G=k.drawType,q=void 0===G?Eu:G,W=k.tournamentAlternates,H=void 0===W?0:W,z=k.alternatesCount,Y=void 0===z?0:z,K=k.qualifyingPositions,J=k.qualifyingProfiles,X=k.generate,Q=void 0===X||X,$=k.eventExtensions,ee=k.drawExtensions,te=k.completionGoal,re=k.tieFormatName,ne=k.seedsCount,ie=k.timeItems,ae=k.drawName,oe=k.category,ue=k.idPrefix,se=k.publish,le=k.gender,ce=k.stage,de=k.drawSize||(k.ignoreDefaults?void 0:32),pe=k.eventId||ed(),ve=C.eventType||C.matchUpType||va,fe=ve===ma?hs:fs,me="object"==typeof C.tieFormat&&C.tieFormat||ve===gs&&tU({event:{eventId:pe,category:oe,gender:le},namedFormat:re,hydrateCollections:P,isMock:A})||void 0,he=(null==oe?void 0:oe.categoryName)||(null==oe?void 0:oe.ageCategoryCode)||(null==oe?void 0:oe.ratingType),ge=C.eventName||he||"Generated ".concat(ve),Ie=(null==N?void 0:N.participants)||[],ye=((null==J?void 0:J.map((function(e){return e.structureProfiles||[]})).flat().reduce((function(e,t){return e+(!t.participantsCount||t.participantsCount>t.drawSize?t.drawSize:t.participantsCount||0)}),0))||0)*(fe===hs?2:1),Ue=(!C.participantsCount||C.participantsCount>de?de:C.participantsCount)||0,Se={eventName:ge,eventType:ve,tieFormat:me,category:oe,eventId:pe,gender:le};Array.isArray(ie)&&ie.forEach((function(e){return If({event:Se,timeItem:e})}));var we=C.eventAttributes;if("object"!=typeof we&&(we={}),Object.assign(Se,we),(null==$?void 0:$.length)&&Array.isArray($)){var Te=$.filter(Ln);(null==Te?void 0:Te.length)&&Object.assign(Se,{extensions:Te})}var Pe=[];if(ye||C.uniqueParticipants||!N||le||oe){var be,Ne=(Ue||0)+Y+ye,Me=Ne,Re=((r={})[cp]=0,r[vp]=0,r),Ae=void 0;ve===gs&&(Ae=(n=FS({alternatesCount:Y,tieFormatName:re,tieFormat:me,drawSize:de})).teamSize,be=n.genders,Object.keys(be).forEach((function(e){[cp,vp].includes(e)&&be[e]&&(Re[e]=de*be[e])})),Me=Ae*((de||0)+ye));var Ee=(null==U?void 0:U.idPrefix)?"D-".concat(O,"-").concat(null==U?void 0:U.idPrefix):void 0,Ce=xS(t(t({},U),{scaledParticipantsCount:C.scaledParticipantsCount||U.scaledParticipantsCount,participantsCount:Me,consideredDate:null==N?void 0:N.startDate,sex:le||(null==U?void 0:U.sex),rankingRange:C.rankingRange,uuids:C.uuids||F,ratingsParameters:b,participantType:fe,gendersCount:Re,idPrefix:Ee,category:oe})).participants;if(Se.category&&(Se.category.categoryName=he),N){var xe=kI({participants:Ce,tournamentRecord:N});if(xe.error)return xe}if(Ce.forEach((function(e){var t=e.participantId;return Pe.push(t)})),Ie=Ce,ve===gs){var Oe=be[cp]?Ce.filter((function(e){var t=e.participantType,r=e.person;return t===fs&&(null==r?void 0:r.sex)===cp})).map(Mo):[],Fe=be[vp]?Ce.filter((function(e){var t=e.participantType,r=e.person;return t===fs&&(null==r?void 0:r.sex)===vp})).map(Mo):[],ke=Ce.filter((function(e){return e.participantType===fs})).map(Mo).filter((function(e){return!Oe.includes(e)&&!Fe.includes(e)})),_e=Ae-(be[cp]+be[vp]),Le=0,je=0,Be=0,Ve=R(0,Ne).map((function(e){var t=Fe.slice(Le,Le+be[vp]),r=Oe.slice(je,je+be[cp]),n=ke.slice(Be,Be+_e);return Le+=be[vp],je+=be[cp],Be+=_e,{individualParticipantIds:u(u(u([],o(t),!1),o(r),!1),o(n),!1),participantOtherName:"TM".concat(e+1),participantName:"Team ".concat(e+1),participantRole:Vv,participantType:gs,participantId:ed()}})),Ge=kI({participants:Ve,tournamentRecord:N});if(!Ge.success)return Ge;Ie=Ve}}var qe=function(e){var t=e.participantType;return ve===va&&t===fs||(ve===ma&&t===hs||ve===gs&&t===gs)},We=function(e){var t,r;return!C.gender||((null===(t=e.person)||void 0===t?void 0:t.sex)===C.gender||(null===(r=e.individualParticipantIds)||void 0===r?void 0:r.some((function(e){var t=Ie.find((function(t){return t.participantId===e}));return t&&We(t)}))))},He=Ie.filter(qe).filter(We).filter((function(e){var t=e.participantId;return!I.includes(t)})),ze=He.slice(0,Ue).map((function(e){return e.participantId}));if(A&&(null==ze?void 0:ze.length)){var Ye=Bv({autoEntryPositions:T,entryStage:ce,tournamentRecord:N,participantIds:ze,event:Se});if(Ye.error)return Ye}var Ke=ye?He.slice(Ue,Ue+ye).map((function(e){return e.participantId})):0;if(A&&(null==Ke?void 0:Ke.length)){var Je=0,Ze=1,Xe=function(e,t){return e.stageSequence-t.stageSequence};try{for(var Qe=a(J.sort((function(e,t){return e.roundTarget-t.roundTarget}))),$e=Qe.next();!$e.done;$e=Qe.next()){var et=$e.value;Ze=et.roundTarget||Ze;var tt=1,rt=void 0;try{for(var nt=(l=void 0,a(et.structureProfiles.sort(Xe))),it=nt.next();!it.done;it=nt.next()){var at=it.value,ot=(at.drawSize||p(at.participantsCount))-(rt||0),ut=Ke.slice(Je,Je+ot),st=Bv({entryStage:au,entryStageSequence:tt,autoEntryPositions:T,tournamentRecord:N,participantIds:ut,roundTarget:Ze,event:Se});if(st.error)return st;rt=at.qualifyingPositions,Je+=ot,tt+=1}}catch(e){l={error:e}}finally{try{it&&!it.done&&(c=nt.return)&&c.call(nt)}finally{if(l)throw l.error}}Ze+=1}}catch(e){i={error:e}}finally{try{$e&&!$e.done&&(s=Qe.return)&&s.call(Qe)}finally{if(i)throw i.error}}}var lt=j&&(null===(f=null==N?void 0:N.participants)||void 0===f?void 0:f.filter((function(e){var t=e.participantId;return!ze.includes(t)})).filter(qe).filter(We).slice(0,Y||de-Ue||H).map((function(e){return e.participantId})));if(A&&(null==lt?void 0:lt.length)){var ct=Bv({participantIds:lt,autoEntryPositions:!1,entryStatus:Sl,tournamentRecord:N,event:Se});if(ct.error)return ct.error}var dt=he||ge;N&&ne&&ne<=ze.length&&R(1,ne+1).forEach((function(e,t){var r={scaleName:dt,scaleDate:x,scaleType:Sc,scaleValue:e,eventType:ve},n=ze[t];JS({tournamentRecord:N,participantId:n,scaleItem:r})}));var pt=bU(t(t({},Ui(C,!1,!0)),{tournamentRecord:N,seedingScaleName:dt,matchUpFormat:V,eventId:pe,isMock:A,event:Se}));if(pt.error)return pt;if(!pt.drawDefinition)return{error:Z};var vt=pt.drawDefinition,ft=vt.drawId;if(Array.isArray(ee)&&ee.filter(Ln).forEach((function(e){return jn({element:vt,extension:e})})),Q){if(FI({drawDefinition:vt,event:Se,suppressNotifications:!0}),C.withPlayoffs){var mt=null===(m=vt.structures)||void 0===m?void 0:m[0].structureId,ht=TI(t(t({},C.withPlayoffs),{tournamentRecord:N,drawDefinition:vt,structureId:mt,idPrefix:ue,isMock:A,event:Se}));if(null==ht?void 0:ht.error)return ht}var gt=!1===C.automated;if(A&&!gt){var It=function(e){var t,r=aw({completeAllMatchUps:e.completeAllMatchUps,completionGoal:e.completionGoal,matchUpStatusProfile:S,randomWinningSide:D,tournamentRecord:N,drawDefinition:vt,matchUpFormat:V,event:Se});if(r.error)return r;var n=r.completedCount;if(q===Ku){var i=null===(t=vt.structures)||void 0===t?void 0:t.find((function(e){return e.stage===iu}));if(!i)return{error:De};Ch({structureId:i.structureId,tournamentRecord:N,drawDefinition:vt,event:Se});var a=aw({completionGoal:te?te?te-(null!=n?n:0):void 0:void 0,matchUpStatusProfile:S,completeAllMatchUps:w,randomWinningSide:D,tournamentRecord:N,drawDefinition:vt,matchUpFormat:V,event:Se});if(a.error)return a}};if(te&&It({completionGoal:te}),C.outcomes){var yt=Up({inContext:!0,drawDefinition:vt,event:Se}).matchUps,Ut=function(e){var t=e.matchUpStatus,r=void 0===t?_o:t,n=e.matchUpStatusCodes,i=e.stageSequence,a=void 0===i?1:i,s=e.matchUpIndex,l=void 0===s?0:s,c=e.structureOrder,d=e.matchUpFormat,p=e.drawPositions,v=e.roundPosition,f=e.stage,m=void 0===f?iu:f,g=e.roundNumber,I=e.winningSide,y=e.scoreString,U=null!==(h=null==yt?void 0:yt.reduce((function(e,t){var r=t.structureId,n=t.matchUpId;return e[r]?e[r].push(n):e[r]=[n],e}),{}))&&void 0!==h?h:[],S=Object.assign.apply(Object,u([{}],o(Object.keys(U).map((function(e,t){var r;return(r={})[e]=t+1,r}))),!1)),w=null==yt?void 0:yt.filter((function(e){return!(m&&e.stage!==m||a&&e.stageSequence!==a||g&&e.roundNumber!==g||v&&e.roundPosition!==v||c&&S[e.structureId]!==c||p&&2!==E(p,e.drawPositions).length)})),T=null==w?void 0:w[l],P=ow({matchUpStatusCodes:n,tournamentRecord:N,drawDefinition:vt,targetMatchUp:T,matchUpFormat:d,matchUpStatus:r,scoreString:y,winningSide:I});if(null==P?void 0:P.error)return{value:P}};try{for(var St=a(C.outcomes),wt=St.next();!wt.done;wt=St.next()){var Tt=Ut(wt.value);if("object"==typeof Tt)return Tt.value}}catch(e){d={error:e}}finally{try{wt&&!wt.done&&(v=St.return)&&v.call(St)}finally{if(d)throw d.error}}}w&&It({completeAllMatchUps:w})}se&&Pf({tournamentRecord:N,event:Se})}else{var Pt=vy({drawEntries:vt.entries,drawName:ae||q,qualifyingPositions:K,drawId:ft,event:Se,stage:ce});if(Pt.error)return Pt}return t(t({},L),{event:xn(Se),uniqueParticipantIds:Pe,targetParticipants:Ie,drawDefinition:vt,eventId:pe,drawId:ft})}var hw=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function gw(){return"\n    This project would not have been possible without the generous input and patience\n    of tournament organizers and directors who worked with early versions of CourtHive/TMX.\n\n    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. \n\n    The project would not have even begun without the support of Miro, or the introduction by Sretchko.\n    The project would not have succeeded without the enthusiasm of Randy and Bruce.\n    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.\n    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.\n    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.\n    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.\n    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.\n    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.\n    Thanks to Shannon for the validation of the approach from his deep domain experience.\n    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.\n\n    And a special thanks to my family for putting up with the long days and weeks and months of coding\n    and conversations at all hours.\n  "}var Iw={generateOutcomeFromScoreString:nS,anonymizeTournamentRecord:function(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D,b,N,M,R,A,E,C=e.keepExtensions,x=void 0===C?[]:C,O=e.anonymizeParticipantNames,F=void 0===O||O,k=e.tournamentRecord,_=e.tournamentName,j=e.personIds,B=void 0===j?[]:j,V=e.tournamentId;if(!k)return{error:W};var G=Array.isArray(x)?wo.concat.apply(wo,u([],o(x),!1)):wo,q=function(e){var t;return Array.isArray(x)?null===(t=null==e?void 0:e.extensions)||void 0===t?void 0:t.filter((function(e){return G.includes(e.name)})):null==e?void 0:e.extensions},H={};k.extensions=q(k);var z=V||ed();H[k.tournamentId]=z,k.tournamentId=z,k.createdAt=(new Date).toISOString(),k.tournamentName=_||"Anonymized: ".concat(Xn(new Date)),delete k.parentOrganisation;try{for(var Y=a(k.participants||[]),K=Y.next();!K.done;K=Y.next()){var J=K.value,Z=ed();H[J.participantId]=Z,J.participantId=Z}}catch(e){r={error:e}}finally{try{K&&!K.done&&(n=Y.return)&&n.call(Y)}finally{if(r)throw r.error}}try{for(var X=a(k.participants||[]),Q=X.next();!Q.done;Q=X.next()){J=Q.value;Array.isArray(J.individualParticipantIds)&&(J.individualParticipantIds=J.individualParticipantIds.map((function(e){return H[e]})))}}catch(e){i={error:e}}finally{try{Q&&!Q.done&&(s=X.return)&&s.call(X)}finally{if(i)throw i.error}}var $=0;try{for(var ee=a(k.venues||[]),te=ee.next();!te.done;te=ee.next()){var re=te.value;re.extensions=q(re),re.venueName="Venue #".concat($),re.venueAbbreviation="V".concat($);var ne=ed();H[re.venueId]=ne,$+=1}}catch(e){l={error:e}}finally{try{te&&!te.done&&(c=ee.return)&&c.call(ee)}finally{if(l)throw l.error}}var ie=1;try{for(var ae=a(k.events||[]),oe=ae.next();!oe.done;oe=ae.next()){var ue=oe.value;ue.extensions=q(ue);var se=ed();H[ue.eventId]=se,ue.eventId=se;var le=(null===(N=ue.category)||void 0===N?void 0:N.categoryName)||(null===(M=ue.category)||void 0===M?void 0:M.ageCategoryCode)||(null===(R=ue.category)||void 0===R?void 0:R.ratingType)||ue.gender;if(ue.eventName="Event ".concat(ie," ").concat(le),Array.isArray(ue.entries))try{for(var ce=(v=void 0,a(ue.entries)),de=ce.next();!de.done;de=ce.next()){(Ie=de.value).participantId=H[Ie.participantId]}}catch(e){v={error:e}}finally{try{de&&!de.done&&(f=ce.return)&&f.call(ce)}finally{if(v)throw v.error}}try{for(var pe=(m=void 0,a(ue.drawDefinitions||[])),ve=pe.next();!ve.done;ve=pe.next()){var fe=ve.value;fe.extensions=q(fe);var me=ed();if(H[fe.drawId]=me,fe.drawId=me,Array.isArray(fe.entries))try{for(var he=(g=void 0,a(fe.entries)),ge=he.next();!ge.done;ge=he.next()){var Ie;(Ie=ge.value).participantId=H[Ie.participantId]}}catch(e){g={error:e}}finally{try{ge&&!ge.done&&(I=he.return)&&I.call(he)}finally{if(g)throw g.error}}var ye=function(e){var t,r,n,i,o,u,s,l;e.extensions=q(e);var c=ed();H[e.structureId]=c,e.structureId=c;try{for(var d=(t=void 0,a(e.positionAssignments||[])),p=d.next();!p.done;p=d.next()){(m=p.value).participantId&&(m.participantId=H[m.participantId])}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}try{for(var v=(n=void 0,a(e.seedAssignments||[])),f=v.next();!f.done;f=v.next()){var m;(m=f.value).participantId&&(m.participantId=H[m.participantId])}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}try{for(var h=(o=void 0,a(e.matchUps||[])),g=h.next();!g.done;g=h.next()){var I=g.value;try{for(var y=(s=void 0,a(I.sides||[])),U=y.next();!U.done;U=y.next()){var S=U.value;S.lineUp&&(S.lineUp=S.lineUp.map((function(e){var t=e.participantId,r=e.collectionAssignments;return{participantId:H[t],collectionAssignments:r}})))}}catch(e){s={error:e}}finally{try{U&&!U.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}}}catch(e){o={error:e}}finally{try{g&&!g.done&&(u=h.return)&&u.call(h)}finally{if(o)throw o.error}}};try{for(var Ue=(y=void 0,a(fe.structures||[])),Se=Ue.next();!Se.done;Se=Ue.next()){var we=Se.value;if(ye(we),Array.isArray(we.structures))try{for(var Te=(S=void 0,a(we.structures)),Pe=Te.next();!Pe.done;Pe=Te.next()){ye(Pe.value)}}catch(e){S={error:e}}finally{try{Pe&&!Pe.done&&(w=Te.return)&&w.call(Te)}finally{if(S)throw S.error}}}}catch(e){y={error:e}}finally{try{Se&&!Se.done&&(U=Ue.return)&&U.call(Ue)}finally{if(y)throw y.error}}try{for(var De=(T=void 0,a(fe.links||[])),be=De.next();!be.done;be=De.next()){var Ne=be.value;Ne.source.structureId=H[Ne.source.structureId],Ne.target.structureId=H[Ne.target.structureId]}}catch(e){T={error:e}}finally{try{be&&!be.done&&(P=De.return)&&P.call(De)}finally{if(T)throw T.error}}}}catch(e){m={error:e}}finally{try{ve&&!ve.done&&(h=pe.return)&&h.call(pe)}finally{if(m)throw m.error}}var Me=Vn({name:ao,element:ue}).extension;Array.isArray(null===(A=null==Me?void 0:Me.value)||void 0===A?void 0:A.flights)&&(null===(E=null==Me?void 0:Me.value.flights)||void 0===E||E.forEach((function(e){var t,r;if(e.drawId=H[e.drawId],Array.isArray(e.drawEntries))try{for(var n=(t=void 0,a(e.drawEntries)),i=n.next();!i.done;i=n.next()){var o=i.value;o.participantId=H[o.participantId]}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}}))),ie+=1}}catch(e){d={error:e}}finally{try{oe&&!oe.done&&(p=ae.return)&&p.call(ae)}finally{if(d)throw d.error}}var Re=k.startDate||Xn(new Date),Ae=(k.participants||[]).filter((function(e){return e.participantType===fs})),Ee=Ae.reduce((function(e,t){var r,n=null===(r=t.person)||void 0===r?void 0:r.sex;return[cp,vp].includes(n)?e[n]+=1:e[pp]+=1,e}),((D={})[cp]=0,D[vp]=0,D[pp]=0,D)),Ce=Object.assign.apply(Object,u([{}],o(Object.keys(Ee).map((function(e){var t,r;return(t={})[e]=(null===(r=ZU({category:{ageCategoryCode:"O18"},count:Ee[e],addressProps:{citiesCount:10},personExtensions:[],consideredDate:Re,sex:e}))||void 0===r?void 0:r.persons)||[],t}))),!1)),xe=((b={})[cp]=0,b[vp]=0,b[pp]=0,b),Oe=Ae.length,Fe=Ae.reduce((function(e,t){var r,n,i=(null===(n=null===(r=t.person)||void 0===r?void 0:r.addresses)||void 0===n?void 0:n[0])||{},a=i.city,o=i.state,u=i.postalCode;return e.cities.includes(a)||e.cities.push(a),e.states.includes(o)||e.states.push(o),e.postalCodes.includes(u)||e.postalCodes.push(u),e}),{cities:[],postalCodes:[],states:[]}),ke=Fe.postalCodes.length,_e=Fe.cities.length,Le=Fe.states.length,je={cities:HU({count:_e||Oe,participantsCount:Oe}).cities,states:zU({count:Le||Oe,participantsCount:Oe}).states,postalCodes:YU({count:ke||Oe,participantsCount:Oe}).postalCodes};Ae.forEach((function(e,r){var n,i,a=null==e?void 0:e.person,u=(null==a?void 0:a.sex)||pp,s=null===(n=ui(null==a?void 0:a.birthDate))||void 0===n?void 0:n.split("-")[0],l=xe[u],c=Ce[u][l];if(xe[u]+=1,s){var d=o((null===(i=null==c?void 0:c.birthDate)||void 0===i?void 0:i.split("-"))||[],3),p=[s,d[1],d[2]].join("-");c.birthDate=p}if(null==a?void 0:a.addresses){var v=XU(t(t({},je),{participantIndex:r,nationalityCode:c.nationalityCode}));c.addresses=[v]}c.personId=(null==B?void 0:B[r])||ed(),F?(c.standardFamilyName=c.lastName,c.standardGivenName=c.firstName,e.participantName="".concat(c.standardGivenName," ").concat(c.standardFamilyName)):(c.standardFamilyName=null==a?void 0:a.standardFamilyName,c.standardGivenName=null==a?void 0:a.standardGivenName),delete c.firstName,delete c.lastName,c.extensions=q(a),e.person=c,H[null==a?void 0:a.personId]=c.personId}));var Be=(k.participants||[]).filter((function(e){return e.participantType===hs}));Be.forEach((function(e){var t=e.individualParticipantIds;e.participantName=function(e){var t=e.individualParticipantIds,r=e.individualParticipants,n=r.filter((function(e){var r=e.participantId;return t.includes(r)})).map((function(e){var t=e.person;return null==t?void 0:t.standardFamilyName})).filter(Boolean).sort().join("/");1===t.length&&(n+="/Unknown");return n}({individualParticipantIds:t,individualParticipants:Ae})}));var Ve=(k.participants||[]).filter((function(e){return e.participantType===gs})),Ge=$U({count:Ve.length}).names;Ve.forEach((function(e,t){e.participantName=Ge[t]}));var qe=(k.participants||[]).filter((function(e){return e.participantType===ms})),We=$U({count:qe.length,nameRoot:"Group"}).names;qe.forEach((function(e,t){e.participantName=We[t]}));var He=Vn({element:k,name:go}).extension;Array.isArray(null==He?void 0:He.value)&&(null==He||He.value.forEach((function(e){e.tournamentId=H[e.tournamentId],e.structureId=H[e.structureId],e.eventId=H[e.eventId],e.drawId=H[e.drawId]})));var ze=Vn({element:k,name:po}).extension;return Array.isArray(null==ze?void 0:ze.value)&&(null==ze||ze.value.forEach((function(e){e.personId=H[e.personId]}))),t({},L)},generateTournamentRecord:function(e){var r,n,i,s,l,c,d,p,v=e.tournamentAttributes,f=e.startDate,m=e.endDate,h=e.tournamentName,g=void 0===h?N(hw):h,I=e.ratingsParameters,y=void 0===I?KI:I,S=e.scheduleCompletedMatchUps,w=e.tournamentExtensions,T=e.matchUpStatusProfile,P=e.completeAllMatchUps,D=e.participantsProfile,b=e.autoEntryPositions,M=e.hydrateCollections,R=e.randomWinningSide,A=e.policyDefinitions,C=e.schedulingProfile,x=e.periodLength,O=e.autoSchedule,F=e.eventProfiles,k=e.venueProfiles,_=e.drawProfiles,j=e.uuids;if(f&&!Jn(f)||m&&!Jn(m))return{error:It};if(F&&!Array.isArray(F))return{error:xr};if(!f){var B=new Date;f=Xn(null!=m?m:B),m=Xn(B.setDate(B.getDate()+7))}m||(m=Xn((B=new Date(f)).setDate(B.getDate()+7))),"object"!=typeof v&&(v={});var V=AS(t(t({},v),{tournamentName:g,isMock:!0,startDate:f,endDate:m}));if((null==w?void 0:w.length)&&Array.isArray(w)){var G=w.filter((function(e){return Ln({extension:e})}));(null==G?void 0:G.length)&&Object.assign(V,{extensions:G,isMock:!0})}if("object"==typeof A)try{for(var q=a(Object.keys(A)),W=q.next();!W.done;W=q.next()){var H=W.value;EI({policyDefinitions:(i={},i[H]=A[H],i),tournamentRecord:V})}}catch(e){r={error:e}}finally{try{W&&!W.done&&(n=q.return)&&n.call(q)}finally{if(r)throw r.error}}var z=kS({participantsProfile:D,tournamentRecord:V,eventProfiles:F,drawProfiles:_,startDate:f,uuids:j});if(!z.success)return z;var Y=[],K=[],J=[];if(Array.isArray(_)){var Z=0;try{for(var X=a(_),Q=X.next();!Q.done;Q=X.next()){var $=mw({allUniqueParticipantIds:Y,matchUpStatusProfile:T,completeAllMatchUps:P,autoEntryPositions:b,hydrateCollections:M,participantsProfile:D,randomWinningSide:R,ratingsParameters:y,tournamentRecord:V,isMock:!0,drawProfile:Q.value,startDate:f,drawIndex:Z,uuids:j});if($.error)return $;var ee=$.drawId,te=$.eventId,re=$.event,ne=$.uniqueParticipantIds;if(($=nU({suppressNotifications:!1,internalUse:!0,tournamentRecord:V,event:re})).error)return $;ee&&J.push(ee),K.push(te),(null==ne?void 0:ne.length)&&Y.push.apply(Y,u([],o(ne),!1)),Z+=1}}catch(e){s={error:e}}finally{try{Q&&!Q.done&&(l=X.return)&&l.call(X)}finally{if(s)throw s.error}}}if(F){var ie=0;try{for(var ae=a(F),oe=ae.next();!oe.done;oe=ae.next()){var ue=pw({allUniqueParticipantIds:Y,matchUpStatusProfile:T,participantsProfile:D,completeAllMatchUps:P,autoEntryPositions:b,hydrateCollections:M,randomWinningSide:R,ratingsParameters:y,tournamentRecord:V,eventProfile:oe.value,eventIndex:ie,startDate:f,uuids:j});if(ue.error)return ue;te=ue.eventId;var se=ue.drawIds;ne=ue.uniqueParticipantIds;se&&J.push.apply(J,u([],o(se),!1)),K.push(te),(null==ne?void 0:ne.length)&&Y.push.apply(Y,u([],o(ne),!1)),ie+=1}}catch(e){c={error:e}}finally{try{oe&&!oe.done&&(d=ae.return)&&d.call(ae)}finally{if(c)throw c.error}}}var le,ce=(null==k?void 0:k.length)?zS({tournamentRecord:V,venueProfiles:k,uuids:j}):[],de={};if(C){var pe=function(e){var r,n,i,o,u,s,l,c,d=e.schedulingProfile,p=e.tournamentRecord;if("object"!=typeof d)return{error:xr};var v=jp({tournamentRecord:p}).containedStructures,f=null!==(l=Kp({tournamentRecord:p}).matchUps)&&void 0!==l?l:[],m=p.tournamentId,h=[];try{for(var g=a(d),I=g.next();!I.done;I=g.next()){var y=I.value,S=y.scheduleDate,w=y.venues,T=void 0===w?[]:w;try{for(var P=(i=void 0,a(T)),D=P.next();!D.done;D=P.next()){var b=D.value,N=b.rounds,M=b.venueId,R=function(e){var r,n=e.drawId,i=e.winnerFinishingPositionRange,a=e.roundSegment,o=f.filter((function(t){var r,a=(null==i?void 0:i.indexOf("-"))>0&&i.split("-").map((function(e){return+e})),o=null===(r=t.finishingPositionRange)||void 0===r?void 0:r.winner;return!(t.drawId!==n||e.roundNumber&&t.roundNumber!==e.roundNumber||o&&a&&2!==E(o,a).length&&(U(o).length!==U(a).length||E(o,a).length!==U(o).length))})),u=o[0];if(u){var s=u.eventId,l=u.roundNumber,d=u.drawName,g=u.structureName,I=u.roundName,y=u.structureId;l&&!i&&(y=null!==(c=Object.keys(v).find((function(e){return v[e].includes(y)})))&&void 0!==c?c:y);var w={tournamentId:m,structureId:y,roundNumber:l,roundSegment:a,eventId:s,drawId:n},T=fw({tournamentRecords:(r={},r[m]=p,r),round:w,scheduleDate:S,venueId:M});if(T.error)return{value:T};h.push(t({structureName:g,roundName:I,drawName:d},w))}};try{for(var A=(u=void 0,a(N)),C=A.next();!C.done;C=A.next()){var x=R(C.value);if("object"==typeof x)return x.value}}catch(e){u={error:e}}finally{try{C&&!C.done&&(s=A.return)&&s.call(A)}finally{if(u)throw u.error}}}}catch(e){i={error:e}}finally{try{D&&!D.done&&(o=P.return)&&o.call(P)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{I&&!I.done&&(n=g.return)&&n.call(g)}finally{if(r)throw r.error}}return{scheduledRounds:h}}({schedulingProfile:C,tournamentRecord:V});if(pe.error)return pe;if(le=pe.scheduledRounds,O)de=RS({scheduleCompletedMatchUps:S,tournamentRecords:((p={})[V.tournamentId]=V,p),periodLength:x})}return fn(),xn(t(t({},L),{tournamentRecord:V,scheduledRounds:le,schedulerResult:de,eventIds:K,venueIds:ce,drawIds:J}))},modifyTournamentRecord:function(e){var r,n,i,s,l,c,d,p,v,f=e.ratingsParameters,m=void 0===f?KI:f,h=e.participantsProfile,g=void 0===h?{}:h,I=e.matchUpStatusProfile,y=e.completeAllMatchUps,U=e.autoEntryPositions,S=e.hydrateCollections,w=e.randomWinningSide,T=e.schedulingProfile,P=e.tournamentRecord,D=e.eventProfiles,b=e.periodLength,N=e.venueProfiles,M=e.autoSchedule,R=e.drawProfiles,A=e.uuids;if(!P)return{error:W};var E=[],C=[],x=[];null==D||D.forEach((function(e){var t,r=null===(t=P.events)||void 0===t?void 0:t.find((function(t,r){return void 0!==e.eventIndex&&r===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId}));(null==r?void 0:r.gender)&&(e.gender=r.gender)}));var O=(null===(d=P.participants)||void 0===d?void 0:d.length)||void 0;O&&(null==g?void 0:g.idPrefix)&&(g.idPrefix="".concat(g.idPrefix,"-").concat(O));var F=kS({startDate:P.startDate,participantsProfile:g,tournamentRecord:P,eventProfiles:D,drawProfiles:R,uuids:A});if(!F.success)return F;if(D){var k=(null===(p=P.events)||void 0===p?void 0:p.length)||0,_=function(e){var t=e.ratingsParameters,r=null===(v=P.events)||void 0===v?void 0:v.find((function(t,r){return void 0!==e.eventIndex&&r===e.eventIndex||e.eventName&&t.eventName===e.eventName||e.eventId&&t.eventId===e.eventId}));if(r){var n=r.gender,i=r.category,a=r.eventType,s=e.drawProfiles,l=e.publish,c=a===va&&fs||a===ma&&hs||a;if(s){var d=YS({drawProfiles:s,category:i,gender:n}),p=d.stageParticipantsCount,f=d.uniqueParticipantsCount,m=d.uniqueParticipantStages?lw({event:{eventType:a,category:i,gender:n},uniqueParticipantsCount:f,participantsProfile:g,ratingsParameters:t,tournamentRecord:P,eventProfile:e,uuids:A}):{},h=m.uniqueDrawParticipants,S=void 0===h?[]:h,T=m.uniqueParticipantIds;O=void 0===T?[]:T;E.push.apply(E,u([],o(O),!1));var D=KS({targetParticipants:P.participants||[],allUniqueParticipantIds:E,stageParticipantsCount:p,eventParticipantType:c}).stageParticipants,b=dw({uniqueDrawParticipants:S,autoEntryPositions:U,stageParticipants:D,tournamentRecord:P,drawProfiles:s,category:i,gender:n,event:r});if(b.error)return{value:b};if((b=sw({matchUpStatusProfile:I,completeAllMatchUps:y,randomWinningSide:w,tournamentRecord:P,drawProfiles:s,event:r})).error)return{value:b};x.push.apply(x,u([],o(b.drawIds),!1))}l&&Pf({tournamentRecord:P,event:r})}else{var N=pw({startDate:P.startDate,allUniqueParticipantIds:E,matchUpStatusProfile:I,participantsProfile:g,completeAllMatchUps:y,autoEntryPositions:U,randomWinningSide:w,ratingsParameters:t,tournamentRecord:P,eventProfile:e,eventIndex:k,uuids:A});if(N.error)return{value:N};var M=N.eventId,R=N.drawIds,O=N.uniqueParticipantIds;R&&x.push.apply(x,u([],o(R),!1)),C.push(M),(null==O?void 0:O.length)&&E.push.apply(E,u([],o(O),!1)),k+=1}};try{for(var j=a(D),B=j.next();!B.done;B=j.next()){var V=_(B.value);if("object"==typeof V)return V.value}}catch(e){r={error:e}}finally{try{B&&!B.done&&(n=j.return)&&n.call(j)}finally{if(r)throw r.error}}}if(R){var G=(P.events||[]).map((function(e){var t;return(null===(t=e.drawDefinitions)||void 0===t?void 0:t.map((function(){return 1})))||[]})).flat().reduce((function(e,t){return e+t}),0);try{for(var q=a(R),H=q.next();!H.done;H=q.next()){var z=H.value,Y=mw({startDate:P.startDate,allUniqueParticipantIds:E,matchUpStatusProfile:I,participantsProfile:g,completeAllMatchUps:y,autoEntryPositions:U,hydrateCollections:S,randomWinningSide:w,ratingsParameters:m,tournamentRecord:P,drawProfile:z,drawIndex:G,uuids:A});if(Y.error)return Y;var K=Y.drawId,J=Y.eventId,Z=Y.event,X=Y.uniqueParticipantIds;if((Y=nU({tournamentRecord:P,event:Z,internalUse:!0})).error)return Y;K&&x.push(K),C.push(J),(null==X?void 0:X.length)&&E.push.apply(E,u([],o(X),!1)),G+=1}}catch(e){i={error:e}}finally{try{H&&!H.done&&(s=q.return)&&s.call(q)}finally{if(i)throw i.error}}}var Q=(null==N?void 0:N.length)?zS({tournamentRecord:P,venueProfiles:N}):[],$={};if(null==T?void 0:T.length){var ee=vf({tournamentRecords:((l={})[P.tournamentId]=P,l),schedulingProfile:T});if(ee.error)return ee;if(M)$=RS({tournamentRecords:((c={})[P.tournamentId]=P,c),periodLength:b})}var te=P.participants.length;return t(t({totalParticipantsCount:te,scheduledRounds:undefined,schedulerResult:$},L),{eventIds:C,venueIds:Q,drawIds:x})},generateEventWithDraw:mw,generateParticipants:xS,parseScoreString:rS,generateOutcome:nw,credits:gw};function yw(e){var t,r,n=e.personFormat,i=e.person,a=function(e){return e.replace(/\W/g,"")},o=function(e){return e.toLowerCase().indexOf("l")<e.toLowerCase().indexOf("f")},u=function(e){return e.indexOf(",")>=0};if(i){var s=n.indexOf(" ")>0?" ":"",l=$v(null!==(t=null==i?void 0:i.standardGivenName)&&void 0!==t?t:""),c=$v(null!==(r=null==i?void 0:i.standardFamilyName)&&void 0!==r?r:"");if(!n)return"".concat(l).concat(s).concat(c);!function(e){return e.toLowerCase().indexOf("f.")>=0}(n)||u(n)||o(n)||(l="".concat(l[0],".")),!function(e){return/^[a-z]*$/.test(a(e))}(n)?!function(e){return/^[A-Z]*$/.test(a(e))}(n)?function(e){return/^[LAST]{4}/.test(a(e))}(n)&&(c=c.toUpperCase()):(l=l.toUpperCase(),c=c.toUpperCase()):(l=l.toLowerCase(),c=c.toLowerCase());var d="".concat(l).concat(s).concat(c);return!function(e){return e.toLowerCase().indexOf("f")<0}(n)?o(n)&&(d=u(n)?"".concat(c,",").concat(s).concat(l):"".concat(c).concat(s).concat(l)):d=c,d}}function Uw(e){var t=e.participantMap,r=e.participant,n=e.formats,i=r.participantType,a=r.individualParticipantIds,o=r.person,u=i&&n[i];if(i!==vs&&u){var s=u.personFormat,l=u.doublesJoiner;i===fs&&(r.participantName=yw({person:o,personFormat:s})),i===hs&&(r.participantName=null==a?void 0:a.map((function(e){var r;return yw({person:null===(r=t[e])||void 0===r?void 0:r.person,personFormat:s})})).filter(Boolean).join(null!=l?l:"/"))}}function Sw(e){var r,n=e.tournamentRecord,i=e.penaltyId;if(!n)return{error:W};if(!i)return{error:ir};var a,o=null!==(r=null==n?void 0:n.participants)&&void 0!==r?r:[],u=[],s=!1;return o.forEach((function(e){var t,r=!1;e.penalties=(null!==(t=e.penalties)&&void 0!==t?t:[]).filter((function(t){return t.penaltyId===i&&(r=!0,s||(a=t,s=!0)),r&&u.push(e),t.penaltyId!==i}))})),a&&mn({topic:md,payload:{tournamentId:n.tournamentId,participants:u}}),a?t(t({},L),{penalty:a}):{error:ar}}var ww=function(e){var t=(void 0===e?{}:e).penaltyId;return{refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:void 0===t?ed():t}};function Tw(e){var r,n=e.tournamentRecord,i=e.modifications,a=e.penaltyId;if(!n)return{error:W};if(!i)return{error:xr,modifications:i};if(!a)return{error:ir};var o,u=null!==(r=null==n?void 0:n.participants)&&void 0!==r?r:[],s=Object.keys(ww()).filter((function(e){return"penaltyId"!==e})),l=Object.keys(i).filter((function(e){return s.includes(e)}));if(!l.length)return{error:_r};var c=[];return u.forEach((function(e){var t,r=!1;e.penalties=(null!==(t=e.penalties)&&void 0!==t?t:[]).map((function(e){return e.penaltyId===a&&(r=!0,l.forEach((function(t){var r;return Object.assign(e,((r={})[t]=i[t],r))})),o||(o=e)),e})),r&&c.push(e)})),o&&mn({topic:md,payload:{tournamentId:n.tournamentId,participants:c}}),o?t(t({},L),{penalty:o}):{error:ar}}function Pw(e,t,r){return!e&&t?t:e&&!t||"object"!=typeof e||"object"!=typeof t?e:U(Object.keys(e).concat(Object.keys(t))).reduce((function(n,i){if(t[i])if(e[i])if(typeof e[i]!=typeof t[i])n[i]=t[i];else if(Array.isArray(e[i]))if(!0===r||Array.isArray(r)&&r.includes(i)){var a=U(e[i].map((function(e){return JSON.stringify(e)})).concat(t[i].map((function(e){return JSON.stringify(e)})))).map((function(e){return JSON.parse(e)}));n[i]=a}else n[i]=t[i];else"object"==typeof e[i]?n[i]=Pw(e[i],t[i],r):n[i]=t[i];else n[i]=t[i];else n[i]=e[i];return n}),{})}function Dw(e){var r,n=e.refereeParticipantId,i=e.tournamentRecord,a=e.participantIds,o=e.penaltyCode,u=e.penaltyType,s=e.extensions,l=e.penaltyId,c=e.matchUpId,d=e.issuedAt,p=e.notes;if(!i)return{error:W};if(!a)return{error:_t};if(!u)return{error:nr};var v=(null!==(r=null==i?void 0:i.participants)&&void 0!==r?r:[]).filter((function(e){return a.includes(e.participantId)}));if(!v.length)return{error:Lt};var f=(new Date).toISOString(),m=Object.assign(ww({penaltyId:l}),{refereeParticipantId:n,penaltyCode:o,penaltyType:u,matchUpId:c,notes:p,issuedAt:d,createdAt:f});return Array.isArray(s)&&s.forEach((function(e){return jn({element:m,extension:e})})),v.forEach((function(e){e.penalties||(e.penalties=[]),e.penalties.push(m)})),mn({topic:md,payload:{tournamentId:i.tournamentId,participants:v}}),t(t({},L),{penaltyId:m.penaltyId})}var bw={addIndividualParticipantIds:Sm,addParticipant:gm,addParticipants:kI,addPenalty:function(e){var r,n,i,o,u,s,l,c,d=e.tournamentRecord,p=e.participantIds,v=null!==(u=null!==(o=e.tournamentRecords)&&void 0!==o?o:d&&((r={})[d.tournamentId]=d,r))&&void 0!==u?u:{};try{for(var f=a(Object.values(v)),m=f.next();!m.done;m=f.next()){var h=m.value,g=null!==(s=Rv({tournamentRecord:h}).participants)&&void 0!==s?s:[],I=null==g?void 0:g.map(Ri("participantId")).filter((function(e){return p.includes(e)}));if(I.length)c=Dw(t(t({},e),{penaltyId:null!==(l=e.penaltyId)&&void 0!==l?l:c,tournamentRecord:h,participantIds:I})).penaltyId}}catch(e){n={error:e}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}return c?t(t({},L),{penaltyId:c}):{error:Lt}},addPersons:function(e){var r,n,i=e.participantRole,a=void 0===i?Vv:i,s=e.tournamentRecord,l=e.persons;if(!s)return{error:W};if(!Array.isArray(l))return{error:xr};if(!Object.keys(Wv).includes(a))return{error:Ct};var c,d=(s.participants||[]).map((function(e){var t=e.person;return null==t?void 0:t.personId})).filter(Boolean),p=[],v=l.filter((function(e){return e&&(!e.personId||!d.includes(e.personId))})).map((function(e){return e.personId||(e.personId=ed()),p.push(e.personId),e})).map((function(e){return xn({extensions:e.participantExtensions,timeItems:e.participantTimeItems,participantType:fs,participantRole:a,person:(t=e,r=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign.apply(Object,u([{}],o(Object.keys(t).filter((function(e){return!r.includes(e)})).map((function(e){var r;return(r={})[e]=t[e],r}))),!1)))});var t,r})),f=0,m=kI({participants:v,tournamentRecord:s});if(m.error)return m;c=m.addedCount||0;var h=[],g=null!==(n=null===(r=Rv({participantFilters:{participantTypes:[fs]},tournamentRecord:s}))||void 0===r?void 0:r.participants)&&void 0!==n?n:[];if(a===Vv&&l.filter((function(e){return e.pairedPersons})).forEach((function(e){var t=e.personId,r=e.pairedPersons;Array.isArray(r)&&r.forEach((function(e){var r=[t,e.personId].map((function(e){return Wa({tournamentParticipants:g,personId:e})})).filter(Boolean);if(2===r.length){var n=r.map(Mo);h.push(xn({extensions:e.participantExtensions,timeItems:e.timeItems,participantRole:Vv,individualParticipantIds:n,participantType:hs}))}}))})),h.length){if((m=kI({participants:h,tournamentRecord:s})).error)return m;f=m.addedCount||0}var I=c+f;return t(t({},L),{addedCount:I,newPersonIds:p})},createGroupParticipant:function(e){var r,n,i,o=e.individualParticipantIds,u=void 0===o?[]:o,s=e.participantRoleResponsibilities,l=e.participantRole,c=void 0===l?qv:l,d=e.tournamentRecord,p=e.participantId,v=e.groupName;if(!d)return{error:W};if(!v)return{error:pt,info:"Missing groupName"};if(!Array.isArray(u))return{info:"Invalid individualParticipantIds",error:xr};var f=(null!==(i=Rv({participantFilters:{participantTypes:[fs]},tournamentRecord:d}).participants)&&void 0!==i?i:[]).map((function(e){return e.participantId}));try{for(var m=a(u),h=m.next();!h.done;h=m.next()){var g=h.value;if(!f.includes(g))return{error:xt,participantId:g}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}var I=xn({participantId:p||ed(),participantRoleResponsibilities:s,participantName:v,individualParticipantIds:u,participantType:ms,participantRole:c}),y=gm({participant:I,tournamentRecord:d});return y.error?y:(Un().topics.includes(nd)&&mn({topic:nd,payload:{tournamentId:d.tournamentId,participants:[I]}}),t(t({},L),{participant:Ui(I)}))},createTeamsFromParticipantAttributes:ES,deleteParticipants:Kv,filterParticipants:Nv,mergeParticipants:function(e){var r,n=e.participants,i=void 0===n?[]:n,a=e.tournamentRecord,s=e.arraysToMerge;if(!a)return{error:W};a.participants||(a.participants=[]);var l=i.filter(Ri(Li)).map((function(e){var t;return(t={})[e.participantId]=e,t})),c=Object.assign.apply(Object,u([{}],o(l),!1)),d=[];a.participants=a.participants.map((function(e){if(c[e.participantId]){var t=Pw(e,c[e.participantId],s);return d.push(t),t}return e}));var p=a.participants.map(Ri(Li))||[],v=i.filter((function(e){var t=e.participantId;return!p.includes(t)})),f=Un().topics;return v.length&&(a.participants=(r=a.participants).concat.apply(r,u([],o(v),!1)),f.includes(nd)&&mn({topic:nd,payload:{participants:v}})),d.length&&f.includes(md)&&mn({topic:md,payload:{tournamentId:a.tournamentId,participants:d}}),t({modifiedParticipantsCount:d.length,newParticipantsCount:v.length},L)},modifyIndividualParticipantIds:function(e){var r=e.individualParticipantIds,n=e.groupingParticipantId,i=e.tournamentRecord,a="modifyIndividualParticipantIds";if(!i)return On({result:{error:W},stack:a});if(!n||!r)return On({result:{error:pt},stack:a});var o=i.participants||[],u=o.find((function(e){return e.participantId===n}));if(!u)return On({result:{error:Lt},stack:a});if(![gs,ms].includes(u.participantType))return On({result:{error:xt},context:{participantType:u.participantType},stack:a});var s=r.filter((function(e){var t=o.find((function(t){return t.participantId===e}));return(null==t?void 0:t.participantType)!==fs}));if(s.length)return On({result:{error:Et,invalidParticipantIds:s},stack:a});var l=u.individualParticipantIds||[],c=r.filter((function(e){return!l.includes(e)})),d=l.filter((function(e){return!r.includes(e)})),p=Sm({individualParticipantIds:c,groupingParticipantId:n,tournamentRecord:i});if(p.error)return On({result:p,stack:a});var v=Hv({individualParticipantIds:d,groupingParticipantId:n,tournamentRecord:i});if(v.error)return On({result:v,stack:a});if(Un().topics.includes(md)){var f=o.find((function(e){return e.participantId===n}));mn({topic:md,payload:{tournamentId:i.tournamentId,participants:[f]}})}return t(t({},p),v)},modifyParticipant:wm,modifyParticipantName:function(e){var r=e.tournamentRecord,n=e.participantName,i=e.participantId;if(!r)return{error:W};if(!i)return{error:_t};if(!n)return{error:pt,info:"Missing participantName"};var a=Ps({tournamentRecord:r,participantId:i}).participant;return a?(a.participantName=n,Un().topics.includes(md)&&mn({topic:md,payload:{tournamentId:r.tournamentId,participants:[a]}}),t({},L)):{error:Lt}},modifyParticipantOtherName:function(e){var r=e.tournamentRecord,n=e.participantId,i=e.participantOtherName;if(!r)return{error:W};if(!n)return{error:_t};var a=Ps({tournamentRecord:r,participantId:n}).participant;return a?(a.participantOtherName=i,Un().topics.includes(md)&&mn({topic:md,payload:{tournamentId:r.tournamentId,participants:[a]}}),t({},L)):{error:Lt}},modifyParticipantsSignInStatus:function(e){var r,n,i=e.tournamentRecord,o=e.participantIds,u=e.signInState;if(!i)return{error:W};if(!Array.isArray(o))return{error:pt};if(![ps,ds].includes(u))return{error:xr,signInState:u};var s=i.participants||[];if(!s.length)return{error:kt};var l=s.map(Mo),c=o.filter((function(e){return!l.includes(e)}));if(c.length)return{error:xr,context:{invalidParticipantIds:c}};var d=[],p=(new Date).toISOString();try{for(var v=a(s),f=v.next();!f.done;f=v.next()){var m=f.value,h=m.participantId;if(o.includes(h)){var g=hf({duplicateValues:!1,tournamentRecord:i,participantId:h,timeItem:{itemType:cs,itemValue:u,createdAt:p}});if(g.error)return g;d.push(m)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(n=v.return)&&n.call(v)}finally{if(r)throw r.error}}var I=Un().topics;return d.length&&I.includes(md)&&mn({topic:md,payload:{tournamentId:i.tournamentId,participants:d}}),t({},L)},modifyPenalty:function(e){var r,n,i=e.tournamentRecords;if("object"!=typeof i||!Object.keys(i).length)return{error:q};try{for(var o=a(Object.values(i)),u=o.next();!u.done;u=o.next()){var s=u.value,l=Tw(t(t({},e),{tournamentRecord:s}));if(l.error&&l.error!==ar)return l;if(l.success)return l}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return{error:ar}},regenerateParticipantNames:function(e){var r,n,i,o=e.tournamentRecord,u=e.formats;if(!o)return{error:W};if(!Di(u))return{error:pt};var s=null!==(i=o.participants)&&void 0!==i?i:[],l=Ni(s,"participantId");try{for(var c=a(s),d=c.next();!d.done;d=c.next()){Uw({participant:d.value,participantMap:l,formats:u})}}catch(e){r={error:e}}finally{try{d&&!d.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}return t({},L)},removeIndividualParticipantIds:Hv,removeParticipantIdsFromAllTeams:Yv,removePenalty:function(e){var r,n,i=e.tournamentRecords;if("object"!=typeof i||!Object.keys(i).length)return{error:q};try{for(var o=a(Object.values(i)),u=o.next();!u.done;u=o.next()){var s=u.value,l=Sw(t(t({},e),{tournamentRecord:s}));if(l.error&&l.error!==ar)return l}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t({},L)},scaledTeamAssignment:function(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,y,U,S,w,T,P,D,b,N,M,A,E,C,x,O=e.clearExistingAssignments,F=void 0===O||O,k=e.individualParticipantIds,_=e.reverseAssignmentOrder,j=e.initialTeamIndex,B=void 0===j?0:j,V=e.scaledParticipants,G=void 0===V?[]:V,q=e.teamParticipantIds,H=e.tournamentRecord,z=e.scaleAttributes,Y=e.teamNameBase,K=e.teamsCount,J=e.eventId,Z=e.event;if(!H)return{error:W};if(!Array.isArray(q)&&!I(K)&&!J||!I(B)||G&&!Array.isArray(G)||z&&("object"!=typeof z||!Object.keys(z).length))return{error:xr};if(!z&&!G.length||!G&&(!k||!z))return{error:pt,info:"Missing scaling details"};if(J&&!q){if((null==Z?void 0:Z.eventType)!==Ia)return{error:Re};q=null===(S=null==Z?void 0:Z.entries)||void 0===S?void 0:S.filter((function(e){return e.entryStatus===Tl})).map(Mo)}if(!(null==q?void 0:q.length)&&!K)return{info:"Missing teamParticipantIds or teamsCount",error:pt};var X=null!=k?k:G.map((function(e){return e.participantId}));_&&(null==q||q.reverse(),B+=1),B>((null==q?void 0:q.length)||0)-1&&(B=0);var Q=null!==(w=null==q?void 0:(r=q.slice(B)).concat.apply(r,u([],o(q.slice(0,B)),!1)))&&void 0!==w?w:[],$=[];try{for(var ee=a(null!==(T=H.participants)&&void 0!==T?T:[]),te=ee.next();!te.done;te=ee.next()){var re=(fe=te.value).participantId,ne=fe.participantType;if(Q.includes(re)){if(ne!==vs)return{error:xt,participant:fe};$.push(fe)}}}catch(e){n={error:e}}finally{try{te&&!te.done&&(i=ee.return)&&i.call(ee)}finally{if(n)throw n.error}}if(K&&$.length<K){var ie=K-((null==$?void 0:$.length)||0),ae=null!=Y?Y:"Team",oe=kI({participants:R(0,ie).map((function(e){return{participantName:"".concat(ae," ").concat(e+1),participantType:vs,participantRole:Vv}})),returnParticipants:!0,tournamentRecord:H}).participants,ue=(void 0===oe?[]:oe).map(Mo),se=null!==(D=null===(P=H.participants)||void 0===P?void 0:P.filter((function(e){var t=e.participantId;return ue.includes(t)})))&&void 0!==D?D:[];$.push.apply($,u([],o(se),!1))}if(!$.length)return{error:Fr};if(F)try{for(var le=a($),ce=le.next();!ce.done;ce=le.next()){(we=ce.value).individualParticipantIds=[]}}catch(e){s={error:e}}finally{try{ce&&!ce.done&&(l=le.return)&&l.call(le)}finally{if(s)throw s.error}}else{var de=$.map((function(e){return e})).flat();(null==k?void 0:k.length)?X=X.filter((function(e){return!de.includes(e)})):G=null==G?void 0:G.filter((function(e){var t=e.participantId;return!de.includes(t)}))}if(!(null==k?void 0:k.length)&&!(null==G?void 0:G.length))return{error:Nr,info:"Nothing to be done"};if(!G.length){try{for(var pe=a(null!==(b=H.participants)&&void 0!==b?b:[]),ve=pe.next();!ve.done;ve=pe.next()){var fe;re=(fe=ve.value).participantId,ne=fe.participantType;if(X.includes(re)){if(ne!==fs)return{error:xt,participant:fe};var me=null===(N=yv({scaleAttributes:z,participant:fe}))||void 0===N?void 0:N.scaleItem,he={participantId:re,scaleValue:(null==z?void 0:z.accessor)?null===(M=null==me?void 0:me.scaleValue)||void 0===M?void 0:M[null==z?void 0:z.accessor]:null==me?void 0:me.scaleValue};G.push(he)}}}catch(e){c={error:e}}finally{try{ve&&!ve.done&&(d=pe.return)&&d.call(pe)}finally{if(c)throw c.error}}if(!G.length)return{error:Lt}}G.sort((function(e,t){return(null==z?void 0:z.sortOrder)?((null==t?void 0:t.scaleValue)||0)-((null==e?void 0:e.scaleValue)||0):((null==e?void 0:e.scaleValue)||1/0)-((null==t?void 0:t.scaleValue)||1/0)}));try{for(var ge=a(G),Ie=ge.next();!Ie.done;Ie=ge.next()){if(!(he=Ie.value).participantId)return{error:xr,scaledParticipant:he}}}catch(e){p={error:e}}finally{try{Ie&&!Ie.done&&(v=ge.return)&&v.call(ge)}finally{if(p)throw p.error}}for(var ye=0;ye<G.length;){try{for(var Ue=(f=void 0,a($)),Se=Ue.next();!Se.done;Se=Ue.next()){var we=Se.value;if(ye+1>G.length)break;he=G[ye];we.individualParticipantIds.push(he.participantId),ye++}}catch(e){f={error:e}}finally{try{Se&&!Se.done&&(m=Ue.return)&&m.call(Ue)}finally{if(f)throw f.error}}$.reverse()}var Te=$.map(Mo);try{for(var Pe=a(null!==(A=H.events)&&void 0!==A?A:[]),De=Pe.next();!De.done;De=Pe.next()){var be=De.value;if(be.eventType===Ia){var Ne=(null!==(E=be.entries)&&void 0!==E?E:[]).filter((function(e){return Te.includes(e.participantId)})),Me=function(e){var t=e.participantId,r=$.find((function(e){return e.participantId===t})),n=null==r?void 0:r.individualParticipantIds;be.entries=(null!==(C=be.entries)&&void 0!==C?C:[]).filter((function(e){return!n.includes(e.participantId)})),(null!==(x=be.drawDefinitions)&&void 0!==x?x:[]).forEach((function(e){var t;e.entries=(null!==(t=e.entries)&&void 0!==t?t:[]).filter((function(e){return!n.includes(e.participantId)}))}));var i=_d({event:be}).flightProfile;((null==i?void 0:i.flights)||[]).forEach((function(e){e.drawEntries=(e.drawEntries||[]).filter((function(e){return!n.includes(e.participantId)}))}))};try{for(var Ae=(y=void 0,a(Ne)),Ee=Ae.next();!Ee.done;Ee=Ae.next()){Me(Ee.value)}}catch(e){y={error:e}}finally{try{Ee&&!Ee.done&&(U=Ae.return)&&U.call(Ae)}finally{if(y)throw y.error}}}}}catch(e){h={error:e}}finally{try{De&&!De.done&&(g=Pe.return)&&g.call(Pe)}finally{if(h)throw h.error}}return t(t({},L),{scaledParticipants:G})},setParticipantScaleItem:JS,setParticipantScaleItems:function(e){var n,i,o,u,s,l=e.scaleItemsWithParticipantIds,c=void 0===l?[]:l,d=e.removePriorValues,p=e.tournamentRecord,v=e.auditData,f=e.context;if(!p)return{error:W};if(!p.participants)return{error:kt};var m=0,h={},g=[];try{for(var I=a(c),y=I.next();!y.done;y=I.next()){var U=y.value,S=null==U?void 0:U.participantId;if(Array.isArray(null==U?void 0:U.scaleItems))try{for(var w=(o=void 0,a(U.scaleItems)),T=w.next();!T.done;T=w.next()){var P=T.value;if(!ZS({scaleItem:P}))return{error:Tr};Array.isArray(h[S])||(h[S]=[]),h[S].push(P)}}catch(e){o={error:e}}finally{try{T&&!T.done&&(u=w.return)&&u.call(w)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{y&&!y.done&&(i=I.return)&&i.call(I)}finally{if(n)throw n.error}}p.participants.forEach((function(e){var t=(e||{}).participantId;Array.isArray(h[t])&&h[t].forEach((function(t){XS({participant:e,scaleItem:t,removePriorValues:d}),g.push(e),m++}))}));var D=m?void 0:Dr,b=Un().topics;if(b.includes(md)&&m&&mn({topic:md,payload:{tournamentId:p.tournamentId,participants:g}}),f){var N=f.eventId,M=f.drawId,R=r(f,["eventId","drawId"]),A=(null===(s=R.scaleAttributes)||void 0===s?void 0:s.scaleType)&&[R.scaleAttributes.scaleType];if(Object.keys(R).length){var E={itemType:id,itemValue:R};if(A&&(E.itemSubTypes=A),M||N){var C=Ld({tournamentRecord:p,eventId:N,drawId:M}),x=C.drawDefinition,O=C.event;M&&Xg({drawDefinition:x,timeItem:E}),N&&If({event:O,timeItem:E})}else gf({tournamentRecord:p,timeItem:E})}}return v&&b.includes(od)&&mn({topic:od,payload:v}),xn(t(t({},L),{modificationsApplied:m,info:D}))}};function Nw(e,r){var n,i=null!==(n=tl(e).appliedPolicies)&&void 0!==n?n:{};if(i[e.policyType]){if(delete i[e.policyType],Object.keys(i).length)jn({element:r,extension:{name:Za,value:i}});else _n({element:r,name:Za});return t({},L)}return{error:st}}var Mw={attachPolicies:EI,removePolicy:function(e){var r,n,i,o,u,s,l,c=da(e,[(r={},r.policyType=!0,r._anyOf=(n={},n[xi]=!1,n[Fi]=!1,n[ki]=!1,n[ta]=!1,n),r)]);if(c.error)return c;var d=null!==(s=null!==(u=e.drawDefinition)&&void 0!==u?u:e.event)&&void 0!==s?s:(e.tournamentId||!e.tournamentRecords)&&e.tournamentRecord;if(d)return Nw(e,d);if(!e.tournamentRecords)return{error:W};var p=Object.keys(e.tournamentRecords);if(!p.length)return{error:W};try{for(var v=a(p),f=v.next();!f.done;f=v.next()){var m=f.value,h=Nw(e,e.tournamentRecords[m]);if(h.error)return h;l=!0}}catch(e){i={error:e}}finally{try{f&&!f.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}return l?t({},L):{error:st}}};function Rw(e){var r,n=e.removePriorValues,i=void 0===n||n,a=e.tournamentRecord,o=e.status,u=void 0===o?Tc:o;if(!a)return{error:W};var s="".concat(wc,".").concat(Pc),l=Ds({element:a,itemType:s}).timeItem,c=(null==l?void 0:l.itemValue)||((r={})[u]={},r);return c[u]&&delete c[u].orderOfPlay,mf({timeItem:{itemValue:c,itemType:s},element:a,removePriorValues:i}),mn({topic:bd,payload:{tournamentId:a.tournamentId}}),t({},L)}function Aw(e){var r,n=e.scheduledDates,i=void 0===n?[]:n,a=e.removePriorValues,o=e.tournamentRecord,u=e.status,s=void 0===u?Tc:u,l=e.eventIds,c=void 0===l?[]:l;if(!o)return{error:W};var d="".concat(wc,".").concat(Pc),p=Ds({element:o,itemType:d}).timeItem,v=(null==p?void 0:p.itemValue)||((r={})[s]={},r);return v[s].orderOfPlay={published:!0,scheduledDates:i,eventIds:c},mf({timeItem:{itemValue:v,itemType:d},element:o,removePriorValues:a}),mn({topic:Td,payload:{tournamentId:o.tournamentId,scheduledDates:i,eventIds:c}}),t({},L)}var Ew,Cw,xw,Ow,Fw,kw={getAllEventData:function(e){var t=e.tournamentRecord,r=e.policyDefinitions;if(!t)return{error:W};var n=t.events||[],i=(null==t?void 0:t.participants)||[],a=Uf({tournamentRecord:t}).tournamentInfo,o=lf({tournamentRecord:t}).venues,u=n.map((function(e){var n=e.eventId,a=function(e){return{eventId:e.eventId,eventName:e.eventName,eventType:e.eventType,eventLevel:e.eventLevel,surfaceCategory:e.surfaceCategory,matchUpFormat:e.matchUpFormat,category:e.category,gender:e.gender,startDate:e.startDate,endDate:e.endDate,ballType:e.ballType,discipline:e.discipline}}(e),o=Ac({tournamentRecord:t,event:e}).scheduleTiming,u=(e.drawDefinitions||[]).map((function(a){var u=function(e){var t=e.drawId,r=e.drawName;return{matchUpFormat:e.matchUpFormat,updatedAt:e.updatedAt,drawName:r,drawId:t}}(a),s=yp({requireParticipants:!0,tournamentParticipants:i,context:{eventId:n},policyDefinitions:r,tournamentRecord:t,inContext:!0,scheduleTiming:o,drawDefinition:a,event:e});return{drawInfo:u,matchUps:{abandonedMatchUps:s.abandonedMatchUps,completedMatchUps:s.completedMatchUps,upcomingMatchUps:s.upcomingMatchUps,pendingMatchUps:s.pendingMatchUps}}})),s=Uv({event:e});return Object.assign(a,{drawsData:u,publish:s}),a}));return{allEventData:{tournamentInfo:a,venuesData:o,eventsData:u}}},getCourtInfo:xd,getDrawData:wf,getEventData:Tf,getPublishState:wv,getVenueData:Od,publishEvent:Pf,publishEventSeeding:function(e){var r,n,i,a,o=e.removePriorValues,u=void 0===o||o,s=e.stageSeedingScaleNames,l=e.seedingScaleNames,c=e.tournamentRecord,d=e.status,p=void 0===d?Tc:d,v=e.drawIds,f=void 0===v?[]:v,m=e.event;if(!c)return{error:W};if(!m)return{error:Ae};var h=Uv({event:m,status:p}),g=((null===(r=null==h?void 0:h.seeding)||void 0===r?void 0:r.seedingScaleNames)||l)&&t(t({},null===(n=null==h?void 0:h.seeding)||void 0===n?void 0:n.seedingScaleNames),l);return yf({statusObject:{seeding:xn({stageSeedingScaleNames:((null===(i=null==h?void 0:h.seeding)||void 0===i?void 0:i.stageSeedingScaleNames)||s)&&t(t({},null===(a=null==h?void 0:h.seeding)||void 0===a?void 0:a.stageSeedingScaleNames),s),seedingScaleNames:g,published:!0,drawIds:f})},removePriorValues:u,status:p,event:m}),mn({topic:wd,payload:{tournamentId:c.tournamentId,eventId:m.eventId,drawIds:f}}),t({},L)},publishOrderOfPlay:function(e){var r,n,i=$c(e);if(!Object.keys(i).length)return{error:q};try{for(var o=a(Object.values(i)),u=o.next();!u.done;u=o.next()){var s=u.value,l=Aw(t({tournamentRecord:s},e));if(l.error)return l}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return t({},L)},setEventDisplay:function(e){var r,n,i,s,l,c=e.removePriorValues,d=e.tournamentRecord,p=e.displaySettings,v=e.status,f=void 0===v?Tc:v,m=e.event;if(!d)return On({result:{error:W}});if(!m)return On({result:{error:Ae}});if(!Di(p))return On({result:{error:pt}});if(Di(p.draws))try{for(var h=a(Object.keys(p.draws)),g=h.next();!g.done;g=h.next()){var I=g.value,y=null!==(l=p.draws[I].scheduleDetails)&&void 0!==l?l:[];if(y.length){var U=[],S=function(e){var t,r=U.find((function(t){return bi(t.attributes,e.attributes)}));(null==r?void 0:r.dates)&&e.dates?(t=r.dates).push.apply(t,u([],o(e.dates),!1)):U.push(e)};try{for(var w=(i=void 0,a(y)),T=w.next();!T.done;T=w.next()){S(T.value)}}catch(e){i={error:e}}finally{try{T&&!T.done&&(s=w.return)&&s.call(w)}finally{if(i)throw i.error}}p.draws[I].scheduleDetails=U}}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}var P=yf({statusObject:{displaySettings:p},removePriorValues:c,status:f,event:m});return P.error?P:t({},L)},unPublishEvent:function(e){var r,n=e.removePriorValues,i=void 0===n||n,a=e.tournamentRecord,o=e.status,u=void 0===o?Tc:o,s=e.event;if(!a)return{error:W};if(!s)return{error:Ae};var l="".concat(wc,".").concat(Pc),c=bs({itemType:l,event:s}).timeItem,d=(null==c?void 0:c.itemValue)||((r={})[u]={},r);return delete d[u].structureIds,delete d[u].drawDetails,delete d[u].drawIds,If({event:s,timeItem:{itemValue:d,itemType:l},removePriorValues:i}),yf({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:i,status:u,event:s}),mn({topic:Pd,payload:{tournamentId:a.tournamentId,eventId:s.eventId}}),t({eventId:s.eventId},L)},unPublishEventSeeding:function(e){var r,n,i,o,u,s=e.removePriorValues,l=void 0===s||s,c=e.seedingScaleNames,d=e.tournamentRecord,p=e.status,v=void 0===p?Tc:p,f=e.drawIds,m=e.stages,h=e.event;if(!d)return{error:W};if(!h)return{error:Ae};var g=Uv({event:h});if(g){var I=g.seeding;if(Array.isArray(m)&&I.stageSeedingScaleNames)try{for(var y=a(m),U=y.next();!U.done;U=y.next()){var S=U.value;I.stageSeedingScaleNames[S]&&delete I.stageSeedingScaleNames[S]}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}Array.isArray(c)&&(null==I?void 0:I.seedingScaleNames)&&(I.seedingScaleNames=I.seedingScaleNames.filter((function(e){return!c.includes(e)}))),Array.isArray(f)&&(null==I?void 0:I.drawIds)&&(I.drawIds=I.drawIds.filter((function(e){return!f.includes(e)}))),(Object.values(null!==(i=I.stageSeedingScaleNames)&&void 0!==i?i:{}).length||(null===(o=I.seedingScaleNames)||void 0===o?void 0:o.length)||(null===(u=I.drawIds)||void 0===u?void 0:u.length))&&(m||c||(null==f?void 0:f.length))||(delete I.stageSeedingScaleNames,delete I.seedingScaleNames,delete I.drawIds,I.published=!1),yf({statusObject:{seeding:I},removePriorValues:l,status:v,event:h})}return mn({topic:Dd,payload:{tournamentId:d.tournamentId,eventId:h.eventId}}),t({},L)},unPublishOrderOfPlay:function(e){var r,n,i,o,u,s=null!==(u=null!==(o=null==e?void 0:e.tournamentRecords)&&void 0!==o?o:(null==e?void 0:e.tournamentRecord)&&((r={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,r))&&void 0!==u?u:{};if(!Object.keys(s).length)return{error:q};try{for(var l=a(Object.values(s)),c=l.next();!c.done;c=l.next()){var d=c.value,p=Rw(t({tournamentRecord:d},e));if(p.error)return p}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return t({},L)}};function _w(e){var t,r,n,i,o,u=e.tournamentRecords,s=e.extensionName;if("object"!=typeof u||!Object.keys(u).length)return{error:q};var l,c=[];try{for(var d=a(Object.values(u)),p=d.next();!p.done;p=d.next()){var v=p.value,f=Vn({element:v,name:s}).extension;f&&!l&&(c.push({params:{extension:f,discover:!0},method:"addExtension"}),l=!0);var m=null!==(o=v.events)&&void 0!==o?o:[];try{for(var h=(n=void 0,a(m)),g=h.next();!g.done;g=h.next()){var I=g.value,y=I.eventId,U=Vn({name:s,element:I}).extension;U&&c.push({params:{eventId:y,extension:U},method:"addEventExtension"})}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}return{methods:c}}var Lw="ADULT",jw="JUNIOR",Bw="WHEELCHAIR",Vw=((Ew={})[_a]={allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:(Cw={},Cw[xs]=30,Cw.default=60,Cw)}]},defaultDailyLimits:(xw={},xw[Es]=2,xw[xs]=2,xw.total=3,xw),matchUpAverageTimes:[{matchUpFormatCodes:[Fh],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[Bw],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[Lw,Bw],minutes:(Ow={default:60},Ow[xs]=30,Ow)},{categoryTypes:[jw],minutes:(Fw={default:60},Fw[xs]=60,Fw)}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[Lw,Bw],minutes:{default:30}},{categoryTypes:[jw],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[Lw,jw],minutes:{default:30}},{categoryTypes:[Bw],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]},Ew);function Gw(e){var r,n,i=da(e,[(r={},r[Fi]=!0,r),(n={},n[aa]=function(e){return Fm({matchUpFormat:e})},n[oa]=Ge,n[_i]=!0,n)]);if(i.error)return i;var a=e.tournamentRecord,o=e.matchUpFormat,u=e.event,s=Vn({name:ho,element:u}).extension,l=null==s?void 0:s.value,c=Vn({element:a,name:ho}).extension,d=null==c?void 0:c.value,p=[(null==l?void 0:l.matchUpAverageTimes)&&Nc(t(t({},l),{matchUpFormat:o})),(null==d?void 0:d.matchUpAverageTimes)&&Nc(t(t({},d),{matchUpFormat:o}))].find((function(e){return e}));return{matchUpFormat:o,recoveryTimes:[(null==l?void 0:l.matchUpRecoveryTimes)&&Mc(t(t({},l),{matchUpFormat:o})),(null==d?void 0:d.matchUpRecoveryTimes)&&Mc(t(t({},d),{matchUpFormat:o}))].find((function(e){return e})),averageTimes:p}}function qw(e){var r,n=e.tournamentRecord;if(!n)return{error:W};var i=(null!==(r=null==n?void 0:n.participants)&&void 0!==r?r:[]).reduce((function(e,r){var n,i=r.participantId;return(null!==(n=r.penalties)&&void 0!==n?n:[]).forEach((function(r){var n=(r||{}).penaltyId;e[n]?e[n].participants.push(i):e[n]=t(t({},r),{participantIds:[i]})})),e}),{});return{penalties:Object.values(i)}}function Ww(e){var t,r,n,i,s,l,c,d,p=e.schedulingProfile,v=e.matchUps,f=void 0===v?[]:v,m={},h=function(e){var t=e.eventId,r=e.drawId,n=e.structureId,i=e.roundNumber;return"".concat(t,"|").concat(r,"|").concat(n).concat(i)};if(null==p?void 0:p.length){var g=p.map((function(e){return e.venues.map((function(e){return e.rounds}))})).flat();g.forEach((function(e){e.sort((function(e,t){return(e.sortOrder||0)-(t.sortOrder||0)})).forEach((function(e,t){var r=e.eventId,n=e.drawId,i=e.structureId,a=e.roundNumber,o=h({eventId:r,drawId:n,structureId:i,roundNumber:a});m[o]=t}))}))}var I=[],y={noScheduledDate:[]};try{for(var U=a(f),S=U.next();!S.done;S=U.next()){y[D=(E=(A=S.value).schedule||{}).scheduledDate&&ui(E.scheduledDate)||E.scheduledTime&&ui(E.scheduledTime)||"noScheduledDate"]||(y[D]=[]),y[D].push(A)}}catch(e){t={error:e}}finally{try{S&&!S.done&&(r=U.return)&&r.call(U)}finally{if(t)throw t.error}}var w=Object.keys(y).sort();try{for(var T=a(w),P=T.next();!P.done;P=T.next()){var D,b=y[D=P.value],N={noScheduledTime:[]};try{for(var M=(s=void 0,a(b)),R=M.next();!R.done;R=M.next()){var A,E;N[F=(E=(A=R.value).schedule||{}).scheduledTime&&oi(E.scheduledTime)||"noScheduledTime"]||(N[F]=[]),N[F].push(A)}}catch(e){s={error:e}}finally{try{R&&!R.done&&(l=M.return)&&l.call(M)}finally{if(s)throw s.error}}var C=Object.keys(N).sort();try{for(var x=(c=void 0,a(C)),O=x.next();!O.done;O=x.next()){var F,k=N[F=O.value];k.sort((function(e,t){return(m[h(e)]||0)-(m[h(t)]||0)})),I.push.apply(I,u([],o(k),!1))}}catch(e){c={error:e}}finally{try{O&&!O.done&&(d=x.return)&&d.call(x)}finally{if(c)throw c.error}}}}catch(e){n={error:e}}finally{try{P&&!P.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}return I}function Hw(e){var t=e.courtPrefix,r=void 0===t?"C|":t,n=e.minRowsCount,i=e.courtsData;if(!Array.isArray(i))return{error:xr};var s=null==i?void 0:i.reduce((function(e,t){var r=t.matchUps||[],n=Math.max.apply(Math,u([0],o(r.map((function(e){return e.schedule.courtOrder||0}))),!1));return n>e?n:e}),1),l=R(0,n?Math.max(n,s):s).map((function(e){return{matchUps:R(0,i.length).map((function(t){var r=i[t],n=r.courtId,a=r.venueId;return{schedule:{courtOrder:e+1,venueId:a,courtId:n}}}))}}));return i.forEach((function(e,t){var r,n,i;try{for(var o=a(e.matchUps),u=o.next();!u.done;u=o.next()){var s=u.value,c=null===(i=s.schedule)||void 0===i?void 0:i.courtOrder;c&&(l[c-1].matchUps[t]=s)}}catch(e){r={error:e}}finally{try{u&&!u.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}})),{courtPrefix:r,rows:l.map((function(e,t){return Object.assign.apply(Object,u([{rowId:"rowId-".concat(t+1)}],o(e.matchUps.map((function(e,t){var n;return(n={})["".concat(r).concat(t)]=e,n}))),!1))}))}}function zw(e){var r,n,i,a,o=e.participants,u=e.contextContent,s=e.participantMap,l=e.tournamentAppliedPolicies,c=e.scheduleVisibilityFilters,d=e.participantsProfile,p=e.afterRecoveryTimes,v=e.policyDefinitions,f=e.useParticipantMap,m=e.tournamentRecord,h=e.usePublishState,g=e.contextFilters,I=e.matchUpFilters,y=e.contextProfile,U=e.nextMatchUps,S=e.tournamentId,w=e.inContext,T=e.context,P=e.event;if(!P)return{error:Ae};var D,b=P.eventId,N=P.eventName,M=P.endDate,R=t(t({},T),xn({eventId:b,eventName:N,endDate:null!=M?M:null==m?void 0:m.endDate,tournamentId:null!=S?S:null==m?void 0:m.tournamentId,indoorOutDoor:null!==(n=P.indoorOutdoor)&&void 0!==n?n:null==m?void 0:m.indoorOutdoor,surfaceCategory:null!==(i=P.surfaceCategory)&&void 0!==i?i:null==m?void 0:m.surfaceCategory}));!o&&m&&(r=qs({participantsProfile:d,policyDefinitions:v,useParticipantMap:f,tournamentRecord:m,contextProfile:y,inContext:w}),o=r.participants,s=r.participantMap,D=r.groupInfo),y&&!u&&(u=pl({policyDefinitions:v,tournamentRecord:m,contextProfile:y,event:P}));var A=Uv({event:P}),E=(null!==(a=P.drawDefinitions)&&void 0!==a?a:[]).reduce((function(e,t){var r=yp({context:R,tournamentAppliedPolicies:l,scheduleVisibilityFilters:c,tournamentParticipants:o,participantsProfile:d,afterRecoveryTimes:p,policyDefinitions:v,tournamentRecord:m,usePublishState:h,contextContent:u,contextFilters:g,matchUpFilters:I,participantMap:s,publishStatus:A,contextProfile:y,drawDefinition:t,nextMatchUps:U,inContext:w,event:P}),n=Object.keys(r);return null==n||n.forEach((function(t){Array.isArray(r[t])&&(e[t]||(e[t]=[]),e[t]=e[t].concat(r[t]))})),e}),{});return t(t(t({},E),L),{groupInfo:D})}function Yw(e){var r,n,i;if(!(null==e?void 0:e.tournamentRecord))return{error:W};var a=e.contextContent,o=e.scheduleVisibilityFilters,u=e.participantsProfile,s=e.afterRecoveryTimes,l=e.policyDefinitions,c=e.useParticipantMap,d=e.tournamentRecord,p=e.inContext,v=void 0===p||p,f=e.usePublishState,m=e.contextFilters,h=e.matchUpFilters,g=e.contextProfile,I=e.nextMatchUps,y=e.context,U=null!==(r=e.tournamentId)&&void 0!==r?r:d.tournamentId,S=null!==(n=null==d?void 0:d.events)&&void 0!==n?n:[],w=qs({participantsProfile:u,policyDefinitions:l,useParticipantMap:c,tournamentRecord:d,contextProfile:g,inContext:v}),T=w.participants,P=w.participantMap,D=w.groupInfo;g&&!a&&(a=pl({policyDefinitions:l,tournamentRecord:d,contextProfile:g}));var b=tl({tournamentRecord:d}).appliedPolicies,N=null!==(i=null==m?void 0:m.eventIds)&&void 0!==i?i:[],M=S.filter((function(e){return!N.includes(e.eventId)})).map((function(e){var r,n,i=_d({event:e}).flightProfile;return zw({context:t({eventDrawsCount:(null===(r=null==i?void 0:i.flights)||void 0===r?void 0:r.length)||(null===(n=e.drawDefinitions)||void 0===n?void 0:n.length)||0},y),tournamentAppliedPolicies:b,scheduleVisibilityFilters:o,participantsProfile:u,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:d,usePublishState:f,contextFilters:m,contextProfile:g,contextContent:a,matchUpFilters:h,participantMap:P,participants:T,tournamentId:U,nextMatchUps:I,inContext:v,event:e})})),R=M.reduce((function(e,t){var r=t&&Object.keys(t).filter((function(e){return!["success","matchUpsMap"].includes(e)}));return null==r||r.forEach((function(r){Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r]),e.matchUpsCount+=t[r].length)})),e}),{matchUpsCount:0});return t(t({},R),{groupInfo:D})}function Kw(e){var r=e.scheduleVisibilityFilters,n=e.participantsProfile,i=e.tournamentRecords,a=e.policyDefinitions,o=e.usePublishState,u=e.matchUpFilters,s=e.contextFilters,l=e.nextMatchUps,c=e.inContext;if("object"!=typeof i||!Object.keys(i).length)return{error:q};var d=Object.keys(i).map((function(e){var t=i[e];return Yw({scheduleVisibilityFilters:r,participantsProfile:n,policyDefinitions:a,tournamentRecord:t,usePublishState:o,matchUpFilters:u,contextFilters:s,nextMatchUps:l,inContext:c})})),p={},v=d.reduce((function(e,t){return Object.keys(t).forEach((function(r){Array.isArray(t[r])&&(e[r]||(e[r]=[]),e[r]=e[r].concat(t[r])),"groupInfo"===r&&Object.assign(p,t[r])})),e}),{});return t(t({},v),{groupInfo:p})}function Jw(e){var r,n,i,s,l,c,d,p,v;if("object"!=typeof(null==e?void 0:e.tournamentRecords)||!Object.keys(null==e?void 0:e.tournamentRecords).length)return{error:q};var f,m,h=lf(e),g=h.courts,I=h.venues,y=pf(e).schedulingProfile,U=e.sortDateMatchUps,S=void 0===U||U,w=e.courtCompletedMatchUps,T=e.alwaysReturnCompleted,P=e.activeTournamentId,D=e.tournamentRecords,b=e.withCourtGridRows,N=e.minCourtGridRows,M=e.usePublishState,R=e.status,A=void 0===R?Tc:R,E=e.sortCourtsData,C=M?null===(i=null===(n=Ns({tournamentRecord:D[null!=P?P:wn()],itemType:"".concat(wc,".").concat(Pc)}).timeItem)||void 0===n?void 0:n.itemValue)||void 0===i?void 0:i[A]:void 0,x=T?Kw(t(t({},e),{matchUpFilters:t(t({},e.matchUpFilters),{matchUpStatuses:[_o]}),contextFilters:e.contextFilters})).completedMatchUps:[];if(M&&(!C||!Object.keys(C).length))return{completedMatchUps:x,dateMatchUps:[],courtsData:[],venues:I};M&&(r=function(e){var t,r,n,i,s,l,c=e.tournamentRecords,d=[],p={};try{for(var v=a(Object.values(c)),f=v.next();!f.done;f=v.next()){var m=f.value,h=function(e){var t=Uv({event:e}),r=null==t?void 0:t.drawDetails;Di(r)?(Object.assign(p,r),d.push.apply(d,u([],o(Object.keys(r).filter((function(e){return Sv({drawId:e,drawDetails:r})}))),!1))):(null===(l=null==t?void 0:t.drawIds)||void 0===l?void 0:l.length)&&d.push.apply(d,u([],o(t.drawIds),!1))};try{for(var g=(n=void 0,a(null!==(s=m.events)&&void 0!==s?s:[])),I=g.next();!I.done;I=g.next())h(I.value)}catch(e){n={error:e}}finally{try{I&&!I.done&&(i=g.return)&&i.call(g)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}return{drawIds:d,detailsMap:p}}({tournamentRecords:D}),f=r.drawIds,m=r.detailsMap),(null==f?void 0:f.length)&&(e.contextFilters||(e.contextFilters={}),(null===(s=e.contextFilters)||void 0===s?void 0:s.drawIds)?e.contextFilters.drawIds=e.contextFilters.drawIds.filter((function(e){return f.includes(e)})):e.contextFilters.drawIds=f),(null===(l=null==C?void 0:C.eventIds)||void 0===l?void 0:l.length)&&(e.matchUpFilters||(e.matchUpFilters={}),(null===(c=e.matchUpFilters)||void 0===c?void 0:c.eventIds)&&e.matchUpFilters.eventIds.length?e.matchUpFilters.eventIds=e.matchUpFilters.eventIds.filter((function(e){return C.eventIds.includes(e)})):e.matchUpFilters.eventIds=C.eventIds),(null===(d=null==C?void 0:C.scheduledDates)||void 0===d?void 0:d.length)&&(e.matchUpFilters||(e.matchUpFilters={}),e.matchUpFilters.scheduledDates&&e.matchUpFilters.scheduledDates.length?e.matchUpFilters.scheduledDates=e.matchUpFilters.scheduledDates.filter((function(e){return C.scheduledDates.includes(e)})):e.matchUpFilters.scheduledDates=C.scheduledDates),T&&(e.matchUpFilters||(e.matchUpFilters={}),(null===(v=null===(p=e.matchUpFilters)||void 0===p?void 0:p.excludeMatchUpStatuses)||void 0===v?void 0:v.length)?e.matchUpFilters.excludeMatchUpStatuses.includes(_o)||e.matchUpFilters.excludeMatchUpStatuses.push(_o):e.matchUpFilters.excludeMatchUpStatuses=[_o]);var O=Kw(t(t({},e),{matchUpFilters:e.matchUpFilters,contextFilters:e.contextFilters})),F=O.completedMatchUps,k=O.upcomingMatchUps,_=O.pendingMatchUps,j=O.groupInfo,B=u(u([],o(null!=k?k:[]),!1),o(null!=_?_:[]),!1);m&&Object.keys(m).length&&(B=B.filter((function(e){var t=e.drawId,r=e.structureId,n=e.stage;if(!m[t])return!1;if(m[t].stageDetails){var i=Object.keys(m[t].stageDetails),a=i.filter((function(e){return!m[t].stageDetails[e].published})),o=i.filter((function(e){return m[t].stageDetails[e].published}));return(!a.length||!a.includes(n))&&(!(!o.length||!o.includes(n))||a.length&&!a.includes(n)&&!o.length)}if(m[t].structureDetails){var u=Object.keys(m[t].structureDetails),s=u.filter((function(e){return!m[t].structureDetails[e].published})),l=u.filter((function(e){return m[t].structureDetails[e].published}));return(!s.length||!s.includes(r))&&(!(!l.length||!l.includes(r))||s.length&&!s.includes(r)&&!l.length)}return!0})));var V=S?Ww({matchUps:B,schedulingProfile:y}):B,G=null==g?void 0:g.map((function(e){var r,n=function(e){var t=e.courtId,r=(w?V.concat(null!=F?F:[]):V).filter((function(e){var r,n,i;return(null===(r=e.schedule)||void 0===r?void 0:r.courtId)===t||(null===(i=null===(n=e.schedule)||void 0===n?void 0:n.allocatedCourts)||void 0===i?void 0:i.map((function(e){return e.courtId})).includes(t))}));return E?Ww({matchUps:r,schedulingProfile:y}):r}(e);return t({surfaceCategory:null!==(r=null==e?void 0:e.surfaceCategory)&&void 0!==r?r:"",matchUps:n},e)})),W={completedMatchUps:T?x:F,dateMatchUps:V,courtsData:G,groupInfo:j,venues:I};if(b){var H=Hw({minRowsCount:N,courtsData:G}),z=H.rows,Y=H.courtPrefix;W.courtPrefix=Y,W.rows=z}return t(t({},W),L)}function Zw(e){var t=e.targetRoundNumber,r=e.finishingPosition,n=e.drawDefinition,i=e.structureId,a=e.linkType,o=(Ys({drawDefinition:n,structureId:i})||{}).links,u=((null==o?void 0:o.target)||[]).filter((function(e){return e.linkType===a})).filter((function(e){var r=e.target;return!t||t===r.roundNumber})),s=u.map((function(e){var t=as({structureId:e.source.structureId,drawDefinition:n}).structure;if(!r||(null==t?void 0:t.finishingPosition)===r)return e})).filter(Boolean),l=s.map((function(e){return e.source.structureId}));return{sourceStructureIds:l,relevantLinks:s}}var Xw,Qw="qualifierDrawPositionAssignment",$w="alternateDrawPositionAssignment",eT="luckyLoserDrawPositionAssignment",tT="removeDrawPositionAssignment",rT="swapDrawPositionAssignments",nT="modifyPairAssignment",iT="assignDrawPosition",aT="assignDrawPositionBye",oT="addPenalty",uT="MODIFY_PAIR",sT="QUALIFIER",lT="ALTERNATE",cT="WITHDRAW",dT="ASSIGN",pT="REMOVE",vT="LUCKY",fT="REMOVE_SEED",mT="SWAP",hT="NICKNAME",gT="SEED_VALUE",IT="PENALTY",yT="BYE",UT={MODIFY_PAIR_ASSIGNMENT:uT,QUALIFYING_PARTICIPANT:sT,ALTERNATE_PARTICIPANT:lT,WITHDRAW_PARTICIPANT:cT,ASSIGN_PARTICIPANT:dT,LUCKY_PARTICIPANT:vT,REMOVE_ASSIGNMENT:pT,SWAP_PARTICIPANTS:mT,ADD_NICKNAME:hT,REMOVE_SEED:fT,ADD_PENALTY:IT,ASSIGN_BYE:yT,SEED_VALUE:gT};function ST(e){var t=e.restrictQualifyingAlternates,r=e.structure,n=e.entry,i=r.stage;if(!n.entryStage||n.entryStage===i||i===au&&!t||n.entryStage===iu&&i===ou)return!0}function wT(e,t){return e.bye||zf(e.seedValue)<zf(t.seedValue)||e.seedValue&&!t.seedValue?-1:(e.seedNumber||0)-(t.seedNumber||0)}function TT(e){var r,n=e.onlyAssignedPositions,i=void 0===n||n,a=e.possiblyDisablingAction,s=e.tournamentParticipants,l=e.inactiveDrawPositions,c=e.activeDrawPositions,d=e.positionAssignments,p=e.returnParticipants,v=e.byeDrawPositions,f=e.drawDefinition,m=e.isByePosition,h=e.drawPosition,g=e.structureId,I=e.structure,y=e.drawId,U=e.event;if(c.includes(h))return{};var S=null==l?void 0:l.filter((function(e){return e!==h&&!(m&&v.includes(e))})),w=null!==(r=null==d?void 0:d.filter((function(e){return function(e){return!i||e.participantId||e.qualifier||e.bye}(e)&&(null==S?void 0:S.includes(e.drawPosition))})))&&void 0!==r?r:[],T=w.map((function(e){return e.drawPosition})),P=mp({afterRecoveryTimes:!1,inContext:!0,drawDefinition:f,structure:I,event:U}).matchUps.filter((function(e){return x(e.drawPositions,T)})),D=Object.assign.apply(Object,u([{}],o(P.map((function(e){var t;return null===(t=e.sides)||void 0===t?void 0:t.filter((function(e){return e.sourceDrawPositionRange})).map((function(e){var t,r=e.drawPosition,n=e.sourceDrawPositionRange;return(t={})[r]=n,t}))})).flat()),!1)),b=w.map((function(e){return e.participantId})).filter(Boolean),N=(null!=s?s:[]).filter((function(e){return b.includes(e.participantId)})),M=Object.assign.apply(Object,u([{}],o(N.map((function(e){var t;return(t={})[e.participantId]=e,t}))),!1)),R=w.map((function(e){var r=null==M?void 0:M[e.participantId],n=D[e.drawPosition];return xn(t(t({},e),{participant:p?Ui(r,!1,!0):void 0,sourceDrawPositionRange:n}))}));return R.length?{validSwapAction:{payload:{drawId:y,structureId:g,drawPositions:[h]},willDisableLinks:a,method:rT,type:mT,availableAssignments:R}}:{}}var PT=((Xw={})[Ea]={policyName:"positionActionsDefault",enabledStructures:[{stages:[au,iu],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[hT,IT,sT,gT],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]},Xw),DT="positionAction",bT="matchUpAction";function NT(e){var t,r,n=e.actionType,i=void 0===n?DT:n,a=e.appliedPolicies,o=e.drawDefinition,u=e.structure,s=i===DT&&Ea||i===bT&&Ca,l=i===DT&&PT||i===bT&&jv,c=s&&((null==a?void 0:a[s])||(null==l?void 0:l[s])),d=null===(t=o.links)||void 0===t?void 0:t.filter((function(e){var t;return(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.structureId)===(null==u?void 0:u.structureId)})),p=null!==(r=null==d?void 0:d.map((function(e){return e.target.feedProfile})))&&void 0!==r?r:[],v=c||{},f=v.enabledStructures,m=v.disabledStructures;return{enabledStructures:f,actionsDisabled:null==m?void 0:m.find((function(e){var t=e.stages,r=e.stageSequences,n=e.structureTypes,i=e.feedProfiles;return(!(null==i?void 0:i.length)||Array.isArray(i)&&i.some((function(e){return p.includes(e)})))&&(!(null==t?void 0:t.length)||Array.isArray(t)&&(null==t?void 0:t.includes(null==u?void 0:u.stage)))&&(!(null==n?void 0:n.length)||Array.isArray(n)&&(null==n?void 0:n.includes(null==u?void 0:u.structureType)))&&(!(null==r?void 0:r.length)||Array.isArray(r)&&r.includes(null==u?void 0:u.stageSequence))})),actionsPolicy:c}}function MT(e){var t=e.activePositionOverrides,r=e.activeDrawPositions,n=e.action;return!(!n||!t.includes(n))||!r.length}function RT(e){var t,r=e.enabledStructures,n=e.drawDefinition,i=e.structure;if(!1===r)return{};if(!(null==r?void 0:r.length))return{policyActions:{enabledActions:[],disabledActions:[]}};var a=i||{},o=a.stage,u=a.stageSequence,s=a.structureType,l=null===(t=n.links)||void 0===t?void 0:t.filter((function(e){var t;return(null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.structureId)===(null==i?void 0:i.structureId)})),c=(null==l?void 0:l.map((function(e){return e.target.feedProfile})))||[],d=r.find((function(e){var t=e||{},r=t.stages,n=t.stageSequences,i=t.structureTypes,a=t.feedProfiles,l=!(null==r?void 0:r.length)||Array.isArray(r)&&r.includes(o),d=!(null==n?void 0:n.length)||Array.isArray(n)&&n.includes(u),p=!(null==i?void 0:i.length)||Array.isArray(i)&&i.includes(s),v=!(null==a?void 0:a.length)||Array.isArray(a)&&a.some((function(e){return c.includes(e)}));return d&&p&&v&&e&&l}));return{policyActions:d}}function AT(e){var t,r=e.action,n=e.policyActions,i=!(null==n?void 0:n.enabledActions)||(null===(t=null==n?void 0:n.disabledActions)||void 0===t?void 0:t.length)&&n.disabledActions.includes(r);return!i&&((0===(null==n?void 0:n.enabledActions.length)||(null==n?void 0:n.enabledActions.includes(r)))&&!i)}var ET="replaceTieMatchUpParticipantId",CT="assignTieMatchUpParticipantId",xT="removeTieMatchUpParticipantId",OT="assignMatchUpSideParticipant",FT="removeMatchUpSideParticipant",kT="substituteParticipant",_T="REMOVE_SUBSTITUTION",LT="REPLACE_PARTICIPANT",jT="REMOVE_PARTICIPANT",BT="setMatchUpStatus",VT="SUBSTITUTION",GT="SCHEDULE",qT="REFEREE",WT="STATUS",HT="START",zT="SCORE",YT="END",KT={REPLACE_TEAM_POSITION_METHOD:ET,ASSIGN_TEAM_POSITION_METHOD:CT,REMOVE_TEAM_POSITION_METHOD:xT,REPLACE_PARTICIPANT:LT,SUBSTITUTION_METHOD:kT,REMOVE_SUBSTITUTION:_T,REMOVE_PARTICIPANT:jT,SCHEDULE_METHOD:BT,SUBSTITUTION:VT,SCHEDULE:GT,PENALTY:"PENALTY",REFEREE:qT,STATUS:WT,SCORE:zT,START:HT,END:YT};function JT(e){var t,r,n,i,a,s,l=e.restrictAdHocRoundParticipants,c=e.tournamentParticipants,d=e.matchUpParticipantIds,p=e.otherFlightEntries,v=e.drawDefinition,f=e.structureId,m=e.sideNumber,h=e.matchUpId,g=e.structure,I=e.matchUp,y=e.drawId,S=e.event,w=[],T=(null!==(t=null==g?void 0:g.matchUps)&&void 0!==t?t:[]).filter((function(e){return e.roundNumber===I.roundNumber})),P=null!==(n=null===(r=null==v?void 0:v.entries)||void 0===r?void 0:r.filter((function(e){var t=e.entryStatus;return t&&kl.includes(t)})).map(Ri("participantId")))&&void 0!==n?n:[],D=T.map((function(e){var t;return(null!==(t=e.sides)&&void 0!==t?t:[]).flatMap(Ri("participantId"))})).flat().filter(Boolean),b=P.filter((function(e){return!(d.includes(e)||l&&D.includes(e))})),N=null==c?void 0:c.filter((function(e){return null==b?void 0:b.includes(e.participantId)})).map((function(e){return Ui(e,void 0,!0)}));null==N||N.forEach((function(e){var t,r=(null!==(t=v.entries)&&void 0!==t?t:[]).find((function(t){return t.participantId===e.participantId}));e.entryPosition=null==r?void 0:r.entryPosition})),b.length&&w.push({payload:{drawId:y,matchUpId:h,structureId:f,sideNumber:m},method:OT,type:dT,availableParticipantIds:b,participantsAvailable:N});var M=function(e){var t=e.eventEntries,r=e.structure;return t.filter((function(e){return e.entryStatus===Sl&&ST({structure:r,entry:e})})).sort((function(e,t){return(e.entryPosition||1/0)-(t.entryPosition||1/0)})).map(Ri("participantId"))}({eventEntries:null!==(i=null==S?void 0:S.entries)&&void 0!==i?i:[],structure:g}),R=U(P.concat(M));if(p){var A=S?_d({event:S}):void 0,E=null===(a=null==A?void 0:A.flights)||void 0===a?void 0:a.filter((function(e){return e.drawId!==y})).flatMap((function(e){return e.drawEntries.filter((function(e){return e.participantId&&![xl,Al,El].includes(e.entryStatus)})).map((function(e){return e.participantId}))})).filter(Boolean);(null==E?void 0:E.length)&&R.push.apply(R,u([],o(E),!1))}R=R.filter((function(e){return!(d.includes(e)||b.includes(e)||l&&D.includes(e))}));var C=null==c?void 0:c.filter((function(e){return R.includes(e.participantId)})).map((function(e){return Ui(e,void 0,!0)}));if(null==C||C.forEach((function(e){var t,r=(null!==(t=v.entries)&&void 0!==t?t:[]).find((function(t){return t.participantId===e.participantId}));e.entryPosition=null==r?void 0:r.entryPosition})),null==C||C.sort((function(e,t){return(e.entryPosition||1/0)-(t.entryPosition||1/0)})),R.length&&w.push({payload:{drawId:y,matchUpId:h,structureId:f,sideNumber:m},availableParticipantIds:R,participantsAvailable:C,method:OT,type:Sl}),!Bp(I)&&m){var x=null===(s=I.sides)||void 0===s?void 0:s.find((function(e){return e.sideNumber===m}));(null==x?void 0:x.participantId)&&w.push({payload:{drawId:y,matchUpId:h,structureId:f,sideNumber:m},method:FT,type:jT})}return w}function ZT(e){var t,r,n,i,a,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w;if(!e)return{error:xr};var T=e.restrictAdHocRoundParticipants,P=void 0===T||T,D=e.policyDefinitions,b=e.enforceGender,N=e.participantId,M=e.sideNumber,R=e.matchUpId,A=null!==(t=e.tournamentRecord)&&void 0!==t?t:e.tournamentId&&Pi(e.tournamentId)&&(null===(r=e.tournamentRecords)||void 0===r?void 0:r[e.tournamentId]);if(!A)return{error:W};if(!R||!Pi(R))return{error:Ze};if(M&&![1,2].includes(M))return On({result:{error:xr},context:{sideNumber:M}});if(!S){var E=(null!==(n=Kp({tournamentRecord:A}).matchUps)&&void 0!==n?n:[]).find((function(e){return e.matchUpId===R}));S=(null!==(a=null==(w=(null!==(i=null==A?void 0:A.events)&&void 0!==i?i:[]).find((function(e){return e.eventId===(null==E?void 0:E.eventId)})))?void 0:w.drawDefinitions)&&void 0!==a?a:[]).find((function(e){return e.drawId===(null==E?void 0:E.drawId)}))}if(!S)return{error:K};var C=Rv({tournamentRecord:A,withIndividualParticipants:!0}).participants,x=S.drawId,O=Ef({drawDefinition:S,matchUpId:R,event:w}),F=O.matchUp,k=O.structure;if(!F)return{error:Qe};var _=null!==(s=tl({tournamentRecord:A,drawDefinition:S,structure:k,event:w}).appliedPolicies)&&void 0!==s?s:{};Object.assign(_,null!=D?D:{});var L=null===(l=null==_?void 0:_[Ea])||void 0===l?void 0:l.otherFlightEntries,j=null!==(c=null==_?void 0:_[Ca])&&void 0!==c?c:jv[Ca],B=RT({enabledStructures:NT({actionType:bT,appliedPolicies:_,drawDefinition:S,structure:k}).enabledStructures,drawDefinition:S,structure:k}).policyActions,V=null!==(d=e.matchUpsMap)&&void 0!==d?d:fl({drawDefinition:S}),G=null!==(p=e.inContextDrawMatchUps)&&void 0!==p?p:Ip({tournamentParticipants:C,inContext:!0,drawDefinition:S,matchUpsMap:V,event:w}).matchUps,q=null==G?void 0:G.find((function(e){return e.matchUpId===R})),H=M&&(null===(v=null==q?void 0:q.sides)||void 0===v?void 0:v.find((function(e){return e.sideNumber===M}))),z=null!==(m=null===(f=null==q?void 0:q.sides)||void 0===f?void 0:f.map((function(e){var t;return e.participantId||(null===(t=e.participant)||void 0===t?void 0:t.participantid)})).filter(Boolean))&&void 0!==m?m:[],Y=ls({structure:k}),J=Y.assignedPositions,Z=Y.allPositionsAssigned,X=(null!=k?k:{}).structureId,Q=[];if(!X)return{validActions:Q};var $=ip({drawDefinition:S,structure:k}),ee=F.collectionId;if($&&!ee){var te=JT({restrictAdHocRoundParticipants:P,tournamentParticipants:C,matchUpParticipantIds:z,otherFlightEntries:L,drawDefinition:S,structureId:X,sideNumber:M,matchUpId:R,structure:k,matchUp:F,drawId:x,event:w});Q.push.apply(Q,u([],o(te),!1))}var re=uh({drawDefinition:S,structure:k}),ne=null==J?void 0:J.filter((function(e){return e.participantId})).map((function(e){return e.drawPosition})),ie=null==J?void 0:J.filter((function(e){return e.bye})).map((function(e){return e.drawPosition})),ae=F.matchUpStatus===Fo||!ee&&(null===(h=F.drawPositions)||void 0===h?void 0:h.reduce((function(e,t){return(null==ie?void 0:ie.includes(t))||e}),!1));if(ae)return{validActions:Q,isByeMatchUp:ae};AT({policyActions:B,action:qT})&&Q.push({type:qT,payload:{matchUpId:R}});var oe=!Vp({matchUpStatus:F.matchUpStatus}),ue=null===(g=null==_?void 0:_.scoring)||void 0===g?void 0:g.structures,se=(null==k?void 0:k.stage)&&(null==ue?void 0:ue.stage)&&(null==ue?void 0:ue.stage[k.stage]),le=(null==k?void 0:k.stageSequence)&&(null==se?void 0:se.stageSequence)&&se.stageSequence[k.stageSequence],ce=!((null===(I=null==_?void 0:_.scoring)||void 0===I?void 0:I.requireAllPositionsAssigned)||(null==se?void 0:se.requireAllPositionsAssigned)||(null==le?void 0:le.requireAllPositionsAssigned))||Z,de=F.sides&&2===F.sides.filter((function(e){return null==e?void 0:e.participantId})).length,pe=F.matchUpStatus&&[Vo,Bo].includes(F.matchUpStatus),ve=bg({inContextDrawMatchUps:G,drawDefinition:S,targetData:Ks({inContextDrawMatchUps:G,drawDefinition:S,matchUpId:R})}),fe=2===(null===(y=null==q?void 0:q.drawPositions)||void 0===y?void 0:y.length)&&q.drawPositions.every((function(e){return null==ne?void 0:ne.includes(e)}))&&2===(null===(U=null==q?void 0:q.sides)||void 0===U?void 0:U.length)&&q.sides.every((function(e){return e.participantId})),me=(fe||de)&&!(pe&&ve),he={method:oT,type:IT,payload:{drawId:x,matchUpId:R,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(oe&&Q.push({payload:{drawId:x,matchUpId:R,schedule:{}},method:BT,type:GT}),AT({policyActions:B,action:IT})&&((null==H?void 0:H.participant)||!M&&(null==z?void 0:z.length))&&Q.push(he),oe&&me&&Q.push({type:WT}),ce&&me){var ge={drawId:x,matchUpId:F.matchUpId,matchUpFormat:F.matchUpFormat,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};Q.push({info:"set outcome and winningSide",method:BT,type:zT,payload:ge}),AT({policyActions:B,action:HT})&&Q.push({type:HT}),AT({policyActions:B,action:YT})&&Q.push({type:YT})}if(ee&&q){var Ie=function(e){var t,r,n,i,a,o,u,s,l,c,d,p,v,f,m,h,g=e.specifiedPolicyDefinitions,I=e.inContextDrawMatchUps,y=e.matchUpParticipantIds,U=e.matchUpActionsPolicy,S=e.inContextMatchUp,w=e.policyActions,T=e.enforceGender,P=e.participantId,D=e.sideNumber,b=e.matchUpId,N=e.matchUp,M=e.drawId,R=e.side,A=[],E=null===(t=S.sides)||void 0===t?void 0:t.find((function(e){return e.participant})),C=S.gender===dp&&S.sideNumber&&1===(null===(r=S.sides)||void 0===r?void 0:r.filter((function(e){return e.particiapntId})).length)&&(null===(i=null===(n=null==E?void 0:E.participant)||void 0===n?void 0:n.person)||void 0===i?void 0:i.sex),x=S.matchUpType,O=!1!==(null!=T?T:null===(a=null==U?void 0:U.participants)||void 0===a?void 0:a.enforceGender)?S.gender:void 0,F=null===(o=S.sides)||void 0===o?void 0:o.flatMap((function(e){var t;return(null===(t=e.participant)||void 0===t?void 0:t.individualParticipants)||e.participant})).filter(Boolean),k=null==F?void 0:F.map(Ri("participantId")),_=null===(u=S.sides)||void 0===u?void 0:u.filter((function(e){return!D||e.sideNumber===D})).flatMap((function(e){var t;return(null===(t=e.participant)||void 0===t?void 0:t.individualParticipants)||e.participant})).filter(Boolean),L=null==_?void 0:_.map(Ri("participantId")),j=null==I?void 0:I.find((function(e){return e.matchUpId===S.matchUpTieId})),B=null===(s=null==j?void 0:j.sides)||void 0===s?void 0:s.map((function(e){var t;return null===(t=e.participant)||void 0===t?void 0:t.individualParticipants.filter((function(e){var t=e.participantId,r=e.person;return!(null==L?void 0:L.includes(t))&&(!O||O===lp||r.sex===O||O===dp&&!C||C&&r.sex!==C)}))})),V=D?null==B?void 0:B[D-1]:null==B?void 0:B.map((function(e,t){return{participants:e,sideNumber:t+1}})),G=D?null===(l=null==B?void 0:B[D-1])||void 0===l?void 0:l.map(Mo):null==B?void 0:B.map((function(e,t){return{participants:null==e?void 0:e.map(Mo),sideNumber:t+1}})),q=D&&(x===As&&!(null==L?void 0:L.length)||x===Cs&&(null!==(c=null==L?void 0:L.length)&&void 0!==c?c:0)<2)||!D&&(x===As&&(null!==(d=null==L?void 0:L.length)&&void 0!==d?d:0)<2||x===Cs&&(null!==(p=null==L?void 0:L.length)&&void 0!==p?p:0)<4),W=null==G?void 0:G.filter((function(e){return!(null==k?void 0:k.includes(e))})),H=null==V?void 0:V.filter((function(e){var t=e.participantId;return W.includes(t)}));if(q&&(null==W?void 0:W.length)&&A.push({availableParticipantIds:W,method:CT,availableParticipants:H,type:dT,payload:{participantId:void 0,tieMatchUpId:b,sideNumber:D,drawId:M}}),!(null==L?void 0:L.length)||Bp(N)&&!(null===(v=null==R?void 0:R.substitutions)||void 0===v?void 0:v.length)||A.push({method:xT,type:jT,existingParticipantIds:L,payload:{participantId:void 0,tieMatchUpId:b,drawId:M}}),(null==H?void 0:H.length)&&(!D&&(null==L?void 0:L.length)||D&&(null==R?void 0:R.participant))&&A.push({availableParticipantIds:W,method:ET,availableParticipants:H,type:LT,existingParticipantIds:L,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:b,drawId:M}}),AT({policyActions:w,action:_T})&&(null===(f=null==R?void 0:R.substitutions)||void 0===f?void 0:f.length)){var z=(null===(m=R.participant)||void 0===m?void 0:m.participantType)===fs&&[R.participantId]||(null===(h=R.participant)||void 0===h?void 0:h.participantType)===hs&&R.participant.individualParticipantIds||[],Y=R.substitutions.map((function(e){return e.participantId})).filter((function(e){return z.includes(e)}));P&&!Y.includes(P)||A.push({method:xT,type:_T,substitutedParticipantIds:Y,payload:{participantId:void 0,tieMatchUpId:b,drawId:M}})}var K=null==g?void 0:g[Ca],J=null==K?void 0:K.substituteWithoutScore,Z=null==K?void 0:K.substituteAfterCompleted;if(AT({policyActions:w,action:VT})&&2===y.length&&(!D&&(null==L?void 0:L.length)||D&&(null==R?void 0:R.participant))&&(J||Bp(N))&&(Z||N.matchUpStatus&&!eu.includes(N.matchUpStatus))&&(null==_?void 0:_.length)&&V.length){var X=_.map(Mo);A.push({info:"list of team players available for substitution",method:kT,availableParticipantIds:G,existingParticipantIds:X,availableParticipants:V,existingParticipants:_,type:VT,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:D,matchUpId:b,drawId:M}})}return A}({specifiedPolicyDefinitions:D,inContextDrawMatchUps:G,matchUpParticipantIds:z,matchUpActionsPolicy:j,inContextMatchUp:q,policyActions:B,enforceGender:b,participantId:N,sideNumber:M,matchUpId:R,matchUp:F,drawId:x,side:H});Q.push.apply(Q,u([],o(Ie),!1))}return{structureIsComplete:re,validActions:Q,isDoubleExit:pe}}function XT(e){var t=e.singlesForDoubles,r=e.exclusionRule,n=e.valueAccessor,i=e.matchUpType,o=e.scaleName,u=e.sides,s=null==r?void 0:r.range.sort(),l=function(e){var t=null==e?void 0:e[null==r?void 0:r.valueAccessor];return{exclude:r&&t>=s[0]&&t<=s[1],exclusionValue:t}};return u.sort((function(e,t){return e.sideNumber-t.sideNumber})).map((function(e){var r,u,s=e.participant,c=[],d=null==s?void 0:s.individualParticipants;if(null==d?void 0:d.length){var p=[],v=0;try{for(var f=a(d),m=f.next();!m.done;m=f.next()){var h=m.value,g=QT({singlesForDoubles:t,valueAccessor:n,participant:h,matchUpType:i,scaleName:o}),I=g.scaleValue,y=g.value,U=l(I),S=U.exclude,w=U.exclusionValue;S&&c.push(w),p.push(I),y&&!isNaN(v)?v+=y:v=void 0}}catch(e){r={error:e}}finally{try{m&&!m.done&&(u=f.return)&&u.call(f)}finally{if(r)throw r.error}}return{participantName:s.participantName,exclusionValues:c,scaleValues:p,value:v}}if(s){var T=QT({singlesForDoubles:t,valueAccessor:n,matchUpType:i,participant:s,scaleName:o}),P=(I=T.scaleValue,v=T.value,l(I));S=P.exclude,w=P.exclusionValue;return S&&c.push(w),{participantName:s.participantName,exclusionValues:c,scaleValue:I,value:v}}return{}}))}function QT(e){var t,r,n,i,a,o=e.singlesForDoubles,u=e.valueAccessor,s=e.matchUpType,l=e.participant,c=e.scaleName,d=o?Es:s,p=null===(r=null===(t=null==l?void 0:l.rankings)||void 0===t?void 0:t[d])||void 0===r?void 0:r.find((function(e){return e.scaleName===c})),v=null===(a=(null===(i=null===(n=null==l?void 0:l.ratings)||void 0===n?void 0:n[d])||void 0===i?void 0:i.find((function(e){return e.scaleName===c})))||p)||void 0===a?void 0:a.scaleValue;return{scaleValue:v,value:u?null==v?void 0:v[u]:v}}function $T(e){var t,r,n,i,a,o=null===(t=e.participants)||void 0===t?void 0:t.filter((function(e){return e.participantType===gs})),u=2===(null==o?void 0:o.length),s=1===(null===(r=e.events)||void 0===r?void 0:r.length)&&e.events[0],l=1===(null===(n=null==s?void 0:s.drawDefinitions)||void 0===n?void 0:n.length)&&s.drawDefinitions[0],c=1===(null===(i=null==l?void 0:l.structures)||void 0===i?void 0:i.length)&&l.structures[0],d=2===(null===(a=null==c?void 0:c.positionAssignments)||void 0===a?void 0:a.length);return!!(s.tieFormat&&u&&d)}function eP(e){var t=e.containerStructureId,r=e.roundSegment,n=e.isRoundRobin,i=e.tournamentId,a=e.roundNumber,o=e.structureId,u=e.eventId,s=e.drawId,l=n?t:o,c=[i,u,s,l,a].join("|");return xn({structureId:l,roundSegment:r,tournamentId:i,roundNumber:a,eventId:u,drawId:s,id:c})}function tP(e){var t=e.round,r=e.matchUps,n=e.events,i=e.tournamentRecords,a=n.find((function(e){return e.eventId===t.eventId}))||{},o=a.eventType,u=a.category,s=a.categoryType,l=u||{},c=l.categoryName,d=l.ageCategoryCode,p=T(r.map((function(e){return e.matchUpFormat}))),v=0;return Object.keys(p).forEach((function(e){var r=p[e],n=fS({categoryName:c||d,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:i,matchUpFormat:e,categoryType:s,eventType:o});if(n.error)return n;var a=n.averageMinutes*r;isNaN(v)||(v+=a)})),{roundMinutes:v}}function rP(e){var t=e.length,r=e.filter((function(e){var t=e.sides;return null==t?void 0:t.some((function(e){return e.bye}))})).length||0,n=e.filter((function(e){var t=e.winningSide,r=e.matchUpStatus;return t||eu.includes(r)})).length||0,i=e.filter((function(e){var t=e.schedule,r=e.matchUpStatus;return(null==t?void 0:t.scheduledDate)&&(null==t?void 0:t.scheduledTime)&&r!==Fo})).length||0,a=t-r;return{unscheduledCount:a-i,incompleteCount:a-i,scheduledCount:i,completedCount:n,matchUpsCount:t,isScheduled:a===i,isComplete:a===n,byeCount:r}}function nP(e){var r,n=e.tournamentRecords,i=e.schedulingProfile,a=e.tournamentRecord,o=e.withRoundId;if(a&&!n){if("object"!=typeof a)return{error:H};(r={})[a.tournamentId]=a,n=r}if(i){var u=of({tournamentRecords:n,schedulingProfile:i});if(u.error)return u}if(!i&&n){var s=pf({tournamentRecords:n});if(s.error)return s;i=s.schedulingProfile}if(!i)return{error:jr};var l={},c=i.map((function(e){var r=e.venues,n=e.scheduleDate;return r.map((function(e){return e.rounds.map((function(e){var r,i=eP(e);return(null===(r=i.roundSegment)||void 0===r?void 0:r.segmentsCount)&&(l[i.id]=i.roundSegment.segmentsCount),xn(t({id:o?i.id:void 0,scheduleDate:n},i))}))}))})).flat(1/0);return{profileRounds:c,segmentedRounds:l}}var iP=rs.stageOrder;function aP(e,t){return e.eventName.localeCompare(t.eventName)||e.eventId.localeCompare(t.eventId)||(iP[null==e?void 0:e.stage]||0)-(iP[null==t?void 0:t.stage]||0)||t.matchUpsCount-e.matchUpsCount||"".concat(e.stageSequence,"-").concat(e.roundNumber,"-").concat(e.minFinishingSum).localeCompare("".concat(t.stageSequence,"-").concat(t.roundNumber,"-").concat(t.minFinishingSum))}var oP={allCompetitionMatchUps:Jp,allDrawMatchUps:Up,allEventMatchUps:Yp,allTournamentMatchUps:Kp,analyzeDraws:OI,analyzeMatchUp:tw,analyzeTournament:function(e){var r=e.tournamentRecord;if(!r)return{error:W};var n=OI({tournamentRecord:r}).drawsAnalysis,i={isDual:$T(r),drawsAnalysis:n};return t(t({},L),{analysis:i})},bulkUpdatePublishedEventIds:function(e){var t,r=e.tournamentRecord,n=e.outcomes;if(!r)return{error:W};if(!(null==n?void 0:n.length))return{error:pt,info:"Missing outcomes"};var i=n.reduce((function(e,t){var r=t.drawId,n=t.eventId;return n&&r&&(e[n]?e[n].includes(r)||e[n].push(r):e[n]=[r]),e}),{}),a=Object.keys(i),o=(null===(t=r.events)||void 0===t?void 0:t.filter((function(e){return a.includes(e.eventId)}))).filter((function(e){var t=Uv({event:e}),r=null!=t?t:{},n=r.drawDetails,a=r.drawIds,o=e.eventId;return i[o].filter((function(e){var r=n?Object.keys(t.drawDetails).filter((function(e){return Sv({drawId:e,drawDetails:n})})):[];return(null==a?void 0:a.includes(e))||r.includes(e)})).length})).map((function(e){return e.eventId}));return{publishedEventIds:o,eventIdPublishedDrawIdsMap:i}},categoryCanContain:qm,checkMatchUpIsComplete:hp,checkValidEntries:UU,competitionScheduleMatchUps:Jw,credits:gw,drawMatchUps:function(e){var r,n,i,a,o,u=e.participants,s=e.tournamentAppliedPolicies,l=e.scheduleVisibilityFilters,c=e.participantsProfile,d=e.afterRecoveryTimes,p=e.policyDefinitions,v=e.useParticipantMap,f=e.tournamentRecord,m=e.usePublishState,h=e.contextFilters,g=e.contextContent,I=e.matchUpFilters,y=e.participantMap,U=e.publishStatus,S=e.contextProfile,w=e.drawDefinition,T=e.nextMatchUps,P=e.tournamentId,D=e.inContext,b=e.context,N=e.event,M=null!=N?N:{},R=M.eventId,A=M.eventName,E=M.endDate,C=t(t({},b),xn({eventId:R,eventName:A,endDate:null!==(n=null!=E?E:null==N?void 0:N.endDate)&&void 0!==n?n:null==f?void 0:f.endDate,tournamentId:null!=P?P:null==f?void 0:f.tournamentId,indoorOutDoor:null!==(i=null==N?void 0:N.indoorOutdoor)&&void 0!==i?i:null==f?void 0:f.indoorOutdoor,surfaceCategory:null!==(a=null==N?void 0:N.surfaceCategory)&&void 0!==a?a:null==f?void 0:f.surfaceCategory}));!(null==u?void 0:u.length)&&f&&(u=(r=qs({participantsProfile:c,policyDefinitions:p,useParticipantMap:v,tournamentRecord:f,contextProfile:S,inContext:D})).participants,y=r.participantMap,o=r.groupInfo),N&&S&&!g&&(g=pl({policyDefinitions:p,tournamentRecord:f,contextProfile:S,drawDefinition:w,event:N}));var x=yp({context:C,tournamentAppliedPolicies:s,scheduleVisibilityFilters:l,tournamentParticipants:u,participantsProfile:c,afterRecoveryTimes:d,policyDefinitions:p,tournamentRecord:f,usePublishState:m,participantMap:y,contextContent:g,contextFilters:h,matchUpFilters:I,publishStatus:U,contextProfile:S,drawDefinition:w,nextMatchUps:T,inContext:D,event:N});return t(t({},x),{groupInfo:o})},eventMatchUps:zw,findDrawDefinition:function(e){var t=e.tournamentRecord,r=e.drawDefinition;return t?r?{drawDefinition:Ui(r)}:{error:pe}:{error:W}},findExtension:Vn,findMatchUp:sm,findParticipant:function(e){var r,n,i,o,u,s=e.tournamentRecord,l=e.policyDefinitions,c=e.contextProfile,d=e.participantId,p=e.personId,v=e.tournamentRecords||s&&((r={})[s.tournamentId]=s,r)||{};if("string"!=typeof d&&"string"!=typeof p)return{error:pt,stack:"publicFindParticipant"};try{for(var f=a(Object.values(v)),m=f.next();!m.done;m=f.next()){var h=m.value;if(u=h.tournamentId,o=Wa({tournamentParticipants:h.participants||[],internalUse:!0,policyDefinitions:l,contextProfile:c,participantId:d,personId:p}))break}}catch(e){n={error:e}}finally{try{m&&!m.done&&(i=f.return)&&i.call(f)}finally{if(n)throw n.error}}return t({participant:o,tournamentId:u},L)},findPolicy:Jl,getAllDrawMatchUps:Ip,getAllowedDrawTypes:yU,getAllowedMatchUpFormats:function(e){var t=e.tournamentRecord,r=e.categoryName,n=e.categoryType;if(!t)return{error:W};var i=tl({tournamentRecord:t}).appliedPolicies,a=null==i?void 0:i[ja];return((null==a?void 0:a.matchUpFormats)||[]).filter((function(e){var t=e.categoryNames,i=e.categoryTypes;return!r&&!i||r&&(null==t?void 0:t.includes(r))||n&&(null==i?void 0:i.includes(n))}))},getAppliedPolicies:tl,getAssignedParticipantIds:fv,getCompetitionDateRange:vw,getCompetitionMatchUps:Kw,getCompetitionParticipants:function(e){var r,n,i=(e||{}).tournamentRecords;if("object"!=typeof i||!Object.keys(i).length)return{error:q};var s=[],l={},c={},d={},p=[],v={},f=[];try{for(var m=a(Object.values(i)),h=m.next();!h.done;h=m.next()){var g=h.value,I=Rv(t(t({},e),{tournamentRecord:g})),y=I.participantIdsWithConflicts,U=I.mappedMatchUps,S=I.participantMap,w=I.participants,T=I.matchUps,P=I.derivedEventInfo,D=I.derivedDrawInfo;Object.assign(v,U),Object.assign(l,S),Object.assign(c,P),Object.assign(d,D),s.push.apply(s,u([],o(null!=w?w:[]),!1)),p.push.apply(p,u([],o(null!=T?T:[]),!1)),null==y||y.forEach((function(e){f.includes(e)||f.push(e)}))}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}return t(t({participantIdsWithConflicts:f,derivedEventInfo:c,derivedDrawInfo:d,participantMap:l,mappedMatchUps:v,participants:s},L),{matchUps:p})},getCompetitionPenalties:function(e){var t,r,n=e.tournamentRecords;if("object"!=typeof n||!Object.keys(n).length)return{error:q};var i=[];try{for(var s=a(Object.values(n)),l=s.next();!l.done;l=s.next()){var c=qw({tournamentRecord:l.value}).penalties;i.push.apply(i,u([],o(null!=c?c:[]),!1))}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return{penalties:i}},getCompetitionVenues:cf,getCourts:function(e){var t=e.tournamentRecord,r=e.venueId,n=e.venueIds;return t?{courts:(t.venues||[]).filter((function(e){return r?e.venueId===r:!n||n.includes(e.venueId)})).map((function(e){var t=e.venueId,r=Ui(e.courts||[]);return r.forEach((function(e){return Object.assign(e,{venueId:t})})),r})).flat()}:{error:W}},getDrawDefinitionTimeItem:function(e){var t=e.returnPreviousValues,r=e.drawDefinition,n=e.itemSubTypes,i=e.itemType;if(!r)return{error:pe};if(!r.timeItems)return{info:jr};var a=Ds({element:r,returnPreviousValues:t,itemSubTypes:n,itemType:i}),o=a.timeItem,u=a.previousItems,s=a.info;return o&&{timeItem:o,previousItems:u}||{info:s}},getDrawParticipantRepresentativeIds:function(e){var t,r=Vn({name:"participantRepresentatives",element:e.drawDefinition});return r.error?r:{representativeParticipantIds:(null===(t=r.extension)||void 0===t?void 0:t.value)||[]}},getDrawTypeCoercion:vU,getEligibleVoluntaryConsolationParticipants:function(e){var r,n,i,o,u,s,l,c,d,p,v,f=e.excludedMatchUpStatuses,m=void 0===f?[]:f,h=e.includeEventParticipants,g=e.includeQualifyingStage,I=e.finishingRoundLimit,y=e.policyDefinitions,U=e.roundNumberLimit,S=e.tournamentRecord,w=e.drawDefinition,T=e.matchUpsLimit,P=e.requirePlay,D=e.requireLoss,b=e.allEntries,N=e.winsLimit,M=e.event;if(!w)return{error:K};var R=[iu,su];g&&R.push(au);var A=(null==M?void 0:M.eventType)?{matchUpTypes:[M.eventType]}:void 0,E=(null==w?void 0:w.matchUpType)?{matchUpTypes:[w.matchUpType]}:void 0,C=h&&M?null!==(o=null===(i=Yp({contextFilters:{stages:R},matchUpFilters:A,tournamentRecord:S,inContext:!0,event:M}))||void 0===i?void 0:i.matchUps)&&void 0!==o?o:[]:null!==(s=null===(u=Up({contextFilters:{stages:R},matchUpFilters:E,tournamentRecord:S,inContext:!0,drawDefinition:w}))||void 0===u?void 0:u.matchUps)&&void 0!==s?s:[],x=Gl({stage:uu,drawDefinition:w}).map((function(e){return e.participantId})),O={},F={},k={},_={};y||(y=rl({policyTypes:[Ma],tournamentRecord:S,drawDefinition:w,event:M}).policyDefinitions);var j=null==y?void 0:y[Ma];m=m.length&&m||(null==j?void 0:j.excludedMatchUpStatuses)||[],h=null!=h?h:null==j?void 0:j.includeEventParticipants,b=null!=b?b:null==j?void 0:j.allEntries,I=null!=I?I:null==j?void 0:j.finishingRoundLimit,U=null!=U?U:null==j?void 0:j.roundNumberLimit,T=null!=T?T:null==j?void 0:j.matchUpsLimit,void 0===P&&(P=void 0===(null==j?void 0:j.requirePlay)||j.requirePlay),void 0===D&&(D=void 0===(null==j?void 0:j.requireLoss)||j.requireLoss),N=null!=N?N:null==j?void 0:j.winsLimit;var B=function(e){if(P&&e.winningSide&&![1,2].includes(e.winningSide)&&e.matchUpStatus!==Vo)return"continue";if(e.finishingRound&&I&&e.finishingRound>=I)return"continue";if(e.finishingRound&&U&&e.finishingRound<=U)return"continue";var t=null===(l=e.sides)||void 0===l?void 0:l.find((function(t){var r=t.sideNumber;return e.winningSide&&r===3-e.winningSide})),r=null===(c=e.sides)||void 0===c?void 0:c.find((function(t){var r=t.sideNumber;return e.winningSide&&r===e.winningSide}));if(null===(d=e.sides)||void 0===d||d.forEach((function(t){var r,n=null===(r=null==t?void 0:t.participant)||void 0===r?void 0:r.participantId;n&&(k[n]=t.participant,e.matchUpStatus!==Vo||P||(F[n]=t.participant,O[n]||(O[n]=0),e.matchUpStatus&&m.includes(e.matchUpStatus)||(O[n]+=1)))})),null==t?void 0:t.participant){var n=t.participant.participantId;F[n]=t.participant,O[n]||(O[n]=0),e.matchUpStatus&&!m.includes(e.matchUpStatus)&&(O[n]+=1)}if(null==r?void 0:r.participant){n=r.participant.participantId;_[n]||(_[n]=0),_[n]+=1,O[n]||(O[n]=0),e.matchUpStatus&&!m.includes(e.matchUpStatus)&&(O[n]+=1)}};try{for(var V=a(C),G=V.next();!G.done;G=V.next()){B(G.value)}}catch(e){r={error:e}}finally{try{G&&!G.done&&(n=V.return)&&n.call(V)}finally{if(r)throw r.error}}var q=(null==S?void 0:S.participants)&&!P&&!D&&b,W=q?(null!==(p=h&&M?M.entries:w.entries)&&void 0!==p?p:[]).filter((function(e){return![xl,Al].includes(e.entryStatus)})).map((function(e){return e.participantId})):[],H=Object.keys(F),z=q?(null!==(v=null==S?void 0:S.participants)&&void 0!==v?v:[]).filter((function(e){var t=e.participantId;return W.includes(t)})):D&&Object.values(F)||Object.values(k),Y=z.filter((function(e){return t=e.participantId,(!D||H.includes(t))&&function(e){return!P||(O[e]||0)>=0}(e.participantId)&&function(e){return!N||(_[e]||0)<=N}(e.participantId)&&function(e){return!T||O[e]<=T}(e.participantId)&&function(e){return!x.includes(e)}(e.participantId);var t})).map((function(e){var r;return t(t({},e),{individualParticipants:null===(r=e.individualParticipantIds)||void 0===r?void 0:r.map((function(e){var t;return null===(t=null==S?void 0:S.participants)||void 0===t?void 0:t.find((function(t){return t.participantId===e}))}))})}));return t({eligibleParticipants:Y,losingParticipantIds:H},L)},getEntriesAndSeedsCount:ly,getEvent:function(e){var t,r=e.tournamentRecord,n=e.drawDefinition,i=e.context,a=e.event;if(!r)return{error:W};if(!a)return{error:Ae};var o=Ui(a);i&&Object.assign(o,i);var u=n&&(null===(t=o.drawDefinitions)||void 0===t?void 0:t.find((function(e){var t=e.drawId;return n.drawId===t})));return xn({drawDefinition:u,event:o})},getEventMatchUpFormatTiming:function(e){var r,n,i,a,s=e.tournamentRecord,l=e.matchUpFormats,c=e.categoryType,d=e.event;if(!d)return{error:Ae};var p,v=[];if(null==l?void 0:l.length){var f=[];v=l.map((function(e){var t="string"==typeof e?{matchUpFormat:e}:e;if(!f.includes(null==t?void 0:t.matchUpFormat)&&Fm({matchUpFormat:null==t?void 0:t.matchUpFormat}))return f.push(t.matchUpFormat),t})).filter(Boolean)}else{var m=Jl({policyType:ja,tournamentRecord:s,event:d}).policy;if(null==m?void 0:m.matchUpFormats)v=null==m?void 0:m.matchUpFormats;else{var h=Vn({name:ho,element:d}).extension,g=void 0,I=void 0;(null==h?void 0:h.value)?(g=(r=h.value).matchUpAverageTimes,I=r.matchUpRecoveryTimes):(g=(n=Vw[_a]).matchUpAverageTimes,I=n.matchUpRecoveryTimes),v=U(u(u([],o((g||[]).map((function(e){return e.matchUpFormatCodes}))),!1),o((I||[]).map((function(e){return e.matchUpFormatCodes}))),!1).flat()).map((function(e){return{matchUpFormat:e}})),p="default scheduling policy in use"}}var y=d.eventType,S=d.eventId,w=d.category,T=null!==(a=null!==(i=null==w?void 0:w.categoryName)&&void 0!==i?i:null==w?void 0:w.ageCategoryCode)&&void 0!==a?a:S;if(!S)return{error:Ae};var P=v.map((function(e){var r=e.matchUpFormat,n=e.description,i=qc({tournamentRecord:s,matchUpFormat:r,categoryName:T,categoryType:c,eventType:y,event:d});return t({matchUpFormat:r,description:n},i)}));return xn({eventMatchUpFormatTiming:P,info:p})},getEventProperties:function(e){var t,r,n=e.tournamentRecord,i=e.event;if(!n)return{error:W};if(!i)return{error:Ae};var a,o,u,s=i.entries||[],l=n.participants||[],c=(null===(t=i.category)||void 0===t?void 0:t.categoryName)||(null===(r=i.category)||void 0===r?void 0:r.ageCategoryCode),d=i.eventType,p=s.map((function(e){return e.participantId})),v=l.filter((function(e){return p.includes(e.participantId)})).map((function(e){var t,r,n,i,s,l,p=e.participantId,v=e.participantName,f=e.name,m={scaleType:Sc,eventType:d,scaleName:c},h=null===(r=null===(t=yv({participant:e,scaleAttributes:m}))||void 0===t?void 0:t.scaleItem)||void 0===r?void 0:r.scaleValue,g=null===(i=null===(n=yv({participant:e,scaleAttributes:m={scaleType:Uc,eventType:d,scaleName:c}}))||void 0===n?void 0:n.scaleItem)||void 0===i?void 0:i.scaleValue,I=null===(l=null===(s=yv({participant:e,scaleAttributes:m={scaleType:yc,eventType:d,scaleName:c}}))||void 0===s?void 0:s.scaleItem)||void 0===l?void 0:l.scaleValue;return a=!(!a&&!h),o=!(!o&&!g),u=!(!u&&!I),{participantId:p,participantName:v||f,seed:h,ranking:g,rating:I}}));return{entryScaleAttributes:v,hasSeededParticipants:a,hasRankedParticipants:o,hasRatedParticipants:u}},getEvents:function(e){var r,n,i,s,l,c,p,v,f,m,h,g,I=e.tournamentRecord,y=e.withScaleValues,U=e.scaleEventType,S=e.inContext,w=e.eventIds,T=e.drawIds,P=e.context;if(!I)return{error:W};var D=I.tournamentId,b=(null!==(i=I.events)&&void 0!==i?i:[]).filter((function(e){var t=e.eventId;return!w||Array.isArray(w)&&w.includes(t)})).map((function(e){var t,r=null===(t=e.drawDefinitions)||void 0===t?void 0:t.map(Ri("drawId"));if(!(null==T?void 0:T.length)||E(T,r).length){var n=Ui(e);return S&&Object.assign(n,{tournamentId:D}),P&&Object.assign(n,P),n}})).filter(Boolean),N={};if(y){var M=Rv({withScaleValues:!0,tournamentRecord:I}).participantMap,R=function(e){return e.reduce((function(e,t){return e+parseFloat(t)}),0)},A=function(e){var t,r,n,i,I,y,S,w,P,D,b,A,E,C,x=null!=U?U:e.eventType,O=e.eventId;N[O]||(N[O]={ratingsStats:{},ratings:{},ranking:{},draws:{}});var F=(null!==(s=e.entries)&&void 0!==s?s:[]).filter((function(e){var t=e.entryStatus;return _l.includes(t)})),k=F.map(Ri(Li)),_=function(e){var t,r,n,i,o,u,s,l,c,d,p,v;if(null===(o=null==e?void 0:e.ratings)||void 0===o?void 0:o[x])try{for(var f=(t=void 0,a(null!==(s=null===(u=null==e?void 0:e.ratings)||void 0===u?void 0:u[x])&&void 0!==s?s:[])),m=f.next();!m.done;m=f.next()){var h=m.value,g=h.scaleName;N[O].ratings[g]||(N[O].ratings[g]=[]);var I=null===(l=KI[g])||void 0===l?void 0:l.accessor;if(I){var y=parseFloat(null===(c=h.scaleValue)||void 0===c?void 0:c[I]);y&&N[O].ratings[g].push(y)}}}catch(e){t={error:e}}finally{try{m&&!m.done&&(r=f.return)&&r.call(f)}finally{if(t)throw t.error}}if(null===(d=null==e?void 0:e.rankings)||void 0===d?void 0:d[x])try{for(var U=(n=void 0,a(null!==(v=null===(p=null==e?void 0:e.rankings)||void 0===p?void 0:p[x])&&void 0!==v?v:[])),S=U.next();!S.done;S=U.next()){var w=S.value;g=w.scaleName;N[O].ranking[g]||(N[O].ranking[g]=[]),w.scaleValue&&N[O].ranking[g].push(w.scaleValue)}}catch(e){n={error:e}}finally{try{S&&!S.done&&(i=U.return)&&i.call(U)}finally{if(n)throw n.error}}};try{for(var L=(t=void 0,a(k)),j=L.next();!j.done;j=L.next()){var B=j.value,V=null===(l=null==M?void 0:M[B])||void 0===l?void 0:l.participant;if((null==V?void 0:V.participantType)!==fs)try{for(var G=(n=void 0,a(null!==(c=null==V?void 0:V.individualParticipantIds)&&void 0!==c?c:[])),q=G.next();!q.done;q=G.next()){var W=q.value;_(null===(p=null==M?void 0:M[W])||void 0===p?void 0:p.participant)}}catch(e){n={error:e}}finally{try{q&&!q.done&&(i=G.return)&&i.call(G)}finally{if(n)throw n.error}}else _(V)}}catch(e){t={error:e}}finally{try{j&&!j.done&&(r=L.return)&&r.call(L)}finally{if(t)throw t.error}}var H=N[O].ratings;try{for(var z=(I=void 0,a(Object.keys(H))),Y=z.next();!Y.done;Y=z.next()){if((ve=H[pe=Y.value]).length){var K=null===(v=d(ve))||void 0===v?void 0:v.toFixed(2);N[O].ratingsStats[pe]={avg:parseFloat((R(ve)/ve.length).toFixed(2)),median:K?parseFloat(K):void 0,max:Math.max.apply(Math,u([],o(ve),!1)),min:Math.min.apply(Math,u([],o(ve),!1))}}}}catch(e){I={error:e}}finally{try{Y&&!Y.done&&(y=z.return)&&y.call(z)}finally{if(I)throw I.error}}var J=function(e,t){var r,n,i,o,u,s,l,c=function(t){var r,n,i,o,u,s,l,c,d,p,v,f,m,h,g,I;if((null===(u=N[O].draws)||void 0===u?void 0:u[e])&&(null===(s=null==t?void 0:t.ratings)||void 0===s?void 0:s[x]))try{for(var y=(r=void 0,a(null!==(c=null===(l=null==t?void 0:t.ratings)||void 0===l?void 0:l[x])&&void 0!==c?c:[])),U=y.next();!U.done;U=y.next()){var S=U.value,w=S.scaleName;(null===(d=N[O].draws[e])||void 0===d?void 0:d.ratings[w])||(N[O].draws[e].ratings[w]=[]);var T=null===(p=KI[w])||void 0===p?void 0:p.accessor;if(T)(b=parseFloat(null===(v=S.scaleValue)||void 0===v?void 0:v[T]))&&N[O].draws[e].ratings[w].push(b)}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}if((null===(f=N[O].draws)||void 0===f?void 0:f[e])&&(null===(m=null==t?void 0:t.rankings)||void 0===m?void 0:m[x]))try{for(var P=(i=void 0,a(null!==(g=null===(h=null==t?void 0:t.rankings)||void 0===h?void 0:h[x])&&void 0!==g?g:[])),D=P.next();!D.done;D=P.next()){var b,M=D.value;w=M.scaleName;(null===(I=N[O].draws[e])||void 0===I?void 0:I.ranking[w])||(N[O].draws[e].ranking[w]=[]),(b=M.scaleValue)&&N[O].draws[e].ranking[w].push(b)}}catch(e){i={error:e}}finally{try{D&&!D.done&&(o=P.return)&&o.call(P)}finally{if(i)throw i.error}}};try{for(var d=(r=void 0,a(t.filter(Boolean))),p=d.next();!p.done;p=d.next()){var v=p.value,f=null===(u=null==M?void 0:M[v])||void 0===u?void 0:u.participant;if((null==f?void 0:f.participantType)!==fs)try{for(var m=(i=void 0,a(null!==(s=null==f?void 0:f.individualParticipantIds)&&void 0!==s?s:[])),h=m.next();!h.done;h=m.next()){var g=h.value;c(null===(l=null==M?void 0:M[g])||void 0===l?void 0:l.participant)}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}else c(f)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}},Z=[],X=function(e){return(null==T?void 0:T.length)&&T.includes(e)||Z.includes(e)};try{for(var Q=(S=void 0,a(null!==(f=e.drawDefinitions)&&void 0!==f?f:[])),$=Q.next();!$.done;$=Q.next()){var ee=$.value;if(!X(se=ee.drawId)){var te=null!==(m=fv({drawDefinition:ee}).assignedParticipantIds)&&void 0!==m?m:[];N[O].draws[se]||(N[O].draws[se]={ratingsStats:{},ratings:{},ranking:{}}),Z.push(se),J(se,te)}}}catch(e){S={error:e}}finally{try{$&&!$.done&&(w=Q.return)&&w.call(Q)}finally{if(S)throw S.error}}var re=_d({event:e}).flightProfile;try{for(var ne=(P=void 0,a(null!==(h=null==re?void 0:re.flights)&&void 0!==h?h:[])),ie=ne.next();!ie.done;ie=ne.next()){var ae=ie.value;if(!X(se=ae.drawId))J(se,ae.drawEntries.map(Ri(Li)))}}catch(e){P={error:e}}finally{try{ie&&!ie.done&&(D=ne.return)&&D.call(ne)}finally{if(P)throw P.error}}try{for(var oe=(b=void 0,a(Z)),ue=oe.next();!ue.done;ue=oe.next()){var se=ue.value,le=N[O].draws[se].ratings;try{for(var ce=(E=void 0,a(Object.keys(le))),de=ce.next();!de.done;de=ce.next()){var pe,ve;if((ve=le[pe=de.value]).length){K=null===(g=d(ve))||void 0===g?void 0:g.toFixed(2);N[O].draws[se].ratingsStats[pe]={avg:parseFloat((R(ve)/ve.length).toFixed(2)),median:K?parseFloat(K):void 0,max:Math.max.apply(Math,u([],o(ve),!1)),min:Math.min.apply(Math,u([],o(ve),!1))}}}}catch(e){E={error:e}}finally{try{de&&!de.done&&(C=ce.return)&&C.call(ce)}finally{if(E)throw E.error}}}}catch(e){b={error:e}}finally{try{ue&&!ue.done&&(A=oe.return)&&A.call(oe)}finally{if(b)throw b.error}}};try{for(var C=a(b),x=C.next();!x.done;x=C.next()){A(x.value)}}catch(e){r={error:e}}finally{try{x&&!x.done&&(n=C.return)&&n.call(C)}finally{if(r)throw r.error}}}return xn(t({eventScaleValues:N,events:b},L))},getEventStructures:oh,getEventTimeItem:bs,getFlightProfile:_d,getLinkedTournamentIds:Qc,getMatchUpCompetitiveProfile:Zl,getMatchUpDailyLimits:iS,getMatchUpDailyLimitsUpdate:function(e){var t=e.tournamentRecords;return _w({extensionName:mo,tournamentRecords:t})},getMatchUpDependencies:Xp,getMatchUpFormat:function(e){var t,r,n,i,a,o=e.structureId,u=e.matchUpId,s=e.event,l=e.drawDefinition,c=da(e,[(t={},t[Fi]=!0,t),(r={},r._anyOf=(n={},n[Bi]=!1,n[Wi]=!1,n[$i]=!1,n[ta]=!1,n),r)]);if(c[ea])return c;var d=cm(e,[(i={},i[ra]=Qi,i[ea]=pt,i)]),p=null==d?void 0:d.matchUp;if(u&&(null==p?void 0:p.error))return p;!l&&(null==p?void 0:p.drawDefinition)&&(l=null==p?void 0:p.drawDefinition);var v=null==p?void 0:p.structure;if(!v&&o&&!u){if(!l)return{error:pe};var f=as({drawDefinition:l,structureId:o});if(f.error)return f;v=f.structure}var m=null==v?void 0:v.matchUpFormat,h=null==l?void 0:l.matchUpFormat,g=null==s?void 0:s.matchUpFormat;return{structureDefaultMatchUpFormat:m,eventDefaultMatchUpFormat:g,drawDefaultMatchUpFormat:h,matchUpFormat:(null===(a=null==p?void 0:p.matchUp)||void 0===a?void 0:a.matchUpFormat)||m||h||g}},getMatchUpFormatTiming:qc,getMatchUpFormatTimingUpdate:function(e){var t=e.tournamentRecords;return _w({extensionName:ho,tournamentRecords:t})},getMatchUpScheduleDetails:jd,getMatchUpsStats:function(e){var r,n,i=e.profileBands,a=e.tournamentRecord,s=e.matchUps;if(!Zs(s))return{error:$e};var l=!i&&Jl({policyType:Ra,tournamentRecord:a}).policy,c=i||(null==l?void 0:l.profileBands)||dl[Ra].profileBands,d=s.filter((function(e){return e.winningSide})),p=Kl(d.map(zl)).reduce((function(e,t){return function(e,t){return e[Hl(t,c)]+=1,e}(e,t)}),((r={})[ul]=0,r[sl]=0,r[ll]=0,r[al]=0,r)),v=Object.keys(p).reduce((function(e,t){return(p[t]||0)+e}),0),f=Object.keys(p).map((function(e){var t,r=parseFloat((p[e]/v).toFixed(4));return(t={})[e]=100*r,t})),m=d.filter((function(e){return e.matchUpStatus===ol})).length;return f.push(((n={})[ol]=100*parseFloat((m/v).toFixed(4)),n)),t({competitiveBands:Object.assign.apply(Object,u([{}],o(f),!1))},L)},getMatchUpType:op,getMaxEntryPosition:function(e){var t=e.entries,r=void 0===t?[]:t,n=e.entryStatus,i=e.stage;return Math.max.apply(Math,u(u([],o(r.filter((function(e){return!(i&&i!==e.entryStage||n&&e.entryStatus!==n||isNaN(e.entryPosition))})).map((function(e){return l(e.entryPosition||0)}))),!1),[0],!1))},getModifiedMatchUpFormatTiming:Gw,getPairedParticipant:gl,getParticipantEventDetails:function(e){var t,r,n=e.tournamentRecord,i=e.participantId;if(!n)return{error:W};if(!i)return{error:_t};var a=[i].concat((null!==(t=n.participants)&&void 0!==t?t:[]).filter((function(e){var t;return(null==e?void 0:e.participantType)&&[gs,hs].includes(e.participantType)&&(null===(t=e.individualParticipantIds)||void 0===t?void 0:t.includes(i))})).map((function(e){return e.participantId}))),o=(null!==(r=n.events)&&void 0!==r?r:[]).filter((function(e){var t;return x((null!==(t=null==e?void 0:e.entries)&&void 0!==t?t:[]).map((function(e){return e.participantId})),a)})).map((function(e){return{eventName:e.eventName,eventId:e.eventId}}));return{eventDetails:o}},getParticipantIdFinishingPositions:function(e){var t=e.byeAdvancements,r=void 0!==t&&t,n=e.tournamentRecord,i=e.drawDefinition;if(!i)return{error:K};var a=function(e){var t=e.tournamentParticipants,r=e.drawDefinition,n=e.event;if(!r)return{error:K};var i=Ui(Ip({tournamentParticipants:t,inContext:!0,drawDefinition:r,event:n}).matchUps,!1,!0),a=U(i.reduce((function(e,t){return e.concat.apply(e,u([],o(t.sides.map((function(e){return e.participantId})).filter(Boolean)),!1))}),[])),s=Object.assign.apply(Object,u([{}],o(a.map((function(e){var t,r=i.filter((function(t){return t.sides.map((function(e){return e.participantId})).filter(Boolean).includes(e)}));return(t={})[e]=r,t}))),!1));return{participantIds:a,participantIdMatchUps:s}}({tournamentParticipants:null==n?void 0:n.participants,drawDefinition:i}),s=a.participantIds,l=a.participantIdMatchUps,c=s.map((function(e){var t,n=l[e].filter((function(e){return[_o,Fo].includes(e.matchUpStatus)||e.winningSide})),i=n.map((function(t){var n=t.sides.find((function(e){return e.bye})),i=t.sides.find((function(t){return t.participantId===e})).sideNumber;return(t.winningSide||r&&n&&i)===i?t.finishingPositionRange.winner:t.finishingPositionRange.loser})),a=function(e){return Math.abs(e[0]-e[1])},o=i.reduce((function(e,t){return e&&a(e)<a(t)?e:t}),void 0);return(t={})[e]={relevantMatchUps:n,finishingPositionRanges:i,finishingPositionRange:o},t}));return Object.assign.apply(Object,u([{}],o(c),!1))},getParticipantMembership:function(e){var t=e.tournamentRecord,r=e.participantId;if(!t)return{error:W};if(!r)return{error:_t};var n=Rv({participantFilters:{participantTypes:[gs,hs,ms]},tournamentRecord:t}).participants,i=(null!=n?n:[]).filter((function(e){var t;return null===(t=e.individualParticipantIds)||void 0===t?void 0:t.includes(r)}));return i.reduce((function(e,t){var r=t.participantType;return r&&(e[r]||(e[r]=[]),e[r].push(t)),e}),{})},getParticipants:Rv,getParticipantScaleItem:dy,getParticipantSchedules:function(e){var r,n,i,s,l,c=e.participantFilters,d=void 0===c?{}:c,p=e.tournamentRecord;if(!p)return{error:W};if("object"!=typeof d)return{error:Ar,context:{participantFilters:d}};var v=null!==(i=Kp({tournamentRecord:p,contextFilters:{eventIds:d.eventIds}}).matchUps)&&void 0!==i?i:[],f=Object.assign.apply(Object,u([{}],o(v.map((function(e){var t;return(t={})[e.matchUpId]=e,t}))),!1)),m=v.filter((function(e){var t=e.schedule;return t&&Object.keys(t).length})),h=null!==(s=Xp({tournamentRecord:p,matchUps:v}).sourceMatchUpIds)&&void 0!==s?s:[],g={},I=function(e){var t,r,n,i,s,c=e.sides,d=null!==(l=null==c?void 0:c.map((function(t){var r;if(t.participant)return(r=[t.participant]).concat.apply(r,u([],o(t.participant.individualParticipants||[]),!1));h[e.matchUpId]&&!s&&(s=(h[e.matchUpId]||[]).map((function(e){return f[e]})).filter((function(e){var t=e.winningSide,r=e.bye;return!t&&!r})))})).filter(Boolean).flat())&&void 0!==l?l:[];try{for(var p=(t=void 0,a(d)),v=p.next();!v.done;v=p.next()){var m=(S=v.value).participantId;g[m]||(g[m]={potentialMatchUps:[],participant:S,matchUps:[]}),g[m].matchUps.push(e)}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}var I=(null==s?void 0:s.map((function(e){return e.sides})).flat().map((function(e){var t,r=e.participant;return r&&(t=[r]).concat.apply(t,u([],o(r.individualParticipants||[]),!1))})).filter(Boolean).flat())||[];try{for(var y=(n=void 0,a(I)),U=y.next();!U.done;U=y.next()){var S;m=(S=U.value).participantId;g[m]||(g[m]={potentialMatchUps:[],participant:S,matchUps:[]}),g[m].potentialMatchUps.push(e)}}catch(e){n={error:e}}finally{try{U&&!U.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}};try{for(var y=a(m),U=y.next();!U.done;U=y.next()){I(U.value)}}catch(e){r={error:e}}finally{try{U&&!U.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var S=Object.values(g).filter((function(e){var t=e.participant;return!(d.participantIds&&!d.participantIds.includes(t.participantId)||d.participantTypes&&!d.participantTypes.includes(t.participantType))}));return t({participantSchedules:S},L)},getParticipantSignInStatus:function(e){var t=e.tournamentRecord,r=e.participantId;if(!t)return{error:W};if(!r)return{error:_t};var n=Ps({tournamentRecord:t,participantId:r}).participant;if(!n)return{error:Lt};var i=Ds({itemType:cs,element:n}).timeItem;return i&&i.itemValue===ps&&ps},getParticipantTimeItem:function(e){var t=e.returnPreviousValues,r=e.tournamentRecord,n=e.participantId,i=e.itemSubTypes,a=e.itemType;if(!r)return{error:W};if(!n)return{error:_t};var o=Ps({tournamentRecord:r,participantId:n});if(o.error)return o;var u=o.participant;if(!(null==u?void 0:u.timeItems))return{info:jr};var s=Ds({element:o.participant,returnPreviousValues:t,itemSubTypes:i,itemType:a}),l=s.timeItem,c=s.previousItems,d=s.info;return l&&{timeItem:l,previousItems:c}||{info:d}},getPersonRequests:DS,getPolicyDefinitions:rl,getPositionAssignments:nf,getPredictiveAccuracy:function(e){var r,n,i,s,l,c,d,p,v=e.matchUps,f=e.singlesForDoubles,m=e.tournamentRecord,h=e.drawDefinition,g=e.excludeMargin,y=e.exclusionRule,U=e.zoneDoubling,S=e.matchUpType,w=e.scaleName,T=e.eventId,P=e.zonePct,D=e.drawId,b=e.event;if(!m&&!v)return{error:W};if(S&&![Es,xs].includes(S))return{error:xr,info:{matchUpType:S}};if(v&&!Zs(v))return{error:xr,context:{matchUps:v}};var N=KI[w],M=null!==(n=null!==(r=null==N?void 0:N.ascending)&&void 0!==r?r:e.ascending)&&void 0!==n&&n,R=null!==(i=null==N?void 0:N.accessor)&&void 0!==i?i:e.valueAccessor,A=Array.isArray(null==N?void 0:N.range)?Math.abs(N.range[0]-N.range[1]):0,E=I(P)&&A?(null!=P?P:0)*A:null!==(s=e.zoneMargin)&&void 0!==s?s:A,C={withScaleValues:!0,withCompetitiveness:!0},x={matchUpTypes:S?[S]:[Es,xs]},O=null==m?void 0:m.participants;(null===(l=null==v?void 0:v[0])||void 0===l?void 0:l.hasContext)?D?v=v.filter((function(e){return e.drawId===D})):T&&(v=v.filter((function(e){return e.eventId===T}))):void 0===v&&(v=D&&!h&&[]||!D&&T&&!b&&[]||D&&(null===(c=Up({inContext:!0,drawDefinition:h,contextFilters:x,contextProfile:C,participants:O}))||void 0===c?void 0:c.matchUps)||!D&&T&&(null===(d=Yp({inContext:!0,contextFilters:x,contextProfile:C,participants:O,event:b}))||void 0===d?void 0:d.matchUps)||(null===(p=Kp({tournamentRecord:m,contextFilters:x,contextProfile:C}))||void 0===p?void 0:p.matchUps)||[]),S&&(v=v.filter((function(e){return e.matchUpType===S})));var F=v.filter((function(e){var t=e.winningSide,r=e.score,n=e.sides,i=e.matchUpStatus;return![Ho,jo,Ko,Lo,xo].includes(null!=i?i:"")&&Bp({score:r})&&2===(null==n?void 0:n.length)&&t})),k=function(e){var t,r,n=e.excludeMargin,i=e.exclusionRule,o=e.valueAccessor,u=e.ascending,s=e.scaleName,l=e.matchUps,c={affirmative:[],negative:[],excluded:[]};try{for(var d=a(l),p=d.next();!p.done;p=d.next()){var v=p.value,f=v.matchUpType,m=v.sides,h=v.score,g=v.winningSide;if(g){if(i&&(!i.valueAccessor||!i.range))return{info:"exclusionRule requires valueAccessor and range",error:pt};var I=g-1,y=XT({exclusionRule:i,valueAccessor:o,matchUpType:f,scaleName:s,sides:m});if(i){var U=y.map((function(e){return e.exclusionValues})).flat();if(U.length){c.excluded.push({scoreString:null==h?void 0:h.scoreStringSide1,exclusionValues:U,winningSide:g,sideValues:y});continue}}if(y.filter((function(e){return![void 0,"",null].includes(e.value)})).length<2)c.excluded.push({scoreString:null==h?void 0:h.scoreStringSide1,missingValues:!0,winningSide:g,sideValues:y});else{var S=y[I].value-y[1-I].value,w=parseFloat(n||0),T=w&&Math.abs(S)<w;if(T)c.excluded.push({scoreString:null==h?void 0:h.scoreStringSide1,excludeMargin:n,winningSide:g,excludeGap:T,sideValues:y,valuesGap:S});else{var P=u?S:-1*S,D=1===g?null==h?void 0:h.scoreStringSide1:null==h?void 0:h.scoreStringSide2;P>0?c.affirmative.push({winningScoreString:D,winningSide:g,sideValues:y,valuesGap:S,score:h}):c.negative.push({winningScoreString:D,winningSide:g,sideValues:y,valuesGap:S,score:h})}}}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}var b=c.affirmative.length+c.negative.length,N=b&&c.affirmative.length/b*100;return c.percent=N?Math.round(100*N)/100:0,c}({matchUps:F,excludeMargin:g,exclusionRule:y,valueAccessor:R,ascending:M,scaleName:w}),_=U&&S!==Es?2*(E||0):E,j=E?F.map((function(e){var t=e.competitiveProfile,r=e.matchUpType,n=e.score,i=e.sides,a=XT({singlesForDoubles:f,valueAccessor:R,matchUpType:r,scaleName:w,sides:i}),o=Math.abs(a[0].value-a[1].value);return{competitiveness:null==t?void 0:t.competitiveness,valuesGap:o,score:n}})).filter((function(e){return e.valuesGap<=_})):[],B=function(e){var t,r,n,i=e.zoneData,o=(t={},t[ul]=[],t[sl]=[],t[ll]=[],t);try{for(var u=a(i),s=u.next();!s.done;s=u.next()){var l=s.value,c=l.competitiveness,d=l.score,p=l.valuesGap;o[c]&&o[c].push({score:d,valuesGap:p})}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return o}({zoneData:j}),V=B&&[].concat(Object.values(B)).flat().length,G=V&&Object.assign.apply(Object,u([{}],o(Object.keys(B).map((function(e){var t;return(t={})[e]=Math.round(1e4*B[e].length/V)/100,t}))),!1)),q=F.length-((null==j?void 0:j.length)||0);return t(t({},L),{relevantMatchUps:F,zoneDistribution:G,zoneData:j,accuracy:k,nonZone:q})},getRoundMatchUps:Xs,getRounds:function(e){var r,n,i=e.excludeScheduleDateProfileRounds,a=e.excludeScheduledRounds,s=e.excludeCompletedRounds,l=e.inContextMatchUps,c=e.tournamentRecords,d=e.schedulingProfile,p=e.tournamentRecord,v=e.withSplitRounds,f=e.matchUpFilters,m=e.scheduleDate,h=e.withRoundId,g=e.venueId,I=e.context;if(l&&!Array.isArray(l||"object"!=typeof l[0]))return{error:xr,inContextMatchUps:l};if(p&&!c){if("object"!=typeof p)return{error:H};(r={})[p.tournamentId]=p,c=r}var y="object"!=typeof c||!Object.keys(c).length;if((g||m||!l||!d&&(i||s||d||v))&&y)return{error:q};var U=Object.assign.apply(Object,u([{}],o(Object.values(null!=c?c:{}).map((function(e){var t,r=e.venues,n=void 0===r?[]:r;return(t={})[e.tournamentId]=null==n?void 0:n.map((function(e){return e.venueId})),t}))),!1)),S=Object.values(null!=c?c:{}).map((function(e){var r=e.events,n=void 0===r?[]:r,i=e.tournamentId,a=e.startDate,o=e.endDate;return n.map((function(e){var r,n;return t(t({},e),{validVenueIds:U[i],startDate:null!==(r=e.startDate)&&void 0!==r?r:a,endDate:null!==(n=e.endDate)&&void 0!==n?n:o})}))})).flat(),w=c&&(i||s||d||v)&&nP({tournamentRecords:c,schedulingProfile:d})||{},T=w.segmentedRounds,P=w.profileRounds,D=i&&Object.assign.apply(Object,u([{}],o(P.map((function(e){var t;return(t={})[e.id]=e,t}))),!1)),b=l||c&&(null===(n=Jp({tournamentRecords:c,matchUpFilters:f}))||void 0===n?void 0:n.matchUps)||[],N=[],M=b&&Object.values(b.reduce((function(e,r){var n,i,a,s=eP(r).id,l=null==T?void 0:T[s],c=u(u([],o(null!==(a=null===(i=e[s])||void 0===i?void 0:i.matchUps)&&void 0!==a?a:[]),!1),[r],!1),d=r.containerStructureId,p=r.stageSequence,v=r.structureName,f=r.tournamentId,m=r.isRoundRobin,g=r.matchUpType,I=r.roundNumber,y=r.roundOffset,U=r.structureId,S=r.eventName,w=r.roundName,P=r.drawName,D=r.eventId,b=r.drawId,N=m?d:U;return t(t({},e),((n={})[s]={id:h?s:void 0,structureId:N,stageSequence:p,segmentsCount:l,structureName:v,tournamentId:f,matchUpType:g,roundNumber:I,roundOffset:y,eventName:S,roundName:w,drawName:P,matchUps:c,eventId:D,drawId:b},n))}),{})).map((function(e){var r=(e.matchUps||[]).reduce((function(e,t){var r,n,i=((null===(r=t.finishingPositionRange)||void 0===r?void 0:r.winner)||[]).reduce((function(e,t){return e+t}),0),a=((null===(n=t.finishingPositionRange)||void 0===n?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||i<e.minFinishingSum?{minFinishingSum:i,winnerFinishingPositionRange:a}:e}),{minFinishingSum:0,winnerFinishingPositionRange:""}),n=r.minFinishingSum,i=r.winnerFinishingPositionRange,a=e.segmentsCount;if(a){var o=e.matchUps.length/a;return O(e.matchUps.sort((function(e,t){return e.roundPosition-t.roundPosition})),o).map((function(r,o){var u=rP(r),s=u.unscheduledCount,l=u.incompleteCount,d=u.matchUpsCount,p=u.isScheduled,v=u.isComplete,f=u.byeCount,m=tP({matchUps:e.matchUps,tournamentRecords:c,events:S,round:e});return xn(t(t(t({},e),I),{roundSegment:{segmentsCount:a,segmentNumber:o+1},winnerFinishingPositionRange:i,unscheduledCount:s,incompleteCount:l,minFinishingSum:n,matchUpsCount:d,isScheduled:p,roundTiming:m,isComplete:v,byeCount:f,matchUps:r}))}))}var u=rP(e.matchUps),s=u.unscheduledCount,l=u.incompleteCount,d=u.matchUpsCount,p=u.isScheduled,v=u.isComplete,f=u.byeCount,m=tP({matchUps:e.matchUps,tournamentRecords:c,events:S,round:e});return xn(t(t(t({},e),I),{winnerFinishingPositionRange:i,unscheduledCount:s,incompleteCount:l,minFinishingSum:n,matchUpsCount:d,isScheduled:p,roundTiming:m,isComplete:v,byeCount:f}))})).flat().filter((function(e){var t,r;if(i){var n=ui(i),o=h?e.id:eP(e).id;if(n&&D[o]&&ui(D[o].scheduleDate)===n)return!1}var u=e.isComplete,l=e.isScheduled,c=!s||!u,d=!a||!l,v=g||m?null==S?void 0:S.find((function(t){return t.eventId===e.eventId})):void 0,f=null!==(t=null==v?void 0:v.startDate)&&void 0!==t?t:null==p?void 0:p.startDate,I=null!==(r=null==v?void 0:v.endDate)&&void 0!==r?r:null==p?void 0:p.endDate,y=!m||!f||new Date(m)>=new Date(f),U=!m||!I||new Date(m)<=new Date(I),w=y&&U,T=!g||(null==v?void 0:v.validVenueIds.includes(g)),P=c&&d&&T&&w;return P||N.push(e),P})).sort(aP)||[];return t(t({},L),{rounds:M,excludedRounds:N})},getScaledEntries:py,getScheduledRoundsDetails:mS,getSchedulingProfileIssues:function(e){var r,n,i=null!=e?e:{},s=i.scheduleDates,l=void 0===s?[]:s,c=i.tournamentRecords,d=i.periodLength,p=void 0===d?30:d;if("object"!=typeof c)return{error:H};if(!Array.isArray(l))return{error:xr};if(!l.every(Jn))return{error:It};var v=[],f=0,m={},h=pf({tournamentRecords:c}).schedulingProfile;if(!h)return t({issues:v},L);var g=Jp({nextMatchUps:!0,tournamentRecords:c}).matchUps,I=function(e){var t,r,n=e.scheduleDate,i=e.venues,s=void 0===i?[]:i;if(!(null==l?void 0:l.length)||l.includes(n)){var d=function(e){if(e){var t=e.rounds,r=[],i=mS({tournamentRecords:c,periodLength:p,matchUps:g,rounds:t}),a=i.orderedMatchUpIds,s=i.scheduledRoundsDetails,l=Xp({tournamentRecords:c,matchUps:g}).matchUpDependencies,d=function(e){var t;return null==s||s.find((function(r,n){var i=r.matchUpIds.includes(e);return i&&(t=n),i})),t};if(null==a||a.forEach((function(e,t){var n,i=E(a.slice(t+1),(null===(n=null==l?void 0:l[e])||void 0===n?void 0:n.matchUpIds)||[]);i.length&&r.push({matchUpId:e,shouldBeAfter:i})})),r.length){f+=r.length;var h=r.map((function(e){var t=e.matchUpId,r=e.shouldBeAfter,i=d(t),a=U(r.map(d));return m[n]||(m[n]={}),m[n][i]||(m[n][i]=[]),a.forEach((function(e){m[n][i].includes(e)||m[n][i].push(e)})),{matchUpId:t,matchUpRoundIndex:i,earlierRoundIndices:a,shouldBeAfter:r}}));v.push.apply(v,u([],o(h),!1))}}};try{for(var h=(t=void 0,a(s||[])),I=h.next();!I.done;I=h.next()){d(I.value)}}catch(e){t={error:e}}finally{try{I&&!I.done&&(r=h.return)&&r.call(h)}finally{if(t)throw t.error}}}};try{for(var y=a(h),S=y.next();!S.done;S=y.next()){I(S.value)}}catch(e){r={error:e}}finally{try{S&&!S.done&&(n=y.return)&&n.call(y)}finally{if(r)throw r.error}}var w={matchUpIdShouldBeAfter:Object.assign.apply(Object,u([{}],o(v.map((function(e){var t,r=e.matchUpId,n=e.shouldBeAfter,i=e.earlierRoundIndices;return(t={})[r]={earlierRoundIndices:i,shouldBeAfter:n},t}))),!1))};return t({issuesCount:f,profileIssues:w,roundIndexShouldBeAfter:m},L)},getSeedsCount:sy,getStructureSeedAssignments:ql,getTeamLineUp:Il,getTieFormat:function(e){var r,n,i,a,o,u=e.tournamentRecord,s=e.drawDefinition,l=e.structureId,c=e.matchUpId,d=e.structure,p=e.eventId,v=e.drawId,f=e.event;if(!u)return{error:W};if(!(v||f||l||c))return On({result:{error:pt},stack:"getTieFormat"});p&&!f&&(f=null===(r=u.events)||void 0===r?void 0:r.find((function(e){return e.eventId===p})));var m=sm({tournamentRecord:u,drawDefinition:s,matchUpId:c,drawId:v,event:f});if(c&&(null==m?void 0:m.error))return m;if(!s&&(null==m?void 0:m.drawDefinition)&&(s=null==m?void 0:m.drawDefinition),!(d=null!=d?d:null==m?void 0:m.structure)&&l&&!c){if(!s)return{error:pe};var h=as({drawDefinition:s,structureId:l});if(h.error)return h;d=h.structure}var g=((null==d?void 0:d.tieFormat)||(null==d?void 0:d.tieFormatId))&&(null===(n=Gd({structure:d,drawDefinition:s,event:f}))||void 0===n?void 0:n.tieFormat),I=((null==s?void 0:s.tieFormat)||(null==s?void 0:s.tieFormatId))&&(null===(i=Gd({drawDefinition:s,event:f}))||void 0===i?void 0:i.tieFormat),y=null===(a=Gd({event:f}))||void 0===a?void 0:a.tieFormat,U=null===(o=Gd({matchUp:null==m?void 0:m.matchUp,drawDefinition:s,structure:d,event:f}))||void 0===o?void 0:o.tieFormat;return t(t({},L),{matchUp:null==m?void 0:m.matchUp,structureDefaultTieFormat:bm(g),eventDefaultTieFormat:bm(y),drawDefaultTieFormat:bm(I),tieFormat:bm(U),structure:d})},getTournamentIds:To,getTournamentInfo:Uf,getTournamentPenalties:qw,getTournamentPersons:function(e){var r=e.tournamentRecord,n=e.participantFilters;if(!r)return{error:W};var i=r.participants||[];n&&(i=Nv({participants:i,participantFilters:n,tournamentRecord:r}));var a={};return i.forEach((function(e){e.person&&function(e){if(e.person){var r=e.person.personId;a[r]?a[r].participantIds.push(e.participantId):a[r]=t(t({},e.person),{participantIds:[e.participantId]})}}(e)})),{tournamentPersons:Object.values(a)}},getTournamentStructures:function(e){var t,r,n,i,s,l=e.withStageGrouping,c=e.tournamentRecord,d=e.stageSequences,p=e.stageSequence,v=e.roundTarget,f=e.stages,m=e.stage;if(!c)return{error:W};var h={},g=[];try{for(var I=a(c.events||[]),y=I.next();!y.done;y=I.next()){var U=oh({withStageGrouping:l,stageSequences:d,stageSequence:p,roundTarget:v,stages:f,event:y.value,stage:m}),S=U.structures,w=U.stageStructures;if(S&&g.push.apply(g,u([],o(S),!1)),w)try{for(var T=(n=void 0,a(Object.keys(w))),P=T.next();!P.done;P=T.next()){var D=P.value;h[D]||(h[D]=[]),(s=h[D]).push.apply(s,u([],o(w[D]),!1))}}catch(e){n={error:e}}finally{try{P&&!P.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=I.return)&&r.call(I)}finally{if(t)throw t.error}}return{structures:g,stageStructures:h}},getTournamentTimeItem:Ns,getVenuesAndCourts:lf,getVenuesReport:function(e){var t,r,n=e.ignoreDisabled,i=void 0===n||n,o=e.tournamentRecords,u=e.tournamentId,s=e.venueIds,l=void 0===s?[]:s,c=e.dates,d=void 0===c?[]:c;if(!Array.isArray(d))return{error:xr,dates:d};if(!Array.isArray(l))return{error:xr,venueIds:l};if(!(o&&Object.keys(o).filter((function(e){return!u||e===u}))||[]).length)return{error:q};if(!d.every(Jn))return{error:It};var p=lf({tournamentRecords:o,ignoreDisabled:i,dates:d});if(p.error)return p;var v=null===(t=null==p?void 0:p.venues)||void 0===t?void 0:t.filter((function(e){var t=e.venueId;return!(null==l?void 0:l.length)||l.includes(t)})),f=null===(r=p.courts)||void 0===r?void 0:r.reduce((function(e,t){var r;return null===(r=t.dateAvailability)||void 0===r||r.forEach((function(t){var r=t.date;e.includes(r)||e.push(r)})),e}),[]).filter((function(e){return!d.length||d.includes(e)})),m={venueIds:null==v?void 0:v.map((function(e){return e.venueId}))},h=Jp({afterRecoveryTimes:!0,tournamentRecords:o,matchUpFilters:m}).matchUps,g=null==v?void 0:v.map((function(e){return function(e,t,r){var n=t.venueId,i=t.courts,o=t.venueName,u={};return e.forEach((function(e){var t,o,s=0,l=0,c=0;try{for(var d=a(i),p=d.next();!p.done;p=d.next()){var v=p.value.dateAvailability.find((function(t){return t.date===e})),f=v&&FU({courtDate:v}),m=null==f?void 0:f.reduce((function(e,t){var r=t.startTime;return e+(ii(t.endTime)-ii(r))}),0);m&&(c+=1),s+=m}}catch(e){t={error:e}}finally{try{p&&!p.done&&(o=d.return)&&o.call(d)}finally{if(t)throw t.error}}var h=r.filter((function(t){var r=t.schedule;return r.venueId===n&&Ii(e,r.scheduledDate)}));h.forEach((function(e){var t=e.schedule,r=oi(t.scheduledTime),n=ii(mi(r,t.averageMinutes))-ii(r);l+=n}));var g=s?(l/s*100).toFixed(2):"100";u[e]={scheduledMatchUpsCount:h.length,availableCourts:c,availableMinutes:s,scheduledMinutes:l,percentUtilization:g}})),{venueId:n,venueName:o,venueReport:u}}(f,e,h)}));return{venuesReport:g}},isValidForQualifying:function(e){var r=e.structureId,n=e.drawDefinition;if(!n)return{error:K};if(!Pi(r))return{error:xr};var i=Ys({drawDefinition:n,structureId:r});if(i.error)return i;var a=i.links.target.flatMap((function(e){return e.target.feedProfile})).filter(Boolean),o=!E([wu,Su,Uu,hu],a).length;return t(t({},L),{valid:o})},isValidMatchUpFormat:Fm,matchUpActions:ZT,participantScaleItem:yv,participantScheduledMatchUps:function(e){var r=e.scheduleAttributes,n=void 0===r?["scheduledDate","scheduledTime"]:r,i=e.matchUps,a=void 0===i?[]:i;if(!Zs(a))return{error:$e};if(!Array.isArray(n))return{error:xr};var o=a.filter(Boolean).filter((function(e){var t=e.schedule;return gS({schedule:t,scheduleAttributes:n})})).reduce((function(e,t){var r=t.schedule,n=ui(null==r?void 0:r.scheduledDate),i=oi(null==r?void 0:r.scheduledTime);return n&&i&&(e[n]?e[n].push(t):e[n]=[t]),e}),{});return Object.keys(o).forEach((function(e){o[e].sort((function(e,t){var r,n;return di(oi(null===(r=e.schedule)||void 0===r?void 0:r.scheduledTime),oi(null===(n=t.schedule)||void 0===n?void 0:n.scheduledTime))}))})),t(t({},L),{scheduledMatchUps:o})},positionActions:function(e){var t,r,n,i,s,l,c=e.policyDefinitions,d=e.returnParticipants,p=void 0===d||d,v=e.provisionalPositioning,f=e.tournamentRecord,m=e.drawDefinition,h=e.drawPosition,g=e.event;if(!g)return{error:Ae};if(!m)return{error:K};if(!e.structureId)return{error:Pe};var I=null!==(r=null!==(t=e.tournamentParticipants)&&void 0!==t?t:f&&Rv({withIndividualParticipants:!0,tournamentRecord:f}).participants)&&void 0!==r?r:[],y=as({structureId:e.structureId,drawDefinition:m});if(y.error)return y;var S=y.containingStructure||y.structure;if(!S)return{error:De};var w=S.structureId;if(y=Qp({drawDefinition:m,structureId:w}),void 0===h&&!y.isAdHoc)return{error:ue};if(y.isAdHoc)return ZT(e);if(y.error)return y;var T=y.drawPositionInitialRounds,P=y.inactiveDrawPositions,D=y.activeDrawPositions,b=y.byeDrawPositions,N=null!==(n=tl({tournamentRecord:f,drawDefinition:m,structure:S,event:g}).appliedPolicies)&&void 0!==n?n:{};Object.assign(N,null!=c?c:{});var M,R=NT({actionType:DT,appliedPolicies:N,drawDefinition:m,structure:S}),A=R.actionsPolicy,E=R.enabledStructures,C=R.actionsDisabled,x=(null==A?void 0:A.activePositionOverrides)||[],O=(Zw({finishingPosition:$u,targetRoundNumber:1,linkType:Tu,drawDefinition:m,structureId:w})||{}).sourceStructureIds;(null==O?void 0:O.length)&&(M=O.reduce((function(e,t){return uh({structureId:t,drawDefinition:m})&&e}),!0));var F=O.length,k=O.length&&!M,_=RT({enabledStructures:E,drawDefinition:m,structure:S}).policyActions,L=![au,iu].includes(S.stage)||1!==S.stageSequence,j=m.drawId,B=[],V=ls({structure:S}),G=V.assignedPositions,q=V.positionAssignments,W=null==G?void 0:G.find((function(e){return e.drawPosition===h})),H=null==q?void 0:q.map((function(e){return e.drawPosition}));if(!(null==H?void 0:H.includes(h)))return{error:oe};var z=S.stage,Y=S.stageSequence,J=[z];z===ou&&J.push(iu),z===iu&&J.push(ou);var Z=Gl({entryStatuses:kl,provisionalPositioning:v,drawDefinition:m,stageSequence:Y,structureId:w,stages:J}),X=null!==(i=fv({drawDefinition:m,stages:J}).assignedParticipantIds)&&void 0!==i?i:[],Q=Z.filter((function(e){return!X.includes(e.participantId)})).map((function(e){return e.participantId})),$=b.includes(h),ee=D.includes(h);if(C)return{hasPositionAssigned:!!W,info:"Actions Disabled for structure",isActiveDrawPosition:ee,isDrawPosition:!0,validActions:[],isByePosition:$};if(AT({policyActions:_,action:dT})&&!ee&&q&&!k&&(!W||$)){var te=function(e){var t,r,n,i,a,o=e.positionSourceStructureIds,u=e.unassignedParticipantIds,s=e.possiblyDisablingAction,l=e.provisionalPositioning,c=e.tournamentParticipants,d=e.isWinRatioFedStructure,p=e.positionAssignments,v=e.returnParticipants,f=e.appliedPolicies,m=e.drawDefinition,h=e.seedingProfile,g=e.isByePosition,I=e.drawPosition,y=e.structureId,S=e.event,w=m.drawId,T=[],P=[],D=null===(r=null===(t=null==f?void 0:f[Ba])||void 0===t?void 0:t.validSeedPositions)||void 0===r?void 0:r.ignore;if(!D){var b=Xf({provisionalPositioning:l,returnAllProxies:!0,randomize:!0,drawDefinition:m,seedingProfile:h,structureId:y,event:S});i=b.unplacedSeedParticipantIds,a=b.unplacedSeedAssignments,P=b.unfilledPositions}if((null==P?void 0:P.length)||(P=p.filter((function(e){return!e.participantId&&!e.bye&&!e.qualifier})).map((function(e){return e.drawPosition}))),g||T.push({payload:{drawId:w,structureId:y,drawPosition:I,isPositionAction:!0},willDisableLinks:s,method:aT,type:yT}),d&&D){var N=p.map((function(e){return e.participantId})).filter(Boolean),M=yp({inContext:!0,matchUpFilters:{structureIds:o},drawDefinition:m}).completedMatchUps,R=U(null===(n=(null!=M?M:[]).filter((function(e){var t=e.matchUpType;return(null==S?void 0:S.eventType)!==ga||t===ga})))||void 0===n?void 0:n.map((function(e){var t=e.sides;return null==t?void 0:t.map(Ri("participantId"))})).flat().filter((function(e){return e&&!N.includes(e)})));return null==(E=v?null==c?void 0:c.filter((function(e){return null==R?void 0:R.includes(e.participantId)})).map((function(e){return Ui(e,void 0,!0)})):void 0)||E.forEach((function(e){var t,r=(null!==(t=m.entries)&&void 0!==t?t:[]).find((function(t){return t.participantId===e.participantId}));e.entryPosition=null==r?void 0:r.entryPosition})),(null==E?void 0:E.length)&&T.push(xn({payload:{drawId:w,structureId:y,drawPosition:I},willDisableLinks:s,method:iT,type:dT,availableParticipantIds:R,participantsAvailable:E})),{validAssignmentActions:T}}if(P.includes(I)||g){var A,E;if(null==a?void 0:a.length){var C=a.filter((function(e){return null==i?void 0:i.includes(e.participantId)}));C.sort(wT),A=C.map((function(e){return e.participantId}))}else A=u;(null==(E=v?null==c?void 0:c.filter((function(e){return A.includes(e.participantId)})).map((function(e){return Ui(e,void 0,!0)})):void 0)?void 0:E.length)&&T.push(xn({payload:{drawId:w,structureId:y,drawPosition:I},willDisableLinks:s,method:iT,type:dT,availableParticipantIds:A,participantsAvailable:E}))}return{validAssignmentActions:T}}({positionSourceStructureIds:O,unassignedParticipantIds:Q,possiblyDisablingAction:L,isWinRatioFedStructure:F,tournamentParticipants:I,positionAssignments:q,returnParticipants:p,appliedPolicies:N,drawDefinition:m,isByePosition:$,drawPosition:h,structureId:w,event:g}).validAssignmentActions;null==te||te.forEach((function(e){return B.push(e)}))}if(AT({policyActions:_,action:sT})){te=function(e){var t,r,n,i,s,l,c,d,p=e.drawPositionInitialRounds,v=e.tournamentParticipants,f=e.positionAssignments,m=e.returnParticipants,h=e.appliedPolicies,g=e.drawDefinition,I=e.drawPosition,y=e.structureId,U=e.drawId,S=[],w=[],T=[],P=[],D=f.map((function(e){return e.participantId})).filter(Boolean),b=null==h?void 0:h[Ea],N=!(null==b?void 0:b.disableRoundRestrictions)&&p[I],M=null==b?void 0:b.requireCompletedStructures,R=Zw({targetRoundNumber:N,linkType:Pu,drawDefinition:g,structureId:y})||{},A=R.sourceStructureIds,E=R.relevantLinks;(null==A?void 0:A.length)&&P.push.apply(P,u([],o(A),!1));var C=Zw({targetRoundNumber:N,linkType:Tu,drawDefinition:g,structureId:y})||{},x=C.sourceStructureIds,O=C.relevantLinks;(null==x?void 0:x.length)&&P.push.apply(P,u([],o(x),!1));var F=function(e){var t,r,n=null===(s=g.structures)||void 0===s?void 0:s.find((function(t){return t.structureId===e.source.structureId}));if((null==n?void 0:n.stage)!==au)return"continue";var i=uh({structureId:e.source.structureId,drawDefinition:g});if(!M||i){var o=mp({matchUpFilters:{roundNumbers:[n.qualifyingRoundNumber],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:v,inContext:!0,structure:n}).matchUps,u=function(e){var t=e.sides.find((function(t){return(null==t?void 0:t.sideNumber)===e.winningSide})),r=e.matchUpStatus===Fo&&(null===(l=e.sides)||void 0===l?void 0:l.find((function(e){return e.participantId})));if(t||r){var n=t||r||{},i=n.participantId,a=n.participant;i&&!D.includes(i)&&(a&&m&&S.push(a),w.push(i))}};try{for(var c=(t=void 0,a(o)),d=c.next();!d.done;d=c.next())u(d.value)}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}}};try{for(var k=a(E),_=k.next();!_.done;_=k.next())F(_.value)}catch(e){t={error:e}}finally{try{_&&!_.done&&(r=k.return)&&r.call(k)}finally{if(t)throw t.error}}var L=function(e){var t=null===(c=g.structures)||void 0===c?void 0:c.find((function(t){return t.structureId===e.source.structureId}));if((null==t?void 0:t.stage)!==au)return"continue";var r=uh({structureId:e.source.structureId,drawDefinition:g});if(!M||r){var n=ss({structure:t}).positionAssignments,i=null!==(d=null==n?void 0:n.map((function(e){var t,r=e.participantId,n=null===(t=Vn({element:e,name:yo}).extension)||void 0===t?void 0:t.value;return n?{participantId:r,groupOrder:null==n?void 0:n.groupOrder}:{}})).filter((function(e){var t=e.groupOrder,r=e.participantId;return 1===t&&!D.includes(r)})).map((function(e){return e.participantId})))&&void 0!==d?d:[];if(i&&w.push.apply(w,u([],o(i),!1)),m){var a=v.filter((function(e){var t=e.participantId;return i.includes(t)}));S.push.apply(S,u([],o(a),!1))}}};try{for(var j=a(O),B=j.next();!B.done;B=j.next())L(B.value)}catch(e){n={error:e}}finally{try{B&&!B.done&&(i=j.return)&&i.call(j)}finally{if(n)throw n.error}}return w.length&&T.push(xn({payload:{qualifyingParticipantId:void 0,drawPosition:I,structureId:y,drawId:U},method:Qw,type:sT,qualifyingParticipantIds:w,qualifyingParticipants:m?S:void 0})),{validAssignmentActions:T,sourceStructureIds:P}}({drawPositionInitialRounds:T,tournamentParticipants:I,positionAssignments:q,returnParticipants:p,appliedPolicies:N,drawDefinition:m,drawPosition:h,structureId:w,drawId:j}).validAssignmentActions;null==te||te.forEach((function(e){return B.push(e)}))}var re=(W||{}).participantId,ne=re&&I.find((function(e){return e.participantId===re}));if(W){AT({policyActions:_,action:pT})&&!ee&&(B.push({type:pT,method:tT,payload:{drawId:j,structureId:w,drawPosition:h},willDisableLinks:L}),$||B.push({type:cT,method:"withdrawParticipantAtDrawPosition",payload:{drawId:j,structureId:w,drawPosition:h},willDisableLinks:L}),AT({policyActions:_,action:yT})&&!$&&B.push({type:yT,method:tT,payload:{drawId:j,structureId:w,drawPosition:h,replaceWithBye:!0},willDisableLinks:L}));var ie=S.stage===au||S.stage===iu&&1===S.stageSequence;if(!$&&MT({activePositionOverrides:x,activeDrawPositions:D,action:gT})&&AT({policyActions:_,action:gT})&&Zf({drawDefinition:m,structureId:w,drawPosition:h})&&ie){var ae=null!==(s=null==(ce=ql({returnAllProxies:!0,drawDefinition:m,structure:S}).seedAssignments)?void 0:ce.find((function(e){return e.participantId===re})))&&void 0!==s?s:{},se=ae.seedNumber,le=ae.seedValue;B.push({type:gT,method:"modifySeedAssignment",participant:ne,seedNumber:se,payload:{drawId:j,structureId:w,participantId:re,seedValue:le}})}if(!$&&MT({activePositionOverrides:x,activeDrawPositions:D,action:fT})&&AT({policyActions:_,action:fT})&&Zf({drawDefinition:m,structureId:w,drawPosition:h})&&ie){var ce;se=(null!==(l=null==(ce=ql({returnAllProxies:!0,drawDefinition:m,structure:S}).seedAssignments)?void 0:ce.find((function(e){return e.participantId===re})))&&void 0!==l?l:{}).seedNumber;B.push({method:"removeSeededParticipant",type:fT,participant:ne,seedNumber:se,payload:{participantId:re,structureId:w,drawId:j}})}if(!$&&re){if(AT({policyActions:_,action:IT})){var de={type:IT,method:oT,participant:ne,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:j}};B.push(de)}if(AT({policyActions:_,action:hT})){var pe={type:hT,method:"modifyParticipantOtherName",participant:ne,payload:{participantId:re,otherName:void 0}};B.push(pe)}}if(AT({policyActions:_,action:mT})){var ve=TT({possiblyDisablingAction:L,tournamentParticipants:I,inactiveDrawPositions:P,activeDrawPositions:D,positionAssignments:q,returnParticipants:p,byeDrawPositions:b,drawDefinition:m,isByePosition:$,drawPosition:h,structureId:w,structure:S,drawId:j}).validSwapAction;ve&&B.push(ve)}}if(AT({policyActions:_,action:lT})&&!k){var fe=function(e){var t,r,n,i,a,s,l=e.tournamentParticipants,c=void 0===l?[]:l,d=e.possiblyDisablingAction,p=e.activeDrawPositions,v=e.positionAssignments,f=e.returnParticipants,m=e.appliedPolicies,h=e.drawDefinition,g=e.drawPosition,I=e.validActions,y=e.structureId,S=e.structure,w=e.drawId,T=e.event;if(p.includes(g))return{};var P=null===(t=I.find((function(e){return e.type===dT})))||void 0===t?void 0:t.availableParticipantIds,D=null===(r=null==m?void 0:m[Ea])||void 0===r?void 0:r.otherFlightEntries,b=null===(n=null==m?void 0:m[Ea])||void 0===n?void 0:n.restrictQualifyingAlternates,N=(null!==(i=h.entries)&&void 0!==i?i:[]).filter((function(e){var t=e.entryStage;return!b||(S.stage===au?t===au:t!==au)})).sort((function(e,t){var r,n;return(null!==(r=e.entryPosition)&&void 0!==r?r:1/0)-(null!==(n=t.entryPosition)&&void 0!==n?n:1/0)})).map((function(e){return e.participantId})).filter(Boolean),M=us({drawDefinition:h}).allPositionedParticipantIds,R=v.map((function(e){return e.participantId})).filter(Boolean),A=N.filter((function(e){return S.stage&&[au,iu,su].includes(S.stage)?!(null==M?void 0:M.includes(e)):!R.includes(e)})),E=(null!==(a=null==T?void 0:T.entries)&&void 0!==a?a:[]).filter((function(e){return e.entryStatus===Sl&&ST({restrictQualifyingAlternates:b,structure:S,entry:e})&&(S.stage&&[au,iu,su].includes(S.stage)?!(null==M?void 0:M.includes(e.participantId)):!R.includes(e.participantId))})).sort((function(e,t){var r,n;return(null!==(r=e.entryPosition)&&void 0!==r?r:1/0)-(null!==(n=t.entryPosition)&&void 0!==n?n:1/0)})).map((function(e){return e.participantId})),C=U(A.concat(E));if(D){var x=T?_d({event:T}).flightProfile:void 0,O=null===(s=null==x?void 0:x.flights)||void 0===s?void 0:s.filter((function(e){return e.drawId!==w})).map((function(e){return e.drawEntries.filter((function(e){return e.participantId&&![xl,Al,El].includes(e.entryStatus)&&!N.includes(e.participantId)})).map((function(e){return e.participantId}))})).flat().filter(Boolean);(null==O?void 0:O.length)&&C.push.apply(C,u([],o(O),!1))}(null==P?void 0:P.length)&&(C=C.filter((function(e){return!P.includes(e)})));var F=f?null==c?void 0:c.filter((function(e){return C.includes(e.participantId)})):void 0;return null==F||F.forEach((function(e){var t,r=(null!==(t=h.entries)&&void 0!==t?t:[]).find((function(t){return t.participantId===e.participantId}));e.entryPosition=null==r?void 0:r.entryPosition})),null==F||F.sort((function(e,t){return(e.entryPosition||1/0)-(t.entryPosition||1/0)})),C.length?{validAlternatesAction:xn({payload:{drawId:w,structureId:y,drawPosition:g},willDisableLinks:d,method:$w,availableAlternatesParticipantIds:C,type:lT,availableAlternates:F})}:{}}({possiblyDisablingAction:L,tournamentParticipants:I,positionAssignments:q,activeDrawPositions:D,returnParticipants:p,appliedPolicies:N,drawDefinition:m,drawPosition:h,validActions:B,structureId:w,structure:S,drawId:j,event:g}).validAlternatesAction;fe&&B.push(fe)}if(AT({policyActions:_,action:vT})&&!k&&q){var me=function(e){var t,r,n,i,o,u,s,l,c=e.tournamentParticipants,d=void 0===c?[]:c,p=e.sourceStructuresComplete,v=e.possiblyDisablingAction,f=e.isWinRatioFedStructure,m=e.activeDrawPositions,h=e.positionAssignments,g=e.drawDefinition,I=e.drawPosition,y=e.structureId,U=e.structure,S=e.drawId,w=e.event;if(m.includes(I)||f&&!p)return{};var T=(null===(n=g.links)||void 0===n?void 0:n.reduce((function(e,t){var r,n,i=null===(r=t.source)||void 0===r?void 0:r.structureId,a=null===(n=t.target)||void 0===n?void 0:n.structureId;return e.sourceStructureIds.includes(i)||e.sourceStructureIds.push(i),e.targetStructureIds.includes(a)||e.targetStructureIds.push(a),e}),{sourceStructureIds:[],targetStructureIds:[]}))||{},P=T.sourceStructureIds,D=T.targetStructureIds,b=[],N=null!==(o=null===(i=g.links)||void 0===i?void 0:i.filter((function(e){var t;return(null===(t=e.target)||void 0===t?void 0:t.structureId)===U.structureId})))&&void 0!==o?o:[],M=function(e){var t=null===(u=null==e?void 0:e.source)||void 0===u?void 0:u.structureId,r=as({structureId:t,drawDefinition:g}).structure,n={};if((null==r?void 0:r.finishingPosition)===es&&(1!==(null==P?void 0:P.length)||1!==(null==D?void 0:D.length))){var i=mp({drawDefinition:g,structure:U,event:w}).matchUps,a=$p({drawPosition:I,matchUps:i}).initialRoundNumber,o=null===(s=g.links)||void 0===s?void 0:s.find((function(e){var t;return(null===(t=e.target)||void 0===t?void 0:t.structureId)===(null==U?void 0:U.structureId)&&e.target.roundNumber===a})),c=null===(l=null==o?void 0:o.source)||void 0===l?void 0:l.roundNumber;n.roundNumbers=[c]}var d=gp({structureId:t,inContext:!0,matchUpFilters:n,drawDefinition:g}).completedMatchUps,p=h.map((function(e){return e.participantId})).filter(Boolean),v=null==d?void 0:d.filter((function(e){var t=e.matchUpType;return e.winningSide&&((null==w?void 0:w.eventType)!==ga||t===ga)})).map((function(e){var t=e.winningSide,r=e.sides;return t&&(null==r?void 0:r[1-(t-1)])})).map(Ri("participantId")).filter((function(e){return e&&!p.includes(e)}));null==v||v.forEach((function(e){b.includes(e)||b.push(e)}))};try{for(var R=a(N),A=R.next();!A.done;A=R.next())M(A.value)}catch(e){t={error:e}}finally{try{A&&!A.done&&(r=R.return)&&r.call(R)}finally{if(t)throw t.error}}var E=null==d?void 0:d.filter((function(e){return null==b?void 0:b.includes(e.participantId)}));return null==E||E.forEach((function(e){var t,r=(null!==(t=g.entries)&&void 0!==t?t:[]).find((function(t){return t.participantId===e.participantId}));e.entryPosition=null==r?void 0:r.entryPosition})),(null==b?void 0:b.length)?{validLuckyLosersAction:{type:vT,method:eT,availableLuckyLosers:E,availableLuckyLoserParticipantIds:b,willDisableLinks:v,payload:{drawId:S,structureId:y,drawPosition:I}}}:{}}({sourceStructuresComplete:M,possiblyDisablingAction:L,isWinRatioFedStructure:F,tournamentParticipants:I,activeDrawPositions:D,positionAssignments:q,drawDefinition:m,drawPosition:h,structureId:w,structure:S,drawId:j}).validLuckyLosersAction;me&&B.push(me)}if((null==ne?void 0:ne.participantType)===hs&&AT({policyActions:_,action:uT})){var he=function(e){var t,r=e.tournamentParticipants,n=e.returnParticipants,i=e.drawPosition,a=e.participant,o=e.drawId,u=e.event,s=(null===(t=null==u?void 0:u.entries)||void 0===t?void 0:t.filter((function(e){var t=e.entryStatus;return[Al,El].includes(t)})).map((function(e){return e.participantId})))||[];if(s.length){var l=a.individualParticipantIds,c=n?r.filter((function(e){var t=e.participantId;return s.includes(t)})):void 0,d=n?r.filter((function(e){var t=e.participantId;return l.includes(t)})):void 0;return{validModifyAssignedPairAction:xn({payload:{participantId:a.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:o},method:nT,availableIndividualParticipantIds:s,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:d,type:uT},!1,!1,!0)}}return{}}({tournamentParticipants:I,returnParticipants:p,drawPosition:h,participant:ne,drawId:j,event:g}).validModifyAssignedPairAction;he&&B.push(he)}return{hasPositionAssigned:!!W,isActiveDrawPosition:ee,isDrawPosition:!0,isByePosition:$,validActions:B}},tallyParticipantResults:ig,tournamentMatchUps:Yw,validateCollectionDefinition:Hm,validateLineUp:nm,validMatchUp:Js,validMatchUps:Zs,allPlayoffPositionsFilled:function(e){var t,r,n,i=e.drawDefinition,a=e.structureId;if(!i)return{error:K};var o=ah({drawDefinition:i,structureId:a}).playoffStructures;if(!(null==o?void 0:o.length))return!1;var u=null!==(n=null===(r=null===(t=null==i?void 0:i.entries)||void 0===t?void 0:t.filter((function(e){return(null==e?void 0:e.entryStatus)&&_l.includes(e.entryStatus)})))||void 0===r?void 0:r.length)&&void 0!==n?n:0,s=0,l=(o||[]).reduce((function(e,t){var r,n=null!==(r=ss({structure:t}).positionAssignments)&&void 0!==r?r:[],i=null==n?void 0:n.filter((function(e){var t;return e.participantId&&s++,null!==(t=null==e?void 0:e.bye)&&void 0!==t?t:null==e?void 0:e.participantId})).length;return!(!i||!e)}),!!o.length);return l||s===u},getCategoryAgeDetails:Vm,calculateWinCriteria:Mm,compareTieFormats:Zm,getMatchUpContextIds:function(e){var t=e.matchUps,r=e.matchUpId;if(!Zs(t))return{error:xr};var n=t.find((function(e){return e.matchUpId===r}))||{},i=n.drawId,a=n.eventId,o=n.structureId,u=n.tournamentId;return{matchUpId:r,drawId:i,eventId:a,structureId:o,tournamentId:u}},getScaleValues:ba,getSeedingThresholds:function(e){var r=e.roundRobinGroupsCount,n=e.participantsCount;if(r){var i=qf({drawSize:n}).validGroupSizes,a=null==i?void 0:i.map((function(e){return Math.ceil(n/e)}));if(!(null==a?void 0:a.includes(r)))return On({context:{roundRobinGroupsCount:r},result:{error:xr}})}var s=Hf({drawSize:n,roundRobinGroupsCount:r}).seedGroups,l=(null==s?void 0:s.map((function(e){return Math.min.apply(Math,u([],o(e),!1))})))||[];return t(t({},L),{seedingThresholds:l})},getTimeItem:Ds,getValidGroupSizes:qf,isAdHoc:ip,isCompletedStructure:uh,roundRobinGroups:Vf,tieFormatGenderValidityCheck:Lm,validateCategory:Gm};function uP(e){var t,r,n,i,a,o,u=e.participant,s=e.eventType,l=null===(t=null==u?void 0:u.person)||void 0===t?void 0:t.personId,c=null===(n=null===(r=null==u?void 0:u.person)||void 0===r?void 0:r.personOtherIds)||void 0===n?void 0:n[0],d=null===(i=null==u?void 0:u.person)||void 0===i?void 0:i.tennisId,p=null===(o=null===(a=null==u?void 0:u.ratings)||void 0===a?void 0:a[s])||void 0===o?void 0:o.find((function(e){return e.scaleName===zI})),v=(null==p?void 0:p.scaleValue)||{},f=v.wtnRating,m=v.confidence;return{timeStamp:null==p?void 0:p.scaleDate,personOtherId:c,confidence:m,wtnRating:f,personId:l,tennisId:d}}function sP(e){var t=e.eventType,r=e.matchUps,n=e.eventId,i=e.drawId,a={},o=r.filter((function(e){return n?e.eventId===n:e.drawId===i})).reduce((function(e,t){var r,n,i;return(i=null==(n=t)?void 0:n.matchUpFormat)&&(a[i]||(a[i]=0),a[i]+=1),(null!==(r=t.sides)&&void 0!==r?r:[]).flatMap((function(e){var t;return((null===(t=null==e?void 0:e.participant)||void 0===t?void 0:t.individualParticipants)||[null==e?void 0:e.participant]).filter(Boolean)})).forEach((function(t){return e[t.participantId]=t})),e}),{}),u=Object.values(o),s=u.map((function(e){return uP({participant:e,eventType:t})})).filter((function(e){return e.wtnRating})),l=(u.length-s.length)/u.length*100,c=s.reduce((function(e,t){var r=t.wtnRating,n=t.confidence;return e.totalWTN+=r,e.totalConfidence+=n,e}),{totalWTN:0,totalConfidence:0}),d=(null==s?void 0:s.length)?c.totalWTN/s.length:0,p=(null==s?void 0:s.length)?c.totalConfidence/s.length:0,v=Object.values(a).reduce((function(e,t){return e+(t||0)}),0);return{matchUpFormatCounts:a,matchUpsCount:v,avgConfidence:p,pctNoRating:l,avgWTN:d}}var lP={getStructureReports:function(e){var r,n,i=e.firstFlightOnly,a=void 0===i||i,s=e.extensionProfiles,l=e.tournamentRecord;if(!l)return{error:z};var c={},d=Object.assign.apply(Object,u([{}],o((null!=s?s:[]).map((function(e){var t,r,n,i,a=e.name,o=e.label,u=e.accessor,s=null===(n=null===(r=Vn({element:l,name:a}))||void 0===r?void 0:r.extension)||void 0===n?void 0:n.value,c=u?null===(i=wi({element:s,accessor:u}))||void 0===i?void 0:i.value:s;return(t={})[o||a]=c,t}))),!1)),p=null==l?void 0:l.tournamentId,v=null!==(r=Kp({participantsProfile:{withScaleValues:!0},tournamentRecord:l}).matchUps)&&void 0!==r?r:[],f=function(e){var t,r,n=null===(t=Ds({itemType:id,itemSubTypes:[Pa],element:{timeItems:e}}))||void 0===t?void 0:t.timeItem;return null===(r=null==n?void 0:n.itemValue)||void 0===r?void 0:r.scaleBasis},m=null===(n=null==l?void 0:l.events)||void 0===n?void 0:n.flatMap((function(e){var r,n,i,s,l=e.timeItems,m=e.drawDefinitions,h=void 0===m?[]:m,g=e.extensions,I=e.eventType,y=e.eventId,U=e.category,S=null==g?void 0:g.find((function(e){return e.name===ao})),w=null===(n=null===(r=null==S?void 0:S.value)||void 0===r?void 0:r.flights)||void 0===n?void 0:n.map((function(e){var t;return(t={})[e.drawId]=e.flightNumber,t})),T=w&&Object.assign.apply(Object,u([{}],o(w),!1)),P=(null===(s=null===(i=null==g?void 0:g.find((function(e){return e.name===no})))||void 0===i?void 0:i.value)||void 0===s?void 0:s.length)||0,D=Object.values(T),b=T&&Math.min.apply(Math,u([],o(D),!1)),N=f(l);return c[y]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:P,seedingBasis:N?JSON.stringify(N):void 0,tournamentId:p,eventId:y},h.filter((function(e){return!a||!w||T[e.drawId]===b})).flatMap((function(e){var r=e.matchUpFormat,n=e.tieFormat,i=e.timeItems,a=e.extensions,o=e.structures,u=e.drawType,s=e.drawId,l=sP({eventType:I,matchUps:v,drawId:s}),m=l.matchUpFormatCounts,h=l.matchUpsCount,g=l.avgConfidence,S=l.pctNoRating,w=l.avgWTN,P=f(i)||N,D=function(e){var t,r,n=e.extensions;return null===(r=null===(t=null==n?void 0:n.find((function(e){return e.name===Xa})))||void 0===t?void 0:t.value)||void 0===r?void 0:r.slice(1)}({extensions:a}),b=(null==D?void 0:D.length)||0;return c[y].totalPositionManipulations+=b,c[y].generatedDrawsCount+=1,b>c[y].maxPositionManipulations&&(c[y].maxPositionManipulations=b),null==o?void 0:o.filter((function(e){return 1===e.stageSequence&&[au,iu,ou,su].includes(e.stage)})).map((function(e){var i,a,o=[iu,su].includes(e.stage)?v.find((function(t){return t.structureId===e.structureId&&1===t.finishingRound&&t.winningSide})):void 0,l=null===(i=null==o?void 0:o.sides)||void 0===i?void 0:i.find((function(e){return e.sideNumber===o.winningSide})),c=null==l?void 0:l.participant,f=(null==c?void 0:c.participantType)===vs&&c.participantId,b=(null==c?void 0:c.participantType)===hs?c.individualParticipants:[],N=uP({participant:(null==b?void 0:b[0])||c,eventType:I})||{},M=N.personId,R=N.personOtherId,A=N.tennisId,E=N.confidence,C=N.wtnRating,x=uP({participant:null==b?void 0:b[1],eventType:I})||{},O=x.personId,F=x.personOtherId,k=x.tennisId,_=x.confidence,L=x.wtnRating,j=null!=U?U:{},B=j.ageCategoryCode,V=j.categoryName,G=j.subType,q=e.matchUpFormat||r,W=(m[q]||0)/h*100,H=Jm(n),z=H.tieFormatName,Y=H.tieFormatDesc,K=Jm(e.tieFormat),J=K.tieFormatName,Z=K.tieFormatDesc,X=Y===Z,Q=!X&&J,$=e.tieFormat&&!X&&Z,ee=(null===(a=null==D?void 0:D.filter((function(t){return t.structureId===e.structureId})))||void 0===a?void 0:a.length)||0;return t(t({},d),{tournamentId:p,eventId:y,structureId:e.structureId,drawId:s,eventType:I,category:G,categoryName:V,ageCategoryCode:B,flightNumber:T[s],drawType:u,stage:e.stage,seedingBasis:P?JSON.stringify(P):void 0,winningPersonId:M,winningPersonOtherId:R,winningPersonTennisId:A,winningPersonWTNrating:C,winningPersonWTNconfidence:E,winningPerson2Id:O,winningPerson2OtherId:F,winningPerson2TennisId:k,winningPerson2WTNrating:L,winningPerson2WTNconfidence:_,winningTeamId:f,positionManipulations:ee,pctNoRating:S,matchUpFormat:q,pctInitialMatchUpFormat:W,matchUpsCount:h,drawTieFormatName:z,drawTieFormatDesc:Y,tieFormatName:Q,tieFormatDesc:$,avgConfidence:g,avgWTN:w})}))}))}));return{eventStructureReports:Object.values(c),structureReports:m}},getEntryStatusReports:function(e){var r,n,i,s,l=e.tournamentRecord;if(!l)return{error:W};var c=l.tournamentId,d=Rv({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:l,withDraws:!0}).participantMap,p=(null!==(i=Kp({matchUpFilters:{matchUpTypes:[As,Cs]},tournamentRecord:l}).matchUps)&&void 0!==i?i:[]).flatMap((function(e){var t=e.sides,r=e.matchUpType;return null==t?void 0:t.flatMap((function(e){var t,n;return r===Cs?null===(t=null==e?void 0:e.participant)||void 0===t?void 0:t.individualParticipantIds:(null===(n=null==e?void 0:e.participant)||void 0===n?void 0:n.participantId)||e.participantId})).filter(Boolean)})).filter(Boolean),v=[],f={},m={},h={},g=0,I=function(e){var r,n,i=e.id,a=e.entry,o=e.eventId,u=e.eventType,s=a.qualifyingSeeding,l=a.mainSeeding,p=a.entryStatus,m=a.entryStage,h=a.drawId;f[i]||(f[i]=[]);var g=null!==(r=null==d?void 0:d[i])&&void 0!==r?r:{},I=g.participant,y=g.events,U=uP({participant:I,eventType:u}),S=null===(n=null==y?void 0:y[o])||void 0===n?void 0:n.ranking;p===cT&&v.push(i),f[i].push(t(t({participantType:null==I?void 0:I.participantType,participantId:i,tournamentId:c,eventType:u,eventId:o,drawId:h,entryStatus:p,entryStage:m},U),{ranking:S,mainSeeding:l,qualifyingSeeding:s}))},y=function(e){var r,n={},i=e.drawDefinitions,a=void 0===i?[]:i,s=e.eventType,l=e.eventId,v=a.flatMap((function(e){var t,r=e.drawId,i=e.entries;g+=1;var a=(null!==(t=e.structures)&&void 0!==t?t:[]).filter((function(e){var t=e.stage,r=e.stageSequence;return t===iu&&1===r||t===au})).flatMap((function(e){return e.positionAssignments})).filter(Boolean).map((function(e){return e.participantId}));return null==i?void 0:i.filter((function(e){var t=e.participantId;return a.includes(t)})).map((function(e){var t,i,a,o,u,s,l,c,p=e.participantId,v=e.entryStatus,f=e.entryStage;!function(e){n[e]||(n[e]={count:0}),n[e].count+=1}(v);var m=null===(o=null===(a=null===(i=null===(t=null==d?void 0:d[p])||void 0===t?void 0:t.draws)||void 0===i?void 0:i[r])||void 0===a?void 0:a.seedAssignments)||void 0===o?void 0:o[iu];return{qualifyingSeeding:null===(c=null===(l=null===(s=null===(u=null==d?void 0:d[p])||void 0===u?void 0:u.draws)||void 0===s?void 0:s[r])||void 0===l?void 0:l.seedAssignments)||void 0===c?void 0:c[au],participantId:p,mainSeeding:m,entryStatus:v,entryStage:f,drawId:r}}))})),f=function(e){var t,r,n=e.participantId,i=null===(r=null==d?void 0:d[n].participant.individualParticipantIds)||void 0===r?void 0:r.filter((function(e){return p.includes(e)}));return n&&((t={})[n]={individualParticipantIds:i},t)};s===ha?(r=Object.assign.apply(Object,u([{}],o(v.map(f).filter(Boolean)),!1)),v.forEach((function(e){r[e.participantId].individualParticipantIds.forEach((function(t){I({id:t,eventType:s,eventId:l,entry:e})}))}))):v.forEach((function(e){I({id:null==e?void 0:e.participantId,eventType:s,eventId:l,entry:e})}));var y=Object.values(n).reduce((function(e,t){return e+t.count}),0);Object.keys(n).forEach((function(e){n[e].pct=n[e].count/y*100})),h[l]={tournamentId:c,eventId:l,entries:v,entryStatuses:n};var U=Object.assign.apply(Object,u([{}],o(_l.flatMap((function(e){var t,r,i,a;return[(t={},t[e+"_count"]=null===(i=n[e])||void 0===i?void 0:i.count,t),(r={},r[e+"_pct"]=null===(a=n[e])||void 0===a?void 0:a.pct,r)]}))),!1));m[l]=t({tournamentId:c,eventId:l},U)};try{for(var U=a(null!==(s=l.events)&&void 0!==s?s:[]),S=U.next();!S.done;S=U.next()){y(S.value)}}catch(e){r={error:e}}finally{try{S&&!S.done&&(n=U.return)&&n.call(U)}finally{if(r)throw r.error}}var w=Object.values(null!=d?d:{}).filter((function(e){var t=e.participant,r=t.participantType,n=t.participantRole;return r===fs&&n===Vv})),T=w.filter((function(e){var t=e.participant;return!p.includes(t.participantId)})).map((function(e){return e.participant.participantId})),P={nonParticipatingEntriesCount:T.length,individualParticipantsCount:w.length,eventsCount:Object.values(h).length,nonParticipatingParticipantIds:T,drawDefinitionsCount:g,tournamentId:c};return{entryStatusReports:Object.values(m).flat(),participantEntryReports:Object.values(f).flat(),eventReports:Object.values(h).flat(),withDrawnParticipantIds:v,tournamentEntryReport:P}},getParticipantStats:function(e){var r,n,i,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D=e.withCompetitiveProfiles,b=e.opponentParticipantId,N=e.withIndividualStats,M=e.teamParticipantId,R=e.tournamentRecord,A=e.withScaleValues,C=e.tallyPolicy,x=e.matchUps;if(!R)return{error:W};if(x&&!Array.isArray(x))return{error:tt};if(!(null==(x=null!=x?x:Kp({tournamentRecord:R,participantsProfile:A?{withScaleValues:A}:void 0}).matchUps)?void 0:x.length))return{error:$e};var O=[];b&&O.push(b),M&&O.push(M);var F=null!==(y=Rv({participantFilters:O.length?{participantIds:O}:{participantTypes:[vs]},tournamentRecord:R}).participants)&&void 0!==y?y:[];if(!F.every((function(e){return e.participantType===vs})))return{error:Et};O.length||O.push.apply(O,u([],o(F.map(Ri("participantId"))),!1));var k=new Map,_=new Map,j=new Map,B=new Map,V=function(e,t){return void 0===t&&(t=""),_.get(e)||_.set(e,{participantName:t,participantId:e,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&_.get(e)};try{for(var G=a(F),q=G.next();!q.done;q=G.next()){var H=q.value,z=H.participantId,Y=H.individualParticipantIds;B.set(z,null!=Y?Y:[]),V(z,H.participantName)}}catch(e){r={error:e}}finally{try{q&&!q.done&&(n=G.return)&&n.call(G)}finally{if(r)throw r.error}}if(M&&!B.get(M))return On({result:{error:Lt},context:{teamParticipantId:M}});if(b&&!B.get(b))return On({result:{error:Lt},context:{opponentParticipantId:b}});var K=[],J=function(e){if(!Di(e))return{value:{error:tt}};var t=e.matchUpStatus,r=e.matchUpFormat,n=e.matchUpType,i=e.winningSide,s=e.score,l=e.sides;if(!l||!s||n===Os||t===Fo)return"continue";var c=function(e){var t,r,n,i,s,l,c=[[],[]];try{for(var d=a(e),p=d.next();!p.done;p=d.next()){var v=(T=p.value).participant;if(null==v?void 0:v.participantName){k.set(v.participantId,{participantName:v.participantName,ratings:v.ratings});var f=_.get(v.participantId);f&&(f.participantName=v.participantName)}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}var m=function(e){var t,r,n,i,a,o=e.side,u=e.individualParticipantIds;return o.participantId&&(!(null==u?void 0:u.length)||u.includes(o.participantId))&&[o.participantId]||(null===(r=null===(t=o.participant)||void 0===t?void 0:t.individualParticipantIds)||void 0===r?void 0:r.length)&&(!(null==u?void 0:u.length)||E(u,null===(n=o.participant)||void 0===n?void 0:n.individualParticipantIds).length===(null===(a=null===(i=o.participant)||void 0===i?void 0:i.individualParticipantIds)||void 0===a?void 0:a.length))&&o.participant.individualParticipantIds};if(B.size){var h=function(t,r){var n,i,s,l;try{for(var d=a(e),p=d.next();!p.done;p=d.next()){var v=p.value;if(v.participant){var f=m({individualParticipantIds:r,side:v});if(null==f?void 0:f.length){var h=v.sideNumber;if(!h)continue;var g=[t];N&&g.push.apply(g,u([],o(f),!1)),c[h-1]=g;var I=_.get(t);try{for(var y=(s=void 0,a(f.filter(Boolean))),U=y.next();!U.done;U=y.next()){var S=U.value;I&&!I.competitorIds.includes(S)&&I.competitorIds.push(S)}}catch(e){s={error:e}}finally{try{U&&!U.done&&(l=y.return)&&l.call(y)}finally{if(s)throw s.error}}}}}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}};if(M){var g=!b||e.every((function(e){return e.participant&&(m({individualParticipantIds:B.get(M),side:e})||m({individualParticipantIds:B.get(b),side:e}))}));g&&h(M,B.get(M))}else try{for(var I=a(B),y=I.next();!y.done;y=I.next()){var U=o(y.value,2);h(U[0],U[1])}}catch(e){n={error:e}}finally{try{y&&!y.done&&(i=I.return)&&i.call(I)}finally{if(n)throw n.error}}}else if(N)try{for(var S=a(e),w=S.next();!w.done;w=S.next()){var T;if((T=w.value).participant){var P=m({individualParticipantIds:[],side:T}),D=T.sideNumber;D&&(c[D-1]=P)}}}catch(e){s={error:e}}finally{try{w&&!w.done&&(l=S.return)&&l.call(S)}finally{if(s)throw s.error}}return c}(l);if(!c.filter(Boolean).length)return"continue";var d=D&&i&&(null===(U=Zl({matchUp:e}))||void 0===U?void 0:U.competitiveness);K.push(e);var p=Lh({matchUpStatus:t,matchUpFormat:r,tallyPolicy:C,winningSide:i,score:s}),v=jh({matchUpStatus:t,matchUpFormat:r,tallyPolicy:C,winningSide:i,score:s}),f=Bh({matchUpFormat:r,score:s}),m=f.pointsTally,h=f.tiebreaksTally;c.forEach((function(e,r){var n,s,l,c=function(e){var n=null===(l=k.get(e))||void 0===l?void 0:l.participantName,a=V(e,n);if(a){var s=function(e,t){return t.forEach((function(t,r){return a[e][r]+=t}))},c=r?u([],o(h),!1).reverse():h,f=r?u([],o(m),!1).reverse():m,g=r?u([],o(v),!1).reverse():v,I=r?u([],o(p),!1).reverse():p;if(s("tiebreaks",c),s("points",f),s("games",g),s("sets",I),i){var y=i-1===r?0:1;a.matchUps[y]+=1}if(d){var U=d.toLowerCase();a.competitiveness[U]||(a.competitiveness[U]=[0,0]),a.competitiveness[U][r]+=1}if(t){U=t.toLowerCase();a.matchUpStatuses[U]||(a.matchUpStatuses[U]=0),a.matchUpStatuses[U]+=1}}};try{for(var f=(n=void 0,a(e)),g=f.next();!g.done;g=f.next()){c(g.value)}}catch(e){n={error:e}}finally{try{g&&!g.done&&(s=f.return)&&s.call(f)}finally{if(n)throw n.error}}}))};try{for(var Z=a(x),X=Z.next();!X.done;X=Z.next()){var Q=J(X.value);if("object"==typeof Q)return Q.value}}catch(e){i={error:e}}finally{try{X&&!X.done&&(s=Z.return)&&s.call(Z)}finally{if(i)throw i.error}}var $=["tiebreaks","matchUps","points","games","sets"],ee=["competitive","routine","decisive"],te=new Map,re=function(e,t){return(null!=e?e:0)+(null!=t?t:0)};try{for(var ne=a(_.entries()),ie=ne.next();!ie.done;ie=ne.next()){var ae=o(ie.value,2),oe=(z=ae[0],ae[1]);try{for(var ue=(d=void 0,a($)),se=ue.next();!se.done;se=ue.next()){if(fe=oe[me=se.value].reduce(re)){var le=oe[me][0]/fe,ce="".concat(me,"Ratio"),de=parseFloat(le.toFixed(2));oe[ce]=de,j.set(z,!0),te.has(ce)||te.set(ce,[]),null===(S=te.get(ce))||void 0===S||S.push(de)}}}catch(e){d={error:e}}finally{try{se&&!se.done&&(p=ue.return)&&p.call(ue)}finally{if(d)throw d.error}}try{for(var pe=(v=void 0,a(ee)),ve=pe.next();!ve.done;ve=pe.next()){var fe,me=ve.value;if(fe=null===(T=null===(w=oe.competitiveness)||void 0===w?void 0:w[me])||void 0===T?void 0:T.reduce(re)){le=oe.competitiveness[me][0]/fe,ce="".concat(me,"Ratio"),de=parseFloat(le.toFixed(2));oe[ce]=de}}}catch(e){v={error:e}}finally{try{ve&&!ve.done&&(f=pe.return)&&f.call(pe)}finally{if(v)throw v.error}}}}catch(e){l={error:e}}finally{try{ie&&!ie.done&&(c=ne.return)&&c.call(ne)}finally{if(l)throw l.error}}if(!M){var he=function(e,t){return t-e};try{for(var ge=a(_.values()),Ie=ge.next();!Ie.done;Ie=ge.next()){oe=Ie.value;try{for(var ye=(g=void 0,a($)),Ue=ye.next();!Ue.done;Ue=ye.next()){me=Ue.value;if("number"==typeof oe[ce="".concat(me,"Ratio")]){var Se=null===(P=te.get(ce))||void 0===P?void 0:P.sort(he).indexOf(oe[ce]);if("number"==typeof Se&&Se>=0)oe["".concat(me,"Rank")]=Se+1}}}catch(e){g={error:e}}finally{try{Ue&&!Ue.done&&(I=ye.return)&&I.call(ye)}finally{if(g)throw g.error}}}}catch(e){m={error:e}}finally{try{Ie&&!Ie.done&&(h=ge.return)&&h.call(ge)}finally{if(m)throw m.error}}}var we=t({relevantMatchUps:K},L);return M?(we.teamStats=_.get(M),b&&(we.opponentStats=_.get(b))):we.participatingTeamsCount=j.size,we.allParticipantStats=u([],o(_.values()),!1),we}};function cP(e){void 0===e&&(e=0);var t=new Date;return t.setHours(t.getHours()+e),t.getTime().toString(36).slice(-6).toUpperCase()}function dP(e){var t,r,n=e.personRequests,i=e.personId,o=e.requests;n[i]||(n[i]=[]);var u=o.filter((function(e){return e.requestType})).map((function(e){var t=e.date,r=e.startTime,n=e.endTime;return e.requestType===dS&&(t=ui(t),r=oi(r),n=oi(n),t&&r&&n)?{date:t,startTime:r,endTime:n,requestType:e.requestType}:e})).filter(Boolean);try{for(var s=a(u),l=s.next();!l.done;l=s.next()){var c=l.value;c.requestId=cP(),n[i].push(c)}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return{mergeCount:u.length}}function pP(e){var r,n,i,o,u,s,l=e.tournamentRecords,c=e.personRequests,d=da(e,[(r={},r[xi]=!0,r)]);if(d.error)return d;if(!c)return t({},L);var p=Object.values(l);try{for(var v=a(p),f=v.next();!f.done;f=v.next()){var m=f.value,h=null!==(s=m.participants)&&void 0!==s?s:[],g=[];try{for(var I=(o=void 0,a(Object.keys(c))),y=I.next();!y.done;y=I.next()){var U=y.value;if(Wa({tournamentParticipants:h,personId:U})){var S=c[U];S.length&&g.push({personId:U,requests:S})}}}catch(e){o={error:e}}finally{try{y&&!y.done&&(u=I.return)&&u.call(I)}finally{if(o)throw o.error}}if(Object.keys(g).length)jn({element:m,extension:{value:g,name:po}})}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}return t({},L)}function vP(e){var r,n,i=e.calculateStartTimeFromCourts,a=void 0===i||i,s=e.defaultRecoveryMinutes,l=void 0===s?0:s,c=e.averageMatchUpMinutes,d=void 0===c?90:c,p=e.remainingScheduleTimes,v=e.clearScheduleDates,f=e.tournamentRecords,m=e.periodLength,h=e.scheduleDate,g=e.startTime,I=e.venueIds,y=e.endTime;if("object"!=typeof f||!Object.keys(f).length)return{error:q};m=null!=m?m:jU({recoveryMinutes:l,averageMatchUpMinutes:d});var U=lf({dates:[h],ignoreDisabled:!0,tournamentRecords:f}),S=U.courts,w=U.venues,T=null==S?void 0:S.filter((function(e){return!I||I.includes(e.venueId)}));g||(g=null==T?void 0:T.reduce((function(e,t){var r,n,i=null===(r=t.dateAvailability)||void 0===r?void 0:r.find((function(e){return!e.date||Ii(h,e.date)})),a=null!==(n=null==i?void 0:i.startTime)&&void 0!==n?n:t.startTime;return a&&(!e||ii(a)<ii(e))?a:e}),void 0)),y||(y=null==T?void 0:T.reduce((function(e,t){var r,n,i=null===(r=t.dateAvailability)||void 0===r?void 0:r.find((function(e){return!e.date||Ii(h,e.date)})),a=null!==(n=null==i?void 0:i.endTime)&&void 0!==n?n:t.endTime;return a&&(!e||ii(a)>ii(e))?a:e}),void 0));var P=Object.values(f),D=Object.assign.apply(Object,u([{}],o(P.map((function(e){var t;return(null!==(t=e.events)&&void 0!==t?t:[]).map((function(t){var r,n=Ac({tournamentRecord:e,event:t}).scheduleTiming;return(r={})[t.eventId]={event:t,scheduleTiming:n},r}))})).flat()),!1)),b=Jw({sortDateMatchUps:!1,tournamentRecords:f,matchUpFilters:{scheduledDate:h,venueIds:I}}),N=null!==(r=null==b?void 0:b.dateMatchUps)&&void 0!==r?r:[],M=null!==(n=null==b?void 0:b.completedMatchUps)&&void 0!==n?n:[],R=[];R.push.apply(R,u([],o(N),!1)),R.push.apply(R,u([],o(M),!1));var A={averageTimes:[{minutes:{default:d}}],recoveryTimes:[{minutes:{default:l}}]},E=null==R?void 0:R.map((function(e){var r=e.eventId,n=e.schedule,i=e.matchUpFormat,a=D[r],o=a.event,u=a.scheduleTiming,s=Wc({eventType:null==o?void 0:o.eventType,timingDetails:t(t({},u),{defaultTiming:A,matchUpFormat:i})}),l=s.averageMinutes,c=s.recoveryMinutes,d=n.courtId,p=n.venueId,v=oi(n.scheduledTime),f=mi(v,l);return{recoveryMinutes:c,averageMinutes:l,periodLength:m,startTime:v,endTime:f,courtId:d,venueId:p}})),C=VU({calculateStartTimeFromCourts:a,remainingScheduleTimes:p,averageMatchUpMinutes:d,date:h,clearScheduleDates:v,periodLength:m,startTime:g,endTime:y,bookings:E,courts:T}).scheduleTimes;return{venueId:1===(null==I?void 0:I.length)&&I[0]||1===(null==w?void 0:w.length)&&w[0].venueId||void 0,scheduleTimes:C,dateScheduledMatchUpIds:R.map(Ro)}}function fP(e){var r,n,i,o,u,s=e.matchUpFormat,l=e.recoveryTimes,c=e.averageTimes,d=e.tournamentId,p=e.eventId,v=null!==(u=null!==(o=null==e?void 0:e.tournamentRecords)&&void 0!==o?o:(null==e?void 0:e.tournamentRecord)&&((r={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,r))&&void 0!==u?u:{};if(!Object.keys(v).length)return{error:q};var f,m=Object.keys(v).filter((function(e){return!d||d===e}));if(d&&!m.includes(d))return{error:xr};try{for(var h=a(m),g=h.next();!g.done;g=h.next()){var I=v[g.value],y=Ld({tournamentRecord:I,eventId:p}).event;p&&y&&(f=!0);var U=mP({tournamentRecord:I,event:y,matchUpFormat:s,averageTimes:c,recoveryTimes:l});if(U.error)return U}}catch(e){n={error:e}}finally{try{g&&!g.done&&(i=h.return)&&i.call(h)}finally{if(n)throw n.error}}return!p||f?t({},L):{error:Ee}}function mP(e){var r=e.tournamentRecord,n=e.recoveryTimes,i=e.matchUpFormat,a=e.averageTimes,o=e.event;if(!r)return{error:W};if(a&&!Array.isArray(a))return{error:xr};if(n&&!Array.isArray(n))return{error:xr};var u=ho;if(o){var s=(null==(l=Vn({element:o,name:u}).extension)?void 0:l.value)||{};jn({element:o,extension:{name:u,value:hP(t(t({},s),{matchUpFormat:i,averageTimes:a,recoveryTimes:n}))}})}else{var l,c=(null==(l=Vn({element:r,name:u}).extension)?void 0:l.value)||{};jn({extension:{name:u,value:hP(t(t({},c),{matchUpFormat:i,averageTimes:a,recoveryTimes:n}))},element:r})}return t({},L)}function hP(e){var r=e.matchUpRecoveryTimes,n=void 0===r?[]:r,i=e.matchUpAverageTimes,a=void 0===i?[]:i,o=e.matchUpFormat,u=e.averageTimes,s=e.recoveryTimes;u=(u||[]).filter((function(e){var t,r;return(null===(t=null==e?void 0:e.categoryNames)||void 0===t?void 0:t.length)||(null===(r=null==e?void 0:e.categoryTypes)||void 0===r?void 0:r.length)}));var l=(null==u?void 0:u.length)&&a.map((function(e){var r;return(null==e?void 0:e.matchUpFormatCodes.includes(o))?t(t({},e),{matchUpFormatCodes:null===(r=e.matchUpFormatCodes)||void 0===r?void 0:r.filter((function(e){return e!==o}))}):e})).filter((function(e){var t=e.matchUpFormatCodes;return null==t?void 0:t.length})).concat({matchUpFormatCodes:[o],averageTimes:u});s=(s||[]).filter((function(e){var t,r;return(null===(t=null==e?void 0:e.categoryNames)||void 0===t?void 0:t.length)||(null===(r=null==e?void 0:e.categoryTypes)||void 0===r?void 0:r.length)}));var c=(null==s?void 0:s.length)&&n.map((function(e){var r;return(null==e?void 0:e.matchUpFormatCodes.includes(o))?t(t({},e),{matchUpFormatCodes:null===(r=e.matchUpFormatCodes)||void 0===r?void 0:r.filter((function(e){return e!==o}))}):e})).filter((function(e){var t=e.matchUpFormatCodes,r=e.averageTimes;return(null==t?void 0:t.length)||r})).concat({matchUpFormatCodes:[o],recoveryTimes:s});return{matchUpAverageTimes:(null==l?void 0:l.length)&&l||a,matchUpRecoveryTimes:(null==c?void 0:c.length)&&c||n}}function gP(e){return Ja({event:e.event,name:ho})}var IP={addMatchUpCourtOrder:Vg,addMatchUpEndTime:qg,addMatchUpOfficial:function(e){var t,r=e.removePriorValues,n=e.tournamentRecord,i=e.drawDefinition,a=e.disableNotice,o=e.participantId,u=e.officialType,s=e.matchUpId;if(!s)return{error:Ze};if(!o)return{error:_t};if(n&&!Wa({tournamentParticipants:null!==(t=Rv({tournamentRecord:n,participantFilters:{participantTypes:[fs],participantRoles:[Gv]}}).participants)&&void 0!==t?t:[],participantId:o}))return{error:Lt};var l={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:o};return u&&(l.itemSubTypes=[u]),pm({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:i,disableNotice:a,matchUpId:s,timeItem:l})},addMatchUpResumeTime:Hg,addMatchUpScheduledDate:Bg,addMatchUpScheduledTime:kg,addMatchUpScheduleItems:jg,addMatchUpStartTime:Gg,addMatchUpStopTime:Wg,addPersonRequests:function(e){var t,r,n=e.tournamentRecords,i=e.personId,a=e.requests,o=da(e,[(t={},t[xi]=!0,t.personId=!0,t),(r={requests:!0},r[ua]=ia,r[oa]=xr,r)]);if(o.error)return o;var u=DS({tournamentRecords:n}).personRequests;return dP({personRequests:u,personId:i,requests:a}).mergeCount&&u?pP({tournamentRecords:n,personRequests:u}):{error:xr}},addSchedulingProfileRound:fw,allocateTeamMatchUpCourts:xg,assignMatchUpCourt:Fg,assignMatchUpVenue:Og,bulkRescheduleMatchUps:function(e){var r,n,i,s,l=e.scheduleChange,c=e.matchUpIds,d=e.dryRun;if(!c||!Array.isArray(c))return{error:Xe};if("object"!=typeof l)return{error:xr};var p=$c(e),v=[],f=[],m=function(e){var r=function(e){var r,n,i,o,u,s=e.tournamentRecord,l=e.scheduleChange,c=e.matchUpIds,d=e.dryRun;if(!s)return{error:W};if(!c||!Array.isArray(c))return{error:Xe};if("object"!=typeof l)return{error:xr};var p=[],v=[],f=l.minutesChange,m=l.daysChange;if(!f&&!m)return t({},L);if(f&&isNaN(f))return{error:xr};if(m&&isNaN(m))return{error:xr};var h=Kp({matchUpFilters:{matchUpIds:c},tournamentRecord:s}).matchUps,g=function(e){var t=e.matchUpStatus;return!eu.includes(t)},I=null==h?void 0:h.filter((function(e){return gS({schedule:e.schedule})})).filter((function(e){return g({matchUpStatus:e.matchUpStatus})}));if(!(null==I?void 0:I.length))return t({},L);var y=Uf({tournamentRecord:s}).tournamentInfo,U=y.startDate,S=y.endDate,w=null==I?void 0:I.reduce((function(e,t){var r=t.matchUpId,n=t.drawId;return e[n]?e[n].push(r):e[n]=[r],e}),{}),T=1440;try{for(var P=a(Object.keys(w)),D=P.next();!D.done;D=P.next()){var b=D.value,N=oS({tournamentRecord:s,drawId:b});if(N.error)return N;var M=N.drawDefinition,R=w[b].filter((function(e){return c.includes(e)})),A=function(e){if(e&&M){var t=I.find((function(t){return t.matchUpId===e})),r=null==t?void 0:t.schedule,n=r.scheduledTime,i=r.scheduledDate,a=void 0,o=void 0,u=void 0;if(!a&&m&&i)u=si(ui(i),m),a=new Date(u)<new Date(U)||new Date(u)>new Date(S);if(f&&n){var s=ui(n),l=ii(oi(n))+f;if(!(a=l<0||l>T)){var c=mi(n,f),h=s&&u||i===s&&s;o=h?"".concat(h,"T").concat(c):c}}if(a)v.push(e);else{if(!d){if(o){var g=kg({scheduledTime:o,drawDefinition:M,matchUpId:e});if(g.error)return{value:g}}if(u){var y=Bg({scheduledDate:u,drawDefinition:M,matchUpId:e});if(y.error)return{value:y}}}(o||u)&&p.push(e)}}};try{for(var E=(i=void 0,a(R)),C=E.next();!C.done;C=E.next()){var x=A(C.value);if("object"==typeof x)return x.value}}catch(e){i={error:e}}finally{try{C&&!C.done&&(o=E.return)&&o.call(E)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{D&&!D.done&&(n=P.return)&&n.call(P)}finally{if(r)throw r.error}}var O=null!==(u=Kp({matchUpFilters:{matchUpIds:c},tournamentRecord:s}).matchUps)&&void 0!==u?u:[],F=O.filter((function(e){var t=e.matchUpId;return p.includes(t)})),k=O.filter((function(e){var t=e.matchUpId;return v.includes(t)})),_=F.length&&!k.length;return t(t({},L),{rescheduled:F,notRescheduled:k,allRescheduled:_})}({tournamentRecord:e,scheduleChange:l,matchUpIds:c,dryRun:d});if(r.error)return{value:r};Array.isArray(r.notRescheduled)&&f.push.apply(f,u([],o(r.notRescheduled),!1));var n=bo(r.notRescheduled),p=[];null===(i=r.rescheduled)||void 0===i||i.forEach((function(e){var t=e.matchUpId;n.includes(t)&&p.push(t),v.push(e)})),p.length&&(f=(null===(s=null==r?void 0:r.notRescheduled)||void 0===s?void 0:s.filter((function(e){var t=e.matchUpId;return!p.includes(t)})))||[])};try{for(var h=a(Object.values(p)),g=h.next();!g.done;g=h.next()){var I=m(g.value);if("object"==typeof I)return I.value}}catch(e){r={error:e}}finally{try{g&&!g.done&&(n=h.return)&&n.call(h)}finally{if(r)throw r.error}}var y=!(!v.length||f.length);return t(t({},L),{rescheduled:v,notRescheduled:f,allRescheduled:y})},bulkScheduleMatchUps:TS,bulkScheduleTournamentMatchUps:wS,bulkUpdateCourtAssignments:function(e){var t,r,n=e.courtDayDate,i=da(e,[(t={courtAssignments:!0},t[ua]=ia,t[oa]=pt,t),(r={},r[xi]=!0,r)]);if(i.error)return i;var a,o=e.courtAssignments.reduce((function(e,t){var r=t.tournamentId;return e[r]||(e[r]=[]),e[r].push(t),e}),{});return Object.keys(o).every((function(t){var r=e[xi][t];if(!r)return a={error:W},!1;var i=o[t].reduce((function(e,t){var r=t.drawId;return e[r]||(e[r]=[]),e[r].push(t),e}),{});Object.keys(i).every((function(e){var t=Ld({tournamentRecord:r,drawId:e}).drawDefinition;return t?(i[e].every((function(e){var i=e.matchUpId,o=e.courtId,u=Fg({tournamentRecord:r,drawDefinition:t,courtDayDate:n,matchUpId:i,courtId:o});if(u.success)return null==u?void 0:u.success;a={error:br}})),!0):(a={error:K},!1)}))})),a||L},calculateScheduleTimes:vP,clearMatchUpSchedule:function(e){var r,n,i,a=e.scheduleAttributes,o=void 0===a?[tc,rc,ec,ic,oc,uc,cc,lc,sc]:a,u=e.tournamentRecord,s=e.drawDefinition,l=e.matchUpId,c=s?null===(r=Up({matchUpFilters:{matchUpIds:[l]},inContext:!1,drawDefinition:s}).matchUps)||void 0===r?void 0:r[0]:null===(n=Kp({matchUpFilters:{matchUpIds:[l]},tournamentRecord:u,inContext:!1}).matchUps)||void 0===n?void 0:n[0];if(!c)return{error:Qe};var d=(null!==(i=c.timeItems)&&void 0!==i?i:[]).filter((function(e){return(null==e?void 0:e.itemType)&&!o.includes(null==e?void 0:e.itemType)}));return c.timeItems=d,Cp({tournamentId:u.tournamentId,context:"clearMatchUpSchedule",drawDefinition:s,matchUp:c}),t({},L)},clearScheduledMatchUps:NS,courtGridRows:Hw,findCourt:function(e){return Ui(Cd(e),!1,!0)},findMatchUpFormatTiming:fS,findVenue:Ed,generateBookings:IS,generateVirtualCourts:LU,getProfileRounds:nP,getSchedulingProfile:pf,matchUpScheduleChange:function(e){var r="matchUpScheduleChange",n=e.tournamentRecords;if("object"!=typeof n||!Object.keys(n).length)return{error:q};var i=e||{},a=i.sourceMatchUpContextIds,o=i.targetMatchUpContextIds,u=i.sourceCourtId,s=i.targetCourtId,l=i.courtDayDate,c=a||{},d=c.drawId,p=c.matchUpId,v=c.tournamentId,f=o||{},m=f.drawId,h=f.matchUpId,g=f.tournamentId;if(!p&&!h)return On({result:{error:pt},stack:r});var I=Jp({matchUpFilters:{matchUpIds:[p,h].filter(Boolean),drawIds:[d,m].filter(Boolean)},tournamentRecords:e.tournamentRecords}).matchUps,y=null==I?void 0:I.find((function(e){return e.matchUpId===p})),U=null==I?void 0:I.find((function(e){return e.matchUpId===h})),S=0;if(s&&p&&!h){var w=D({tournamentId:v,matchUpId:p,courtId:s,matchUp:y,drawId:d,tournamentRecords:n,sourceCourtId:u,courtDayDate:l});if((null==w?void 0:w.success)&&S++,w.error)return On({result:w,stack:r})}else{if(!(u&&s&&p&&h))return{error:pt};var T=D({tournamentId:v,matchUpId:p,courtId:s,matchUp:y,drawId:d,tournamentRecords:n,sourceCourtId:u,courtDayDate:l});if(T.success&&S++,T.error)return On({result:T,stack:r,info:"source"});var P=D({tournamentId:g,sourceCourtId:s,matchUpId:h,matchUp:U,courtId:u,drawId:m,tournamentRecords:n,courtDayDate:l});if(P.success&&S++,P.error)return On({result:P,stack:r,info:"target"})}return S?L:On({result:{error:Dr},stack:r});function D(e){var r=e.tournamentRecords,n=e.tournamentId,i=e.matchUp,a=e.drawId,o=r[n],u=oS({tournamentRecord:o,drawId:a}).drawDefinition;return i.matchUpType===Fs?function(e){var t=e.removePriorValues,r=e.tournamentRecords,n=e.tournamentRecord,i=e.drawDefinition,a=e.sourceCourtId,o=e.courtDayDate,u=e.matchUpId,s=e.matchUp,l=e.courtId,c=[l].concat(s.schedule.allocatedCourts.map((function(e){return e.courtId})).filter((function(e){return e!==a})));return xg({removePriorValues:t,tournamentRecords:r,tournamentRecord:n,drawDefinition:i,courtDayDate:o,matchUpId:u,courtIds:c})}(t(t({},e),{tournamentRecord:o,drawDefinition:u})):Fg(t(t({},e),{tournamentRecord:o,drawDefinition:u}))}},modifyEventMatchUpFormatTiming:function(e){var t,r,n=e.tournamentRecord,i=e.recoveryMinutes,a=e.averageMinutes,o=e.matchUpFormat,u=e.categoryType,s=e.eventId,c=e.event;if(!n)return{error:W};if(!Fm({matchUpFormat:o}))return{error:xr};if(!c)return{error:Ae};var d=Gw({tournamentRecord:n,matchUpFormat:o,event:c}),p=d.averageTimes,v=void 0===p?[]:p,f=d.recoveryTimes,m=void 0===f?[]:f,h=c.category,g=(null==h?void 0:h.categoryName)||(null==h?void 0:h.ageCategoryCode)||(null==c?void 0:c.eventId),I={categoryNames:[g],minutes:{}},y={categoryNames:[g],minutes:{}},U=function(e){var t,r;if((null===(t=e.categoryTypes)||void 0===t?void 0:t.includes(u))&&console.log("encountered:",{categoryType:u}),!(null===(r=e.categoryNames)||void 0===r?void 0:r.includes(g))||(e.categoryNames=e.categoryNames.filter((function(e){return e!==g})),I={minutes:e.minutes,categoryNames:[g]},e.categoryNames.length))return e},S=a&&!isNaN(l(a)),w=i&&!isNaN(l(i)),T=v.map(U).filter((function(e){var t;return null===(t=null==e?void 0:e.categoryNames)||void 0===t?void 0:t.length})),P=m.map(U).filter((function(e){var t;return null===(t=null==e?void 0:e.categoryNames)||void 0===t?void 0:t.length}));return S&&(Object.assign(I.minutes,((t={})[(null==c?void 0:c.eventType)||Es]=a,t)),T.push(I)),w&&(Object.assign(y.minutes,((r={})[(null==c?void 0:c.eventType)||Es]=i,r)),P.push(y)),S||w?fP({averageTimes:S&&T,recoveryTimes:w&&P,tournamentRecord:n,matchUpFormat:o,eventId:s,event:c}):{error:xr}},modifyMatchUpFormatTiming:fP,modifyPersonRequests:function(e){var t,r,n,i,o=e.tournamentRecords,u=e.requests,s=e.personId,l=da(e,[(t={},t[xi]=!0,t),(r={requests:!0},r[ua]=ia,r[oa]=xr,r)]);if(l.error)return l;var c=u.map((function(e){return e.requestId})).filter(Boolean),d=DS({tournamentRecords:o}).personRequests,p=function(e){d&&(d[e]=d[e].map((function(e){if(!c.includes(e.requestId))return e;var t=u.find((function(t){return t.requestId===e.requestId}));return t.requestType?Object.assign(e,t):void 0})).filter(Boolean))};if(s&&(null==d?void 0:d[s]))p(s);else if(d)try{for(var v=a(Object.keys(d)),f=v.next();!f.done;f=v.next()){p(f.value)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}var m=u.filter((function(e){return!e.requestId}));return m.length&&dP({personRequests:d,personId:s,requests:m}),pP({tournamentRecords:o,personRequests:d})},proAutoSchedule:function(e){var r=e.scheduleCompletedMatchUps,n=e.tournamentRecords,i=e.scheduledDate,a=e.matchUps;if(!Zs(a))return{error:xr};if(a.some((function(e){return!e.hasContext})))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Sr};var s=Jw({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:n,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(s.error)return s;var l=s.rows,c=[],d=function(e){return[(e.sides||[]).map((function(e){var t;return[e.participantId,null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds]})),(e.potentialParticipants||[]).flat().map((function(e){return[e.participantId,e.individualParticipantIds]}))].flat(1/0).filter(Boolean)},p=null==l?void 0:l.reduce((function(e,t){var r=[],n=[];Object.values(t).forEach((function(e){if(Di(e)&&(e.matchUpId&&(r.push(e.matchUpId),c.push(e)),e.sides)){var t=d(e);n.push.apply(n,u([],o(t),!1))}}));var i=Object.values(t).filter((function(e){return Di(e)&&!e.matchUpId}));return e.concat({matchUpIds:r,availableCourts:i,rowId:t.rowId,participantIds:n})}),[]);a.filter((function(e){var t=e.matchUpStatus;return t&&t!==Fo&&(r||!eu.includes(t))})).sort(Zp);for(var v=Xp({matchUps:a.concat(c),includeParticipantDependencies:!0,tournamentRecords:n}).matchUpDependencies,f=[],m=[];a.length&&p.length;){for(var h=p.shift(),g=[],I=function(){var e,t=a.concat(g).map((function(e){return e.matchUpId})),r=a.shift(),n=null==r?void 0:r.matchUpId,i=n&&v[n].matchUpIds.concat(v[n].dependentMatchUpIds),s=n&&t.some((function(e){return v[n].matchUpIds.includes(e)})),l=n&&m.some((function(e){return v[n].dependentMatchUpIds.includes(e)})),c=h.matchUpIds.some((function(e){return i.includes(e)})),p=d(r),I=h.participantIds.some((function(e){return p.includes(e)}));if(!r||c||s||I||l)r&&g.push(r);else{var y=h.availableCourts.shift();Object.assign(r.schedule,y.schedule),Object.assign(y,r),f.push(r),(e=h.participantIds).push.apply(e,u([],o(p),!1)),h.matchUpIds.push(n)}};a.length&&h.availableCourts.length;)I();a.push.apply(a,u([],o(g),!1)),m.push.apply(m,u([],o(h.matchUpIds),!1))}var y=f.map((function(e){var r=e.matchUpId,n=e.tournamentId,a=e.schedule;return{tournamentId:n,matchUpId:r,drawId:e.drawId,schedule:t(t({},a),{scheduledDate:i})}}));s=TS({tournamentRecords:n,matchUpDetails:y});var U=a;return t(t({},s),{scheduled:f,notScheduled:U})},proConflicts:function(e){var t=e.tournamentRecords,r=e.matchUps;if(!Zs(r))return{error:$e};if(r.some((function(e){var t=e.matchUpId,r=e.hasContext;return t&&!r})))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Sr};var n=Math.max.apply(Math,u([],o(r.map((function(e){var t=e.schedule;return(null==t?void 0:t.courtOrder)||1})).map((function(e){return l(e)}))),!1)),i=R(1,n+1).map((function(e){return r.filter((function(t){var r;return l(null===(r=t.schedule)||void 0===r?void 0:r.courtOrder)===e}))})),s={},c={},d={};i.flat().filter(Boolean).sort(Zp).forEach((function(e){return delete e.schedule[Vc]}));var p=U(r.map((function(e){return e.drawId}))),v=Xp({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:p}).matchUpDependencies,f=i.map((function(e,t){return e.reduce((function(e,r){var n,i,a;if(!r.matchUpId)return e;var l=r.matchUpId,p=r.winnerMatchUpId,f=r.loserMatchUpId,m=r.schedule,h=r.sides,g=r.potentialParticipants,I=null==m?void 0:m.courtId;s[l]=t,c[I]=[],e.matchUpIds.push(l),d[l]=r;var y=v[l].matchUpIds;y.length&&(n=e.sourceMatchUpIds).push.apply(n,u([],o(y),!1));var U=null!==(a=null==h?void 0:h.map((function(e){var t;return[null===(t=e.participant)||void 0===t?void 0:t.individualParticipantIds,e.participantId]})).flat().filter(Boolean))&&void 0!==a?a:[],S=(null==g?void 0:g.flat().map((function(e){return[e.individualParticipantIds,e.participantId]})).flat().filter(Boolean))||[];return(i=e.participantIds).push.apply(i,u(u([],o(S),!1),o(U),!1)),p&&e.targetMatchUpIds.push(p),f&&e.targetMatchUpIds.push(f),e}),{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})})),m=f.map((function(){return[]})),h=function(e,t,r,n){if(!d[e].schedule[Vc]){d[e].schedule[Vc]=t,d[e].schedule[kc]=n,m[s[e]].push({matchUpId:e,issueType:r,issueIds:n,issue:t});var i=d[e].schedule.courtId;c[i]||(c[i]=[]),c[i].push({matchUpId:e,issue:t,issueType:r,issueIds:n})}};return f.forEach((function(e,t){var r=t?f[t-1]:void 0,n=f.slice(t+1),i={},o=T(e.participantIds),u=Object.keys(o).filter((function(e){return o[e]>1})),s=e.matchUpIds.filter((function(e){return v[e].participantIds.some((function(e){return u.includes(e)}))}));s.forEach((function(e){i[e]||(i[e]={}),i[e][_c]||(i[e][_c]=s.filter((function(t){return t!==e})))}));var l=r&&e.participantIds.filter((function(e){return r.participantIds.includes(e)}));l&&l.forEach((function(t){var n=e.matchUpIds.concat(r.matchUpIds).filter((function(e){return v[e].participantIds.includes(t)}));n.forEach((function(e){i[e]||(i[e]={}),i[e][Lc]||(i[e][Lc]=n.filter((function(t){return t!==e})))}))})),e.matchUpIds.forEach((function(t){var o,u,s,l,c,p,f=v[t].matchUpIds;try{for(var m=a(n),g=m.next();!g.done;g=m.next()){var I=g.value.matchUpIds.filter((function(e){return f.includes(e)}));(null==I?void 0:I.length)&&(I.forEach((function(e){return h(e,jc,Fc,[t])})),h(t,jc,Fc,I))}}catch(e){o={error:e}}finally{try{g&&!g.done&&(u=m.return)&&u.call(m)}finally{if(o)throw o.error}}if((null===(s=i[t])||void 0===s?void 0:s[_c])&&h(t,_c,Oc,i[t][_c]),e.sourceMatchUpIds.includes(t)){var y=e.matchUpIds.filter((function(e){return v[e].matchUpIds.includes(t)}));h(t,_c,Fc,y),e.matchUpIds.filter((function(e){return v[e].matchUpIds.includes(t)})).forEach((function(e){return h(e,_c,Fc,[t])}))}var U=null===(l=null==r?void 0:r.matchUpIds)||void 0===l?void 0:l.filter((function(e){return r=e,v[t].sources.reduce((function(e,t,n){return t.includes(r)&&n+1||e}),0)>1;var r}));if((null==U?void 0:U.length)&&(h(t,Bc,Fc,U),U.forEach((function(e){return h(e,Bc,Fc,[t])}))),(null===(c=i[t])||void 0===c?void 0:c[Lc])&&h(t,Lc,Oc,i[t][Lc]),null===(p=null==r?void 0:r.targetMatchUpIds)||void 0===p?void 0:p.includes(t)){var S=d[t].schedule.courtId,w=f.filter((function(e){return r.matchUpIds.includes(e)}));w.some((function(e){return d[e].schedule.courtId===S}))||(w.forEach((function(e){return h(e,Lc,Fc,[t])})),h(t,Lc,Fc,w))}}))})),{courtIssues:c,rowIssues:m}},removeEventMatchUpFormatTiming:function(e){var t,r,n,i;if(e.event)return gP({event:e.event});e.tournamentRecord&&!e.tournamentRecords&&(e.tournamentRecords=((t={})[e.tournamentRecord.tournamentId]=e.tournamentRecord,t));var o=da(e,[(r={},r[xi]=!0,r[Xi]=!0,r)]);if(o.error)return o;var u=e.tournamentRecords,s=e.eventId;try{for(var l=a(Object.values(null!=u?u:{})),c=l.next();!c.done;c=l.next()){var d=Ld({tournamentRecord:c.value,eventId:s}).event;if(d)return gP({event:d})}}catch(e){n={error:e}}finally{try{c&&!c.done&&(i=l.return)&&i.call(l)}finally{if(n)throw n.error}}return{error:Ee}},removeMatchUpCourtAssignment:function(e){var t,r,n,i=da(e,[(t={},t[xi]=!0,t)]);if(i.error)return i;var a=e.removePriorValues,o=e.tournamentRecords,u=e.tournamentId,s=e.courtDayDate,l=e.matchUpId,c=e.courtId,d=e.drawId,p=o[u];if(!p)return{error:W};var v=oS({tournamentRecord:p,drawId:d}),f=v.drawDefinition,m=v.event;if(!f)return{error:K};var h=Ef({drawDefinition:f,event:m,matchUpId:l});if(h.error)return h;if((null===(r=null==h?void 0:h.matchUp)||void 0===r?void 0:r.matchUpType)===Os){var g=zc({timeItems:null!==(n=h.matchUp.timeItems)&&void 0!==n?n:[],itemType:tc}).itemValue,I=c&&g.filter((function(e){return e.courtId!==c}));return pm({duplicateValues:!1,removePriorValues:a,tournamentRecord:p,drawDefinition:f,matchUpId:l,timeItem:{itemType:tc,itemValue:I}})}return Fg({tournamentRecord:p,drawDefinition:f,courtDayDate:s,courtId:"",matchUpId:l})},removePersonRequests:function(e){var t,r,n,i=e.tournamentRecords,o=e.requestType,u=e.requestId,s=e.personId,l=e.date,c=da(e,[(t={},t[xi]=!0,t)]);if(c.error)return c;var d=DS({tournamentRecords:i}).personRequests,p=function(e){var t;d&&(d[e]=d[e].filter((function(e){return!(o&&e.requestType===o||u&&e.requestId===u||l&&e.date===l)})),(null===(t=null==d?void 0:d[e])||void 0===t?void 0:t.length)||delete d[e])},v=!(o||u||s||l);if(!v)if(s&&(null==d?void 0:d[s]))p(s);else if(d)try{for(var f=a(Object.keys(d)),m=f.next();!m.done;m=f.next()){p(m.value)}}catch(e){r={error:e}}finally{try{m&&!m.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return!v&&d&&Object.keys(d).length?pP({tournamentRecords:i,personRequests:d}):_n({name:po,tournamentRecords:i,discover:!0})},reorderUpcomingMatchUps:function(e){var r="reorderUpcomingMatchUps",n=e.tournamentRecords;if("object"!=typeof n||!Object.keys(n).length)return On({result:{error:q},stack:r});var i=e.matchUpsContextIds,a=e.firstToLast;if(!i)return On({result:{error:pt},stack:r});var o=null==i?void 0:i.length;if(!o)return t({},L);var u=0;return i.forEach((function(e,t){var r=e.tournamentId,s=e.drawId,l=e.matchUpId,c=t+(a?-1:1);c<0&&(c=o-1),c===o&&(c=0);var d=function(e){var t=e.tournamentId,r=e.scheduledTime,i=e.matchUpId,a=e.drawId,o=n[t],u=oS({tournamentRecord:o,drawId:a}).drawDefinition;return u?kg({drawDefinition:u,scheduledTime:r,matchUpId:i}):{error:Z}}({tournamentId:r,scheduledTime:i[c].schedule.scheduledTime,matchUpId:l,drawId:s});if(!d.success)return d;u++})),u===o?L:On({result:{error:Pr},stack:r})},scheduleMatchUps:function(e){var r,n,i,a,s,l,c,d=e.tournamentRecords,p=e.allDateMatchUpIds,v=void 0===p?[]:p,f=e.averageMatchUpMinutes,m=void 0===f?90:f,h=e.recoveryMinutes,g=void 0===h?0:h,I=e.recoveryMinutesMap,y=e.matchUpPotentialParticipantIds,U=void 0===y?{}:y,S=e.individualParticipantProfiles,w=void 0===S?{}:S,T=e.matchUpNotBeforeTimes,P=void 0===T?{}:T,D=e.matchUpDailyLimits,b=void 0===D?{}:D,N=e.checkPotentialRequestConflicts,M=void 0===N||N,R=e.remainingScheduleTimes,A=e.clearScheduleDates,E=e.periodLength,C=void 0===E?30:E,x=e.scheduleDate,O=e.matchUpIds,F=e.venueIds,k=e.startTime,_=e.endTime,j=e.dryRun,B=da(e,[(r={},r[xi]=!0,r[Gi]=!0,r),(n={},n[aa]=Jn,n[oa]=It,n.scheduleDate=!0,n),(i={},i[aa]=function(e){return!e||!isNaN(e)},i.averageMatchUpMinutes=!1,i[oa]=xr,i.recoveryMinutes=!1,i.periodLength=!1,i)]);if(B.error)return B;var V=null!==(s=null!==(a=e.competitionMatchUps)&&void 0!==a?a:Jp({nextMatchUps:!0,tournamentRecords:d}).matchUps)&&void 0!==s?s:[],G=null!==(l=e.matchUpDependencies)&&void 0!==l?l:Xp({includeParticipantDependencies:!0,matchUps:V,tournamentRecords:d}).matchUpDependencies;V.forEach((function(e){var t;(null===(t=e.schedule)||void 0===t?void 0:t.scheduledDate)&&Ii(x,ui(e.schedule.scheduledDate))&&uS({matchUpPotentialParticipantIds:U,matchUpNotBeforeTimes:P,matchUp:e})}));var q=O.map((function(e){return V.find((function(t){return t.matchUpId===e}))})).filter(Boolean),W=vP({tournamentRecords:d,remainingScheduleTimes:R,startTime:oi(k),endTime:oi(_),scheduleDate:ui(x),averageMatchUpMinutes:m,clearScheduleDates:A,periodLength:C,venueIds:F}),H=W.venueId,z=W.scheduleTimes,Y=W.dateScheduledMatchUpIds,K={},J=[],Z={},X={},Q={},$=V.filter((function(e){var t=e.matchUpId;return null==Y?void 0:Y.includes(t)}));$.forEach((function(e){var t;hS({matchUpPotentialParticipantIds:U,individualParticipantProfiles:w,matchUp:e,value:1});var r=null===(t=e.schedule)||void 0===t?void 0:t.scheduledTime;r&&(Z[e.matchUpId]=r,lS({recoveryMinutes:(null==I?void 0:I[e.matchUpId])||g,matchUpPotentialParticipantIds:U,individualParticipantProfiles:w,matchUpNotBeforeTimes:P,averageMatchUpMinutes:m,matchUpDependencies:G,scheduleTime:r,matchUp:e}))}));var ee=q.filter((function(e){var t=null==Y?void 0:Y.includes(e.matchUpId),r=[Fo,jo,_o,xo,Ho,Ko].includes(null==e?void 0:e.matchUpStatus);return!t&&!e.winningSide&&!r})),te=ee.reduce((function(e,t){var r,n=t.drawId,i=t.tournamentId,a=t.matchUpType,s=SS({individualParticipantProfiles:w,matchUpPotentialParticipantIds:U,matchUpDailyLimits:b,matchUp:t}),l=s.participantIdsAtLimit,c=s.relevantParticipantIds;return(null==l?void 0:l.length)?(e.overLimitMatchUpIds.push(t.matchUpId),(r=e.participantIdsAtLimit).push.apply(r,u([],o(l),!1)),e):(c.forEach((function(e){sS({individualParticipantProfiles:w,participantId:e});var t=w[e].counters;t[a]?t[a]+=1:t[a]=1,t[xc]?t[xc]+=1:t[xc]=1})),e.matchUpMap[i]||(e.matchUpMap[i]={}),e.matchUpMap[i][n]?e.matchUpMap[i][n].push(t):e.matchUpMap[i][n]=[t],uS({matchUpPotentialParticipantIds:U,matchUpNotBeforeTimes:P,matchUp:t}),e)}),{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]}),re=te.matchUpMap,ne=te.overLimitMatchUpIds,ie=te.participantIdsAtLimit;ee=ee.filter((function(e){var t=e.matchUpId;return!ne.includes(t)}));for(var ae=0,oe=null!==(c=null==z?void 0:z.length)&&void 0!==c?c:0,ue=DS({tournamentRecords:d,requestType:dS}).personRequests,se=function(){ae++;var e=z.shift().scheduleTime,t=ee.find((function(t){var r=t.matchUpId,n=aS({matchUpScheduleTimes:Z,matchUpDependencies:G,allDateMatchUpIds:v,matchUp:t}),i=n.dependenciesScheduled,a=n.remainingDependencies;if(!i)return Q[r]||(Q[r]=[]),Q[r].push({scheduleTime:e,remainingDependencies:a}),!1;if(!US({individualParticipantProfiles:w,matchUpNotBeforeTimes:P,matchUpDependencies:G,scheduleTime:e,matchUp:t}).enoughTime)return X[r]||(X[r]=[]),X[r].push({scheduleTime:e}),!1;var o=vS({potentials:M,averageMatchUpMinutes:m,requestConflicts:K,personRequests:ue,scheduleTime:e,scheduleDate:x,matchUp:t}).conflicts;return!(null==o?void 0:o.length)&&(lS({recoveryMinutes:(null==I?void 0:I[t.matchUpId])||g,matchUpPotentialParticipantIds:U,individualParticipantProfiles:w,matchUpNotBeforeTimes:P,averageMatchUpMinutes:m,matchUpDependencies:G,scheduleTime:e,matchUp:t}),Z[t.matchUpId]=e,!0)}));ee=ee.filter((function(e){return e.matchUpId!==(null==t?void 0:t.matchUpId)})),t||J.push(e)};(null==z?void 0:z.length)&&ee.length&&ae<=oe;)se();ee.forEach((function(e){hS({individualParticipantProfiles:w,matchUpPotentialParticipantIds:U,value:-1,matchUp:e})}));var le=[];Object.keys(re).forEach((function(e){var t=d[e];t&&Object.keys(re[e]).forEach((function(r){var n=oS({tournamentRecord:t,drawId:r}).drawDefinition;n&&re[e][r].forEach((function(e){var r=e.matchUpId,i=Z[r];if(i){var a=i.split(":").map(gi).join(":"),o="".concat(ui(x),"T").concat(a);if(j)le.push(r);else kg({drawDefinition:n,matchUpId:r,scheduledTime:o}).success&&le.push(r),H&&Og({tournamentRecords:d,tournamentRecord:t,drawDefinition:n,matchUpId:r,venueId:H})}}))}))}));var ce=bo(ee);return t(t({},L),{requestConflicts:Object.values(K),remainingScheduleTimes:null==z?void 0:z.map((function(e){return e.scheduleTime})),individualParticipantProfiles:w,matchUpNotBeforeTimes:P,participantIdsAtLimit:ie,skippedScheduleTimes:J,overLimitMatchUpIds:ne,scheduledMatchUpIds:le,noTimeMatchUpIds:ce,recoveryTimeDeferred:X,dependencyDeferred:Q})},scheduleProfileRounds:RS,setMatchUpDailyLimits:function(e){var r,n,i,o=e.tournamentRecord,u=e.tournamentId,s=e.dailyLimits,l=e.tournamentRecords||o&&((r={})[o.tournamentId]=o,r)||{};if("object"!=typeof l||!Object.keys(l).length)return{error:q};if("object"!=typeof s)return{error:Ar};var c=Object.keys(l).filter((function(e){return!u||u===e}));if(u&&!c.includes(u))return{error:xr};try{for(var d=a(c),p=d.next();!p.done;p=d.next()){var v=jn({element:l[p.value],extension:{name:mo,value:{dailyLimits:s}}});if(v.error)return v}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return t({},L)},setSchedulingProfile:vf,toggleParticipantCheckInState:mm,validateSchedulingProfile:of},yP="\\d+-\\d+",UP="\\d+-\\d+\\(\\d+\\)",SP="\\[\\d+-\\d+\\]",wP=new RegExp("(".concat(yP,"),"),"g"),TP=new RegExp("(".concat(UP,"),"),"g"),PP=[yP,UP,SP,"\\d+-\\d+\\(\\d+-\\d+\\)"],DP=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map((function(e){var t=e.split("").map((function(e){return PP[e]})).join(" ");return new RegExp("^".concat(t,"$"))}));function bP(e){return!e||DP.some((function(t){return t.test(e)}))}function NP(e){return/^\(\d+\)$/.test(e)||/^\(\d+$/.test(e)}function MP(e){var t,r=null==(t=e)?void 0:t.split("-").join("").split("/").join("");if(/^\d+$/.test(r)&&2===r.length){var n=r.split("");return 1===Math.abs(n.reduce((function(e,t){return+e-+t})))}return!1}function RP(e,t){var r=[e.slice(t,t+2),t?e.slice(0,1):e.slice(2)].map((function(e){return parseInt(e.join(""))}));t&&r.reverse();var n=r;if(Math.abs(n.reduce((function(e,t){return+e-+t})))>=2)return n.join("-")}function AP(e){return 2===e.length?e.split("").join("-"):([", ",",","/"," "].forEach((function(t){return e=e.split(t).join("-")})),e=e.replace(/-{2,}/,"-"))}function EP(e){return e.startsWith("(")&&e.endsWith(")")}function CP(e){if(!/^[\d-]+(\(\d\))*$/.test(e))return e;var t=A("-",e.split(""));if(!t.length)return e;var r=e.split("-"),n=!(r.length%2),i=!!(t.length%2);n&&i&&t.length>r.length/2&&t.filter((function(e,t){return t%2})).forEach((function(t){e=e.substring(0,t)+" "+e.substring(t+1)}));return e}function xP(e){var t,r=e.score.split(""),n=[],i=function(){return t=[void 0,void 0,void 0]},a=function(){var e="".concat(t[0],"-").concat(t[1]);return t[2]&&(e+=" (".concat(t[2],")")),i(),t.push(t),e};i();for(var o=function(){return void 0!==t[0]&&void 0!==t[1]&&Math.abs(parseInt(t[0])-parseInt(t[1]))};r.length;){var u=r.shift(),s=f(u)&&parseInt(u),l=void 0!==t[0]&&void 0!==t[1];if(f(s)){if(void 0===t[0]){t[0]=s;continue}if(void 0===t[1]&&(t[1]=s,o())){n.push(a()),t=[void 0,void 0];continue}if(l&&1===r.length&&f(r[0])){var c=r.pop();t[0]=t[0].toString()+t[1].toString(),t[1]=c,n.push(a()),t=[void 0,void 0]}l&&o()}}return{sets:n}}function OP(e){var t,r=e.indexOf("1"),n=e.split(""),i=n.every((function(e){return!isNaN(e)}));if(i&&3===e.length&&0===r&&(t=RP(n,r)))return t;if(i&&7===e.length&&r>3&&(t=RP(n.slice(4),r-4)))return"".concat(n[0],"-").concat(n[1]," ").concat(n[2],"-").concat(n[3]," ").concat(t)}function FP(e){var t=e.score,r=e.applied,n=e.matchUpStatus,i=null==t?void 0:t.toString().split(""),a=null==i?void 0:i.every((function(e){return f(e)})),u=function(e){return Math.abs(e[0]-e[1])};if("number"==typeof t||a){t=t.toString().toLowerCase(),a&&(t=i.join(""));var s=a?i.map((function(e){return parseInt(e)})):t.split("").map((function(e){return parseInt(e)}));if(xP({score:t}).sets,s.length,3===t.length&&1===u(s.slice(0,2))){var l=o(s,3),c=l[0],d=l[1],p=l[2];t="".concat(c,"-").concat(d,"(").concat(p,")"),r.push("numericTiebreakPattern1")}else if(3===t.length&&1===s[0]){var v=o(s,3),m=v[0],h=v[1],g=v[2];t="[".concat(m).concat(h,"-").concat(g,"]"),r.push("numericTiebreakPattern2")}else if(4===t.length&&1===u(s.slice(0,2))&&"987654".split("").includes(s[0].toString())){var I=o(s,4),y=(c=I[0],d=I[1],I[2]),U=I[3];p=Math.min(y,U);t="".concat(c,"-").concat(d,"(").concat(p,")"),r.push("numericTiebreakPattern3")}else if(4===t.length&&1===s[0]&&1===s[2]){var S=o(s,4),w=(y=S[0],U=S[1],S[2]),P=S[3];t="[".concat(y).concat(U,"-").concat(w).concat(P,"]"),r.push("bigSuper")}else if(4===t.length){var D=o(s,4),b=(c=D[0],d=D[1],D[2]),N=D[3];t="".concat(c).concat(d," ").concat(b).concat(N),r.push("split4")}else if(5===t.length&&1===u(s.slice(0,2))){var M=o(s,5);c=M[0],d=M[1],p=M[2],b=M[3],N=M[4];t="".concat(c,"-").concat(d,"(").concat(p,") ").concat(b,"-").concat(N),r.push("numericTiebreakPattern4")}else if(5===t.length&&1===u(s.slice(3))){var R=o(s,5);c=R[0],d=R[1],b=R[2],N=R[3],p=R[4];t="".concat(c,"-").concat(d," ").concat(b,"-").concat(N,"(").concat(p,")"),r.push("numericTiebreakPattern5")}else if(7===s.length)if(u(s.slice(0,2))>1&&u(s.slice(2,4))>1&&1===s[4]){var A=o(s,7);c=A[0],d=A[1],b=A[2],N=A[3],m=A[4],h=A[5],g=A[6];t="".concat(c,"-").concat(d," ").concat(b,"-").concat(N," [").concat(m).concat(h,"-").concat(g,"]"),r.push("numericTiebreakPattern6")}else if(1===u(s.slice(0,2))&&u(s.slice(3,5))>1&&u(s.slice(5,7))>1){var E=o(s,7),C=(c=E[0],d=E[1],p=E[2],b=E[3],N=E[4],E[5]),x=E[6];t="".concat(c,"-").concat(d,"(").concat(p,") ").concat(b,"-").concat(N," ").concat(C,"-").concat(x),r.push("numericTiebreakPattern7")}else if(u(s.slice(0,2))>1&&1===u(s.slice(2,4))&&u(s.slice(5,7))>1){var F=o(s,7);c=F[0],d=F[1],b=F[2],N=F[3],p=F[4],C=F[5],x=F[6];t="".concat(c,"-").concat(d," ").concat(b,"-").concat(N,"(").concat(p,") ").concat(C,"-").concat(x),r.push("numericTiebreakPattern8")}else if(u(s.slice(0,2))>1&&u(s.slice(2,4))>1&&1===u(s.slice(4,6))){var k=o(s,7);c=k[0],d=k[1],b=k[2],N=k[3],C=k[4],x=k[5],p=k[6];t="".concat(c,"-").concat(d," ").concat(b,"-").concat(N," ").concat(C,"-").concat(x,"(").concat(p,")"),r.push("numericTiebreakPattern9")}else t=t.slice(0,2)+" "+t.slice(2,4)+" "+t.slice(4),r.push("numericMatchTiebreakPattern");else if(t.length%2){var _=OP(t);_&&t!==_&&r.push("parsedSuperPattern"),t=null!=_?_:t}else{var L=O(t.split(""),2).map((function(e){return e.join("")})),j=L.map((function(e){var t=o(e.split("").map((function(e){return parseInt(e)})),2),r=t[0],n=t[1],i=r>n?1:2;return Math.abs(r-n)>1&&i||-1*i})),B=j.reduce((function(e,t){return e>0&&t>0}),1),V=T(j),G=T(j.map((function(e){return Math.abs(e)}))),q=j[0]<0,W=!q&&j[1]<0;if(j[0]>0&&j[1]>0&&j[0]!==j[1])t=[L.slice(0,2).join(" "),L.slice(2).join("-")].join(" "),r.push("numeric3rdSetTiebreakPattern");else if(B)t=L.join(" "),r.push("chunkSplit");else if(6==s.length){if(2==V[1]||2===V[2])if(Object.values(G).includes(3)){var H=o(s,6),z=H[0],Y=H[1],K=H[2],J=H[3],Z=H[4],X=H[5],Q=j.reduce((function(e,t,r){return t<0?r:e}),void 0);if(0===Q){p=Math.min(K,J);t="".concat(z,"-").concat(Y,"(").concat(p,") ").concat(Z,"-").concat(X),r.push("chunkSplitTiebreak1")}else if(1===Q){p=Math.min(Z,X);t="".concat(z,"-").concat(Y," ").concat(K,"-").concat(J,"(").concat(p,")"),r.push("chunkSplitTiebreak2")}else t="".concat(z,"-").concat(Y," ").concat(K,"-").concat(J),r.push("chunkSplitTrimExtraneous")}else t=L.join(" "),r.push("chunkSplit")}else if(8===s.length){var $=o(s,8),ee=(z=$[0],Y=$[1],K=$[2],J=$[3],Z=$[4],X=$[5],$[6]),te=$[7];q||W?1===s[5]&&(t=q?"".concat(z,"-").concat(Y,"(").concat(K,") ").concat(J,"-").concat(Z," [").concat(X).concat(ee,"-").concat(te,"]"):"".concat(z,"-").concat(Y," ").concat(K,"-").concat(J,"(").concat(Z,") [").concat(X).concat(ee,"-").concat(te,"]")):(j[0],j[1])}}}return{score:t,applied:r,matchUpStatus:n}}function kP(e){var t=[0,0],r=[],n=e.split(" "),i=/(\d+)-(\d+)/;n.forEach((function(e){if(i.test(e)){var n=e.match(i).slice(1).map((function(e){return parseInt(e)})),a=n[0]>n[1]?1:n[1]>n[0]&&2;a&&(t[a-1]+=1,r.push(a))}}));var a=t[0]>t[1]?1:t[1]>t[0]&&2,o=t[0]>0&&t[0]===t[1],u=t.reduce((function(e,t){return e+t}),0);return{setsWon:t,setsTied:o,setWinners:r,totalSets:u,winningSide:a}}var _P={handleTiebreakSlashSeparation:function(e){var t,r,n=e.score,i=new RegExp(/\(\d+\/\d+\)/g),o=n.match(i);try{for(var u=a(o||[]),s=u.next();!s.done;s=u.next()){var l=s.value,c=l.replace("/","-");n=n.replace(l,c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return{score:n}},handleSetSlashSeparation:function(e){var t=e.score;return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}},punctuationAdjustments:function(e){var t,r,n,i,s,l,c,d,p=e.score,v=e.applied;p=function(e){var t="[];",r="()",n=t+r,i=[t[0],r[0]],a=Object.assign.apply(Object,u([{}],o(n.split("").map((function(e){var t;return(t={})[e]=0,t}))),!1)),s="",l=e.split("").map((function(e){var o=n.includes(e)&&e,u=i.includes(o);if(u&&o)return a[o]+=1,s=o,e;if(!u&&o&&s&&o!==s){a[s]-=1;var l=t.includes(s)&&t||r.includes(s)&&r||"",c=l.split("").find((function(e){return e!==s}));if(!l.includes(o))return a[o]||(s=""),c;a[s]||(s="")}return e})).join("");return e!==l?l:e}(p);var f=/\)(\d+)/g;if(f.test(p))try{for(var m=a(p.match(f)),h=m.next();!h.done;h=m.next()){var g=h.value,I=g.replace(")",") ");p=p.replace(g,I)}}catch(e){t={error:e}}finally{try{h&&!h.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}var y=/\(([\d- ]+)\)/,U=(p=(p=p.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);try{for(var S=a(U||[]),w=S.next();!w.done;w=S.next()){var P=w.value,D=o(P.match(y).slice(1),1)[0].replace(/ /g,"");p=p.replace(P,"(".concat(D,")"))}}catch(e){n={error:e}}finally{try{w&&!w.done&&(i=S.return)&&i.call(S)}finally{if(n)throw n.error}}var b,N=/\(\(\d-\d\)\)/g;N.test(p)&&(b=p.match(N)).length&&b.forEach((function(e){var t=e.match(/\((\(\d-\d\))\)/).slice(1)[0];p=p.replace(e,t)})),(N=/\(\((\d)\)\)/g).test(p)&&(b=p.match(N)).length&&b.forEach((function(e){var t=e.match(/\((\(\d\))\)/).slice(1)[0];p=p.replace(e,t)})),/(^|\s)6-,/.test(p)&&(p=p.replace(/(^|\s)6-,/g,"6-0,"));var M=new RegExp(/[-,]{2,}/g);p=p.replace(M,"-"),["- "," -"].forEach((function(e){var t=new RegExp("(\\d+)".concat(e,"(\\d+)"),"g"),r=p.match(t);r&&r.forEach((function(t){return p=p.replace(t,t.split(e).join("-"))}))})),/^[(-/,]+$/.test(p)&&(p=""),/\)[-/,]+$/.test(p)&&(p=p.slice(0,p.length-1)),/\d \/\d/.test(p)&&(p=p.replace(/ \//g,"/")),p.includes(" /")&&(p=p.replace(/ \//g," "));var R=/\(\d+, \)/g;R.test(p)&&p.match(R).forEach((function(e){var t=o(e.match(/\((\d+), \)/).slice(1),1)[0];2===t.length?p=p.replace(e,"(".concat(t,")")):1===t.length&&"6"===t&&(p=p.replace(e,"(6-0)"))}));var A=/\((\d+)\/\)/g;A.test(p)&&p.match(A).forEach((function(e){var t=o(e.match(/\((\d+)\/\)/).slice(1),1)[0];p=2===t.length?p.replace(e,"(".concat(t,")")):1===t.length&&"6"===t?p.replace(e,"(6-0)"):p.replace(e,"(".concat(t,")"))}));var E=/\d\/\d\/,/g;E.test(p)&&p.match(E).forEach((function(e){var t=o(e.match(/(\d\/\d)\/,/).slice(1),1)[0];p=p.replace(e,"".concat(t,",")),v.push("slashComma")}));var C,x,O,F,k,_=/\(\/(\d+)\)/g;_.test(p)&&p.match(_).forEach((function(e){var t=o(e.match(/\(\/(\d+)\)/).slice(1),1)[0];p=2===t.length?p.replace(e,"(".concat(t,")")):1===t.length&&parseInt(t)<6?p.replace(e,"(6-".concat(t,")")):p.replace(e,"(".concat(t,")"))}));var L=function(){k=T(p.split("")),x=k["("]===(k[")"]||0)+1,C=(k["("]||0)+1===k[")"],O=k["["]===k["]"]+1,F=x&&!O};L();var j=/(\d+-\d+\(\d+)0,/;if(j.test(p)){var B=o(p.match(j).slice(1),1)[0];p=p.replace(j,B+")")}if(k["("]===k[")"]&&k["("]>1){var V=p.split(")(").join(") (").split(" ");p=V.every(EP)?V.map((function(e){var t=e.slice(1,e.length-1);return t.length>2?t:e})).join(" "):V.join(" ")}L();var G,q,W,H=/[A-Za-z]+/.test(p),z=/\d+/.test(p);if(!H&&!z)return{score:""};if(/^\[.+\]$/.test(p)&&"()/,- ".split("").some((function(e){return k[e]}))&&(p=p.slice(1,p.length-1)),/^\(.+\)$/.test(p)&&1===k["("]&&1===k[")"]&&"[]/,".split("").some((function(e){return k[e]>1}))&&(p=p.slice(1,p.length-1)),p.startsWith("(")&&p.endsWith("))")&&(p=p.slice(1,p.length-1)),k["("]>(k[")"]||0)&&"("===p[p.length-1]&&(p=p.slice(0,p.length-1)+")",L()),1!==k["("]||k[")"]||"("!==p[0]||(p+=")",L()),k["("]>(k[")"]||0)&&"(("===p.slice(0,2)&&(p=p.slice(1)),C){if(/^9\d/.test(p))p="("+p.slice(1);else if("("!==p[0])p="("+p;else{var Y=[],K=0;try{for(var J=a(p.split("").reverse()),Z=J.next();!Z.done;Z=J.next()){")"===(ee=Z.value)&&(K?Y.push("("):K+=1),"("===ee&&(K-=1),Y.push(ee)}}catch(e){s={error:e}}finally{try{Z&&!Z.done&&(l=J.return)&&l.call(J)}finally{if(s)throw s.error}}Y.reverse(),p=Y.join("")}L()}if(k[")"]>(k["("]||0)&&")"===p[0]&&(p="("+p.slice(1),L()),F&&(p.endsWith(9)||/\d+0$/.test(p))&&(p=p.slice(0,p.length-1)+")",L()),!F||p.endsWith(")")&&!p.startsWith("((")||(p+=")",L()),F){Y="";var X=0;try{for(var Q=a(p.split("")),$=Q.next();!$.done;$=Q.next()){var ee;"("===(ee=$.value)&&(X?Y+=")":X+=1),")"===ee&&(X-=1),Y+=ee}}catch(e){c={error:e}}finally{try{$&&!$.done&&(d=Q.return)&&d.call(Q)}finally{if(c)throw c.error}}p=Y}if(L(),O&&!x&&(p+="]"),p.includes("([")&&p.includes("])")&&(p=p.split("([").join("[").split("])").join("]"),L()),/\(\d+0$/.test(p)&&(p=p.slice(0,p.length-1)+")"),L(),1===k[")"]&&!k["("]&&p.endsWith(")")&&(p=p.slice(0,p.length-1)),p.startsWith("(")&&p.endsWith(")")&&1===k["("]&&1===k[")"]&&(p=p.slice(1,p.length-1),L()),/^\([\d ]+.*[\d ]+\)$/.test(p)&&k["("]===k[")"]){var te=p.slice(1,p.length-1);q=(G=te).indexOf("("),W=G.indexOf(")"),q>=0&&W>=0&&q<W&&(p=te,L())}return{score:p,applied:v}},handleGameSeparation:function(e){var t=e.score,r=new RegExp(/^\d+\/\d+/),n=t.split(" ");n.some((function(e){return r.test(e)}))&&(t=n.map((function(e){return r.test(e)?e.replace("/","-"):e})).join(" "));var i=/^(\d+), *(\d+)$/;if(i.test(t)){var a=o(t.match(i).slice(1),2);t=[a[0],a[1]].join("-")}return{score:t}},joinFloatingTiebreak:function(e){var t,r,n=e.score;if("string"!=typeof n)return{score:n};var i=function(e){return null==e?void 0:e.split("-").join("").split("/").join("")},s=function(e){return e.split("[").join("(").split("]").join(")")},l=(n=n.split(", ").join(" ")).split(" ");n=l.map((function(e){var t=/^-(\d+)$/;if(t.test(e)){var r=o(e.match(t).slice(1),1)[0];if(2===r.length)return r.split("").join("-")}return e})).join(" ");var c=(l=n.split(" ")).filter(NP),d=0,p="";try{for(var v=a(c),f=v.next();!f.done;f=v.next()){var m=f.value,h=A(m,l).filter((function(e){return!d||e>d}))[0],g=l.slice(d,h-1),I=l[h-1],y=i(I);if(/^\d+$/.test(y)&&2===y.length){var U=y.split("");if(1===(T=Math.abs(U.reduce((function(e,t){return+e-+t})))))p+=[g.join(" "),[I,m].join("")].join(" "),d=h+1;else if(0===T){var S=Math.max.apply(Math,u([],o(U),!1));if([4,5,6,7,8,9].includes(S)){var w=[S,[6,4].includes(S)?S+1:S-1].sort().reverse().join("-");p+=[g.join(" "),[w,m].join("")].join(" "),d=h+1}}}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}if(c.length&&p.length)return{score:(p=[p,l.slice(d).join(" ")].join(" ")).trim()};if(2===l.length&&["(","["].some((function(e){return l[1].includes(e)}))){var T;U=(y=i(l[0])).split("");if(1===(T=Math.abs(U.reduce((function(e,t){return+e-+t}),0))))return l[1]=s(l[1]),{score:l.join("")}}var P,D=l.map((function(e){return function(e){return/^\(\d+-\d+\)$/.test(e)||/^\[\d+-\d+\]$/.test(e)}(e)?"bracket":MP(e)&&"set"}));if(D.includes("set")&&D.includes("bracket")){var b,N="";return l.forEach((function(e,t){"bracket"===D[t]&&"set"===b?(e=s(e),N+=e):N+=" ".concat(e),b=D[t]})),{score:N.trim()}}var M=(l=n.split(" ")).map((function(e){var t=new RegExp(/^(\d+)-(\d+)$/);if(t.test(e)){var r=o(e.match(t).slice(1),2),n=r[0],i=r[1],a=Math.abs([n,i].reduce((function(e,t){return+e-+t}))),u=Math.max(n,i);if(1===a)return P="tiebreakSet";if(a>=2&&u>=7&&"tiebreakSet"===P)return P="tiebreak"}})),R=A("tiebreak",M);if(R.length){var E="";l.forEach((function(e,t){R.includes(t)?E+="(".concat(e,") "):R.includes(t+1)?E+="".concat(e):E+="".concat(e," ")})),n=E.trim()}var C=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(C.test(n)){var x=o(n.match(C).slice(1),3),O=(w=x[0],x[1]),F=x[2],k=Math.max(O,F)>=10;!MP(w)&&k&&(n=n.replace(C,"".concat(w," [").concat(O,"-").concat(F,"]")))}return M=[],n=n.split(" ").map((function(e){var t=/^\((.*)\)$/,r=t.test(e),n=(new RegExp(SP).test(e)?"super":new RegExp(UP).test(e)&&"tiebreak")||new RegExp(yP).test(e)&&"standard"||"unknown";return M.push(n),"standard"===n&&r?e.match(t)[1]:e})).join(" "),{score:n}},handleBracketSpacing:function(e){var t=e.score,r=e.applied;return t.includes("( ")&&(r.push("removeParenSpacingAfterOpen"),t=t.split("( ").map((function(e){return e.trim()})).join("(")),t.includes(" )")&&(r.push("removeParenSpacingBeforeClose"),t=t.split(" )").map((function(e){return e.trim()})).join(")")),[wP,TP].forEach((function(e){var n=t.match(e);(null==n?void 0:n.length)&&(n.forEach((function(e){t=t.replace(e,e.slice(0,e.length-1)+" ")})),r.push("setsEndComma"))})),{score:t=t.split(" ").filter(Boolean).map(CP).join(" "),applied:r}},handleSpaceSeparator:function(e){var t=e.score;if(t.includes(",")){var r=t.split(",").map((function(e){return e.trim()}));r.every((function(e){return/\d \d/.test(e)}))&&(t=r.map((function(e){var t,r;try{for(var n=a(e.match(/\d+ \d+/g)),i=n.next();!i.done;i=n.next()){var u=i.value,s=o(u.match(/(\d+) (\d+)/).slice(1),2),l=s[0],c=s[1];e=e.replace(u,"".concat(l,"-").concat(c))}}catch(e){t={error:e}}finally{try{i&&!i.done&&(r=n.return)&&r.call(n)}finally{if(t)throw t.error}}return e})).join(" "))}if(t.includes(" ")){var n=t.replace(/[ ,]/g,"");n.split("").every((function(e){return f(e)}))&&4===n.length&&(t=n)}return{score:t}},separateScoreBlocks:function(e){var t=e.score,r=e.applied;return"string"!=typeof t?{score:t}:(t=t.toLowerCase().split(" ").map((function(e){if(/^\d+$/.test(e)&&e.length>2){var t=e.indexOf("1");if(e.length%2){if(3===e.length&&0===t){var n=RP(e.split(""),t);return r.push("getSuper"),n}}else{var i=FP({score:e,applied:[]}),a=i.score,s=i.applied;a!==e&&(e=a,r.push.apply(r,u([],o(s),!1)))}}return e})).join(" "),{score:t,applied:r})},matchKnownPatterns:function(e){var t,r,n,i,u,s,l,c,d=e.score,p=e.applied;try{for(var v=a([".",","," ","/"]),f=v.next();!f.done;f=v.next()){var m=f.value,h=new RegExp("^(\\d+)\\".concat(m,"(\\d+)$"));if(h.test(d)){var g=d.match(h).slice(1).map((function(e){return parseInt(e)}));(Ue=Math.abs(g[0]-g[1]))<=10&&Ue>=2&&(d=d.split(m).join("-"),p.push("variedJoinerPattern"))}}}catch(e){t={error:e}}finally{try{f&&!f.done&&(r=v.return)&&r.call(v)}finally{if(t)throw t.error}}d.includes(";")&&(d=d.split(";").join(" "),p.push("semicolon set separation"));var I=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(I.test(d)){var y=o(d.match(I).slice(1),6),U=y[0],S=y[1],w=y[2],T=y[3],P=y[4],D=y[5];d=d.replace(I,"".concat(U).concat(S,"-").concat(w," ").concat(T,"-").concat(P).concat(D)),p.push("smashSlashPattern")}/.*\s6[/-]+$/.test(d)&&(d+="0",p.push("incompleteFinalSetPattern"));var b=/\(6,\)/g;b.test(d)&&(d=d.replace(b,"(6, 0)"),p.push("missingZeroPattern1"));var N=/^\d{3,}\(/,M=/\(\d+\)\d+/;[N,M].forEach((function(){var e=d.split(" ");d=e.map((function(e){return N.test(e)&&(e=e.replace("("," (")),M.test(e)&&(e=e.replace(")",") ")),e})).join(" "),p.push("spaceConsiderationPatterns")}));var R=CP(d);R!==d&&(d=R,p.push("deDashMash"));var A=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(A.test(d)){var E=o(d.match(A).slice(1),3),C=(S=E[0],E[1]),x=(P=E[2],o(C.split(""),2));w=x[0],T=x[1];d="".concat(S,"-").concat(w," ").concat(T,"-").concat(P),p.push("smashSetPattern")}var O=/^(\d+)[ -](\d+)$/,F=/^([\d -]+)\/([\d -]+)$/;if(F.test(d)){var k=o(d.match(F).slice(1),2),_=k[0],L=k[1];S=_.trim(),w=L.trim();if(O.test(S)&&O.test(w)){var j=S.match(O).slice(1,3).join("-"),B=w.match(O).slice(1,3).join("-");d="".concat(j," ").concat(B),p.push("slashSeparationPattern")}}var V=/^([\d -]+),([\d -]+)$/;if(V.test(d)){var G=o(d.match(V).slice(1),2);_=G[0],L=G[1],S=_.trim(),w=L.trim();if(O.test(S)&&O.test(w)){j=S.match(O).slice(1,3).join("-"),B=w.match(O).slice(1,3).join("-");d="".concat(j," ").concat(B),p.push("commaSeparationPattern")}}var q=/^\d \d,/;if(q.test(d)){var W=d.match(q)[0],H=W.slice(0,W.length-1).split(" ").join("-");d=d.replace(W,H),p.push("singleSetCommaSeparationPattern")}for(var z=0,Y=/(\d+)-(\d{2})-(\d+)/;Y.test(d)&&z<3;){var K=o(d.match(Y).slice(1),3),J=(_=K[0],K[1]),Z=(L=K[2],J.split("")),X="".concat(_,"-").concat(Z[0]," ").concat(Z[1],"-").concat(L);d=d.replace(Y,X),p.push("noSetSeparationPattern"),z+=1}var Q=d.match(/(^|\s)7-6\s(\d+)\s/g);if(null==Q?void 0:Q.length){var $=/(^|\s)7-6\s(\d+)\s/;Q.forEach((function(e){var t=e.match($).slice(2)[0];d=d.replace(e,"7-6(".concat(t,") ")),p.push("floatingTiebreakPattern1")}))}var ee=d.match(/\d \d /);null==ee||ee.forEach((function(e){var t=e.slice(0,e.length-1).split(" ").join("-");d=d.replace(e,t),p.push("spaceSeparatedSetPattern1")})),null==(ee=d.match(/ \d \d$/))||ee.forEach((function(e){var t=" "+e.slice(1).split(" ").join("-");d=d.replace(e,t),p.push("spaceSeparatedSetPattern2")}));var te=/^\d, *\d\/\d, *\d/;if(te.test(d)){var re=d.match(te)[0];H=re.split("/").map((function(e){return"(".concat(e,")")})).join(" ")+" ";d=d.replace(re,H),p.push("slashCommaSetPattern")}var ne=/\(6-\)/g;ne.test(d)&&(d=d.replace(ne,"(6-0)"),p.push("missingZeroPattern2"));var ie=/(?<!-)(\d+)\/(\d+)(?!-)/g;if(ie.test(d)){var ae=d.match(ie),oe=/(?<!-)(\d+)\/(\d+)(?!-)/,ue=d;ae.forEach((function(e){var t=o(e.match(oe).slice(1),2),r=t[0],n=t[1],i="".concat(r,"-").concat(n);ue=ue.replace(e,i)})),d=ue,p.push("slashSetPattern")}var se=/(.*)\s(1\d)\s(\d+)$/;if(se.test(d)){var le=o(d.match(se).slice(1),3),ce=le[0];S=le[1],w=le[2];ce.replace(/\D/g,"").length>=4&&(d=ce+" ".concat(S).concat(w),p.push("spaceSeparatedSuperPattern"))}try{for(var de=a(d.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g)||[]),pe=de.next();!pe.done;pe=de.next()){var ve=pe.value,fe=o(ve.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),4),me=(U=fe[0],fe[1]),he=fe[2],ge=(D=fe[3],o(me.split("-").map((function(e){return parseInt(e)})),2));S=ge[0],w=ge[1];1===(Ue=Math.abs(S-w))&&(d=d.replace(ve,"".concat(U).concat(me,"(").concat(he,")").concat(D)),p.push("spaceSeparatedSetPattern"))}}catch(e){n={error:e}}finally{try{pe&&!pe.done&&(i=de.return)&&i.call(de)}finally{if(n)throw n.error}}try{for(var Ie=a(d.match(/\d-\d \(\d{1,2}\)(\s|$|,)/g)||[]),ye=Ie.next();!ye.done;ye=Ie.next()){var Ue,Se=ye.value,we=o(Se.match(/(\d-\d) \((\d{1,2})\)(\s|$|,)/).slice(1),3),Te=(me=we[0],he=we[1],we[2]),Pe=o(me.split("-").map((function(e){return parseInt(e)})),2);S=Pe[0],w=Pe[1];1===(Ue=Math.abs(S-w))&&(d=d.replace(Se,"".concat(me,"(").concat(he,")").concat(Te)),p.push("floatingTiebreakPattern2"))}}catch(e){u={error:e}}finally{try{ye&&!ye.done&&(s=Ie.return)&&s.call(Ie)}finally{if(u)throw u.error}}try{for(var De=a(d.match(/(^|\s)(\d \d)\(/g)||[]),be=De.next();!be.done;be=De.next()){var Ne=be.value,Me=o(Ne.match(/(^|\s)(\d \d)\(/).slice(1),2),Re=(U=Me[0],Me[1]);d=d.replace(Ne,"".concat(U).concat(Re.split(" ").join("-"),"(")),p.push("spacedTiebreakPattern")}}catch(e){l={error:e}}finally{try{be&&!be.done&&(c=De.return)&&c.call(De)}finally{if(l)throw l.error}}return{score:d,applied:p}},removeDanglingBits:function(e){var t=e.score,r=e.attributes;(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some((function(e){return t.endsWith(e)}))&&(t=t.slice(0,t.length-1));var n="()/-".split("").some((function(e){return t.includes(e)}));/ \d$/.test(t)&&n&&(r={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));var i=/(.*)[A-Za-z]+$/;if(i.test(t)){var a=t.match(i).slice(1)[0];t=a.trim()}return{score:t,attributes:r}},removeErroneous:function(e){var t=e.score,r=e.applied;return"string"!=typeof t?{score:t}:[3,4].includes(t.length)&&OP(t)?{score:OP(t)}:{score:t=t.toLowerCase().split(" ").map((function(e){if(!/^\d+$/.test(e)||1!==e.length)return e;r.push("removeErroneous1")})).filter(Boolean).join(" "),applied:r}},handleWalkover:function(e){var t=e.score,r=e.applied;return["walkover","wo","w/o","w-o"].includes(null==t?void 0:t.toString().toLowerCase())?(r.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:r}):{score:t}},properTiebreak:function(e){var t,r,n,i=e.score,u=e.matchUpStatus,s=null==i?void 0:i.split(" ");i=s.map((function(e){if(e.endsWith("]")){var t=e.split("[");if(MP(t[0]))return t[0]+"(".concat(t[1].slice(0,t[1].length-1),")")}return e})).join(" ");var l=new RegExp(/(\([\d ]+\))/g);if(l.test(i))try{for(var c=a(i.match(l)),d=c.next();!d.done;d=c.next()){var p=d.value,v=null===(n=p.replace(" ","-").match(/\((.*)\)/))||void 0===n?void 0:n[1];if(f(v)&&(null==v?void 0:v[0])>2)if([2,4].includes(v.length))v=v.split("").join("-");else if(3===v.length){var m=v.indexOf("1");v=RP(v.split(""),m)}i=i.replace(p,"(".concat(v,")"))}}catch(e){t={error:e}}finally{try{d&&!d.done&&(r=c.return)&&r.call(c)}finally{if(t)throw t.error}}s=null==i?void 0:i.split(" ");var h=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),g=s.length-1;i=s.map((function(e,t){var r=[void 0,"","COMPLETED"].includes(u)||t!==g;if(h.test(e)&&r){var n=o(Array.from(e.match(h)).slice(1),3),i=n[0],a=n[1],s=n[2],l=Math.min(a,s);return"".concat(i,"(").concat(l,")")}return e})).join(" "),s=null==i?void 0:i.split(" "),h=new RegExp(/^(\d{2})\((\d+)\)$/),i=s.map((function(e){if(h.test(e)){var t=o(Array.from(e.match(h)).slice(1),2),r=t[0],n=t[1],i=r.split("");return"".concat(i[0],"-").concat(i[1],"(").concat(n,")")}return e})).join(" "),s=null==i?void 0:i.split(" "),h=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),i=s.map((function(e){if(h.test(e)){var t=o(Array.from(e.match(h)).slice(1),2),r=t[0],n=t[1];return MP(r)?"".concat(r,"(").concat(n,")"):r}return e})).join(" "),s=null==i?void 0:i.split(" "),h=new RegExp(/^1-0\((\d+)\)$/),i=s.map((function(e){if(h.test(e)){var t=o(e.match(h).slice(1),1)[0],r=t<9?10:parseInt(t)+2;return"[".concat(r,"-").concat(t,"]")}return e})).join(" ");var I=/\((\d)+0 /;if(I.test(i)){var y=i.match(I)[1];i=i.replace(I,"(".concat(y,") "))}return{score:i}},handleNumeric:FP,handleRetired:function(e){var t,r=e.score,n=e.profile,i=e.applied;r=null==r?void 0:r.toString().toLowerCase();var a=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(a.test(r)){var s=o(r.match(a).slice(1),1)[0];return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}var l=null===(t=null==n?void 0:n.matchUpStatuses)||void 0===t?void 0:t.retired,c=u(["rtd"],o(Array.isArray(l)?l:[l].filter(Boolean)),!1).find((function(e){return null==r?void 0:r.endsWith(e)}));return c?(i.push("handleRetired"),{matchUpStatus:"retired",score:null==r?void 0:r.replace(c,"").trim(),applied:i}):{score:r}},containedSets:function(e){var t,r,n,i=e.score,s=e.attributes,l=e.identifier;if("string"!=typeof i)return{score:i,identifier:l};var c=new RegExp(/\([\d,/ ]+\)/g),d=i.match(c);try{for(var p=a(d||[]),v=p.next();!v.done;v=p.next()){var m=v.value,h=m.match(/^\((.*)\)$/),g=null===(n=null==h?void 0:h.slice(1))||void 0===n?void 0:n[0],I=i.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if(2===(null==g?void 0:g.length)&&(null==I?void 0:I.length)>=2){var y=I.slice(I.length-2).split("").map((function(e){return parseInt(e)}));if(1===Math.abs(y[0]-y[1]))continue}var U=CP(AP(g));i=i.replace(m,"(".concat(U,")")).trim()}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}var S=new RegExp(/\[[\d,/ ]+\]/g),w=i.match(S);if(null==w||w.forEach((function(e){var t=AP(e.match(/^\[(.*)\]$/)[1]);i=i.replace(e,"(".concat(t,") ")).trim()})),i.startsWith("(")&&[")","]"].some((function(e){return i.endsWith(e)}))&&[")(","), (",") (",")[",") [","](","] ("].some((function(e){return i.includes(e)}))){var P,D="",b=i.split(/[)\]]/).filter(Boolean).map((function(e){return e.startsWith(",")&&(e=e.slice(1)),e.trim()})),N=b.every((function(e){return e.includes(",")||NP(e)})),M=b.every((function(e){return e.includes("/")||NP(e)})),R=b.every((function(e){return e.includes("-")||NP(e)})),A=(N?",":R&&"-")||M&&"/";if(A)b.forEach((function(e){if(e.startsWith("("))if("set"===P&&(D+=" "),e.includes(A))D+=e.slice(1).split(A).map((function(e){return e.trim()})).join("-"),P="set";else{var t=e.slice(1);D+="(".concat(t,") "),P="tiebreak"}else if(e.startsWith("[")){var r=e.slice(1).split(A).map((function(e){return parseInt(e.trim())})),n=Math.min.apply(Math,u([],o(r),!1));D+="set"===P?"(".concat(n,") "):"[".concat(r.join("-"),"] "),P="tiebreak"}})),i=D.trim()}var E=T(i.split(""));1===E["("]&&1===E[")"]&&i.startsWith("(")&&i.endsWith(")")&&(i=i.slice(1,i.length-1),1===E["-"]&&MP(i)&&f(null==s?void 0:s.removed)&&(i+="(".concat(s.removed,")"),s.removed=void 0));var C=/\(\)/g;return C.test(i)&&(i=i.replace(C,"").trim()),{score:i}},sensibleSets:function(e){var t,r=e.score,n=e.matchUpStatus,i=e.attributes,a=[],s=r.split(" "),l=s.length;r=s.map((function(e,r){var i;if(new RegExp(UP).test(e)){var s=e.slice(3),c=e.slice(0,3),d=c.split("-");if(!MP(c)&&!n){var p=Math.max.apply(Math,u([],o(d),!1)),v=[p,p-1];return c.indexOf(p)&&v.reverse(),v.join("-")+s}}else if(2===e.length&&f(e))return e.split("").join("-");e=CP(e);var m=(new RegExp("^".concat(SP,"$")).test(e)?"super":new RegExp("^".concat(UP,"$")).test(e)&&"tiebreak")||new RegExp("^".concat(yP,"$")).test(e)&&"standard"||"unknown";if(a.push(m),l>1&&"standard"===m&&r<2){var h=o(e.split("-"),2),g=h[0],I=h[1],y=Math.abs(parseInt(g)-parseInt(I)),U=Math.max(g,I),S=Math.min(g,I),w=[parseInt(g),parseInt(I)].indexOf(S);if(U>9&&y>2){var T=U.toString().split(""),P=null!==(i=T.find((function(e){return parseInt(e)>S||r&&parseInt(e)<=t})))&&void 0!==i?i:T[0];P&&(e=w?[P,S].join("-"):[S,P].join("-"))}U>(t||0)&&(t=U)}if("standard"===m){var D=o(e.split("-"),2);g=D[0],I=D[1];if(!(y=Math.abs(parseInt(g)-parseInt(I)))&&"RETIRED"!==n)return""}return e})).filter(Boolean).join(" ");var c=kP(r),d=c.setsWon,p=c.setWinners;if(1===c.totalSets&&"6"===(null==i?void 0:i.removed)&&(r+=" 6-0"),r.split(" ").length>2&&Math.max.apply(Math,u([],o(d),!1))>=2&&p[0]===p[1]&&(r=r.split(" ").slice(0,2).join(" ")),Math.max.apply(Math,u([],o(d),!1))>2){var v=[0,0];r=r.split(" ").map((function(e,t){return v[p[t]]+=1,Math.max.apply(Math,u([],o(v),!1))>2?void 0:e})).filter(Boolean).join(" ")}return{score:r,profile:a}},stringScore:function(e){var t=e.score;return{score:t=(null==t?void 0:t.toString().toLowerCase())||""}},superSquare:function(e){var t=e.score,r=kP(t),n=r.setsTied,i=/\s\((\d+)\)$/;if(!r.winningSide&&n&&i.test(t)){var a=t.match(i).slice(1)[0],s=a<=8?10:a+2;t=t.replace(i," [".concat(s,"-").concat(a,"]"))}var l=t.split(" "),c=l[l.length-1];if(!c.includes("-")||c.indexOf("(")>0)return{score:t};var d=c.split("(").join("").split(")").join("").split("-");if(!d.every((function(e){return f(e)})))return{score:t};if("76"===d[0]){var p=2===d[1].length?Math.min.apply(Math,u([],o(d[1].split("").map((function(e){return parseInt(e)}))),!1)):d[1];t=u(u([],o(l.slice(0,l.length-1)),!1),["7-6(".concat(p,")")],!1).join(" ")}else{d=d.map((function(e){return parseInt(e)}));var v=Math.max.apply(Math,u([],o(d),!1)),m=Math.abs(d[0]-d[1]);if(v>=10){if(m>2&&d.every((function(e){return+e>=10}))){var h=d.map((function(e){return e===v?e-10:10})).sort();(m=Math.abs(h[0]-h[1]))>2&&(d=h)}t=u(u([],o(l.slice(0,l.length-1)),!1),["[".concat(d.join("-"),"]")],!1).join(" ")}else 3===l.length&&v>=7&&m>2&&(t=u(u([],o(l.slice(0,l.length-1)),!1),["[".concat(d.join("-"),"]")],!1).join(" "))}return{score:t}},setBuilder:xP,excisions:function(e){var t=e.score,r=new RegExp(/^\[\d+\](.*)$/);r.test(t)&&(t=t.match(r).slice(1)[0].trim());var n=/\(,/g;return n.test(t)&&(t=t.replace(n,"(")),{score:t}},replaceOh:function(e){var t=e.score,r=e.applied;return"string"!=typeof t?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map((function(e){return e.split("o").join("0")})).join(" "),r.push("replaceOh")),{score:t,applied:r})}},LP={},jP=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],BP=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function VP(e){var t=e.analysis,r=e.set,n=qP({set:r}),i=t.isDecidingSet,a=t.isTiebreakSet;return GP({matchUpScoringFormat:t.matchUpScoringFormat,isDecidingSet:i,isTiebreakSet:a,set:r})&&n}function GP(e){var t=e.matchUpScoringFormat,r=e.ignoreTiebreak,n=void 0!==r&&r,i=e.matchUpFormat,a=e.isTiebreakSet,o=e.isDecidingSet,u=e.set;if(!u)return{error:pt};t=t||i;var s=o&&t.finalSetFormat||(null==t?void 0:t.setFormat)||{},l=u.side1Score,c=u.side2Score,d=s.NoAD,p=s.setTo,v=s.tiebreakAt,f=s.tiebreakFormat,m=null==f?void 0:f.NoAd,h=qP({set:u}),g=Math.abs(l-c),I=l>=p||c>=p,y=a||l>=p&&c>=p||v&&v<p&&(l===v||c===v),U=n||y&&(1===h&&u.side1TiebreakScore>u.side2TiebreakScore||2===h&&u.side2TiebreakScore>u.side1TiebreakScore);return(I&&(g>=(d||y&&(v&&!a||a&&m)?1:2)||y)||a)&&(!y||U)}function qP(e){var t=e.set;if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}var WP=" ",HP="DEF",zP="WO",YP="ABN",KP="SUS",JP="RET",ZP="INT",XP=[JP,HP,zP,"WO/WO",YP,KP,ZP],QP="DEFAULTED",$P="WALKOVER",eD="ABANDONED",tD="SUSPENDED",rD="RETIRED",nD="INTERRUPTED",iD=[rD,QP,$P],aD="()",oD="[]",uD=["up","left","shift+tab"],sD=["enter","down","tab","right"],lD="backspace",cD="r",dD="s",pD="a",vD="d",fD="w",mD="i",hD=[cD,vD,fD,pD,dD,mD],gD="space",ID=["[","("],yD=u(u(u([],o(uD),!1),o(sD),!1),[gD,"]"],!1),UD="-",SD="-",wD=["/"],TD=["0","1","2","3","4","5","6","7","8","9"].concat(hD),PD=TD.map((function(e){return"shift+".concat(e)})),DD=[UD,lD].concat(yD,wD),bD=[TD,PD,DD].join(","),ND=[bD,uD,sD,["=","+","num_1","num_2","shift+=","shift+-"]].join(",");[].concat.apply([],u(u(u(u(u(u(u(u(u([],o(TD),!1),o(TD),!1),o(DD),!1),o(TD),!1),o(TD),!1),o(TD),!1),o(TD),!1),o(TD),!1),o(TD),!1));var MD={OUTCOMEKEYS:hD,SIDE1KEYS:TD,SIDE2KEYS:PD,MODIFIERS:DD,PROMPT:"Enter Score",MOVEUP:uD,MOVEDOWN:sD,HOTKEYS:ND};function RD(e){var t=e.scoreString,r=e.lowSide,n=e.outcome;return t=AD({scoreString:t}).scoreString,2===r?t+((t&&t[t.length-1])!==WP?WP:"")+n:n+WP+t}function AD(e){var t,r,n=e.scoreString;if(!n)return{scoreString:""};var i=!1;try{for(var o=a(XP),u=o.next();!u.done;u=o.next()){var s=u.value,l=null==n?void 0:n.indexOf(s);0===l?n=n.slice(s.length+1).trim()+WP:l>0&&(n=n.slice(0,l)),l>=0&&(i=!0)}}catch(e){t={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(t)throw t.error}}return(null==n?void 0:n.trim())||(n=""),{scoreString:n,removed:i}}function ED(e){var t,r,n,i,a,o=e.analysis,u=e.scoreString,s=e.sets,l=e.lowSide;if(!u)return{scoreString:u,sets:s};var c=AD({scoreString:u});if(u=c.scoreString,c.removed)return{scoreString:u,sets:s,outcomeRemoved:!0};var d=s[s.length-1]||{},p=Object.values(d).filter((function(e){return void 0!==e})).length;d.setNumber&&1===p&&(d=(s=s.slice(0,s.length-1))[s.length-1]||{});var v=o.setFormat.tiebreakSet||{},f=v.tiebreakTo,m=v.NoAD,h=CD({brackets:oD,scoreString:u}).isTiebreakEntry,g=function(e){var t=e.split("").reduce((function(e,t,r){return t.match(/\d+/g)&&e.push(r),e}),[]);return t.pop()}(u);if(g>=0){i=u.slice(0,g);var I=CD({brackets:aD,scoreString:i}).isTiebreakEntry,y=CD({brackets:oD,scoreString:i}),U=y.lastOpenBracketIndex,S=y.isTiebreakEntry,w=i&&i[i.length-1].trim(),T=i&&!isNaN(w),P=o.isIncompleteSetScore;if(h&&S){var D=i.slice(U+1).split(SD),b=(null==D?void 0:D.length)>0&&void 0!==D[0]&&!isNaN(parseInt(D[0]))&&parseInt(D[0])||void 0,N=(null==D?void 0:D.length)>1&&void 0!==D[1]&&parseInt(D[1])||void 0,M=[b,N];if(N){var R=1===l?1:0;M[R]=((null==M?void 0:M[1-R])||0)+(m?1:2),(M[R]||0)<f&&(M[R]=f),i=u.slice(0,U+1),i+=M.join(SD)}else void 0!==b?(i=u.slice(0,U+1),i+=b):(i=u.slice(0,U),P=!0);d.side1TiebreakScore=M[0]||0,d.side2TiebreakScore=M[1]||0}if(i.length||(i=void 0),P){if(C=null===(t=d.side1Score)||void 0===t?void 0:t.toString()){var A=null==C?void 0:C.slice(0,C.length-1);d.side1Score=!isNaN(A)&&parseInt(A)||void 0,void 0===d.side1Score&&(d.side2Score=void 0)}o.isTimedSet?(a=d.side1Score?s:(null==s?void 0:s.slice(0,s.length-1))||[])[s.length-1]=d:a=(null==s?void 0:s.slice(0,s.length-1))||[]}else if(T){var E=null===(r=d.side2Score)||void 0===r?void 0:r.toString(),C=null===(n=d.side1Score)||void 0===n?void 0:n.toString();if(!o.isTiebreakEntry&&!o.isMatchTiebreak)if(d.side2Score){var x=null==E?void 0:E.slice(0,E.length-1);d.side2Score=!isNaN(x)&&parseInt(x)||void 0}else{A=null==C?void 0:C.slice(0,C.length-1);d.side1Score=!isNaN(A)&&parseInt(A)||void 0}o.isTimedSet?d.side1Score?(a=s||[])[s.length-1]=d:a=(null==s?void 0:s.slice(0,s.length-1))||[]:(a=s||[])[s.length-1]=d,a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else I?(a=s||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!S?a=(null==s?void 0:s.slice(0,s.length-1))||[]:(a=s)[s.length-1]=d,h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:i,sets:a}}return{scoreString:u,sets:s}}function CD(e){var t=e.brackets,r=void 0===t?aD:t,n=e.scoreString;if(!n)return{};var i=o(r.split(""),2),a=i[0],s=i[1],l=n.split(""),c=Math.max.apply(Math,u([],o(A(a,l)),!1));return{isTiebreakEntry:c>Math.max.apply(Math,u([],o(A(s,l)),!1)),lastOpenBracketIndex:c}}function xD(e){var t=e||{},r=t.lowValue,n=void 0===r?0:r,i=t.NoAD,a=void 0!==i&&i,o=t.tiebreakTo;return n+1>=o?n+(a?1:2):parseInt(o)}function OD(e){var t=e.matchUpFormat,r=e.matchUpStatus,n=e.winningSide,i=e.sets,a=Zd(t).bestOf,o=Math.ceil(a/2),u=null==i?void 0:i.reduce((function(e,t){var r=t.winningSide;return r&&e[r-1]++,e}),[0,0]),s=(null==u?void 0:u.indexOf(o))+1||void 0;return iD.includes(r)&&n&&(s=n),{matchUpWinningSide:s}}function FD(e){var t,r=e.lowSide,n=e.value,i=e.sets,a=e.scoreString,o=e.winningSide,u=e.matchUpStatus;return n===cD?a?(t=!0,a=RD({scoreString:a,lowSide:r,outcome:JP}),o=2===r?1:2,u=rD):(t=!0,a=RD({scoreString:a,lowSide:r,outcome:HP}),o=2===r?1:2,u=QP):n===vD?(t=!0,a=RD({scoreString:a,lowSide:r,outcome:HP}),o=2===r?1:2,u=QP):n===fD?(t=!0,i=[],a=zP,o=2===r?1:2,u=$P):n===dD&&a?(t=!0,a=RD({scoreString:a,lowSide:r,outcome:KP}),u=tD,o=void 0):n===pD?(t=!0,a=RD({scoreString:a,lowSide:r,outcome:YP}),u=eD,o=void 0):n===mD&&a&&(t=!0,a=RD({scoreString:a,lowSide:r,outcome:ZP}),u=nD,o=void 0),{updated:t,sets:i,scoreString:a,matchUpStatus:u,winningSide:o}}function kD(e){var t,r,n,i=e.matchUpFormat,a=e.scoreString,s=e.winningSide,l=e.value,c=e.sets,d=((null===(t=null==c?void 0:c.filter((function(e){return null==e?void 0:e.winningSide})))||void 0===t?void 0:t.length)||0)+(s?0:1),p=Zd(i),v=d===(null==p?void 0:p.bestOf),f=v&&(null==p?void 0:p.finalSetFormat)||(null==p?void 0:p.setFormat)||{},m=null==f?void 0:f.timed,h=v&&c[(null==p?void 0:p.bestOf)-1],g=null==h?void 0:h.winningSide,I=CD({brackets:aD,scoreString:a}).isTiebreakEntry,y=CD({brackets:oD,scoreString:a}).isTiebreakEntry,U=I||y,S=!!f.tiebreakSet,w=null===(r=null==a?void 0:a[a.length-1])||void 0===r?void 0:r.trim(),T=a&&!isNaN(w),P=!U&&w===UD,D=I&&ID.includes(w),b=y&&ID.includes(w),N=y&&w===SD,M=null==a?void 0:a.split(""),R=o(oD.split(""),1)[0],E=M&&Math.max.apply(Math,u([],o(A(R,M)),!1)),C=M&&Math.max.apply(Math,u([],o(A(SD,M)),!1)),x=M&&C>E,O=null===(n=c[c.length-1])||void 0===n?void 0:n.winningSide,F=(null==c?void 0:c.length)&&!O,k=XP.find((function(e){return(null==a?void 0:a.indexOf(e))>=0})),_=!isNaN(l),L=l===gD,j=yD.includes(l),B=null==a?void 0:a.split("").find((function(e){return ID.includes(e)})),V=j&&y&&!b&&(N||!function(e){var t=e.scoreString;if(!t)return!1;var r=t&&t[t.length-1].trim(),n=t&&!isNaN(r),i=o(oD.split(""),2),a=i[0],s=i[1],l=t.split(""),c=Math.max.apply(Math,u([],o(A(a,l)),!1)),d=Math.max.apply(Math,u([],o(A(s,l)),!1)),p=Math.max.apply(Math,u([],o(A(SD,l)),!1));return n&&c>d&&p>c}({scoreString:a}));return{isTiebreakSetValue:S&&_,matchUpScoringFormat:p,setNumber:d,setFormat:f,matchTiebreakHasJoiner:x,isGameScoreEntry:F,isSpace:L,isCloser:j,isTiebreakCloser:j&&B&&U&&T,isDecidingSet:v,isTiebreakSet:S,isTimedSet:m,isNumericEnding:T,isNumericValue:_,hasOpener:B,hasOutcome:k,finalSet:h,finalSetIsComplete:g,lastSetIsComplete:O,isInvalidSetTiebreakValue:L&&U&&D,isInvalidMatchTiebreakValue:V,isTiebreakEntry:U,isSetTiebreakEntry:I,isMatchTiebreakEntry:y,isIncompleteSetScore:P,isIncompleteSetTiebreak:D,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:N}}function _D(e){var r=e.matchUp,n=Vn({name:lo,element:r}).extension;if(!n)return{error:jr};var i=n.value,a=i.history,o=void 0===a?[]:a,u=i.undoHistory;return t({history:o,undoHistory:void 0===u?[]:u},L)}function LD(e){var t=e.undoHistory,r=e.history;return jn({element:e.matchUp,extension:{value:{history:r,undoHistory:t},name:lo}})}var jD={analyzeSet:ew,checkScoreHasValue:Bp,checkSetIsComplete:GP,generateScoreString:PI,generateTieMatchUpScore:og,getSetComplement:eS,getTiebreakComplement:tS,isValidMatchUpFormat:Fm,keyValueScore:function(e){var t,r,n,i,a,s,c,d,p=e.lowSide,v=void 0===p?1:p,f=e.value,m=e.scoreString,h=e.sets,g=e.winningSide,I=e.matchUpStatus,y=e.matchUpFormat,U=e.shiftFirst,S=e.auto,w=void 0===S||S,T=U&&2===v||!U&&1===v;if(!bD.includes(f))return{updated:!1,info:"invalid key"};U&&(v=3-v);var P=kD({value:f,winningSide:g=OD({sets:h,winningSide:g,matchUpStatus:I,matchUpFormat:y}).matchUpWinningSide,scoreString:m,sets:h,matchUpFormat:y});if(wD.includes(f)&&(f=UD),P.hasOpener&&P.isTiebreakEntry&&!P.isTiebreakSet&&T&&0===l(f)&&(P.isTiebreakCloser=!0),yD.includes(f)&&P.hasOpener&&(f=""),yD.includes(f)&&(f=gD),P.lastSetIsComplete){var D=(null==m?void 0:m.length)&&m[m.length-1];m&&" "!==D&&(m+=" ")}if(P.isTimedSet)t=function(e){var t,r,n,i,a=e.sets,o=e.info,u=e.scoreString,s=e.winningSide,c=e.matchUpStatus,d=e.analysis,p=e.lowSide,v=e.value;(null==a?void 0:a.length)||v===lD||(a=[{setNumber:1}]);var f=a.length-1;if(hD.includes(v)){var m=(I=a[a.length-1]||{}).side1Score,h=I.side2Score;m&&!h?o="missing side2Score":d.finalSetIsComplete||s?o="final set is already complete":d.isIncompleteSetScore?o="incomplete set scoreString":d.isIncompleteSetScore||(a=(t=FD({lowSide:p,value:v,sets:a,scoreString:u,matchUpStatus:c,winningSide:s})).sets,u=t.scoreString,s=t.winningSide,c=t.matchUpStatus,n=t.updated)}else if(v===lD){if(u=(r=ED({analysis:d,scoreString:u,sets:a})).scoreString,a=r.sets,i=r.outcomeRemoved,""===(null==u?void 0:u.trim())&&(u=u.trim()),u||(a=[]),i&&(m=(I=a[a.length-1]||{}).side1Score,h=I.side2Score,m&&h)){var g=(m>h?1:h>m&&2)||void 0;g&&(I.winningSide=g,a.push({setNumber:a.length+1}))}c=void 0,s=void 0,n=!0}else if(d.hasOutcome)o="has outcome";else{if(s)return{sets:a,scoreString:u,winningSide:s,matchUpStatus:c,updated:!1,info:"matchUp is complete"};if(v===gD){var I,y=((m=(I=a[a.length-1]||{}).side1Score)>(h=I.side2Score)?1:h>m&&2)||void 0;!y||s||d.isIncompleteSetScore||(a[a.length-1].winningSide=y,a.push({setNumber:a.length+1}),u+=" ",n=!0)}else if(v===UD&&void 0!==a[f].side1Score&&void 0===a[f].side2Score&&u&&d.isNumericEnding)u+="-",a[f].side2Score=0,c=void 0,s=void 0,n=!0;else if(!isNaN(v)){var U=void 0;if(void 0===a[f].side2Score){var S=l((a[f].side1Score||0).toString()+v).toString().slice(0,2);a[f].side1Score=l(S),U=a[f].side1Score.toString(),n=!0}else S=l((a[f].side2Score||0).toString()+v).toString().slice(0,2),a[f].side2Score=l(S),U=[a[f].side1Score,a[f].side2Score].join("-"),n=!0;if(n){var w=(a.slice(0,f)||[]).filter((function(e){return e})).map((function(e){return[e.side1Score,e.side2Score].join("-")})).join(" ");u=w?w+" "+U:U}}}return{sets:a,scoreString:u,winningSide:s,matchUpStatus:c,info:o,updated:n}}({analysis:P,lowSide:v,scoreString:m,sets:h,matchUpStatus:I,winningSide:g,value:f}),d=t.info,h=t.sets,m=t.scoreString,c=t.updated,I=t.matchUpStatus,g=t.winningSide;else if(hD.includes(f))P.finalSetIsComplete||g?d="final set is already complete":P.isTiebreakEntry||P.isIncompleteSetScore?P.isTiebreakEntry||P.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:f}):(h=(r=FD({lowSide:v,sets:h,scoreString:m,matchUpStatus:I,winningSide:g,value:f})).sets,m=r.scoreString,I=r.matchUpStatus,g=r.winningSide,c=r.updated);else if(f===lD)c=!0,m=(n=ED({analysis:P,scoreString:m,sets:h,lowSide:v})).scoreString,h=n.sets,m||(h=[]),I=void 0,g=void 0;else if(P.hasOutcome)d="has outcome";else if(f!==UD||P.isMatchTiebreakEntry)if(f===SD&&P.isMatchTiebreakEntry&&!P.isSetTiebreakEntry)P.matchTiebreakHasJoiner?d="existing joiner":P.isNumericEnding&&(c=!0,m+=SD);else if([UD,SD].includes(f))d="invalid location for joiner";else{if(g)return{updated:!1,info:"matchUp is complete"};if(P.isIncompleteSetScore)P.isNumericValue&&(a=function(e){var t,r=e.analysis,n=e.scoreString,i=e.sets,a=e.value;if(!(null==i?void 0:i.length))return{sets:[]};var o=i[i.length-1],u=function(e){var t,r,n=e.analysis,i=e.set,a=void 0===i?{}:i,o=e.value,u=n.isDecidingSet&&n.matchUpScoringFormat.finalSetFormat||n.matchUpScoringFormat.setFormat,s=u.tiebreakAt,l=u.setTo,c=u.NoAD,d=a.side1Score;return(t=s&&s<l?d===s?o<=l:o<=s:d===l?c?o<l:o<=l+1:d===l-1?c?o<=l:o<=l+1:d===l+1?o===l||o===l-1:o<=l)&&(r=s&&s<l?d===l&&o===s||d===s&&o===l:d>=l&&o>=l&&d!==o),{validSide2Score:t,requiresTiebreak:r}}({analysis:r,set:o,value:a=l(a)}),s=u.validSide2Score,c=u.requiresTiebreak;if(s){t=!0,n=(n||"")+a,o.side2Score=a;var d=VP({analysis:r,set:i[i.length-1]});o.winningSide=d||void 0,c?n+=aD.split("")[0]:r.isDecidingSet||(n+=WP)}return{sets:i,scoreString:n,updated:t}}({analysis:P,scoreString:m,sets:h,value:f}),h=a.sets,m=a.scoreString,c=a.updated);else if(P.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(P.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(P.isTiebreakCloser){var b=P.isSetTiebreakEntry?aD:oD,N=b.split("").reverse()[0],M=b.split("")[0],R=h[h.length-1],E=P.setFormat.tiebreakFormat||{},C=E.tiebreakTo,x=E.NoAD,O=qP({set:R});if(!P.isTiebreakSet){var F=parseInt(m.split(M).reverse()[0]),k=xD({lowValue:F,tiebreakTo:C,NoAD:x});1===O?(R.side1TiebreakScore=k,R.side2TiebreakScore=F):(R.side1TiebreakScore=F,R.side2TiebreakScore=k)}m=(m||"")+N,P.isDecidingSet||(m+=WP);var _=VP({analysis:P,set:R});R.winningSide=_||void 0,c=!0}else if(P.isTiebreakSetValue)s=function(e){var t,r,n,i=e.analysis,a=e.auto,u=e.lowSide,s=e.scoreString,c=void 0===s?"":s,d=e.sets,p=e.value,v=i.setFormat.tiebreakSet,f=v.tiebreakTo,m=v.NoAD,h=o(oD.split(""),1)[0];if(i.isMatchTiebreakEntry||(c+=h),d[i.setNumber-1]){var g=CD({brackets:oD,scoreString:c}).lastOpenBracketIndex,I=(c.slice((null!=g?g:0)+1)+(a?"":p)).split(SD);if(((null===(t=I[u-1])||void 0===t?void 0:t.length)||0)>=2)n="tiebreak digit limit";else if(a){1===u&&(I[0]=(I[0]||"")+p),2===u&&(I[1]=(I[1]||"")+p);var y=1===u?1:0;(w=[I[0]||0,I[1]||0].map((function(e){return l(e)})))[y]=w[1-y]+(m?1:2),w[y]<f&&(w[y]=f),(U=d[d.length-1]).side1TiebreakScore=w[0],U.side2TiebreakScore=w[1],c=c.slice(0,(null!=g?g:0)+1),c+=w.join(SD),r=!0}else{var U;w=[I[0]||0,I[1]||0].map((function(e){return l(e)})),(U=d[d.length-1]).side1TiebreakScore=w[0],U.side2TiebreakScore=w[1],c+=p,r=!0}}else{var S=xD({lowValue:l(p||0),tiebreakTo:f,NoAD:m}),w=[l(p),S];2===u&&w.reverse();var T={side1TiebreakScore:w[0],side2TiebreakScore:w[1],setNumber:(null==d?void 0:d.length)+1||1};d.push(T),c+=w.join(SD),r=!0}return{info:n,scoreString:c,sets:d,updated:r}}({analysis:P,auto:w,lowSide:v,scoreString:m,sets:h,value:f}),d=s.info,m=s.scoreString,h=s.sets,c=s.updated;else if(P.isSetTiebreakEntry){var L=o(aD.split(""),1)[0],j=Math.max.apply(Math,u([],o(A(L,m.split(""))),!1)),B=m.slice(j+1),V=B&&0===l(B),G=l(B?B+f:f),q=P.setFormat.tiebreakFormat||{};C=q.tiebreakTo,x=q.NoAD;!V&&B.length<2?x&&G>C-1?d="invalid low value for NoAD tiebreak":(c=!0,m=(m||"")+f):d=V?"tiebreak begins with zero":"tiebreak digit limit"}else if(P.isCloser)d="invalid key: ".concat(f);else if(P.isGameScoreEntry)d="game scoreString entry";else if(P.lastSetIsComplete||!h.length){c=!0;var W=function(e){var t=e.analysis,r=e.lowSide,n=e.scoreString,i=e.value,a=(null==t?void 0:t.setFormat)||{},o=a.setTo,u=a.tiebreakAt,s=a.NoAD,l=i===parseInt(u||o);if(u&&u<o&&i>u)return{scoreString:n};if(s&&i===o||i>o)return{scoreString:n};var c=l?i+1:i+1===o?i+(s?1:2):o,d=[i,c];2===r&&d.reverse();var p=aD.split("")[0];n=(n||"")+(d.join(UD)+(l?p:WP));var v={side1Score:d[0],side2Score:d[1]},f=VP({analysis:t,set:v});return v.winningSide=f||void 0,{scoreString:n,set:v}}({analysis:P,lowSide:v,scoreString:m,value:l(f)}),H=W.scoreString;(R=W.set)&&(R.setNumber=(null==h?void 0:h.length)+1||1),h=(null==h?void 0:h.concat(R).filter(Boolean))||[R],m=H||void 0}else console.log("error: unknown outcome")}else(!P.isSetTiebreakEntry||P.isSetTiebreakEntry&&!P.isNumericEnding)&&(c=!0,m=(i=ED({analysis:P,scoreString:m,sets:h,lowSide:v})).scoreString,h=i.sets,I=void 0);if(c){var z=OD({sets:h=null==h?void 0:h.filter(Boolean),winningSide:g,matchUpStatus:I,matchUpFormat:y}).matchUpWinningSide;return g=z,!z||I&&![Yo,qo].includes(I)?!m||g||[tD,eD,nD].includes(I)||(I=void 0):(I="COMPLETED",h=h.filter((function(e){var t=e.side1Score,r=e.side2Score,n=e.side1TiebreakScore,i=e.side2TiebreakScore;return t||r||n||i}))),{updated:c,scoreString:m,sets:h,winningSide:g,matchUpStatus:I,info:d}}return{updated:c,scoreString:m,sets:h,winningSide:g,matchUpStatus:I,info:d}},parseMatchUpFormat:Zd,reverseScore:function(e){if(!(null==e?void 0:e.score))return{error:pt};var r=e.score.sets.map((function(e){var t=e.side1TiebreakScore,r=e.side2TiebreakScore,n=e.winningSide,i=e.side1Score;return xn({winningSide:n?3-n:void 0,side1TiebreakScore:r,side2TiebreakScore:t,side1Score:e.side2Score,side2Score:i,setNumber:e.setNumber})})),n=PI({sets:r}),i=PI({sets:r,reversed:!0});return t({reversedScore:{sets:r,scoreStringSide1:n,scoreStringSide2:i}},L)},stringifyMatchUpFormat:Am,tidyScore:function(e){if(!e.score)return{error:xr};var t=e.score;e.sheetName;var r=e.identifier;e.fileName;var n,i,a,o=e.stepLog,u=e.fullLog,s=e.profile,l=[],c=[],d=t,p=function(e){e.forEach((function(e){var t=(a=_P[e]({profile:s,identifier:r,matchUpStatus:n,attributes:i,applied:c,score:d})).score!==d;t&&l.push({method:e,score:a.score}),o&&(u||t||a.matchUpStatus!==n)&&(n?console.log({score:a.score,matchUpStatus:n},e):console.log({score:a.score},e)),a.matchUpStatus&&(n=a.matchUpStatus),a.attributes&&(i=a.attributes),a.applied&&(c=a.applied),d=a.score}))};p(jP);var v=bP(d);return v||(d=t.toString().replace(/\D/g,""),(null==i?void 0:i.removed)&&(i.removed=void 0),p(BP),(v=bP(d))||(d="")),c.forEach((function(e){LP[e]||(LP[e]=0),LP[e]+=1})),{matchUpStatus:null==n?void 0:n.toUpperCase(),modifications:l,attributes:i,isValid:v,score:d}},updateTieMatchUpScore:vg,validateScore:zg,validateTieFormat:zm,calculateHistoryScore:function(e){var n,i,o;if(!e)return{error:pt};var u=e.matchUp,s=e.updateScore;if(!u)return{error:et};var l=(null===(o=_D({matchUp:u}))||void 0===o?void 0:o.history)||[];if(!Array.isArray(l))return{error:xr,info:"history is not an array"};var c=u.matchUpFormat;if(!c)return{error:Ye};if(!Fm({matchUpFormat:c}))return{error:ze};var d,p,v=Zd(c),f=v.bestOf,m=v.finalSetFormat,h=v.setFormat,g=["0","15","30","40","A","G"],y={sets:[]},U=[],S=[0,0],w=1,T=0,P=0,D=function(e){return[1,2].includes(e)},b=function(){return{winningSide:void 0,side1Score:0,side2Score:0,setNumber:T+=1,games:[]}},N={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},M={winningSide:void 0,points:[]},R=b(),A=0,E=function(e){A+=1;var t=(p=y.sets.length+1===f)&&m?m:h,n=t.tiebreakAt,i=t.setTo,a=t.NoAD,o=t.tiebbreakFormat,u=R.side1Score===n&&R.side1Score===R.side2Score,s=!!t.tiebreakSet,l=(s?t.tiebreakSet:o)||{},c=l.tiebreakTo,v=l.NoAD,T=function(){d=void 0,S=[0,0],w=3-w,R.side1TiebreakScore=0,R.side2TiebreakScore=0,R.side1PointScore="",R.side2PointScore="",P=0},E=function(e){R.winningSide=e,R.s;var t=r(R,["s"]);y.sets.push(t),N={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},M={winningSide:void 0,points:[]},R=b(),T()},C=function(e){M.winningSide=e,M.g;var t=r(M,["g"]);R.games.push(t),N={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},M={winningSide:void 0,points:[]},T();var n="side".concat(e,"Score");R[n]+=1},x=function(e){N.winningSide=e,N.p;var t=r(N,["p"]);M.points.push(t),N={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},P=0;var n=e-1;if(u||s){S[n]+=1,d=S.reduce((function(e,t){return e+t}))%4/4>.5?w:3-w,R["side".concat(e,"TiebreakScore")]=S[n],R["side".concat(3-e,"TiebreakScore")]=S[1-n];var i=v?1:2;if(S[n]>=c&&S[n]>=S[1-n]+i)return C(e),{gameCompleted:!0}}else if(4===S[1-n]&&3===S[n]?S[1-n]-=1:S[n]+=1,R.side1PointScore=g[S[0]],R.side2PointScore=g[S[1]],5===S[n]||4===S[n]&&S[1-n]<3||a&&4===S[n])return C(e),{gameCompleted:!0}};(D(e.srv)&&(w=e.srv),["p","s","g","o"].includes(e.u)&&U.push(e.u),e.shotOutcome)&&(N.shots.push(e),"SERVE"===e.shotType&&["OUT","NET"].includes(e.shotOutcome)&&(P+=1),2===P&&x(F=3-w));if(D(e.p)||I(e.pointNumber)){var O=x(F=e.winningSide||e.p);if(null==O?void 0:O.gameCompleted)return"continue"}if(D(e.g)||I(e.gameNumber)){var F=e.winningSide||e.g;M.winningSide=F;var k="side".concat(F,"Score"),_="side".concat(3-F,"Score");if(U.length&&(U.includes("p"),U=[]),C(F),R[k]===i&&R[k]-R[_]>=(a?1:2)&&(E(F),p))return"break"}if((D(e.s)||I(e.setNumber))&&(E(F=e.winningSide||e.s),U.length&&(U.includes("p"),U.includes("g"),U=[]),p))return"break"};try{for(var C=a(l),x=C.next();!x.done;x=C.next()){if("break"===E(x.value))break}}catch(e){n={error:e}}finally{try{x&&!x.done&&(i=C.return)&&i.call(C)}finally{if(n)throw n.error}}return A!==l.length&&console.log({error:"Match completed with excess history"}),(R.side1Score||R.side2Score||R.games.length||R.side1TiebreakScore||R.side2TiebreakScore)&&y.sets.push(R),y.scoreStringSide1=PI(t(t({},y),{matchUpFormat:c})),y.scoreStringSide2=PI(t(t({},y),{matchUpFormat:c,reversed:!0})),w=d||w,s&&(u.score=y),t(t({},L),{servingSide:w,score:y})},setServingSide:function(e){var t=e.matchUp,r=e.sideNumber;if(![1,2].includes(r))return{error:lt};var n=_D({matchUp:t}).history,i=void 0===n?[]:n;return i.push({srv:r}),LD({matchUp:t,history:i})},clearHistory:function(e){return LD({matchUp:e.matchUp})},addPoint:function(e){var t=e.matchUp,r=e.point;if(!r)return{error:pt};if("object"!=typeof r)return{error:xr,context:{point:r}};var n=_D({matchUp:t}).history,i=void 0===n?[]:n;return i.push(r),LD({matchUp:t,history:i})},addGame:function(e){var t=e.matchUp,r=e.game;if("object"!=typeof r)return{error:xr,context:{game:r}};var n=_D({matchUp:t}).history,i=void 0===n?[]:n;return i.push(r),LD({matchUp:t,history:i})},addShot:function(e){var t=e.matchUp,r=e.shot;if("object"!=typeof r)return{error:pt};var n=_D({matchUp:t}).history,i=void 0===n?[]:n;return i.push(r),LD({matchUp:t,history:i})},addSet:function(e){var t=e.matchUp,r=e.set;if("object"!=typeof r)return{error:pt};var n=_D({matchUp:t}).history,i=void 0===n?[]:n;return i.push(r),LD({matchUp:t,history:i})},redo:function(e){var t=e.matchUp,r=_D({matchUp:t}),n=r.history,i=void 0===n?[]:n,a=r.undoHistory,o=void 0===a?[]:a;return o.length&&i.push(o.pop()),LD({matchUp:t,history:i,undoHistory:o})},undo:function(e){var t=e.matchUp,r=_D({matchUp:t}),n=r.history,i=void 0===n?[]:n,a=r.undoHistory,o=void 0===a?[]:a;return o.push(i.pop()),LD({matchUp:t,history:i,undoHistory:o})},umo:{scoreboard:function(){},addPoints:function(){},addPoint:function(){}}},BD={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function VD(e){var r,n,i=e.tournamentRecord,s=e.startDate,l=e.endDate;if(!i)return{error:W};if(s&&!Wn.test(s)||l&&!Wn.test(l))return{error:It};if(!s&&!l)return{error:vt};if(l&&s&&new Date(l)<new Date(s))return{error:xr};(s&&i.startDate&&new Date(s)>new Date(i.startDate)||l&&i.endDate&&new Date(l)<new Date(i.endDate))&&(n=!0),s&&(i.startDate=s),l&&(i.endDate=l),s&&i.endDate&&new Date(s)>new Date(i.endDate)&&(i.endDate=s),l&&i.startDate&&new Date(l)<new Date(i.startDate)&&(i.startDate=l);var c=n&&(null===(r=function(e){var t,r,n,i=e.tournamentRecord,o=null!==(n=Kp({tournamentRecord:i}).matchUps)&&void 0!==n?n:[],u=i.startDate&&new Date(i.startDate),s=i.endDate&&new Date(i.endDate),l=[],c=[];try{for(var d=a(o),p=d.next();!p.done;p=d.next()){var v=p.value,f=v.schedule,m=v.matchUpId;if(f&&f.scheduledDate){var h=new Date(f.scheduledDate);(u&&h<u||s&&h>s)&&(c.push(m),l.includes(f.scheduledDate)||l.push(f.scheduledDate))}}}catch(e){t={error:e}}finally{try{p&&!p.done&&(r=d.return)&&r.call(d)}finally{if(t)throw t.error}}if(l.length){if(!NS({scheduledDates:l,tournamentRecord:i}).clearedScheduleCount)return{error:te}}return{unscheduledMatchUpIds:c}}({tournamentRecord:i}))||void 0===r?void 0:r.unscheduledMatchUpIds);return function(e){var r,n,i,s,l,c,d,p=e.tournamentRecord;if(!p)return{error:W};var v=ei(p.startDate,p.endDate),f=[];try{for(var m=a(p.venues||[]),h=m.next();!h.done;h=m.next()){var g=h.value;(null===(l=null==g?void 0:g.courts)||void 0===l?void 0:l.length)&&f.push.apply(f,u([],o(g.courts),!1))}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=m.return)&&n.call(m)}finally{if(r)throw r.error}}var I=function(e){var t=(null!==(c=e.dateAvailability)&&void 0!==c?c:[]).reduce((function(e,t){var r=ii(e.startTime),n=ii(e.endTime);return t.startTime&&ii(t.startTime)<r&&(e.startTime=t.startTime),t.endTime&&ii(t.endTime)>n&&(e.endTime=t.endTime),e}),{startTime:"08:00",endTime:"18:00"}),r=t.startTime,n=t.endTime,i=v.map((function(t){var i,a=null===(i=e.dateAvailability)||void 0===i?void 0:i.find((function(e){return e.date===t}));return null!=a?a:{date:t,startTime:r,endTime:n}})),a=null===(d=e.dateAvailability)||void 0===d?void 0:d.find((function(e){return!e.date}));a&&i.unshift(a),e.dateAvailability=i};try{for(var y=a(f),U=y.next();!U.done;U=y.next())I(U.value)}catch(e){i={error:e}}finally{try{U&&!U.done&&(s=y.return)&&s.call(y)}finally{if(i)throw i.error}}t({},L)}({tournamentRecord:i}),mn({topic:Id,payload:{startDate:s,endDate:l}}),t(t({},L),{unscheduledMatchUpIds:c})}var GD={addDrawDefinitionExtension:za,addEventExtension:Ya,addEventTimeItem:If,addExtension:jn,addNotes:dg,addOnlineResource:function(e){var r,n,i,a,o,u,s=e.tournamentRecord,l=e.onlineResource,c=e.organisationId,d=e.participantId,p=e.personId,v=e.courtId,f=e.venueId;if(!s)return{error:W};if(!Di(l))return{error:pt};if(3!==E(Object.keys(l),["resourceSubType","resourceType","identifier"]).length)return On({result:{error:Ar},context:{onlineResource:l}});if(c){if((null===(r=s.parentOrganisation)||void 0===r?void 0:r.parentOrganisationId)!==c)return On({result:{error:jr}});s.parentOrganisation.onlineResources||(s.parentOrganisation.onlineResources=[]),s.parentOrganisation.onlineResources.push(l)}else if(d||p){var m=(null!==(n=s.participants)&&void 0!==n?n:[]).find((function(e){var t;return p&&(null===(t=e.person)||void 0===t?void 0:t.personId)===p||e.participantId===d}));if(!m)return On(p?{result:{error:jr}}:{result:{error:Lt}});if(p){if((null===(i=m.person)||void 0===i?void 0:i.personId)!==p)return On({result:{error:Rt}});m.person.onlineResources||(m.person.onlineResources=[]),m.person.onlineResources.push(l)}else m.onlineResources||(m.onlineResources=[]),m.onlineResources.push(l)}else if(v){var h=null===(o=(null!==(a=s.venues)&&void 0!==a?a:[]).filter((function(e){return!f||e.venueId===f})).flatMap((function(e){var t;return(null!==(t=e.courts)&&void 0!==t?t:[]).filter((function(e){return e.courtId===v}))})))||void 0===o?void 0:o[0];if(!h)return On({result:{error:ur}});h.onlineResources||(h.onlineResources=[]),h.onlineResources.push(l)}else if(f){var g=(null!==(u=s.venues)&&void 0!==u?u:[]).find((function(e){return e.venueId===f}));if(!g)return On({result:{error:cr}});g.onlineResources||(g.onlineResources=[]),g.onlineResources.push(l)}else s.onlineResources||(s.onlineResources=[]),s.onlineResources.push(l);return t({},L)},addParticipantExtension:function(e){var t;if(!e||"object"!=typeof e)return{error:pt};if(!e.participantId)return{error:_t};var r=(null===(t=e.tournamentRecord)||void 0===t?void 0:t.participants)||[],n=Wa({participantId:e.participantId,tournamentParticipants:r});return n?jn({creationTime:e.creationTime,extension:e.extension,element:n}):{error:Lt}},addParticipantTimeItem:hf,addTimeItem:mf,addTournamentExtension:Ha,addTournamentTimeItem:gf,getProfileRounds:nP,removeDrawDefinitionExtension:function(e){return e&&"object"==typeof e?e.drawDefinition?_n({element:e.drawDefinition,name:e.name}):{error:Z}:{error:pt}},removeEventExtension:Ja,removeExtension:_n,removeNotes:function(e){return"object"!=typeof e?{error:pt}:"object"!=typeof e.element?{error:xr}:(e.element.notes&&delete e.element.notes,t({},L))},removeParticipantExtension:function(e){var t;if(!e||"object"!=typeof e)return{error:pt};if(!e.participantId)return{error:_t};var r=(null===(t=e.tournamentRecord)||void 0===t?void 0:t.participants)||[],n=Wa({participantId:e.participantId,tournamentParticipants:r});return n?_n({element:n,name:e.name}):{error:Lt}},removeTournamentExtension:Ka,setTournamentCategories:function(e){var r=e.tournamentRecord,n=e.categories;return r?(n=(n||[]).filter((function(e){return e.categoryName&&e.type})),r.tournamentCategories=n,t({},L)):{error:W}},setTournamentDates:VD,setTournamentEndDate:function(e){return VD({tournamentRecord:e.tournamentRecord,endDate:e.endDate})},setTournamentName:function(e){var r=e.tournamentRecord,n=e.promotionalName,i=e.tournamentName,a=e.formalName;return r?(i&&(r.tournamentName=i),n&&(r.promotionalName=n),a&&(r.formalName=a),r.promotionalName===r.tournamentName&&delete r.promotionalName,r.formalName===r.tournamentName&&delete r.formalName,t({},L)):{error:W}},setTournamentNotes:function(e){var t=e.tournamentRecord,r=e.notes;return t?dg({element:t,notes:r}):{error:W}},setTournamentStartDate:function(e){return VD({tournamentRecord:e.tournamentRecord,startDate:e.startDate})},setTournamentStatus:function(e){var r=e.tournamentRecord,n=e.status;return r?n&&!Object.keys(BD).includes(n)?{error:xr,info:"Unknown status"}:(r.tournamentStatus=n,t({},L)):{error:W}}};var qD=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function WD(e,t,r){return void 0===t&&(t="."),void 0===r&&(r=[]),"object"==typeof e&&Object.keys(e).reduce((function(n,i){return"object"!=typeof e[i]?(n[r.concat(i).join(t)]=e[i],n):Object.assign(n,WD(e[i],t,r.concat(i)))}),{})}var HD={visualizeScheduledMatchUps:function(e){var r=e.scheduledMatchUps,n=e.showGlobalLog;rv.length=0;var i=null==r?void 0:r.reduce((function(e,t){var r=t.structureId;return e.includes(r)?e:e.concat(r)}),[]),a=Array.isArray(i)&&t({},i.map((function(e){var t,n=r.find((function(t){return t.structureId===e})),i=n.structureName,a=n.matchUpType;return(t={})[e]="".concat(i," ").concat(a),t})));null==i||i.forEach((function(e){var t;nv({color:"blue",method:"draw",structure:a[e],keyColors:{structure:"magenta"}},!0);var n=(null===(t=Xs({matchUps:r.filter((function(t){return t.structureId===e}))}))||void 0===t?void 0:t.roundMatchUps)||[];Object.keys(n).forEach((function(e){nv({roundNumber:e,keyColors:{roundNumber:"brightcyan"}},!0),n[e].forEach((function(e){var t=e.matchUpId,r=e.schedule;nv({matchUpId:t,time:oi(r.scheduledTime),date:r.scheduledDate,venue:r.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)}))}))})),n&&iv()},dehydrateMatchUps:function(e){var r=e.tournamentRecord;if(!r)return{error:W};if("object"!=typeof r||!r.tournamentId)return{error:xr};var n=Kp({tournamentRecord:r,inContext:!1}).matchUps;if(null==n?void 0:n.length){var i=function(e){var t,r,n,i,o,u,s,l,c=e.tournamentRecord,d={};try{for(var p=a(c.events||[]),v=p.next();!v.done;v=p.next()){var f=v.value;f.matchUpFormat&&(d[f.eventId]=f.matchUpFormat);try{for(var m=(n=void 0,a(f.drawDefinitions||[])),h=m.next();!h.done;h=m.next()){var g=h.value;g.matchUpFormat&&(d[g.drawId]=g.matchUpFormat);try{for(var I=(o=void 0,a(g.structures||[])),y=I.next();!y.done;y=I.next()){var U=y.value;U.matchUpFormat&&(d[U.structureId]=U.matchUpFormat);try{for(var S=(s=void 0,a(U.structures||[])),w=S.next();!w.done;w=S.next()){var T=w.value;T.matchUpFormat&&(d[T.structureId]=T.matchUpFormat)}}catch(e){s={error:e}}finally{try{w&&!w.done&&(l=S.return)&&l.call(S)}finally{if(s)throw s.error}}}}catch(e){o={error:e}}finally{try{y&&!y.done&&(u=I.return)&&u.call(I)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=m.return)&&i.call(m)}finally{if(n)throw n.error}}}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}return d}({tournamentRecord:r});!function(e,t){var r,n,i,o;void 0===t&&(t={});try{for(var u=a(e),s=u.next();!s.done;s=u.next()){var l=s.value,c=l.structureId,d=l.drawId,p=l.eventId,v=t[c]||t[d]||t[p],f=l.matchUpFormat===v?void 0:l.matchUpFormat;try{for(var m=(i=void 0,a(Object.keys(l))),h=m.next();!h.done;h=m.next()){var g=h.value;qD.includes(g)||delete l[g]}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}l.sides&&l.drawPositions&&!l.tieMatchUps&&delete l.sides,f&&(l.matchUpFormat=f)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}}(n,i)}return t({},L)},structureSort:ns,allNumeric:F,attributeFilter:Na,chunkArray:O,chunkByNth:_,chunkSizeProfile:function e(t,r){var n=o(r),i=n[0],a=n.slice(1);return t.length?u([t.slice(0,i)],o(e(t.slice(i),u(u([],o(a),!1),[i],!1))),!1):[]},constantToString:ef,countValues:function(e){return P(T(e))},createMap:Ni,dateTime:yi,definedAttributes:xn,extractAttributes:Mi,flattenJSON:WD,generateDateRange:ei,generateHashCode:function(e){if(null!==e&&"object"==typeof e){var t=JSON.stringify(e),r=Ai(e),n=t.split("").reduce((function(e,t){return e+t.charCodeAt(0)}),0);return[t.length,r,n].map((function(e){return e.toString(36)})).join("")}},generateRange:R,generateTimeCode:cP,groupValues:P,hasAttributeValues:function(e){return function(t){return Object.keys(e).every((function(r){return t[r]===e[r]}))}},instanceCount:T,intersection:E,isConvertableInteger:I,isNumeric:f,isOdd:m,isPowerOf2:c,JSON2CSV:function(e,t){if(t&&"object"!=typeof t)return xr;var r=(t||{}).columnTransform,n=void 0===r?{}:r,i=t||{},a=i.includeTransformAccessors,s=i.includeHeaderRow,l=void 0===s||s,c=i.returnTransformedJSON,d=i.removeEmptyColumns,p=i.onlyHeaderRow,v=i.columnAccessors,m=void 0===v?[]:v,h=i.functionMap,g=void 0===h?{}:h,I=i.columnMap,y=void 0===I?{}:I,U=i.valuesMap,S=void 0===U?{}:U,w=i.context,T=void 0===w?{}:w,P=i.delimiter,D=void 0===P?'"':P,b=i.columnJoiner,N=void 0===b?",":b,M=i.rowJoiner,R=void 0===M?"\r\n":M,A=i.keyJoiner,E=void 0===A?".":A;if(!Array.isArray(e)||!Array.isArray(m)||"object"!=typeof T||"object"!=typeof y||"object"!=typeof n||"object"!=typeof g||"object"!=typeof S||"string"!=typeof N||"string"!=typeof R||"string"!=typeof E||"string"!=typeof D)return xr;n=Object.assign.apply(Object,u([{}],o(Object.keys(n).reverse().map((function(e){var t;return(t={})[e]=Array.isArray(n[e])?n[e]:["string"==typeof n[e]&&n[e]].filter(Boolean),t}))),!1));var C=e.filter(Boolean).map((function(e){return WD(e,E)})),x=Object.values(n).flat();a&&m.push.apply(m,u([],o(x),!1));var O=C.reduce((function(e,t){return Object.keys(t).every((function(t){return!e.includes(t)&&e.push(t)||!0}))&&e}),[]).filter((function(e){return!(null==m?void 0:m.length)||m.includes(e)})),F=Object.assign.apply(Object,u([{}],o(Object.keys(n).reverse().map((function(e){return n[e].map((function(t){var r;return(r={})[t]=e,r})).flat()})).flat()),!1)),k=O.reduce((function(e,t){var r=F[t];return r?e.includes(r)||e.push(r):e.push(t),e}),[]).sort((function(e,r){return(null==t?void 0:t.sortOrder)?t.sortOrder.includes(e)&&t.sortOrder.includes(r)&&t.sortOrder.indexOf(e)-t.sortOrder.indexOf(r)||!t.sortOrder.includes(r)&&-1:0}));Object.keys(y).forEach((function(e){return!k.includes(e)&&k.unshift(e)})),Object.keys(n).forEach((function(e){return!k.includes(e)&&k.unshift(e)})),"object"==typeof T&&Object.keys(T).forEach((function(e){return!k.includes(e)&&k.unshift(e)}));var _=k.map((function(e){return y[e]||e}));if(p)return[_];var L=function(e){return"".concat(D).concat(e).concat(D)},j=[],B=C.map((function(e){return Object.values(k.reduce((function(t,r,i){var a,o=n[r],u=((null==o?void 0:o.length)?e[o.find((function(t){return e[t]}))]:e[r])||(null==T?void 0:T[r])||"",s=(null===(a=S[r])||void 0===a?void 0:a[u])||u,l="function"==typeof g[r]?g[r](s):s;return t[r]=L(l),l&&(j[i]=(j[i]||0)+1),t}),{}))})),V=d&&u([],o(j),!1).map((function(e,t){return!e&&t})).filter(f).reverse();if(V){var G=function(e){return e.filter((function(e,t){return!V.includes(t)}))};B=B.map(G),_=G(_)}var q=B.map((function(e){return e.join(N)}));return c?q.map((function(e){var t=e.split(N);return Object.assign.apply(Object,u([{}],o(t.map((function(e,t){var r;return(r={})[_[t]]=e,r}))),!1))})):l?u([_.map(L).join(N)],o(q),!1).join(R):q.join(R)},makeDeepCopy:Ui,matchUpSort:Zp,nearestPowerOf2:v,nextPowerOf2:h,noNulls:function(e){return null==e?void 0:e.map((function(e){return null===e?void 0:e}))},noNumeric:k,numericSort:s,occurrences:function(e,t){return t.reduce((function(e,t){return e[t]=1+e[t]||1,e}),{})[e]||0},overlap:x,randomMember:M,randomPop:N,shuffleArray:S,subSort:function(e,t,r,n){return[].concat.apply([],u(u(u([],o(e.slice(0,t)),!1),o(e.slice(t,t+r).sort(n)),!1),o(e.slice(t+r,e.length)),!1))},undefinedToNull:function e(t,r){if(void 0===t)return null;if("object"!=typeof t||null===t)return t;var n=Object.keys(t);return Object.assign.apply(Object,u([{}],o(n.map((function(n){var i,a,o;return Array.isArray(t[n])?((i={})[n]=r?t[n]:t[n].map((function(t){return e(t)})),i):((a={})[n]=r?void 0===(o=t[n])?null:o:e(t[n]),a)}))),!1))},unique:U,UUID:ed,UUIDS:function(e){return void 0===e&&(e=1),R(0,e).map(ed)}},zD=HD;function YD(e){if(!(null==e?void 0:e.tournamentRecord)&&!Array.isArray(null==e?void 0:e.venueMatchUps))return{error:W};if(!(null==e?void 0:e.courtId))return{error:dt};var t=e.scheduleVisibilityFilters,r=e.tournamentRecord,n=e.matchUpFilters,i=e.venueMatchUps,a=e.courtId,o=pf({tournamentRecord:r}).schedulingProfile;return Array.isArray(i)?{matchUps:u({matchUps:i,courtId:a})}:{matchUps:u({matchUps:Kp({scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:n}).matchUps,courtId:a})};function u(e){var t=e.matchUps,r=e.courtId,n=t.filter((function(e){var t,n,i,a=null===(n=null===(t=e.schedule)||void 0===t?void 0:t.allocatedCourts)||void 0===n?void 0:n.map((function(e){return e.courtId}));return(null===(i=e.schedule)||void 0===i?void 0:i.courtId)===r||(null==a?void 0:a.includes(r))}));return Ww({matchUps:n,schedulingProfile:o})}}function KD(e){var r,n,i,a=e.tournamentRecord,s=e.dateAvailability,l=e.disableNotice,c=e.venueMatchUps,d=e.courtId,p=e.force;if(!a)return{error:W};if(!d)return{error:dt};var v=GS({dateAvailability:s});if(v.error)return v;var f=function(e){var r=0,n=e.reduce((function(e,t){var r=t.date,n=t.startTime,i=t.endTime,a=t.bookings;return e[r]||(e[r]=[]),e[r].push({startTime:n,endTime:i,bookings:a}),e}),{}),i=[];return Object.keys(n).forEach((function(e){n[e].sort(VS);var a=function(e){var t,r,n,i=e.length,a=0,o=[];for(;e.length&&i;){var u=e.shift(),s=u.startTime,l=u.endTime,c=u.bookings;if(i-=1,t)if(fi(vi(r),vi(s),!1)>0){var d={startTime:t,endTime:r};(null==n?void 0:n.length)&&(d.bookings=n),o.push(d),t=s,n=c,r=l}else c&&(n?n.push(c):n=c),r=l,a+=1;else t=s,n=c,r=l}var p={startTime:t,endTime:r};(null==n?void 0:n.length)&&(p.bookings=n);return o.push(p),{mergedAvailability:o,mergeCount:a}}(n[e]),s=a.mergedAvailability,l=a.mergeCount;i.push.apply(i,u([],o(s.map((function(r){return t({date:e},r)}))),!1)),r+=l})),{updatedDateAvailability:i,totalMergeCount:r}}(s),m=f.updatedDateAvailability,h=f.totalMergeCount;s=m;var g=Cd({tournamentRecord:a,courtId:d});if(g.error)return g;var I=g.court,y=g.venue,U=YD({tournamentRecord:a,venueMatchUps:c,courtId:d}).matchUps;if(null==U?void 0:U.length){var S=null===(r=tl({tournamentRecord:a}))||void 0===r?void 0:r.appliedPolicies,w=null!=p?p:null===(i=null===(n=null==S?void 0:S[_a])||void 0===n?void 0:n.allowDeletionWithScoresPresent)||void 0===i?void 0:i.courts,T=[];T.length&&(w||console.log("throw error: scheduled court matchUps",T.length))}return I&&(I.dateAvailability=s,!l&&y&&mn({payload:{venue:y,tournamentId:a.tournamentId},topic:yd,key:y.venueId})),t(t({},L),{totalMergeCount:h})}function JD(e){var t=e.matchUpsCount,r=void 0===t?0:t,n=1===r?"matchUp":"matchUps",i="Schedule would be deleted from ".concat(r," ").concat(n,"; use { force: true }");return{error:Kr,info:i}}function ZD(e){var r,n,i=e.tournamentRecord,a=e.drawDefinition,o=e.matchUpId,u=e.drawId;if(!o)return{error:Ze};if(!a&&!u)return{error:pe};if(!a){if(!i)return{error:W};a=Ld({tournamentRecord:i,drawId:u}).drawDefinition}if(a)n=Ef({drawDefinition:a,matchUpId:o}).matchUp;else{if(!i)return{error:W};n=Af({matchUps:null!==(r=Kp({tournamentRecord:i,inContext:!1}).matchUps)&&void 0!==r?r:[],matchUpId:o}).matchUp}if(!n)return{error:Qe};n.timeItems&&(n.timeItems.find((function(e){return[rc,tc].includes(e.itemType)}))&&(n.timeItems=n.timeItems.filter((function(e){var t=e.itemType;return![rc,tc].includes(t)})),Cp({tournamentId:null==i?void 0:i.tournamentId,context:"removeCourtAssignment",drawDefinition:a,matchUp:n})));return t({},L)}function XD(e){var r,n,i,o,u,s,l,c;if("string"!=typeof(null==e?void 0:e.venueId))return{error:dr};var d=e.tournamentRecord,p=e.venueId,v=e.force,f=e.tournamentRecords||d&&((r={})[d.tournamentId]=d,r)||{};if(!Object.keys(f).length)return{error:W};var m=null!==(o=Jp({tournamentRecords:f,contextFilters:{venueIds:[p]}}).matchUps)&&void 0!==o?o:[],h=null===(u=tl({tournamentRecord:d}))||void 0===u?void 0:u.appliedPolicies,g=null!=v?v:null===(l=null===(s=null==h?void 0:h[_a])||void 0===s?void 0:s.allowDeletionWithScoresPresent)||void 0===l?void 0:l.venues;if(m.length&&!g)return JD({matchUpsCount:m.length});var I=function(e){var t,r,n;try{for(var i=(t=void 0,a(m)),o=i.next();!o.done;o=i.next()){var u=o.value,s=ZD({matchUpId:u.matchUpId,drawId:u.drawId,tournamentRecord:e});if(s.error)return{value:s}}}catch(e){t={error:e}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}e.venues=(null!==(c=e.venues)&&void 0!==c?c:[]).filter((function(e){return(null==e?void 0:e.venueId)!==p||(n=!0,!1)})),n&&mn({payload:{venueId:p,tournamentId:e.tournamentId},topic:sd,key:p})};try{for(var y=a(Object.values(f)),U=y.next();!U.done;U=y.next()){var S=I(U.value);if("object"==typeof S)return S.value}}catch(e){n={error:e}}finally{try{U&&!U.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}return ff({tournamentRecords:f}),t({},L)}function QD(e){var r,n,i,o,u=e.tournamentRecord,s=e.courtIds,l=e.dates,c=!Array.isArray(l)||!l.length||{dates:l},d=function(e){return jn({extension:{value:c,name:eo},creationTime:!1,element:e})};try{for(var p=a(u.venues||[]),v=p.next();!v.done;v=p.next()){var f=v.value;try{for(var m=(i=void 0,a(f.courts||[])),h=m.next();!h.done;h=m.next()){var g=h.value;if(null==s?void 0:s.includes(g.courtId)){var I=d(g);if(I.error)return I}}}catch(e){i={error:e}}finally{try{h&&!h.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return t({},L)}function $D(e){var r,n,i=e.tournamentRecord,o=e.venueIds;try{for(var u=a(i.venues||[]),s=u.next();!s.done;s=u.next()){var l=s.value;if(null==o?void 0:o.includes(l.venueId)){var c=jn({creationTime:!1,element:l,extension:{name:eo,value:!0}});if(c.error)return c}}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}return t({},L)}function eb(e){var r,n,i,o,u=e.tournamentRecord,s=e.courtIds,l=e.enableAll,c=e.dates;try{for(var d=a(u.venues||[]),p=d.next();!p.done;p=d.next()){var v=p.value;try{for(var f=(i=void 0,a(v.courts||[])),m=f.next();!m.done;m=f.next()){var h=m.value;if(l||(null==s?void 0:s.includes(h.courtId)))if(Array.isArray(c)){var g=Vn({element:h,name:eo}).extension;if(g){var I=g.value;Array.isArray(I.dates)&&(I.dates=I.dates.filter((function(e){return!c.includes(e)}))),jn({extension:{name:eo,value:I},creationTime:!1,element:h})}}else _n({element:h,name:eo})}}catch(e){i={error:e}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}return t({},L)}function tb(e){var r,n,i,o,u,s,l=e.tournamentRecord,c=e.disableNotice,d=e.courtId,p=e.force,v=Cd({tournamentRecord:l,courtId:d});if(v.error)return v;var f=v.venue,m=YD({tournamentRecord:l,courtId:d}).matchUps,h=null===(i=tl({tournamentRecord:l}))||void 0===i?void 0:i.appliedPolicies,g=null!=p?p:null===(u=null===(o=null==h?void 0:h[_a])||void 0===o?void 0:o.allowDeletionWithScoresPresent)||void 0===u?void 0:u.courts;if((null==m?void 0:m.length)&&!g)return JD({matchUpsCount:m.length});try{for(var I=a(null!=m?m:[]),y=I.next();!y.done;y=I.next()){var U=y.value,S=ZD({matchUpId:U.matchUpId,drawId:U.drawId,tournamentRecord:l});if(S.error)return S}}catch(e){r={error:e}}finally{try{y&&!y.done&&(n=I.return)&&n.call(I)}finally{if(r)throw r.error}}return f&&(f.courts=(null!==(s=f.courts)&&void 0!==s?s:[]).filter((function(e){return e.courtId!==d})),c||mn({payload:{venue:f,tournamentId:l.tournamentId},topic:yd,key:f.venueId})),t({},L)}function rb(e){var r,n,i,o=e.disableNotice,u=e.modifications,s=e.courtId,l=e.force,c=e.venueMatchUps,d=$c(e);if(!Object.keys(d).length)return{error:q};try{for(var p=a(Object.values(d)),v=p.next();!v.done;v=p.next()){var f=nb({tournamentRecord:v.value,disableNotice:o,venueMatchUps:c,modifications:u,courtId:s,force:l});if(null==f?void 0:f.error)return f;i=!0}}catch(e){r={error:e}}finally{try{v&&!v.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return i?t({},L):undefined}function nb(e){var r=e.tournamentRecord,n=e.disableNotice,i=e.venueMatchUps,a=e.modifications,o=e.courtId,u=e.force;if(!r)return{error:W};if(!o)return{error:dt};if(!a||"object"!=typeof a)return{error:Ar};var s=Cd({tournamentRecord:r,courtId:o});if(s.error)return s;var l=s.venue,c=s.court,d=Object.keys(LS()).filter((function(e){return"courtId"!==e}));if(!Object.keys(a).filter((function(e){return d.includes(e)})).length)return{error:_r};var p=d.filter((function(e){return!["dateAvailability"].includes(e)})),v=Object.keys(a).filter((function(e){return p.includes(e)}));if(c&&v.forEach((function(e){var t;return Object.assign(c,((t={})[e]=a[e],t))})),a.dateAvailability){var f=KD({dateAvailability:a.dateAvailability,tournamentRecord:r,venueMatchUps:i,disableNotice:n,courtId:o,force:u});if(f.error)return f}return n||mn({payload:{venue:l,tournamentId:r.tournamentId},topic:yd,key:null==l?void 0:l.venueId}),t(t({},L),{court:Ui(c)})}var ib=function(){return{venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}};function ab(e){var r,n,i,o,u,s,l,c,d,p,v=e.tournamentRecord,f=e.modifications,m=e.venueId,h=e.force;if(!v)return{error:W};if(!f||"object"!=typeof f)return{error:Ar};if(!m)return{error:dr};var g=null===(i=tl({tournamentRecord:v}))||void 0===i?void 0:i.appliedPolicies,I=null!=h?h:null===(u=null===(o=null==g?void 0:g[_a])||void 0===o?void 0:o.allowDeletionWithScoresPresent)||void 0===u?void 0:u.venues,y=function(e){var t=e.scheduleVisibilityFilters,r=e.tournamentRecord,n=e.matchUpFilters,i=e.venueId;if(!r)return{error:W};if(!i)return{error:dr};var a=pf({tournamentRecord:r}).schedulingProfile,o=function(e){var t=e.matchUps,r=e.venueId,n=t.filter((function(e){var t,n,i,a=null===(n=null===(t=e.schedule)||void 0===t?void 0:t.allocatedCourts)||void 0===n?void 0:n.map((function(e){return e.venueId}));return(null===(i=e.schedule)||void 0===i?void 0:i.venueId)===r||(null==a?void 0:a.includes(r))}));return Ww({matchUps:n,schedulingProfile:a})}({matchUps:Kp({scheduleVisibilityFilters:t,tournamentRecord:r,matchUpFilters:n}).matchUps,venueId:i});return{matchUps:o}}({tournamentRecord:v,venueId:m}).matchUps,U=Ed({tournamentRecord:v,venueId:m});if(U.error)return U;var S=U.venue,w=Object.keys(ib()).filter((function(e){return"venueId"!==e}));if(!Object.keys(f).filter((function(e){return w.includes(e)})).length)return{error:_r};var T=w.filter((function(e){return!["courts","onlineResources"].includes(e)})),P=Object.keys(f).filter((function(e){return T.includes(e)}));S&&P.forEach((function(e){var t;return Object.assign(S,((t={})[e]=f[e],t))}));var D=null!==(l=null===(s=null==S?void 0:S.courts)||void 0===s?void 0:s.map((function(e){return e.courtId})))&&void 0!==l?l:[],b=(null===(c=f.courts)||void 0===c?void 0:c.map((function(e){return e.courtId})))||[],N=b.length&&D.filter((function(e){return!b.includes(e)})),M=[];if(N.length){var R=null===(d=null==S?void 0:S.courts)||void 0===d?void 0:d.filter((function(e){return N.includes(e.courtId)})),A=null==R?void 0:R.map((function(e){var t,r,n,i,o,u=YD({courtId:e.courtId,tournamentRecord:v,venueMatchUps:y});try{for(var s=a(null!==(n=u.matchUps)&&void 0!==n?n:[]),l=s.next();!l.done;l=s.next()){var c=l.value;M.push({matchUpId:c.matchUpId,drawId:c.drawId})}}catch(e){t={error:e}}finally{try{l&&!l.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}return null!==(o=null===(i=u.matchUps)||void 0===i?void 0:i.length)&&void 0!==o?o:0})).reduce((function(e,t){return e+t}));if(console.log({scheduleDeletionsCount:A}),!S||A&&!I)return JD({matchUpsCount:A});S.courts=null===(p=S.courts)||void 0===p?void 0:p.filter((function(e){return b.includes(e.courtId)})),wS({schedule:{courtId:"",scheduledDate:""},matchUpDetails:M,removePriorValues:!0,tournamentRecord:v})}if(f.courts)try{for(var E=a(f.courts),C=E.next();!C.done;C=E.next()){var x=C.value,O=(x||{}).courtId,F=rb({modifications:x,disableNotice:!0,tournamentRecord:v,venueMatchUps:y,courtId:O,force:h});if(F.error===ur&&(F=qS({disableNotice:!0,tournamentRecord:v,venueId:m,court:x})),F.error)return F}}catch(e){r={error:e}}finally{try{C&&!C.done&&(n=E.return)&&n.call(E)}finally{if(r)throw r.error}}return ff({tournamentRecord:v}),S&&mn({payload:{venue:S,tournamentId:v.tournamentId},topic:yd,key:null==S?void 0:S.venueId}),t(t({},L),{venue:Ui(S)})}var ob,ub={addCourt:qS,addCourts:WS,addVenue:Rd,deleteCourt:function(e){var r,n,i,o,u,s=e.courtId,l=e.disableNotice,c=e.force,d=$c(e),p=da(e,[(r={},r[xi]=!0,r[Zi]=!0,r)]);if(p.error)return p;try{for(var v=a(Object.values(d)),f=v.next();!f.done;f=v.next()){if((u=tb({tournamentRecord:f.value,disableNotice:l,courtId:s,force:c})).error&&u.error!==ur)return u;u.success&&(o=!0)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}return o?t({},L):u},deleteVenue:XD,deleteVenues:function(e){var r,n,i=e.tournamentRecord,o=e.venueIds,u=e.force;if(!i)return{error:W};if(!Array.isArray(o))return{error:xr};try{for(var s=a(i.venues||[]),l=s.next();!l.done;l=s.next()){var c=l.value,d=c.venueId;if(o.includes(d)){var p=XD({tournamentRecord:i,venueId:c.venueId,force:u});if(p.error)return p}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}return t({},L)},disableCourts:function(e){var r,n,i,o=e.courtIds,u=e.dates,s=$c(e),l=da(e,[(r={},r[xi]=!0,r[Yi]=!0,r)]);if(l.error)return l;try{for(var c=a(Object.values(s)),d=c.next();!d.done;d=c.next()){QD({tournamentRecord:d.value,courtIds:o,dates:u})}}catch(e){n={error:e}}finally{try{d&&!d.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return t({},L)},disableVenues:function(e){var r,n,i,o=e.tournamentRecords,u=e.tournamentId,s=e.venueIds,l=da(e,[(r={},r[xi]=!0,r[Ki]=!0,r)]);if(l.error)return l;var c=Object.keys(o).filter((function(e){return!u||e===u}));try{for(var d=a(c),p=d.next();!p.done;p=d.next()){$D({tournamentRecord:o[p.value],venueIds:s})}}catch(e){n={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}return t({},L)},enableCourts:function(e){var r,n,i,o,u=$c(e),s=[(r={},r[xi]=!0,r)];!e.enableAll&&s.push(((n={})[Yi]=!0,n));var l=da(e,s);if(l.error)return l;var c=e.enableAll,d=e.courtIds,p=e.dates;try{for(var v=a(Object.values(u)),f=v.next();!f.done;f=v.next()){eb({tournamentRecord:f.value,courtIds:d,enableAll:c,dates:p})}}catch(e){i={error:e}}finally{try{f&&!f.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}return t({},L)},enableVenues:function(e){var r,n,i,o,u,s,l=$c(e),c=[(r={},r[xi]=!0,r)];!e.enableAll&&c.push(((n={})[Ki]=!0,n));var d=da(e,c);if(d.error)return d;var p=e.venueIds,v=e.enableAll;try{for(var f=a(Object.values(l)),m=f.next();!m.done;m=f.next()){var h=m.value;try{for(var g=(u=void 0,a(h.venues||[])),I=g.next();!I.done;I=g.next()){var y=I.value;(v||(null==p?void 0:p.includes(y.venueId)))&&_n({element:y,name:eo})}}catch(e){u={error:e}}finally{try{I&&!I.done&&(s=g.return)&&s.call(g)}finally{if(u)throw u.error}}}}catch(e){i={error:e}}finally{try{m&&!m.done&&(o=f.return)&&o.call(f)}finally{if(i)throw i.error}}return t({},L)},findVenue:function(e){var t=e.convertExtensions,n=r(e,["convertExtensions"]);return Ui(Ed({tournamentRecords:n.tournamentRecords,tournamentRecord:n.tournamentRecord,venueId:n.venueId}),t,!0)},modifyCourt:rb,modifyCourtAvailability:KD,modifyVenue:function(e){var r,n,i,o,u=e.modifications,s=e.venueId,l=e.force,c=$c(e);if(!Object.keys(c).length)return{error:q};if("string"!=typeof s)return{error:dr};try{for(var d=a(Object.values(c)),p=d.next();!p.done;p=d.next()){var v=ab({tournamentRecord:p.value,modifications:u,venueId:s,force:l});if(v.success&&(o=!0),v.error&&(i=v.error),v.error&&v.error!==cr)return v}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(r)throw r.error}}return ff({tournamentRecords:c}),o?t({},L):{error:i}}},sb={competitionGovernor:Po,eventGovernor:cU,generationGovernor:GU,matchUpFormatGovernor:Wm,mocksGovernor:Iw,participantGovernor:bw,policyGovernor:Mw,publishingGovernor:kw,queryGovernor:oP,reportGovernor:lP,scheduleGovernor:IP,scoreGovernor:jD,tournamentGovernor:GD,utilitiesGovernor:HD,venueGovernor:ub};function lb(e){var t,r,n=e||{},i=n.mutationStatus,s=n.tournamentId,l=n.directives,c=n.timeStamp,d=Un().topics;try{for(var p=a(u([],o(d),!1).sort(pb)),v=p.next();!v.done;v=p.next()){var f=v.value,m=gn({topic:f});m&&Sn({topic:f,notices:m})}}catch(e){t={error:e}}finally{try{v&&!v.done&&(r=p.return)&&r.call(p)}finally{if(t)throw t.error}}i&&c&&d.includes(Ud)&&Sn({notices:[{tournamentId:s,directives:l,timeStamp:c}],topic:Ud})}function cb(e){return n(this,void 0,void 0,(function(){var t,r,n,s,l,c,d,p,v,f,m,h,g;return i(this,(function(i){switch(i.label){case 0:r=(t=e||{}).mutationStatus,n=t.tournamentId,s=t.directives,l=t.timeStamp,c=Un().topics,i.label=1;case 1:i.trys.push([1,6,7,8]),d=a(u([],o(c),!1).sort(pb)),p=d.next(),i.label=2;case 2:return p.done?[3,5]:(v=p.value,(f=gn({topic:v}))?[4,Sn({topic:v,notices:f})]:[3,4]);case 3:i.sent(),i.label=4;case 4:return p=d.next(),[3,2];case 5:return[3,8];case 6:return m=i.sent(),h={error:m},[3,8];case 7:try{p&&!p.done&&(g=d.return)&&g.call(d)}finally{if(h)throw h.error}return[7];case 8:return r&&l&&c.includes(Ud)&&Sn({notices:[{tournamentId:n,directives:s,timeStamp:l}],topic:Ud}),[2]}}))}))}var db=((ob={})[Dd]=5,ob[Pd]=5,ob[bd]=5,ob[gd]=5,ob[hd]=5,ob[dd]=5,ob[pd]=5,ob[vd]=5,ob[fd]=1,ob[Nd]=1,ob[md]=5,ob[yd]=5,ob[cd]=4,ob[ud]=4,ob[sd]=4,ob[ld]=4,ob[rd]=3,ob[td]=2,ob);function pb(e,t){return(db[t]||0)-(db[e]||0)}var vb=So.FACTORY;function fb(e){var r=e.timeStamp,n=Pn(),i=fn();return i&&Object.values(n).forEach((function(e){!function(e){var r=e.tournamentRecord,n=e.value,i=Vn({element:r,name:vb}).extension;jn({element:r,extension:{name:vb,value:t(t({},null==i?void 0:i.value),n)}})}({tournamentRecord:e,value:{version:"2.0.0-beta.6",timeStamp:r}})})),i}function mb(e){var t,r,n=e.engineType,i=e.methodName,a=e.elapsed,o=e.params,u=e.result,s=on();if("object"==typeof s){var l={method:i},c=(null==u?void 0:u.error)&&(!0===s.errors||Array.isArray(s.errors)&&s.errors.includes(i)),d=Array.isArray(s.params)&&(null===(t=s.params)||void 0===t?void 0:t.includes(i)),p=s.params&&!Array.isArray(s.params)||d,v=Array.isArray(s.exclude)&&s.exclude.includes(i);!v&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&a>=s.perf&&(l.elapsed=a),v||!c&&!p||(l.params=o),!v&&(c||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||d)||Array.isArray(s.result)&&(null===(r=s.result)||void 0===r?void 0:r.includes(i)))&&(l.result=u),Object.keys(l).length>1&&En(n,l)}}function hb(e){var t=e.methodName,r=e.params,n=e.start,i={error:Yr,methodName:t};return mb({result:i,methodName:t,elapsed:n?Date.now()-n:0,params:r,engineType:"sync"}),i}function gb(e,r,n,i,a){var o;delete e.success,delete e.error;var u=Date.now(),s=wn();if(n&&(n.activeTournamentId=s),(null==n?void 0:n.sandboxTournament)&&!(null==n?void 0:n.sandboxTournament.tournamentId))return{error:xr};var l=(null==n?void 0:n.sandboxTournament)||Tn(s),c=(null==n?void 0:n.sandboxTournament)?((o={})[null==n?void 0:n.sandboxTournament.tournamentId]=n.sandboxTournament,o):Pn(),d=n?Ui(n,void 0,!0):void 0,p=n?function(e,t){var r,n;if(!1===t._middleware)return t;if(t.tournamentId&&!e[t.tournamentId])return{error:W};var i=t.drawId||(null===(r=t.matchUp)||void 0===r?void 0:r.drawId);if(i){var a=Ld({tournamentRecords:e,drawId:i}),o=a.event,u=a.drawDefinition,s=a.tournamentId;u&&(t.drawDefinition=u),s&&(t.tournamentId=s),o&&(t.event=o)}if(t.eventId&&!t.event){var l=Ld({eventId:t.eventId,tournamentRecords:e}),c=l.event,d=l.tournamentId;if(!c)return{error:Ee};t.tournamentId=d,t.event=c}var p=null!==(n=t.tournamentId)&&void 0!==n?n:wn();if(!p&&t)return t;var v=e[p];return p&&!v?{error:W}:v?(t.tournamentRecord=v,t):t}(c,n):void 0;if(null==p?void 0:p.error)return p;var v=function(e){var r=e.tournamentRecords,n=e.tournamentRecord,i=e.params,a=e.methodName,o=e.method;if(on())return o(t({tournamentRecords:r,tournamentRecord:n},i));try{return o(t({tournamentRecords:r,tournamentRecord:n},i))}catch(e){return An({engineName:"engine",methodName:a,params:i,err:e})}}({params:p,tournamentRecords:c,tournamentRecord:l,methodName:i,method:r});return mb({result:v,methodName:i,elapsed:Date.now()-u,params:d,engineType:a}),v}function Ib(e,t){return void 0===t&&(t=!0),"object"!=typeof e||Array.isArray(e)?{error:Ar}:(null==e?void 0:e.tournamentId)?Dn(t?Ui(e):e):{error:xr}}function yb(e,t){var r;if(void 0===t&&(t=!0),"object"!=typeof e)return{error:Ar};if(Nn(),Array.isArray(e)){if(!(e.filter((function(e){return null==e?void 0:e.tournamentId})).length===e.length))return{error:G};e=Object.assign.apply(Object,u([{}],o(e.map((function(e){var t;return(t={})[e.tournamentId]=e,t}))),!1))}else if(null==e?void 0:e.tournamentId)(r={})[e.tournamentId]=e,Nn((e=r).tournamentId);else{if(!Object.keys(e).every((function(t){return e[t].tournamentId===t})))return{error:G}}return bn(t?Ui(e):e)}function Ub(e,a){var o;return n(this,void 0,void 0,(function(){var n,u,s,l,c,d,p,v,f,m,h,g,I;return i(this,(function(i){switch(i.label){case 0:return Di(a)?(n=Object.values(a).filter(Ti).length)>1?[2,{message:"there must be only one arg with typeof function",error:xr}]:(u=n?Object.keys(a).find((function(e){return Ti(a[e])})):Pi(a.method)&&a.method)?(c=(s=a)[l=u],d=r(s,["symbol"==typeof l?l:l+""]),p=(null==a?void 0:a.params)||t({},d),v=p.rollbackOnError&&Ui(Pn(),!1,!0),(f=c||e[u]||en()[u])?[4,gb(e,f,p,u,"async")]:[2,hb({methodName:u,params:p})]):[2,{error:Yr}]:[2,{error:xr,message:"args must be an object"}];case 1:return(null==(m=null!==(o=i.sent())&&void 0!==o?o:{})?void 0:m.error)&&v&&yb(v),h=Date.now(),g=fb({timeStamp:h}),(I=(null==m?void 0:m.success)&&!0!==(null==p?void 0:p.delayNotify)&&!0!==(null==p?void 0:p.doNotNotify))?[4,cb({directives:[{method:f,params:p}],mutationStatus:g,timeStamp:h})]:[3,3];case 2:i.sent(),i.label=3;case 3:return(I||!(null==m?void 0:m.success)||(null==p?void 0:p.doNotNotify))&&yn(),[2,m]}}))}))}function Sb(e,t){return(null==t?void 0:t.error)?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0),e}function wb(e,r){e.importMethods=function(n){return function(e,r,n){return Di(n)?(vn(n),Object.keys(n).filter((function(e){return Ti(n[e])})).forEach((function(i){e[i]=function(a){var o=function(){var o;return r(e,t(((o={})[i]=n[i],o),a))};if(on())return o();try{return o()}catch(e){An({engineName:"engine",methodName:i,params:a,err:e})}}})),t(t({},L),e)):{error:xr}}(e,r,n)},e.getTournament=function(e){return function(e){var t,r=null!=e?e:{},n=r.convertExtensions,i=void 0!==n&&n,a=r.removeExtensions,o=void 0!==a&&a,u=null!==(t=null==e?void 0:e.tournamentId)&&void 0!==t?t:wn();return"string"!=typeof u?{}:{tournamentRecord:Ui(Tn(u),i,!1,o)}}(e)},e.getState=function(e){return function(e){var t=e.convertExtensions,r=e.removeExtensions,n=Pn();return{tournamentId:wn(),tournamentRecords:Ui(n,t,!1,r)}}({convertExtensions:null==e?void 0:e.convertExtensions,removeExtensions:null==e?void 0:e.removeExtensions})},e.version=function(){return"2.0.0-beta.6"},e.reset=function(){return bn({}),Sb(e)},e.devContext=function(t){return sn(t),Sb(e)},e.getDevContext=function(e){return on(e)},e.newTournamentRecord=function(e){void 0===e&&(e={});var r=AS(e),n=r.tournamentId;return r.error?r:(Ib(r),Nn(n),t(t({},L),{tournamentId:n}))},e.setState=function(t,r,n){dn(r,n);var i=yb(t,r);return Sb(e,i)},e.setTournamentId=function(e){return Nn(e)},e.getTournamentId=function(){return wn()},e.setTournamentRecord=function(t,r,n){dn(r,n);var i=Ib(t,r);return Sb(e,i)},e.removeTournamentRecord=function(t){var r=Mn(t);return Sb(e,r)},e.removeUnlinkedTournamentRecords=function(){var t=function(){var e,t=Pn(),r=Vn({name:so,tournamentRecords:t,discover:!0}).extension,n=(null===(e=null==r?void 0:r.value)||void 0===e?void 0:e.tournamentIds)||[];return Object.keys(t).forEach((function(e){n.includes(e)||delete t[e]})),bn(t)}();return Sb(e,t)}}function Tb(e,n){if(!Di(n))return{error:xr,message:"args must be an object"};var i=Object.values(n).filter(Ti).length;if(i>1)return{message:"there must be only one arg with typeof function",error:xr};var a=i?Object.keys(n).find((function(e){return Ti(n[e])})):Pi(n.method)&&n.method;if(!a)return{error:Yr};var o=n,u=a,s=o[u],l=r(o,["symbol"==typeof u?u:u+""]),c=(null==n?void 0:n.params)||t({},l),d=s||e[a]||en()[a];return d?gb(e,d,c,a,"ask"):hb({methodName:a,params:c})}var Pb=function(){var e={execute:function(t){return Tb(e,t)}};return wb(e,Tb),e}();function Db(e,n){var i;if(!Di(n))return{error:xr,message:"args must be an object"};var a=Object.values(n).filter(Ti).length;if(a>1)return{message:"there must be only one arg with typeof function",error:xr};var o=a?Object.keys(n).find((function(e){return Ti(n[e])})):Pi(n.method)&&n.method;if(!o)return{error:Yr};var u=n,s=o,l=u[s],c=r(u,["symbol"==typeof s?s:s+""]),d=(null==n?void 0:n.params)||t({},c),p=d.rollbackOnError&&Ui(Pn(),!1,!0),v=l||e[o]||en()[o];if(!v)return hb({methodName:o,params:d});var f=null!==(i=gb(e,v,d,o,"sync"))&&void 0!==i?i:{};(null==f?void 0:f.error)&&p&&yb(p);var m=Date.now(),h=fb({timeStamp:m}),g=(null==f?void 0:f.success)&&!0!==(null==d?void 0:d.delayNotify)&&!0!==(null==d?void 0:d.doNotNotify);return g&&lb({directives:[{method:v,params:d}],mutationStatus:h,timeStamp:m}),(g||!(null==f?void 0:f.success)||(null==d?void 0:d.doNotNotify))&&yn(),f}var bb=function(){var e={executionQueue:function(r,n){return function(e,r,n){var i,o,u,s;if(!Array.isArray(r))return{error:xr,message:"directives must be an array"};var l=hn(),c=Date.now(),d=n&&Ui(Pn(),!1,!0),p=[];try{for(var v=a(r),f=v.next();!f.done;f=v.next()){var m=f.value;if("object"!=typeof m)return{error:xr,message:"directive must be an object"};var h=m.method,g=m.params,I=void 0===g?{}:g,y=m.pipe;if(!l[h])return hb({methodName:h,start:c,params:I});if(y){var U=p[p.length-1],S=Object.keys(y);try{for(var w=(u=void 0,a(S)),T=w.next();!T.done;T=w.next()){var P=T.value;U[P]&&(I[P]=U[P])}}catch(e){u={error:e}}finally{try{T&&!T.done&&(s=w.return)&&s.call(w)}finally{if(u)throw u.error}}}var D=gb(e,l[h],I,h,"sync");if(null==D?void 0:D.error)return d&&yb(d),t(t({},D),{rolledBack:!!d});p.push(t(t({},D),{methodName:h}))}}catch(e){i={error:e}}finally{try{f&&!f.done&&(o=v.return)&&o.call(v)}finally{if(i)throw i.error}}var b=Date.now();return lb({directives:r,mutationStatus:fb({timeStamp:b}),timeStamp:b}),yn(),{success:p.every((function(e){return e.success})),results:p}}(e,r,n)},execute:function(t){return Db(e,t)}};return wb(e,Db),e}(),Nb=t(t(t(t(t(t(t(t(t(t(t(t({},Po),bw),kw),GU),GD),IP),Mw),lP),cU),oP),jD),ub);bb.importMethods(Nb);var Mb,Rb=bb,Ab=bb,Eb={};function Cb(e,t){var r,n,i,o;if(void 0===t&&(t=!0),!e)return{error:pt};if("object"!=typeof e)return{error:Ar};if(e.matchUpId)Mb=e.matchUpId,Eb[Mb]=t?Ui(e):e;else if(Array.isArray(e))try{for(var u=a(e.reverse()),s=u.next();!s.done;s=u.next()){(d=s.value).matchUpId&&(Eb[d.matchUpId]=t?Ui(d):d,Mb||(Mb=d.matchUpId))}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=u.return)&&n.call(u)}finally{if(r)throw r.error}}else try{for(var l=a(Object.values(e)),c=l.next();!c.done;c=l.next()){var d;(d=c.value).matchUpId&&(Eb[d.matchUpId]=t?Ui(d):d,Mb||(Mb=d.matchUpId))}}catch(e){i={error:e}}finally{try{c&&!c.done&&(o=l.return)&&o.call(l)}finally{if(i)throw i.error}}return t?Ui(e):e}var xb=function(){var e={getState:function(e){return function(e){return Ui(Eb[Mb],null==e?void 0:e.convertExtensions,!1,null==e?void 0:e.removeExtensions)}(e)},version:function(){return"2.0.0-beta.6"},reset:function(){return Mb=void 0,Eb={},t({},L)},drawId:void 0,error:void 0,success:!1,devContext:function(t){return sn(t),e},setState:function(t,r,n){return dn(r,n),function(t){(null==t?void 0:t.error)?(e.error=t.error,e.success=!1):(e.error=void 0,e.success=!0,e.drawId=t.drawId);return e}(Cb(t))}};return function(t){t.forEach((function(t){Object.keys(t).forEach((function(n){e[n]=function(e){if(on())return r({params:e,governor:t,methodName:n});try{return r({params:e,governor:t,methodName:n})}catch(t){An({engineName:"matchUpEngine",methodName:n,params:e,err:t})}}}))}))}([jD]),e;function r(r){var n=r.params,i=r.governor,a=r.methodName;e.error=void 0,e.success=!1;var o=(null==n?void 0:n.matchUp)||Eb[Mb],u=(null==n?void 0:n.matchUps)||Object.values(Eb),s=(null==n?void 0:n.rollbackOnError)&&Ui(o,!1,!0);n=t(t({},n),{matchUpId:null==o?void 0:o.matchUpId,matchUps:u,matchUp:o});var l=i[a](n);if(null==l?void 0:l.error)return s&&Cb(s),t(t({},l),{rolledBack:!!s});var c=(null==l?void 0:l.success)&&!0!==(null==n?void 0:n.delayNotify)&&!0!==(null==n?void 0:n.doNotNotify);return c&&lb(),(c||!(null==l?void 0:l.success)||(null==n?void 0:n.doNotNotify))&&yn(),l}}(),Ob=!1,Fb=function(){var e={version:function(){return"2.0.0-beta.6"},setDeepCopy:function(t,r){return dn(t,r),e},devContext:function(t){return sn(t),Ob=!0,e}};return function(r){r.forEach((function(r){Object.keys(r).forEach((function(n){e[n]=function(e){try{var i=function(e,r){var n=e(t({},r));(null==n?void 0:n.error)||lb();yn(),Ob&&(sn(!1),Ob=!1);return n}(r[n],e);return!(null==i?void 0:i.error)&&(null==e?void 0:e.setState)&&(null==i?void 0:i.tournamentRecord)&&yb(i.tournamentRecord),i}catch(t){var a=void 0;"string"==typeof t?a=t.toUpperCase():t instanceof Error&&(a=t.message),console.log("ERROR",{params:JSON.stringify(e),method:n,error:a})}}}))}))}([Iw]),e}();function kb(e,t){return e&&t&&Array.isArray(t)&&t[e-1]||"object"==typeof t&&t[e]}function _b(e){var t=e.participation,r=void 0===t?{}:t,n=e.awardProfiles,i=e.startDate,a=e.eventType,o=e.drawSize,u=e.drawType,s=e.category,l=e.endDate,c=e.level,d=r.participationOrder,p=r.flightNumber,v=r.rankingStage,f=n.find((function(e){var t,r,n,f,m,h,g,I,y,U;return function(e){return!i&&!l||!e.dateRanges||e.dateRanges.some((function(e){var t=!i||!e.startDate||new Date(i)>new Date(e.startDate),r=!l||!e.endDate||new Date(l)<=new Date(e.endDate);return t&&r}))}(e)&&(!e.maxFlightNumber||p<=e.maxFlightNumber)&&(!(null===(t=e.drawTypes)||void 0===t?void 0:t.length)||(null===(r=e.drawTypes)||void 0===r?void 0:r.includes(u)))&&(!(null===(n=e.drawSizes)||void 0===n?void 0:n.length)||e.drawSizes.includes(o))&&(!(null===(f=e.stages)||void 0===f?void 0:f.length)||e.stages.includes(v))&&(!(null===(m=e.levels)||void 0===m?void 0:m.length)||e.levels.includes(c))&&(!e.maxDrawSize||o<=e.maxDrawSize)&&(!e.drawSize||e.drawSize===o)&&(!e.maxLevel||c<=e.maxLevel)&&(!p||!(null===(g=null===(h=e.flights)||void 0===h?void 0:h.flightNumbers)||void 0===g?void 0:g.length)||e.flights.flightNumbers.includes(p))&&(!e.participationOrder||e.participationOrder===d)&&(!(null===(I=e.category)||void 0===I?void 0:I.ageCategoryCodes)||e.category.ageCategoryCodes.includes(null==s?void 0:s.ageCategoryCode))&&(!(null===(y=e.eventTypes)||void 0===y?void 0:y.length)||(null===(U=e.eventTypes)||void 0===U?void 0:U.includes(a)))}));return{awardProfile:f}}function Lb(e){var t,r,n,i,a,o,u=e.participantWon,s=e.flightNumber,l=e.valueObj,c=e.drawSize,d=e.flights,p=e.level,v=function(e,t){var r=(null==e?void 0:e.value)||(null==e?void 0:e.v)||(I(e)?e:0),n=kb(p,null==e?void 0:e.level),i=function(e,t){if(e){if(Array.isArray(t)){var r=t.find((function(t){return t.flight===e||t.f===e}));return r.value||r.v}if("object"==typeof t){var n=t.flights||t.f;if(Array.isArray(n))return n[e-1]}}}(t,n);return{value:i||I(n)&&n||r}},f=0,m=(u?"won":!1===u&&"lost")||void 0;if(Array.isArray(l)){var h=l.find((function(e){var t;return e.drawSize===c||(null===(t=e.drawSizes)||void 0===t?void 0:t.includes(c))})),g=l.find((function(e){return e.drawSize&&e.threshold&&c>e.drawSize})),y=l.find((function(e){var t;return!e.drawSize&&!(null===(t=e.drawSizes)||void 0===t?void 0:t.length)}));void 0!==m&&(h=null==h?void 0:h[m],g=null==g?void 0:g[m],y=null==y?void 0:y[m]),i=v(h,s).value,a=v(g,s).value,o=v(y,s).value,f=i||a||o,n=i&&h.requireWin||a&&g.requireWin||(null==y?void 0:y.requireWin)}else if("object"==typeof l){h=null===(t=null==l?void 0:l.drawSizes)||void 0===t?void 0:t[c],y=l;void 0!==m&&(h=null==h?void 0:h[m],y=null==y?void 0:y[m]),i=v(h,s).value,o=v(y,s).value,f=i||o,n=i?h.requireWin:null==y?void 0:y.requireWin}else I(l)&&void 0===m&&(f=l);return s&&(null===(r=null==d?void 0:d.pct)||void 0===r?void 0:r[s])&&(f=Math.round(f*d.pct[s])),{awardPoints:f,requireWin:n}}var jb={getTournamentPoints:function(e){var r,n,i,s,l=e.participantFilters,c=e.policyDefinitions,d=e.tournamentRecord,p=e.saveRankings,v=e.level;if(!d)return{error:W};var f=rl({policyTypes:[xa],tournamentRecord:d}).policyDefinitions,m=null!==(i=null==c?void 0:c[xa])&&void 0!==i?i:null==f?void 0:f[xa];if(!m)return{error:nt};var h=m.awardProfiles,g=m.requireWinFirstRound,I=m.requireWinForPoints,y=Rv({withRankingProfile:!0,participantFilters:l,tournamentRecord:d}),S=y.participants,w=y.derivedEventInfo,T=y.derivedDrawInfo,P=y.mappedMatchUps,D=null==S?void 0:S.filter((function(e){var t;return null===(t=e.draws)||void 0===t?void 0:t.length})),b={},N={},M={},R=function(e){var t,r,n,i,l=e.participantType,c=e.participantId,p=e.person,f=e.draws;try{for(var m=(t=void 0,a(f)),y=m.next();!y.done;y=m.next()){var S=y.value,D=S.drawId,R=S.structureParticipation,A=S.eventId,E=w[A],C=T[D],x=null==C?void 0:C.drawType,O=E||{},F=O.category,k=O.eventType,_=S.startDate||E.startDate||d.startDate,L=S.endDate||E.endDate||d.endDate;if(k!==Ia||c===vs){var j=void 0;if(h){var B=I,V=0,G=0,q=0,W=void 0,H=function(t){var r,n,i,d,p,f,m=t.finishingPositionRange,I=t.participationOrder,y=t.participantWon,S=t.flightNumber,w=t.rankingStage,T=t.winCount;V+=T||0;var D=null==C?void 0:C.drawSize,b=_b({awardProfiles:h,participation:t,eventType:k,startDate:_,category:F,drawSize:D,drawType:x,endDate:L,level:v}).awardProfile;if(b){if(!D)return"continue";var N=Array.isArray(m)&&Math.max.apply(Math,u([],o(m),!1)),M=U(m||[]).join("-"),R=N&&w!==au&&(null==m?void 0:m.includes(D));void 0!==b.requireWinForPoints&&(B=b.requireWinForPoints),void 0!==b.requireWinFirstRound&&(g=b.requireWinFirstRound);var A,E=b.finishingPositionPoints,O=void 0===E?{}:E,H=b.finishingPositionRanges,z=b.finishingRound,Y=b.pointsPerWin,K=b.flights,J=Array.isArray(b.perWinPoints)?null===(s=b.perWinPoints)||void 0===s?void 0:s.find((function(e){var t;return null===(t=e.participationOrders)||void 0===t?void 0:t.includes(I)})):b.perWinPoints,Z=O.participationOrders,X=0,Q=void 0;if((!Z||Z.includes(I))&&H&&N)(A=H[N])&&(X=(r=Lb({flightNumber:S,valueObj:A,drawSize:D,flights:K,level:v})).awardPoints,Q=r.requireWin);if(!X&&z&&1===I&&N)(A=z[N])&&(X=(n=Lb({participantWon:y,flightNumber:S,valueObj:A,drawSize:D,flights:K,level:v})).awardPoints,Q=n.requireWin);if(R&&void 0!==g&&(B=g),void 0!==Q&&(B=Q),X>G&&(!B||T)&&(G=X,W=N),!X&&Y&&T&&(q+=T*Y,W=M),!X&&T&&J){var $=kb(v,null==J?void 0:J.level);$?q+=T*$:J.value&&(q+=T*J.value)}}if(j=G+q,l===vs){var ee=(e.matchUps||[]).filter((function(e){return e.structureId===t.structureId}));try{for(var te=(i=void 0,a(ee)),re=te.next();!re.done;re=te.next()){var ne=re.value.matchUpId,ie=P[ne],ae=ie.sides.find((function(e){return e.participantId===c})).sideNumber;if(ie.winningSice===ae)try{for(var oe=(p=void 0,a(ie.tieMatchUps)),ue=oe.next();!ue.done;ue=oe.next()){ue.value.winningSide}}catch(e){p={error:e}}finally{try{ue&&!ue.done&&(f=oe.return)&&f.call(oe)}finally{if(p)throw p.error}}}}catch(e){i={error:e}}finally{try{re&&!re.done&&(d=te.return)&&d.call(te)}finally{if(i)throw i.error}}}};try{for(var z=(n=void 0,a(R)),Y=z.next();!Y.done;Y=z.next()){H(Y.value)}}catch(e){n={error:e}}finally{try{Y&&!Y.done&&(i=z.return)&&i.call(z)}finally{if(n)throw n.error}}if(q||G){var K={winCount:V,positionPoints:G,rangeAccessor:W,perWinPoints:q,eventType:k,drawId:D,points:j},J=null==p?void 0:p.personId;J?(b[J]||(b[J]=[]),b[J].push(K)):l===hs?(M[c]||(M[c]=[]),M[c].push(K)):l===vs&&(N[c]||(N[c]=[]),N[c].push(K))}}}}}catch(e){t={error:e}}finally{try{y&&!y.done&&(r=m.return)&&r.call(m)}finally{if(t)throw t.error}}};try{for(var A=a(null!=D?D:[]),E=A.next();!E.done;E=A.next()){R(E.value)}}catch(e){r={error:e}}finally{try{E&&!E.done&&(n=A.return)&&n.call(A)}finally{if(r)throw r.error}}return p&&jn({element:d,extension:{name:vo,value:{personPoints:b,teamPoints:N,pairPoints:M}}}),t({participantsWithOutcomes:D,personPoints:b,pairPoints:M,teamPoints:N},L)}};var Bb={nSpread:400,diffThreshold:.125,kCalc:function(e){return 250/Math.pow(e+5,.4)},kMultiplier:function(e,t){void 0===e&&(e=3),void 0===t&&(t=2);var r=e/t;return isNaN(r)?Bb.kDefault():r},kDefault:function(){return 1}};function Vb(e){var t=e.winnerRating,r=e.loserRating,n=e.ratingRange,i=e||{},a=i.ratings,s=void 0===a?KI:a,l=i.winnerCountables,c=void 0===l?1:l,d=i.loserCountables,p=void 0===d?0:d,v=i.ratingType,f=void 0===v?WI:v,m=i.maxCountables,h=i.countables,g=null==s?void 0:s[f];if(!g)return{error:pt};n=g.range||n,t=t||g.defaultInitialization,r=r||g.defaultInitialization;var I=n[0]>n[1],y=g.decimalsCount||0,U=I?n.slice().reverse():n,S=function(e,t){return parseFloat(t)>=Math.min.apply(Math,u([],o(e),!1))&&parseFloat(t)<=Math.max.apply(Math,u([],o(e),!1))};S(n,t)&&S(n,r)||(S(n,t)||(t=g.defaultInitialization),S(n,r)||(r=g.defaultInitialization));var w=function(e){var t=e.value,r=e.sourceRange,n=e.targetRange;return(t-r[0])*(n[1]-n[0])/(r[1]-r[0])+n[0]},T=w({targetRange:KI[WI].range,sourceRange:U,value:I?n[0]-t:t}),P=w({targetRange:KI[WI].range,sourceRange:U,value:I?n[0]-r:r}),D=function(e,t){return 1/(1+Math.pow(10,(t-e)/Bb.nSpread))},b=D(T,P),N=D(P,T),M=Bb.kCalc(c),R=Bb.kCalc(p),A=Bb.kMultiplier(m,h),E=T+A*M*(1-b),C=P+A*R*(0-N),x=w({sourceRange:KI[WI].range,value:E,targetRange:U}),O=w({sourceRange:KI[WI].range,value:C,targetRange:U}),F=I?n[0]-x:x,k=parseFloat(parseFloat(F).toFixed(y)),_=I?n[0]-O:O,L=parseFloat(parseFloat(_).toFixed(y)),j=Math.max.apply(Math,u([],o(n),!1))?Math.abs(t-r)/Math.max.apply(Math,u([],o(n),!1)):0;return(x>O&&j>Bb.diffThreshold||k<0||L<0)&&(k=t,L=r),{newWinnerRating:k,newLoserRating:L}}var Gb={calculateNewRatings:Vb,generateDynamicRatings:function(e){var r,n,i,s,l,c=e.removePriorValues,d=void 0===c||c,p=e.tournamentRecord,v=e.ratingType,f=void 0===v?WI:v,m=e.considerGames,h=e.matchUpIds,g=e.asDynamic;if(!p)return{error:W};if(!Array.isArray(h))return{error:$e};if("string"!=typeof f)return{error:xr,ratingType:f};if(!KI[f])return{error:xr};var I=KI[f].accessor,y={},U=null!==(i=Kp({matchUpFilters:{matchUpIds:h,matchUpStatuses:eu},tournamentRecord:p,inContext:!0}).matchUps)&&void 0!==i?i:[];U.sort(Zp);var S=function(e){var r,n,i,c,v,h,U,S=e.endDate,w=e.matchUpFormat,T=e.score,P=e.sides,D=e.winningSide,b=e.matchUpType,N={eventType:b,scaleName:f,scaleType:wa},M="".concat(f,".").concat(Ua),R={scaleName:M,eventType:b,scaleType:wa},A=Object.assign.apply(Object,u([{}],o((null!=P?P:[]).map((function(e){var t,r,n=e.sideNumber,i=e.participant;return n&&((t={})[n]=u([null==i?void 0:i.participantId],o(null!==(r=null==i?void 0:i.individualParticipantIds)&&void 0!==r?r:[]),!1).filter(Boolean).flat(),t)}))),!1)),E=g?M:f,C=Object.assign.apply(Object,u([{}],o(Object.values(A).flat().map((function(e){var t,r,n,i=dy({scaleAttributes:R,tournamentRecord:p,participantId:e}).scaleItem,a=dy({tournamentRecord:p,scaleAttributes:N,participantId:e}).scaleItem,o=I?((t={})[I]=void 0,t):void 0;return e&&((r={})[e]=null!==(n=null!=i?i:a)&&void 0!==n?n:{scaleName:E,eventType:b,scaleDate:S,scaleType:wa,scaleValue:o},r)}))),!1)),x=w?Zd(w):{},O=(null==x?void 0:x.bestOf)||1,F=(null==x?void 0:x.setsTo)||1,k=m?O&F:O,_=(null==T?void 0:T.sets)&&((null==(U=T.sets)?void 0:U.reduce((function(e,t){return t.winningSide&&(e[t.winningSide-1]+=1),e}),[0,0]))||[0,0])||1===D&&[1,0]||[0,1],L=D?A[D]:[],j=D?A[3-D]:[];try{for(var B=(r=void 0,a(L)),V=B.next();!V.done;V=B.next()){var G=V.value,q=null===(s=C[G])||void 0===s?void 0:s.scaleValue,W="object"==typeof q?q[I]:q;try{for(var H=(i=void 0,a(j)),z=H.next();!z.done;z=H.next()){var Y=z.value,K=null===(l=C[Y])||void 0===l?void 0:l.scaleValue,J="object"==typeof K?K[I]:K,Z=Vb({winnerCountables:D?_[D]:[0,0],loserCountables:D?_[3-D]:[0,0],maxCountables:k,winnerRating:W,loserRating:J,ratingType:f}),X=Z.newWinnerRating,Q=Z.newLoserRating,$=I?t(t({},q),((v={})[I]=X,v)):X,ee=I?t(t({},K),((h={})[I]=Q,h)):Q;C[G].scaleValue=$,C[Y].scaleValue=ee;var te=JS({participantId:G,removePriorValues:d,tournamentRecord:p,scaleItem:t(t({},C[G]),{scaleName:E})});if(te.error)return{value:te};if((te=JS({participantId:Y,removePriorValues:d,tournamentRecord:p,scaleItem:t(t({},C[Y]),{scaleName:E})})).error)return{value:te}}}catch(e){i={error:e}}finally{try{z&&!z.done&&(c=H.return)&&c.call(H)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{V&&!V.done&&(n=B.return)&&n.call(B)}finally{if(r)throw r.error}}Object.assign(y,C)};try{for(var w=a(U),T=w.next();!T.done;T=w.next()){var P=S(T.value);if("object"==typeof P)return P.value}}catch(e){r={error:e}}finally{try{T&&!T.done&&(n=w.return)&&n.call(w)}finally{if(r)throw r.error}}var D=U.map((function(e){return e.matchUpId}));return t(t({},L),{modifiedScaleValues:y,processedMatchUpIds:D})}},qb=t(t({},jb),Gb);bb.importMethods(qb);var Wb,Hb,zb,Yb,Kb,Jb,Zb,Xb,Qb,$b,eN=bb,tN=((Wb={})[La]={roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]},Wb),rN=((Hb={})[Ea]={policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[gT,fT]},Hb),nN=((zb={})[Ea]={policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[gT,hT,IT],disabledActions:[]}]},zb),iN=((Yb={})[Ea]={policyName:"positionActionsDisabled",enabledStructures:!1},Yb),aN=((Kb={})[Fa]={policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}},Kb),oN=((Jb={})[ja]={defaultMatchUpFormat:Fh,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:(Zb={},Zb[iu]={stageSequence:{1:{requireAllPositionsAssigned:!0}}},Zb)},Jb),uN=((Xb={})[ja]={requireAllPositionsAssigned:!1,stage:(Qb={},Qb[iu]={stageSequence:{1:{requireAllPositionsAssigned:!0}}},Qb),defaultMatchUpFormat:Fh,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Fh,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]},Xb),sN=(($b={})[Ba]={seedingProfile:{positioning:mu},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]},$b),lN={ratingsParameters:KI,matchUpFormats:_h,countryToFlag:Ss,tieFormats:rU,countries:ws,policies:{POLICY_AVOIDANCE_COUNTRY:tN,POLICY_POSITION_ACTIONS_DEFAULT:PT,POLICY_POSITION_ACTIONS_DISABLED:iN,POLICY_POSITION_ACTIONS_NO_MOVEMENT:nN,POLICY_POSITION_ACTIONS_UNRESTRICTED:rN,POLICY_PRIVACY_DEFAULT:aN,POLICY_ROUND_NAMING_DEFAULT:ap,POLICY_SCHEDULING_DEFAULT:Vw,POLICY_SCORING_DEFAULT:oN,POLICY_SCORING_USTA:uN,POLICY_SEEDING_ITF:sN,POLICY_SEEDING_DEFAULT:DU},flagIOC:function(e){var t=Object.assign.apply(Object,u([{}],o(ws.filter((function(e){return e.ioc})).map((function(e){var t;return(t={})[e.ioc]=e.iso,t}))),!1));return Ss(t[e])}},cN={COACHING:"Coaching",BALL_ABUSE:"Ball Abuse",RACKET_ABUSE:"Racket Abuse",VERBAL_ABUSE:"Verbal Abuse",PHYSICAL_ABUSE:"Physical Abuse",INELIGIBILITY:"INELIGIBILITY",UNSPORTSMANLIKE_CONDUCT:"Unsportmanlike Conduct",PROHIBITED_SUBSTANCE:"PROHIBITED_SUBSTANCE",DRESS_CODE_VIOLATION:"Dress Code Violation",EQUIMENT_VIOLATION:"Equipment Violation",LEAVING_THE_COURT:"Leaving the court",REFUSAL_TO_PLAY:"REFUSAL_TO_PLAY",FAILURE_TO_COMPLETE:"Failure to complete",NO_SHOW:"No Show",OTHER:"Other",PUNCTUALITY:"Puncuality",FAILUIRE_TO_SIGN_IN:"Failure to sign in"},dN={CLAY:"CLAY",HARD:"HARD",GRASS:"GRASS",CARPET:"CARPET",ARTIFICIAL:"ARTIFICIAL"},pN={INDOOR:"INDOOR",OUTDOOR:"OUTDOOR"},vN={activeMatchUpStatuses:tu,auditConstants:Mf,completedMatchUpStatuses:eu,directingMatchUpStatuses:Qo,drawDefinitionConstants:rs,entryStatusConstants:jl,errorConditionConstants:Zr,eventConstants:ya,extensionConstants:So,flightConstants:RU,genderConstants:fp,keyValueConstants:MD,matchUpActionConstants:KT,matchUpStatusConstants:nu,matchUpTypes:ks,nonDirectingMatchUpStatuses:$o,participantConstants:ys,participantRoles:Wv,particicipantsRequiredMatchUpStatuses:Zo,participantTypes:Is,penaltyConstants:cN,policyConstants:qa,positionActionConstants:UT,ratingConstants:YI,recoveryTimeRequiredMatchUpStatuses:Jo,requestConstants:pS,resultConstants:j,scaleConstants:Da,scheduleConstants:Gc,sortingConstants:CU,surfaceConstants:dN,tieFormatConstants:Qy,timeItemConstants:Dc,topicConstants:Md,tournamentConstants:BD,upcomingMatchUpStatuses:ru,validMatchUpStatuses:Xo,venueConstants:pN};exports.askEngine=Pb,exports.asyncEngine=function(e){var r=an();if(r.error&&!e)return r;var o={executionQueue:function(e,r){return function(e,r,o){return n(this,void 0,void 0,(function(){var n,u,s,l,c,d,p,v,f,m,h,g,I,y,U,S,w,T,P,D,b,N,M;return i(this,(function(i){if(!Array.isArray(r))return[2,{error:xr,message:"directives must be an array"}];n=hn(),u=Date.now(),s=o&&Ui(Pn(),!1,!0),l=[];try{for(c=a(r),d=c.next();!d.done;d=c.next()){if("object"!=typeof(p=d.value))return[2,{error:xr,message:"directive must be an object"}];if(v=p.method,f=p.params,m=void 0===f?{}:f,h=p.pipe,!n[v])return[2,hb({methodName:v,start:u,params:m})];if(h){g=l[l.length-1],I=Object.keys(h);try{for(N=void 0,y=a(I),U=y.next();!U.done;U=y.next())S=U.value,g[S]&&(m[S]=g[S])}catch(e){N={error:e}}finally{try{U&&!U.done&&(M=y.return)&&M.call(y)}finally{if(N)throw N.error}}}if(null==(w=gb(e,n[v],m,v,"async"))?void 0:w.error)return s&&yb(s),[2,t(t({},w),{rolledBack:!!s})];l.push(t(t({},w),{methodName:v}))}}catch(e){D={error:e}}finally{try{d&&!d.done&&(b=c.return)&&b.call(c)}finally{if(D)throw D.error}}return T=Date.now(),P=fb({timeStamp:T}),cb({directives:r,mutationStatus:P,timeStamp:T}),yn(),[2,{success:l.every((function(e){return e.success})),results:l}]}))}))}(o,e,r)},execute:function(e){return Ub(o,e)}};return wb(o,Ub),o},exports.competitionEngine=Rb,exports.drawDefinitionConstants=rs,exports.entryStatusConstants=jl,exports.errorConditionConstants=Zr,exports.eventConstants=ya,exports.factoryConstants=vN,exports.fixtures=lN,exports.flightConstants=RU,exports.forge={},exports.genderConstants=fp,exports.globalState=Cn,exports.governors=sb,exports.keyValueConstants=MD,exports.matchUpActionConstants=KT,exports.matchUpEngine=xb,exports.matchUpFormatCode=Wm,exports.matchUpStatusConstants=nu,exports.matchUpTypes=ks,exports.mocksEngine=Fb,exports.participantConstants=ys,exports.participantRoles=Wv,exports.participantTypes=Is,exports.penaltyConstants=cN,exports.policyConstants=qa,exports.positionActionConstants=UT,exports.resultConstants=j,exports.scaleConstants=Da,exports.scaleEngine=eN,exports.surfaceConstants=dN,exports.syncEngine=bb,exports.timeItemConstants=Dc,exports.tournamentEngine=Ab,exports.utilities=zD,exports.venueConstants=pN,exports.version=e;
//# sourceMappingURL=tods-competition-factory.production.cjs.min.js.map
